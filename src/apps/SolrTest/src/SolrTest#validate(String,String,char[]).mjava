  private void validate(String req, String test, char[] resp) {
    if (test==null || test.length()==0) return;
    Document document=null;
    try {
      // the resp[] contains a declaration that it is UTF-8, so we
      // need to change it to that for the XML parser.

      document = builder.parse(new ByteArrayInputStream(new String(resp).getBytes("UTF-8")));
      // document = builder.parse(new String(resp));
    } catch (Exception e) {
      System.out.println("ERROR parsing '" + new String(resp) + "'");
      throw new RuntimeException(e);
    }

      String[] tests = test.split("%");
      for (String xp : tests) {
        Boolean bool=false;
        xp=xp.trim();
        try {
           bool = (Boolean) xpath.evaluate(xp, document, XPathConstants.BOOLEAN);
        } catch (Exception e) {
          System.out.println("##################ERROR EVALUATING XPATH '" + xp + "'");
          throw new RuntimeException(e);
        }
        if (!bool) {
          System.out.println("##################ERROR");
          System.out.println("req="+req);
          System.out.println("xp="+xp);
          throw new RuntimeException("test failed.");
        }
      }

  }

