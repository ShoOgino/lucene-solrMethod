  // add without checking
  protected synchronized int allowDups(AddUpdateCommand cmd) throws IOException {
    if (cmd.id==null) {
      cmd.id=getOptId(cmd.doc);
    }
    synchronized(this) {
      doAdd(cmd.doc);

      if (cmd.id != null) {
        Integer saveCount = pset.get(cmd.id);

        // if there weren't any docs marked for deletion before, then don't mark
        // any for deletion now.
        if (saveCount == null) return 1;

        // If there were docs marked for deletion, then increment the number of
        // docs to save at the end.

        // the following line is optional, but it saves an allocation in the common case.
        if (saveCount == ZERO) saveCount=ONE;
        else saveCount++;

        pset.put(cmd.id, saveCount);
      }
    }
    return 1;
  }

