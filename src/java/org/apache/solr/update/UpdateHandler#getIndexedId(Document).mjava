  protected final String getIndexedId(Document doc) {
    if (idField == null) throw new SolrException(400,"Operation requires schema to have a unique key field");
    // Right now, single valued fields that require value transformation from external to internal (indexed)
    // form have that transformation already performed and stored as the field value.
    // This means
    String id = idFieldType.storedToIndexed(doc.getField(idField.getName()));
    if (id == null) throw new SolrException(400,"Document is missing uniqueKey field " + idField.getName());
    return id;
  }

