  protected int addConditionally(AddUpdateCommand cmd) throws IOException {
    if (cmd.id==null) {
      cmd.id=getId(cmd.doc);
    }
    synchronized(this) {
      if (pset.contains(cmd.id)) return 0;
      // since case 001 is currently the only case to use pset, only add
      // to it in that instance.
      pset.add(cmd.id);
      overwrite(cmd.id,cmd.doc);
      return 1;
    }
  }

