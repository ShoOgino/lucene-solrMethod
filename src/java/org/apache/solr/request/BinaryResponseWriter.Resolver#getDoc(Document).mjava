    public SolrDocument getDoc(Document doc) {
      SolrDocument solrDoc = new SolrDocument();
      for (Fieldable f : (List<Fieldable>)doc.getFields()) {
        String fieldName = f.name();
        if (returnFields!=null && !returnFields.contains(fieldName)) continue;
        FieldType ft = schema.getFieldTypeNoEx(fieldName);
        Object val;
        if (ft==null) {  // handle fields not in the schema
          if (f.isBinary()) val = f.binaryValue();
          else val = f.stringValue();
        } else {
          try {
            val = useFieldObjects ? ft.toObject(f) : ft.toExternal(f);
          } catch (Exception e) {
            // There is a chance of the underlying field not really matching the
            // actual field type . So ,it can throw exception
            LOG.warn("Error reading a field from document : "+solrDoc, e);
            //if it happens log it and continue
            continue;
          }
        }
        solrDoc.addField(fieldName, val);
      }
      return solrDoc;
    }

