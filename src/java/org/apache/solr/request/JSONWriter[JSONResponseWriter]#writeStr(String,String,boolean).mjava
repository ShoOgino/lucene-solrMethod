  public void writeStr(String name, String val, boolean needsEscaping) throws IOException {
    writer.write('"');
    // it might be more efficient to use a stringbuilder or write substrings
    // if writing chars to the stream is slow.
    if (needsEscaping) {
      for (int i=0; i<val.length(); i++) {
        char ch = val.charAt(i);
        switch(ch) {
          case '"':
          case '\\':
            writer.write('\\');
            writer.write(ch);
            break;
            /*** the following are not required to be escaped
             case '\r':
             case '\n':
             case '\t':
             case '\b':
             case '\f':
             case '/':
             ***/
          default: writer.write(ch);
        }
      }
    } else {
      writer.write(val);
    }
    writer.write('"');
  }

