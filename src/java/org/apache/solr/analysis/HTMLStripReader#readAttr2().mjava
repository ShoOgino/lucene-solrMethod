    // This reads attributes and attempts to handle any
    // embedded server side includes that would otherwise
    // mess up the quote handling.
    //  <a href="a/<!--#echo "path"-->">
    private int readAttr2() throws IOException {
    int ch = read();
    if (!isFirstIdChar(ch)) return MISMATCH;
    ch = read();
    while(isIdChar(ch)) ch=read();
    if (isSpace(ch)) ch = nextSkipWS();

    // attributes may not have a value at all!
    // if (ch != '=') return MISMATCH;
    if (ch != '=') {
      push(ch);
      return MATCH;
    }

    int quoteChar = nextSkipWS();

    if (quoteChar=='"' || quoteChar=='\'') {
      // TODO: should I set a max size to try and find the other
      // quote?  Otherwise, I may read to much to restore
      // the stream.
      while (true) {
        ch = next();
        if (ch<0) return MISMATCH;
        else if (ch=='<') {
          eatSSI();
        }
        else if (ch==quoteChar) {
          return MATCH;
        //} else if (ch=='<') {
        //  return MISMATCH;
        }
      }
    } else {
      // unquoted attribute
      while (true) {
        ch = next();
        if (ch<0) return MISMATCH;
        else if (isSpace(ch)) {
          push(ch);
          return MATCH;
        } else if (ch=='>') {
          push(ch);
          return MATCH;
        } else if (ch=='<') {
          eatSSI();
        }
      }
    }

  }

