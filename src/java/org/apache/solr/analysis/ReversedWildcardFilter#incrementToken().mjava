  @Override
  public boolean incrementToken() throws IOException {
    if( save != null ) {
      // clearAttributes();  // not currently necessary
      restoreState(save);
      save = null;
      return true;
    }

    if (!input.incrementToken()) return false;

    // pass through zero-length terms
    int oldLen = termAtt.termLength();
    if (oldLen ==0) return true;
    int origOffset = posAtt.getPositionIncrement();
    if (withOriginal == true){
      posAtt.setPositionIncrement(0);
      save = captureState();
    }
    char [] buffer = termAtt.resizeTermBuffer(oldLen + 1);
    buffer[oldLen] = markerChar;
    //String reversed = reverseAndMark(value, markerChar);
    ReverseStringFilter.reverse(buffer, oldLen + 1);

    posAtt.setPositionIncrement(origOffset);
    termAtt.setTermBuffer(buffer, 0, oldLen +1);
    return true;
  }

