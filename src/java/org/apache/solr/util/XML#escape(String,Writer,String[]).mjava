  private static void escape(String str, Writer out, String[] escapes) throws IOException {
    int start=0;
    // "n" was used for counting the chars added to out...
    // removed cause it wasn't really useful so far.
    // int n=0;

    for (int i=start; i<str.length(); i++) {
      char ch = str.charAt(i);
      // since I already received the char, what if I put it into
      // a char array and wrote that to the stream instead of the
      // string? (would cause extra GC though)
      String subst=null;
      if (ch<escapes.length) {
        subst=escapes[ch];
      }
      if (subst != null) {
        if (start<i) {
          out.write(str.substring(start,i));
          // write(str,off,len) causes problems for Jetty with chars > 127
          //out.write(str, start, i-start);
          // n+=i-start;
        }
        out.write(subst);
        // n+=subst.length();
        start=i+1;
      }
    }
    if (start==0) {
      out.write(str);
      // n += str.length();
    } else if (start<str.length()) {
      out.write(str.substring(start));
      // write(str,off,len) causes problems for Jetty with chars > 127
      // out.write(str, start, str.length()-start);
      // n += str.length()-start;
    }
    // return n;
  }

