  @Override
  public Query getFieldQuery(QParser parser, SchemaField field, String externalVal) {
    Query result = null;

    String[] p1 = DistanceUtils.parsePoint(null, externalVal, dimension);
    //TODO: should we assert that p1.length == dimension?
    BooleanQuery bq = new BooleanQuery(true);
    String name = field.getName() + "_";
    String suffix = POLY_FIELD_SEPARATOR + subType.typeName;
    int len = name.length();
    StringBuilder bldr = new StringBuilder(len + 3 + suffix.length());//should be enough buffer to handle most values of j.
    bldr.append(name);
    for (int i = 0; i < dimension; i++) {
      bldr.append(i).append(suffix);
      SchemaField sf1 = schema.getField(bldr.toString());
      Query tq = subType.getFieldQuery(parser, sf1, p1[i]);
      //new TermQuery(new Term(bldr.toString(), subType.toInternal(p1[i])));
      bq.add(tq, BooleanClause.Occur.MUST);
      bldr.setLength(len);
    }
    result = bq;

    return result;
  }

