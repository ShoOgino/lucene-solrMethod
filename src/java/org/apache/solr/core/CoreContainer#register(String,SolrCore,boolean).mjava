  /**
   * Registers a SolrCore descriptor in the registry.
   * @return a previous core having the same name if it existed and returnPrev==true
   */
  public SolrCore register(String name, SolrCore core, boolean returnPrev) {
    if( core == null ) {
      throw new RuntimeException( "Can not register a null core." );
    }
    if( name == null ||
        name.indexOf( '/'  ) >= 0 ||
        name.indexOf( '\\' ) >= 0 ){
      throw new RuntimeException( "Invalid core name: "+name );
    }

    SolrCore old = null;
    synchronized (cores) {
      old = cores.put(name, core);
      core.setName(name);
    }


    if( old == null || old == core) {
      log.info( "registering core: "+name );
      return null;
    }
    else {
      log.info( "replacing core: "+name );
      if (!returnPrev) {
        old.close();
      }
      return old;
    }
  }

