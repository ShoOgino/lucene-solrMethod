  public static String getInstanceDir() {
    if ( ! isInstanceDirInitialized() ) {
      String home = null;
      // Try JNDI
      try {
        Context c = new InitialContext();
        home = (String)c.lookup("java:comp/env/solr/home");
        log.info("Using JNDI solr.home: "+home );
      } catch (NoInitialContextException e) {
        log.info("JNDI not configured for Solr (NoInitialContextEx)");
      } catch (NamingException e) {
        log.info("No /solr/home in JNDI");
      } catch( RuntimeException ex ) {
        log.warning("Odd RuntimeException while testing for JNDI: " 
                    + ex.getMessage());
      } 
      
      // Now try system property
      if( home == null ) {
        String prop = project + ".solr.home";
        home = normalizeDir(System.getProperty(prop));
        if( home != null ) {
          log.info("using system property solr.home: " + home );
        }
      }
      
      // if all else fails, try 
      if( home == null ) {
        home = project + '/';
        log.info("Solr home defaulted to '" + instanceDir + "' (could not find system property or JNDI)");
      }
      
      setInstanceDir(home);
    }
    return instanceDir;
  }

