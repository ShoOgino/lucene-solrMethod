    // core container instantiation
    public CoreContainer initialize() throws IOException, ParserConfigurationException, SAXException {
      CoreContainer cores = null;
      String instanceDir = SolrResourceLoader.locateInstanceDir();
      File fconf = new File(instanceDir, solrConfigFilename == null? "solr.xml": solrConfigFilename);
      log.info("looking for solr.xml: " + fconf.getAbsolutePath());

      if (fconf.exists()) {
        cores = new CoreContainer();
        cores.load(instanceDir, fconf);
        abortOnConfigurationError = false;
        // if any core aborts on startup, then abort
        for (SolrCore c : cores.getCores()) {
          if (c.getSolrConfig().getBool("abortOnConfigurationError", false)) {
            abortOnConfigurationError = true;
            break;
          }
        }
        solrConfigFilename = cores.getConfigFile().getName();
      } else {
        // perform compatibility init
        cores = new CoreContainer();
        cores.loader = new SolrResourceLoader(instanceDir);
        SolrConfig cfg = solrConfigFilename == null ? new SolrConfig() : new SolrConfig(solrConfigFilename);
        CoreDescriptor dcore = new CoreDescriptor(cores);
        dcore.init("", cfg.getResourceLoader().getInstanceDir());
        SolrCore singlecore = new SolrCore(null, null, cfg, null, dcore);
        dcore.setCore(singlecore);
        abortOnConfigurationError = cfg.getBool(
                "abortOnConfigurationError", abortOnConfigurationError);
        cores.register(dcore);
        cores.setPersistent(false);
        solrConfigFilename = cfg.getName();
      }
      return cores;
    }

