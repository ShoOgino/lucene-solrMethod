  /**
   * The conf files are copied to the tmp dir to the conf dir. A backup of the old file is maintained
   */
  private void copyTmpConfFiles2Conf(File tmpconfDir) throws IOException {
    File confDir = new File(solrCore.getResourceLoader().getConfigDir());
    try {
      for (File file : tmpconfDir.listFiles()) {
        File oldFile = new File(confDir, file.getName());
        if (oldFile.exists()) {
          File backupFile = new File(confDir, oldFile.getName() + "." + getDateAsStr(new Date(oldFile.lastModified())));
          boolean status = oldFile.renameTo(backupFile);
          if (!status) {
            throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,
                    "Unable to rename: " + oldFile + " to: " + backupFile);
          }
        }
        boolean status = file.renameTo(oldFile);
        if (!status) {
          throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,
                  "Unable to rename: " + file + " to: " + oldFile);
        }
      }
    } finally {
      delTree(tmpconfDir);
    }
  }

