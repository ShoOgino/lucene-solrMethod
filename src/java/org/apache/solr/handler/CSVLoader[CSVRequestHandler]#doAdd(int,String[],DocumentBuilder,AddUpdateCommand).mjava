  /** this must be MT safe... may be called concurrently from multiple threads. */
  void doAdd(int line, String[] vals, DocumentBuilder builder, AddUpdateCommand template) throws IOException {
    // the line number is passed simply for error reporting in MT mode.
    // first, create the lucene document
    builder.startDoc();
    for (int i=0; i<vals.length; i++) {
      if (fields[i]==null) continue;  // ignore this field
      String val = vals[i];
      adders[i].add(builder, line, i, val);
    }
    builder.endDoc();

    template.doc = builder.getDoc();
    handler.addDoc(template);
  }

