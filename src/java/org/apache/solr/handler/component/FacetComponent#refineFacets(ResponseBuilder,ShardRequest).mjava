  private void refineFacets(ResponseBuilder rb, ShardRequest sreq) {
    FacetInfo fi = rb._facetInfo;

    for (ShardResponse srsp: sreq.responses) {
      int shardNum = rb.getShardNum(srsp.shard);
      NamedList facet_counts = (NamedList)srsp.rsp.getResponse().get("facet_counts");
      NamedList facet_queries = (NamedList)facet_counts.get("facet_queries");

      // These are single term queries used to fill in missing counts
      // for facet.field queries
      for (int i=0; i<facet_queries.size(); i++) {
        try {
          
          String facet_q = (String)facet_queries.getName(i);
          long count = ((Number)facet_queries.getVal(i)).longValue();

          // expect <!field f=field>value style params
          SolrParams qparams = QueryParsing.getLocalParams(facet_q,null);
          String field = qparams.get(QueryParsing.F);
          String val = qparams.get(QueryParsing.V);

          // Find the right field.facet for this field
          DistribFieldFacet dff = fi.topFacets.get(field);
          // Find the right constraint count for this value
          ShardFacetCount sfc = dff.counts.get(val);
// TODO REMOVE
System.out.println("Got " + facet_q + " , refining count: " + sfc + " += " + count);

          sfc.count += count;

        } catch (ParseException e) {
          // shouldn't happen, so fail for now rather than covering it up
          throw new SolrException(SolrException.ErrorCode.SERVER_ERROR, e);
        }
      }
    }
  }

