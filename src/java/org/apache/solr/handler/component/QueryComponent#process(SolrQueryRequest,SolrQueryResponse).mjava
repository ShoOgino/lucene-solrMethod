  /**
   * Actually run the query
   */
  @Override
  public void process(SolrQueryRequest req, SolrQueryResponse rsp) throws IOException 
  {
    ResponseBuilder builder = SearchHandler.getResponseBuilder( req );
    SolrIndexSearcher searcher = req.getSearcher();
    SolrParams params = req.getParams();
    
    if( builder.isNeedDocSet() ) {
      builder.setResults( searcher.getDocListAndSet(
          builder.getQuery(), builder.getFilters(), builder.getSortSpec().getSort(),
          builder.getSortSpec().getOffset(), builder.getSortSpec().getCount(),
          builder.getFieldFlags() ) );
    }
    else {
      DocListAndSet results = new DocListAndSet();
      results.docList = searcher.getDocList(
          builder.getQuery(), builder.getFilters(), builder.getSortSpec().getSort(),
          builder.getSortSpec().getOffset(), builder.getSortSpec().getCount(),
          builder.getFieldFlags() );
      builder.setResults( results );
    }

    //pre-fetch returned documents
    if (builder.getResults().docList != null && builder.getResults().docList.size()<=50) {
      // TODO: this may depend on the highlighter component (or other components?)
      SolrPluginUtils.optimizePreFetchDocs(builder.getResults().docList, builder.getQuery(), req, rsp);
    }
    rsp.add("response",builder.getResults().docList);
  }

