    /**The main method which downloads file
     * @throws Exception
     */
    void fetchFile() throws Exception {
      try {
        while (true) {
          final FastInputStream is = getStream();
          int result;
          try {
            //fetch packets one by one in a single request
            result = fetchPackets(is);
            if (result == 0 || result == NO_CONTENT) {
              // if the file is downloaded properly set the
              //  timestamp same as that in the server
              if (file.exists())
                file.setLastModified(lastmodified);
              return;
            }
            //if there is an error continue. But continue from the point where it got broken
          } finally {
            //closing Inputstream and HTTP connection takes a long time,
            // so replication status shows as 'replicating' even though it is aborted.
            new Thread() {
              public void run() {
                closeNoExp(is);
                try {
                  if (post != null)
                    post.releaseConnection();
                } catch (Exception e) {
                }
              }
            }.start();
          }
        }
      } finally {
        cleanup();
      }
    }

