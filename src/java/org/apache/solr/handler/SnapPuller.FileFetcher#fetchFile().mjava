    void fetchFile() throws Exception {
      try {
        while (true) {
          final FastInputStream is = getStream();
          int result;
          try {
            result = fetchPackets(is);
            if (result == 0 || result == NO_CONTENT) {
              if (file.exists())
                file.setLastModified(lastmodified);
              return;
            }
          } finally {
            //closing Inputstream and HTTP connection takes a long time,
            // so replication status shows as 'replicating' even though it is aborted.
            new Thread() {
              public void run() {
                closeNoExp(is);
                try {
                  if (post != null)
                    post.releaseConnection();
                } catch (Exception e) {
                }
              }
            }.start();
          }
        }
      } finally {
        cleanup();
      }
    }

