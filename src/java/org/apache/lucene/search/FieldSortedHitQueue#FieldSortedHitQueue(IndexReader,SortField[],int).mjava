  /**
   * Creates a hit queue sorted by the given list of fields.
   * @param reader  Index to use.
   * @param fields Fieldable names, in priority order (highest priority first).  Cannot be <code>null</code> or empty.
   * @param size  The number of hits to retain.  Must be greater than zero.
   * @throws IOException
   */
  public FieldSortedHitQueue (IndexReader reader, SortField[] fields, int size)
  throws IOException {
    final int n = fields.length;
    comparators = new ScoreDocComparator[n];
    this.fields = new SortField[n];
    for (int i=0; i<n; ++i) {
      String fieldname = fields[i].getField();
      comparators[i] = getCachedComparator (reader, fieldname, fields[i].getType(), fields[i].getParser(), fields[i].getLocale(), fields[i].getFactory());
      // new SortField instances must only be created when auto-detection is in use
      if (fields[i].getType() == SortField.AUTO) {
        if (comparators[i].sortType() == SortField.STRING) {
          this.fields[i] = new SortField (fieldname, fields[i].getLocale(), fields[i].getReverse());
        } else {
          this.fields[i] = new SortField (fieldname, comparators[i].sortType(), fields[i].getReverse());
        }
      } else {
        assert comparators[i].sortType() == fields[i].getType();
        this.fields[i] = fields[i];
      }
    }
    initialize (size);
  }

