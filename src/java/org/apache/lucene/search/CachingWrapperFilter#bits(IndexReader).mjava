  /**
   * @deprecated Use {@link #getDocIdSet(IndexReader)} instead.
   */
  public BitSet bits(IndexReader reader) throws IOException {
    if (cache == null) {
      cache = new WeakHashMap();
    }

    Object cached = null;
    synchronized (cache) {  // check cache
      cached = cache.get(reader);
    }
	
    if (cached != null) {
      if (cached instanceof BitSet) {
        return (BitSet) cached;
      } else if (cached instanceof DocIdBitSet)
        return ((DocIdBitSet) cached).getBitSet();
      // It would be nice to handle the DocIdSet case, but that's not really possible
    }

    final BitSet bits = filter.bits(reader);

    synchronized (cache) {  // update cache
      cache.put(reader, bits);
    }

    return bits;
  }

