  final void score(HitCollector c, final int end) throws IOException {
    int d = doc;				  // cache doc in local
    while (d < end) {				  // for docs in window
      final int f = freqs[pointer];
      float score =				  // compute tf(f)*weight
	f < SCORE_CACHE_SIZE			  // check cache
	 ? scoreCache[f]			  // cache hit
	 : Similarity.tf(f)*weight;		  // cache miss

      score *= Similarity.norm(norms[d]);	  // normalize for field

      c.collect(d, score);			  // collect score

      if (++pointer == pointerMax) {
	pointerMax = termDocs.read(docs, freqs);  // refill buffers
	if (pointerMax != 0) {
	  pointer = 0;
	} else {
	  termDocs.close();			  // close stream
	  doc = Integer.MAX_VALUE;		  // set to sentinel value
	  return;
	}
      } 
      d = docs[pointer];
    }
    doc = d;					  // flush cache
  }

