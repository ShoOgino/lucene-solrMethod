  /**
   * Perform an inplace AND with the doc ids from a given DocIdSetIterator,
   * leaving only the bits set for which the doc ids are in common.
   * These doc ids should be smaller than the maximum size passed to the
   * constructor.
   */   
  public void inPlaceAnd(DocIdSetIterator disi) throws IOException {
    int index = nextSetBit(0);
    int lastNotCleared = -1;
    while ((index != -1) && disi.skipTo(index)) {
      while ((index != -1) && (index < disi.doc())) {
        fastClear(index);
        index = nextSetBit(index + 1);
      }
      if (index == disi.doc()) {
        lastNotCleared = index;
        index++;
      }
      assert (index == -1) || (index > disi.doc());
    }
    clear(lastNotCleared+1, size());
  }

