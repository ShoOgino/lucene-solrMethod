  /**
   * Captures the current state of the passed in TokenStream.
   * <p>
   * This state will contain all of the passed in TokenStream's
   * {@link Attribute}s which the {@link AttributeAcceptor} accepts. 
   */
  public AttributeSource captureState(AttributeAcceptor acceptor) {
    AttributeSource state = new AttributeSource();
     
    Iterator it = getAttributesIterator();
    while(it.hasNext()) {
      Attribute att = (Attribute) it.next();
      if (acceptor.accept(att.getClass())) {
        Attribute clone = (Attribute) att.clone();
        state.attributes.put(att.getClass(), clone);
      }
    }
    
    return state;
  }

