  public void copyTo(AttributeImpl target) {
    if (target instanceof Token) {
      final Token to = (Token) target;
      to.reinit(this);
      // reinit shares the payload, so clone it:
      if (payload !=null) {
        to.payload = (Payload) payload.clone();
      }
    // remove the following optimization in 3.0 when old TokenStream API removed:
    } else if (target instanceof TokenWrapper) {
      ((TokenWrapper) target).delegate = (Token) this.clone();
    } else {
      initTermBuffer();
      ((TermAttribute) target).setTermBuffer(termBuffer, 0, termLength);
      ((OffsetAttribute) target).setOffset(startOffset, endOffset);
      ((PositionIncrementAttribute) target).setPositionIncrement(positionIncrement);
      ((PayloadAttribute) target).setPayload((payload == null) ? null : (Payload) payload.clone());
      ((FlagsAttribute) target).setFlags(flags);
      ((TypeAttribute) target).setType(type);
    }
  }

