  synchronized void acquireWrite() {
    assert writeThread != Thread.currentThread();
    while(writeThread != null || readCount > 0)
      doWait();

    // We could have been closed while we were waiting:
    ensureOpen();

    writeThread = Thread.currentThread();
  }

