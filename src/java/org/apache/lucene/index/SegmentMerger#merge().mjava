  /**
   * Merges the readers specified by the {@link #add} method into the directory passed to the constructor
   * @return The number of documents that were merged
   * @throws IOException
   */
  final int merge() throws IOException {
    int value;
    try {
      value = mergeFields();
      mergeTerms();
      mergeNorms();

      if (fieldInfos.hasVectors())
        mergeVectors();

    } finally {
      for (int i = 0; i < readers.size(); i++) {  // close readers
        IndexReader reader = (IndexReader) readers.elementAt(i);
        reader.close();
      }
    }

    if (useCompoundFile)
      createCompoundFile();

    return value;
  }

