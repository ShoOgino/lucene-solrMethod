  /**
   * Delete these segments, as long as they are not listed
   * in protectedSegments.  If they are, then, instead, add
   * them to the pending set.
  */
     
  public final void deleteSegments(Vector segments, HashSet protectedSegments) throws IOException {

    deleteFiles();                                // try to delete files that we couldn't before

    for (int i = 0; i < segments.size(); i++) {
      SegmentReader reader = (SegmentReader)segments.elementAt(i);
      if (reader.directory() == this.directory) {
        if (protectedSegments.contains(reader.getSegmentName())) {
          addPendingFiles(reader.files()); // record these for deletion on commit
        } else {
          deleteFiles(reader.files()); // try to delete our files
        }
      }  else {
        deleteFiles(reader.files(), reader.directory()); // delete other files
      }
    }
  }

