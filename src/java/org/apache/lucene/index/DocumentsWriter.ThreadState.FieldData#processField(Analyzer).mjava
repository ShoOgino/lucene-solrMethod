      /** Process all occurrences of one field in the document. */
      public void processField(Analyzer analyzer) throws IOException {
        length = 0;
        position = 0;
        offset = 0;
        boost = docBoost;

        final int maxFieldLength = writer.getMaxFieldLength();

        final int limit = fieldCount;
        final Fieldable[] docFieldsFinal = docFields;

        // Walk through all occurrences in this doc for this
        // field:
        try {
          for(int j=0;j<limit;j++) {
            Fieldable field = docFieldsFinal[j];

            if (field.isIndexed())
              invertField(field, analyzer, maxFieldLength);

            if (field.isStored())
              localFieldsWriter.writeField(fieldInfo, field);

            docFieldsFinal[j] = null;
          }
        } finally {
          if (postingsVectorsUpto > 0) {
            // Add term vectors for this field
            writeVectors(fieldInfo);
            if (postingsVectorsUpto > maxPostingsVectors)
              maxPostingsVectors = postingsVectorsUpto;
            postingsVectorsUpto = 0;
            vectorsPool.reset();
          }
        }
      }

