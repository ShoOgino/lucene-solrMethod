  /** Blocks until all files in syncing are sync'd */
  private boolean waitForAllSynced(Collection<String> syncing) throws IOException {
    synchronized(synced) {
      Iterator<String> it = syncing.iterator();
      while(it.hasNext()) {
        final String fileName = it.next();
        while(!synced.contains(fileName)) {
          if (!syncing.contains(fileName))
            // There was an error because a file that was
            // previously syncing failed to appear in synced
            return false;
          else
            try {
              synced.wait();
            } catch (InterruptedException ie) {
              throw new ThreadInterruptedException(ie);
            }
        }
      }
      return true;
    }
  }

