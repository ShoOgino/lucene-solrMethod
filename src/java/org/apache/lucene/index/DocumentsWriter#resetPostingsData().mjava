  /** Reset after a flush */
  private void resetPostingsData() throws IOException {
    // All ThreadStates should be idle when we are called
    assert allThreadsIdle();
    for(int i=0;i<threadStates.length;i++) {
      threadStates[i].resetPostings();
      threadStates[i].numThreads = 0;
    }
    threadBindings.clear();
    numBytesUsed = 0;
    balanceRAM();
    bufferIsFull = false;
    flushPending = false;
    segment = null;
    numDocsInRAM = 0;
    nextDocID = 0;
    nextWriteDocID = 0;
    files = null;
  }

