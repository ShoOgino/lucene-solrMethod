  /**
   * Adds a document to this index, using the provided analyzer instead of the
   * value of {@link #getAnalyzer()}.  If the document contains more than
   * {@link #setMaxFieldLength(int)} terms for a given field, the remainder are
   * discarded.
   *
   * See @link #addDocument(Document) for details on index
   * state after an IOException.
   */
  public void addDocument(Document doc, Analyzer analyzer) throws IOException {
    DocumentWriter dw =
      new DocumentWriter(ramDirectory, analyzer, this);
    dw.setInfoStream(infoStream);
    String segmentName = newRAMSegmentName();
    dw.addDocument(segmentName, doc);
    synchronized (this) {
      ramSegmentInfos.addElement(new SegmentInfo(segmentName, 1, ramDirectory, false));
      maybeFlushRamSegments();
    }
  }

