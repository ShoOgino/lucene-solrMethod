  /** Blocks until all files in syncing are sync'd */
  private boolean waitForAllSynced(Collection syncing) throws IOException {
    synchronized(synced) {
      Iterator it = syncing.iterator();
      while(it.hasNext()) {
        final String fileName = (String) it.next();
        while(!synced.contains(fileName)) {
          if (!syncing.contains(fileName))
            // There was an error because a file that was
            // previously syncing failed to appear in synced
            return false;
          else
            try {
              synced.wait();
            } catch (InterruptedException ie) {
              // In 3.0 we will change this to throw
              // InterruptedException instead
              Thread.currentThread().interrupt();
              throw new RuntimeException(ie);
            }
        }
      }
      return true;
    }
  }

