  protected synchronized DirectoryIndexReader doReopen(SegmentInfos infos, boolean doClone, boolean openReadOnly) throws CorruptIndexException, IOException {
    DirectoryIndexReader newReader;

    if (infos == null) {
      if (doClone) {
        // OK: directly clone myself
        newReader = reopenSegment(si, doClone, openReadOnly);
      } else {
        throw new UnsupportedOperationException("cannot reopen a standalone SegmentReader");
      }
    } else if (infos.size() == 1) {
      SegmentInfo si = infos.info(0);
      if (segment.equals(si.name) && si.getUseCompoundFile() == SegmentReader.this.si.getUseCompoundFile()) {
        newReader = reopenSegment(si, doClone, openReadOnly);
      } else { 
        // segment not referenced anymore, reopen not possible
        // or segment format changed
        newReader = SegmentReader.get(openReadOnly, infos, infos.info(0), false);
      }
    } else {
      if (openReadOnly)
        return new ReadOnlyMultiSegmentReader(directory, infos, closeDirectory, new SegmentReader[] {this}, null, null, doClone);
      else
        return new MultiSegmentReader(directory, infos, closeDirectory, new SegmentReader[] {this}, null, null, false, doClone);
    }
    
    return newReader;
  }

