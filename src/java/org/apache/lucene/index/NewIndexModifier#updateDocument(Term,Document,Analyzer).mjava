  /**
   * Updates a document by first deleting all documents containing
   * <code>term</code> and then adding the new document.
   */
  public void updateDocument(Term term, Document doc, Analyzer analyzer)
      throws IOException {
    SegmentInfo newSegmentInfo = buildSingleDocSegment(doc, analyzer);
    synchronized (this) {
      bufferDeleteTerm(term);
      ramSegmentInfos.addElement(newSegmentInfo);
      maybeFlushRamSegments();
    }
  }

