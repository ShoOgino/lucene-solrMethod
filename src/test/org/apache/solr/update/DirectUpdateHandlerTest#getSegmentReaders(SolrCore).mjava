  SegmentReader[] getSegmentReaders(SolrCore core) throws IOException {
    RefCounted<SolrIndexSearcher> ref = core.getSearcher(true, true, null);
    SolrIndexSearcher is = ref.get();
    SegmentReader[] segmentReaders = null;
    try {
      SolrIndexReader reader = is.getReader();
      IndexReader[] subreaders = reader.getSequentialSubReaders();
      segmentReaders = new SegmentReader[subreaders.length];
      for (int x = 0; x < subreaders.length; x++) {
        assert subreaders[x] instanceof SolrIndexReader;
        SolrIndexReader sir = (SolrIndexReader) subreaders[x];
        SegmentReader sr = (SegmentReader) sir.getWrappedReader();
        segmentReaders[x] = sr;
      }
    } finally {
      ref.decref();
    }
    return segmentReaders;
  }

