    // Verify: NativeFSLockFactory works correctly
    public void testNativeFSLockFactory() throws IOException {

      // Make sure we get identical instances:
      NativeFSLockFactory f = NativeFSLockFactory.getLockFactory();
      NativeFSLockFactory f2 = NativeFSLockFactory.getLockFactory();
      assertTrue("got different NativeFSLockFactory instances for same directory",
                 f == f2);

      // Make sure we get identical locks:
      f.setLockPrefix("test");
      Lock l = f.makeLock("commit");
      Lock l2 = f.makeLock("commit");
      assertTrue("got different Lock instances for same lock name",
                 l == l2);

      assertTrue("failed to obtain lock", l.obtain());
      assertTrue("succeeded in obtaining lock twice", !l.obtain());
      l.release();

      // Make sure we can obtain it again:
      assertTrue("failed to obtain lock", l.obtain());
      l.release();
    }

