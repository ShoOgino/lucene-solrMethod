    public void testDocCount()
    {
        Directory dir = new RAMDirectory();

        IndexWriter writer = null;
        IndexReader reader = null;
        int i;

        try {
          writer  = new IndexWriter(dir, new WhitespaceAnalyzer(), true);

          // add 100 documents
          for (i = 0; i < 100; i++) {
              addDoc(writer);
          }
          assertEquals(100, writer.docCount());
          writer.close();

          // delete 50 documents
          reader = IndexReader.open(dir);
          for (i = 0; i < 50; i++) {
              reader.delete(i);
          }
          reader.close();

          writer  = new IndexWriter(dir, new WhitespaceAnalyzer(), false);
          assertEquals(50, writer.docCount());
          writer.optimize();
          assertEquals(50, writer.docCount());
          writer.close();
        }
        catch (IOException e) {
          e.printStackTrace();
        }
    }

