  /**
   * This method creates an empty index (numFields=0, numDocs=0) but is marked
   * to have TermVectors. Adding this index to another index should not throw
   * any exception.
   */
  public void testEmptyIndexWithVectors() throws IOException {
    RAMDirectory rd1 = new MockRAMDirectory();
    {
      IndexWriter iw = new IndexWriter(rd1, new SimpleAnalyzer(Version.LUCENE_CURRENT), true,
                                       MaxFieldLength.UNLIMITED);
      Document doc = new Document();
      doc.add(new Field("test", "", Store.NO, Index.ANALYZED,
                        TermVector.YES));
      iw.addDocument(doc);
      doc.add(new Field("test", "", Store.NO, Index.ANALYZED,
                        TermVector.NO));
      iw.addDocument(doc);
      iw.close();

      IndexReader ir = IndexReader.open(rd1,false);
      ir.deleteDocument(0);
      ir.close();

      iw = new IndexWriter(rd1, new SimpleAnalyzer(Version.LUCENE_CURRENT), false,
                           MaxFieldLength.UNLIMITED);
      iw.optimize();
      iw.close();
    }

    RAMDirectory rd2 = new MockRAMDirectory();
    {
      IndexWriter iw = new IndexWriter(rd2, new SimpleAnalyzer(Version.LUCENE_CURRENT), true,
                                       MaxFieldLength.UNLIMITED);
      Document doc = new Document();
      iw.addDocument(doc);
      iw.close();
    }

    RAMDirectory rdOut = new MockRAMDirectory();

    IndexWriter iwOut = new IndexWriter(rdOut, new SimpleAnalyzer(Version.LUCENE_CURRENT), true,
                                        MaxFieldLength.UNLIMITED);
    ParallelReader pr = new ParallelReader();
    pr.add(IndexReader.open(rd1,true));
    pr.add(IndexReader.open(rd2,true));

    // When unpatched, Lucene crashes here with an ArrayIndexOutOfBoundsException (caused by TermVectorsWriter)
    iwOut.addIndexes(new IndexReader[] { pr });

    // ParallelReader closes any IndexReader you added to it:
    pr.close();

    rd1.close();
    rd2.close();
		
    iwOut.optimize();
    iwOut.close();
    
    _TestUtil.checkIndex(rdOut);
    rdOut.close();
  }

