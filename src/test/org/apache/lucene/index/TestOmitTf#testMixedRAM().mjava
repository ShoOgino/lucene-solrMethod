  // Make sure first adding docs that do not omitTf for
  // field X, then adding docs that do omitTf for that same
  // field, 
  public void testMixedRAM() throws Exception {
    Directory ram = new MockRAMDirectory();
    Analyzer analyzer = new StandardAnalyzer();
    IndexWriter writer = new IndexWriter(ram, analyzer, true, IndexWriter.MaxFieldLength.LIMITED);
    writer.setMaxBufferedDocs(10);
    writer.setMergeFactor(2);
    Document d = new Document();
        
    // this field will have Tf
    Field f1 = new Field("f1", "This field has term freqs", Field.Store.NO, Field.Index.ANALYZED);
    d.add(f1);
       
    // this field will NOT have Tf
    Field f2 = new Field("f2", "This field has NO Tf in all docs", Field.Store.NO, Field.Index.ANALYZED);
    d.add(f2);

    for(int i=0;i<5;i++)
      writer.addDocument(d);

    f2.setOmitTf(true);
        
    for(int i=0;i<20;i++)
      writer.addDocument(d);

    // force merge
    writer.optimize();

    // flush
    writer.close();

    _TestUtil.checkIndex(ram);

    // only one segment in the index, so we can cast to SegmentReader
    SegmentReader reader = (SegmentReader) IndexReader.open(ram);
    FieldInfos fi = reader.fieldInfos();
    assertTrue("OmitTf field bit should not be set.", !fi.fieldInfo("f1").omitTf);
    assertTrue("OmitTf field bit should be set.", fi.fieldInfo("f2").omitTf);
        
    reader.close();
    ram.close();
  }

