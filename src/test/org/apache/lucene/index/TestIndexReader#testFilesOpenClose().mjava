    public void testFilesOpenClose() throws IOException 
    {
        // Create initial data set
        Directory dir = FSDirectory.getDirectory("testIndex", true);
        IndexWriter writer  = new IndexWriter(dir, new WhitespaceAnalyzer(), true);
        addDoc(writer, "test");
        writer.close();
        dir.close();
        
        // Try to erase the data - this ensures that the writer closed all files
        dir = FSDirectory.getDirectory("testIndex", true);
        
        // Now create the data set again, just as before 
        writer  = new IndexWriter(dir, new WhitespaceAnalyzer(), true);
        addDoc(writer, "test");
        writer.close();
        dir.close();
        
        // Now open existing directory and test that reader closes all files
        dir = FSDirectory.getDirectory("testIndex", false);
        IndexReader reader1 = IndexReader.open(dir);
        reader1.close();
        dir.close();
        
        // The following will fail if reader did not close all files
        dir = FSDirectory.getDirectory("testIndex", true);
    }

