  // LUCENE-1642: make sure CFS of destination indexwriter
  // is respected when copying tail segments
  public void testTargetCFS() throws IOException {
    Directory dir = new RAMDirectory();
    IndexWriter writer = newWriter(dir, new IndexWriterConfig(TEST_VERSION_CURRENT));
    ((LogMergePolicy) writer.getMergePolicy()).setUseCompoundFile(false);
    ((LogMergePolicy) writer.getMergePolicy()).setUseCompoundDocStore(false);
    addDocs(writer, 1);
    writer.close();

    Directory other = new RAMDirectory();
    writer = newWriter(other, new IndexWriterConfig(TEST_VERSION_CURRENT));
    ((LogMergePolicy) writer.getMergePolicy()).setUseCompoundFile(true);
    ((LogMergePolicy) writer.getMergePolicy()).setUseCompoundDocStore(true);
    writer.addIndexesNoOptimize(new Directory[] {dir});
    assertTrue(writer.newestSegment().getUseCompoundFile());
    writer.close();
  }

