  /**
   * Writes the document to the directory using the analyzer
   * and the similarity score; returns the SegmentInfo
   * describing the new segment
   * @param dir
   * @param analyzer
   * @param similarity
   * @param doc
   * @throws IOException
   */ 
  public static SegmentInfo writeDoc(Directory dir, Analyzer analyzer, Similarity similarity, Document doc) throws IOException
  {
    IndexWriter writer = new IndexWriter(dir, analyzer);
    writer.setSimilarity(similarity);
    //writer.setUseCompoundFile(false);
    writer.addDocument(doc);
    writer.flush();
    SegmentInfo info = writer.segmentInfos.info(writer.segmentInfos.size()-1);
    writer.close();
    return info;
  }

