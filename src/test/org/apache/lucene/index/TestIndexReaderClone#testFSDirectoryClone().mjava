  // LUCENE-1453
  public void testFSDirectoryClone() throws Exception {

    String tempDir = System.getProperty("java.io.tmpdir");
    if (tempDir == null)
      throw new IOException("java.io.tmpdir undefined, cannot run test");
    File indexDir2 = new File(tempDir, "FSDirIndexReaderClone");

    Directory dir1 = FSDirectory.getDirectory(indexDir2);
    TestIndexReaderReopen.createIndex(dir1, false);

    IndexReader reader = IndexReader.open(indexDir2);
    IndexReader readOnlyReader = (IndexReader) reader.clone();
    reader.close();
    readOnlyReader.close();

    // Make sure we didn't pick up too many incRef's along
    // the way -- this close should be the final close:
    dir1.close();

    try {
      dir1.listAll();
      fail("did not hit AlreadyClosedException");
    } catch (AlreadyClosedException ace) {
      // expected
    }
  }

