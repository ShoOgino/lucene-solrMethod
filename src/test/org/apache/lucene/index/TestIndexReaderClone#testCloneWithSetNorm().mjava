  // LUCENE-1648
  public void testCloneWithSetNorm() throws Throwable {
    final Directory dir1 = new MockRAMDirectory();
    TestIndexReaderReopen.createIndex(dir1, false);
    SegmentReader orig = (SegmentReader) IndexReader.open(dir1);
    orig.setNorm(1, "field1", 17.0f);
    final byte encoded = Similarity.encodeNorm(17.0f);
    assertEquals(encoded, orig.norms("field1")[1]);

    // the cloned segmentreader should have 2 references, 1 to itself, and 1 to
    // the original segmentreader
    SegmentReader clonedSegmentReader = (SegmentReader) orig.clone();
    orig.close();
    clonedSegmentReader.close();

    SegmentReader r = (SegmentReader) IndexReader.open(dir1);
    assertEquals(encoded, r.norms("field1")[1]);
    r.close();
    dir1.close();
  }

