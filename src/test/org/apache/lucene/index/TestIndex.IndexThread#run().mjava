    public void run() {
      try {
        for(int i = 0; i < ITERATIONS; i++) {
          int rand = random.nextInt(101);
          if (rand < 5) {
            index.optimize();
          } else if (rand < 60) {
            Document doc = getDocument();
            //System.out.println("add doc id=" + doc.get("id"));
            index.addDocument(doc);
            idStack.push(doc.get("id"));
            added++;
          } else {
            if (idStack.size() == 0) {
              // not enough docs in index, let's wait for next chance
            } else {
              // we just delete the last document added and remove it
              // from the id stack so that it won't be removed twice:
              String delId = (String)idStack.pop();
              //System.out.println("delete doc id = " + delId);
              index.delete(new Term("id", new Integer(delId).toString()));
              deleted++;
            }
          }
          if (maxWait > 0) {
            try {
              rand = random.nextInt(maxWait);
              //System.out.println("waiting " + rand + "ms");
              Thread.sleep(rand);
            } catch (InterruptedException e) {
              e.printStackTrace();
            }
          }
        }
      } catch (IOException e) {
        throw new RuntimeException(e);
      }
    }

