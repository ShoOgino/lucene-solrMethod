  private void compare(TopDocs oldHits, TopDocs newHits) {
    assertEquals(oldHits.totalHits, newHits.totalHits);
    assertEquals(oldHits.scoreDocs.length, newHits.scoreDocs.length);
    final ScoreDoc[] oldDocs = oldHits.scoreDocs;
    final ScoreDoc[] newDocs = newHits.scoreDocs;

    for(int i=0;i<oldDocs.length;i++) {
      if (oldDocs[i] instanceof FieldDoc) {
        assert newDocs[i] instanceof FieldDoc;
        FieldDoc oldHit = (FieldDoc) oldDocs[i];
        FieldDoc newHit = (FieldDoc) newDocs[i];
        assertEquals("hit " + i + " of " + oldDocs.length + " differs: oldDoc=" + oldHit.doc + " vs newDoc=" + newHit.doc + " oldFields=" + _TestUtil.arrayToString(oldHit.fields) + " newFields=" + _TestUtil.arrayToString(newHit.fields),
                     oldHit.doc, newHit.doc);

        assertEquals(oldHit.score, newHit.score, 0.00001);
        assertTrue(Arrays.equals(oldHit.fields, newHit.fields));
      } else {
        ScoreDoc oldHit = oldDocs[i];
        ScoreDoc newHit = newDocs[i];
        assertEquals(oldHit.doc, newHit.doc);
        assertEquals(oldHit.score, newHit.score, 0.00001);
      }
    }
    
  }

