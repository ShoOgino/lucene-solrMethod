  /**
   * Returns the number of bytes required to decode the given char sequence.
   * 
   * @param encoded The char sequence to be encoded.  Must be backed by an array.
   * @return The number of bytes required to decode the given char sequence
   * @throws IllegalArgumentException If the given CharBuffer is not backed by an array
   */
  public static int getDecodedLength(CharBuffer encoded) 
    throws IllegalArgumentException {
    if (encoded.hasArray()) {
      int numChars = encoded.limit() - encoded.arrayOffset() - 1;
      if (numChars <= 0) {
        return 0;
      } else {
        int numFullBytesInFinalChar = encoded.charAt(encoded.limit() - 1);
        int numEncodedChars = numChars - 1;
        return (numEncodedChars * 15 + 7) / 8 + numFullBytesInFinalChar;
      }
    } else {
      throw new IllegalArgumentException("encoded argument must have a backing array");
    }
  }

