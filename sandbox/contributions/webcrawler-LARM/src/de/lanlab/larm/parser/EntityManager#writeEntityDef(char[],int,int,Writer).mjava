    // character references are rare enough that we don't care about
    // creating a String object for them unnecessarily...
    /**
     * Description of the Method
     *
     * @param buf                        Description of the Parameter
     * @param off                        Description of the Parameter
     * @param len                        Description of the Parameter
     * @param out                        Description of the Parameter
     * @exception Exception              Description of the Exception
     * @exception IOException            Description of the Exception
     * @exception NumberFormatException  Description of the Exception
     */
    public void writeEntityDef(char[] buf, int off, int len, Writer out)
        throws Exception, IOException, NumberFormatException
    {
        Integer ch;
        //System.out.println("Entity: " + new String(buf, off, len) +" "+off+" "+len);

        if (buf[off] == '#')
        {
            // character reference
            off++;
            len--;
            if (buf[off] == 'x' || buf[off] == 'X')
            {
                ch = Integer.valueOf(new String(buf, off + 1, len - 1), 16);
            }
            else
            {
                ch = Integer.valueOf(new String(buf, off, len));
            }
            out.write(ch.intValue());
        }
        else
        {
            String ent = new String(buf, off, len);
            String val = (String) entities.get(ent);
            if (val != null)
            {
                out.write(val);
            }
            else
            {
                out.write("&" + ent + ";");
                //tok.warning("unknown entity reference: " + ent);
            }
        }
    }

