    public static String encodeText(String s, boolean attr) {
        StringBuffer sb = new StringBuffer();
        int ch, len = s.length();

        for (int i = 0; i < len; i++) {
            ch = s.charAt(i);
            if (ch == '"') sb.append("&quot;");
            /* cause we don't recognize markup within PCDATA and attr values
            else if (ch == '&') sb.append("&amp;");
            else if (!attr && ch == '<') sb.append("&lt;");
            else if (!attr && ch == '>') sb.append("&gt;");
            else if ((" \r\n\t".indexOf((char) ch) != -1)
                     && (ch <= 31 || ch >= 127)) sb.append("&#"+ch+";");
            */
            else sb.append((char) ch);
        }
        return sb.toString();
    }

