  /**
   * Copies data from the specified input stream to the output stream
   * until <em>n</em> bytes has been copied or end of file is met.
   * @return    the total number of bytes written to the output stream
   */
  public static int cpybytes(InputStream in, OutputStream out, int n)
    throws IOException
  {
    int sz = n < 1024 ? n : 1024;
    byte[] buf = new byte[sz];
    int chunk, nread, ntotal = 0;

    chunk = sz;

    while (ntotal < n && (nread = in.read(buf, 0, chunk)) > -1) {
      out.write(buf, 0, nread);
      ntotal += nread;
      chunk = (n - ntotal < sz) ? n - ntotal : sz;
    }
    return ntotal;
  }

