  /**
   * Find byte pattern ptrn in buffer buf.
   * @return    index of first occurrence of ptrn in buf, -1 if no occurence
   */
  public static final int findBytes(byte buf[],
                                    int off,
                                    int len,
                                    byte ptrn[]) {
    // Note: This code is completely incomprehensible without a drawing...

    int buf_len = off + len;
    int ptrn_len = ptrn.length;
    int i;                       // index into buf
    int j;                       // index into ptrn;
    byte b = ptrn[0];            // next byte of interest

    for (i = off; i < buf_len; ) {
      j = 0;
      while (i < buf_len && j < ptrn_len && buf[i] == ptrn[j]) {
        i++;
        j++;
      }
      if (i == buf_len || j == ptrn_len)
        return i - j;
      else {
        // We have to go back a bit as there may be an overlapping
        // match starting a bit later in buf...
        i = i - j + 1;
      }
    }
    return -1;
  }

