    /**
     * <p>
     * Materializes the object represented by the
     * {@link org.apache.lucene.document.Document}.
     * </p>
     * <p>
     * Objects which need to be returned via this method (essentially
     * any object which implements
     * {@link com.marketingbright.core.services.search.SearchResult},
     * must either have an associated broker, or a no-arg ctor and
     * INIT_OBJECT_METHOD with INIT_OBJECT_METHOD_ARGS.
     * </p>
     */
    public static Object getDocAsObject(Document doc) throws Exception
    {
        Class clazz = Class.forName(doc.get(DataSource.OBJECT_CLASS));
        String id = doc.get(DataSource.OBJECT_IDENTIFIER);
        Object o = null;
        try
        {
            Broker broker = BrokerFactory.getBroker(clazz);
            // assume it's a two-part compound pk if there's a comma
            int indexOfComma = id.indexOf(',');
            if (indexOfComma != -1)
            {
                String[] pks = new String[2];
                pks[0] = id.substring(0, indexOfComma);
                pks[1] = id.substring(indexOfComma + 1);
                o = broker.retrieveByPK(pks);
            }
            else
            {
                o = broker.retrieveByPK(id);
            }
        }
        catch (NoSuchBrokerException nsbe)
        {
            /**
             * Some objects don't have brokers or peers, this offers an
             * alternative.
             */
            o = clazz.newInstance();
            invokeMethod(o, INIT_OBJECT_METHOD,
                         INIT_OBJECT_METHOD_ARGS, new Object[]{id});
        }
        String searchResultClassname = null;
        searchResultClassname = doc.get(DataSource.SEARCH_RESULT_CLASSNAME);
        return generateObject(searchResultClassname,
                              SEARCH_RESULT_WRAPPER_CTOR_ARGS,
                              new Object[]{o});
    }

