  /**
   * TODO -- in the future, this could perhaps transform the NamedList without serializing it
   * then parsing it from the serialized form.
   * 
   * @param req
   * @param rsp
   * @return a response object equivalent to what you get from the XML/JSON/javabin parser. Documents
   * become SolrDocuments, DocList becomes SolrDocumentList etc.
   */
  public NamedList<Object> getParsedResponse( SolrQueryRequest req, SolrQueryResponse rsp )
  {
    try {
      BinaryResponseWriter writer = new BinaryResponseWriter();
      ByteArrayOutputStream bos = new ByteArrayOutputStream();
      writer.write( bos, req, rsp );
      BinaryResponseParser parser = new BinaryResponseParser();
      return parser.processResponse( new ByteArrayInputStream( bos.toByteArray() ), "UTF-8" );
    }
    catch( Exception ex ) {
      throw new RuntimeException( ex );
    }
  }

