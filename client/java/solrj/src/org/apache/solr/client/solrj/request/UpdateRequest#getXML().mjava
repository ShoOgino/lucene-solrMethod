  public String getXML() throws IOException {
    StringWriter writer = new StringWriter();
    if( documents != null && documents.size() > 0 ) {
      if( commitWithin > 0 ) {
        writer.write("<add commitWithin=\""+commitWithin+"\">");
      }
      else {
        writer.write("<add>");
      }
      for (SolrInputDocument doc : documents ) {
        if( doc != null ) {
          ClientUtils.writeXML( doc, writer );
        }
      }
      writer.write("</add>");
    }
    
    // Add the delete commands
    boolean deleteI = deleteById != null && deleteById.size() > 0;
    boolean deleteQ = deleteQuery != null && deleteQuery.size() > 0;
    if( deleteI || deleteQ ) {
      writer.append( "<delete>" );
      if( deleteI ) {
        for( String id : deleteById ) {
          writer.append( "<id>" );
          XML.escapeCharData( id, writer );
          writer.append( "</id>" );
        }
      }
      if( deleteQ ) {
        for( String q : deleteQuery ) {
          writer.append( "<query>" );
          XML.escapeCharData( q, writer );
          writer.append( "</query>" );
        }
      }
      writer.append( "</delete>" );
    }
    
    // If action is COMMIT or OPTIMIZE, it is sent with params
    String xml = writer.toString();
    //System.out.println( "SEND:"+xml );
    return (xml.length() > 0) ? xml : null;
  }

