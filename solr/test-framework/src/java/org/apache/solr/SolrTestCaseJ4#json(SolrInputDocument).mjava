  /** Creates JSON from a SolrInputDocument.  Doesn't currently handle boosts. */
  public static String json(SolrInputDocument doc) {
     CharArr out = new CharArr();
    try {
      out.append('{');
      boolean firstField = true;
      for (SolrInputField sfield : doc) {
        if (firstField) firstField=false;
        else out.append(',');
        JSONUtil.writeString(sfield.getName(), 0, sfield.getName().length(), out);
        out.append(':');
        if (sfield.getValueCount() > 1) {
          out.append('[');
        }
        boolean firstVal = true;
        for (Object val : sfield) {
          if (firstVal) firstVal=false;
          else out.append(',');
          out.append(JSONUtil.toJSON(val));
        }
        if (sfield.getValueCount() > 1) {
          out.append(']');
        }
      }
      out.append('}');
    } catch (IOException e) {
      // should never happen
    }
    return out.toString();
  }

