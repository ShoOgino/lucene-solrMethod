    @Override
    public CoreContainer initialize() {
      CoreContainer container = new CoreContainer(new SolrResourceLoader(SolrResourceLoader.locateSolrHome())) {
        {
          hostPort = System.getProperty("hostPort");
          hostContext = "solr";
          defaultCoreName = CoreContainer.DEFAULT_DEFAULT_CORE_NAME;
          initShardHandler(null);
          initZooKeeper(System.getProperty("zkHost"), 10000);
        }
      };
      LogWatcher<?> logging = new JulWatcher("test");
      logging.registerListener(new ListenerConfig(), container);
      container.setLogging(logging);
      
      CoreDescriptor dcore = new CoreDescriptor(container, coreName, solrConfig.getResourceLoader().getInstanceDir());
      dcore.setConfigName(solrConfig.getResourceName());
      dcore.setSchemaName(indexSchema.getResourceName());
      SolrCore core = new SolrCore(coreName, dataDirectory, solrConfig, indexSchema, dcore);
      container.register(coreName, core, false);

      // TODO: we should be exercising the *same* core container initialization code, not equivalent code!
      if (container.getZkController() == null && core.getUpdateHandler().getUpdateLog() != null) {
        // always kick off recovery if we are in standalone mode.
        core.getUpdateHandler().getUpdateLog().recoverFromLog();
      }
      return container;
    }

