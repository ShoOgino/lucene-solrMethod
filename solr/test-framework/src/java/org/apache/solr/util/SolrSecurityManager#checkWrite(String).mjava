  /**
   * {@inheritDoc}
   * <p>This method implements hacks to workaround hadoop's garbage FileUtil code
   */
  @Override
  public void checkWrite(String file) {
    for (StackTraceElement element : Thread.currentThread().getStackTrace()) {
      // hadoop "canWrite" method doesn't handle securityexception and fails completely.
      // so, lie to it, and tell it we will happily write, so it does not crash.
      if ("org.apache.hadoop.fs.FileUtil".equals(element.getClassName()) &&
          "canWrite".equals(element.getMethodName())) {
        return;
      }
    }
    super.checkWrite(file);
  }

