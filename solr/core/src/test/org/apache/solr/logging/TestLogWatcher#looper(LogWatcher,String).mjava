  private boolean looper(LogWatcher watcher, String msg) {
    // In local testing this loop usually succeeds 1-2 tries.
    boolean success = false;
    boolean testingNew = msg == null;
    for (int msgIdx = 0; msgIdx < 100 && success == false; ++msgIdx) {
      if (testingNew) { // check that there are no entries registered for the watcher
        success = watcher.getLastEvent() == -1;
      } else { // check that the expected message is there.
        // Returns an empty (but non-null) list even if there are no messages yet.
        SolrDocumentList events = watcher.getHistory(-1, new AtomicBoolean());
        for (SolrDocument doc : events) {
          if (doc.get("message").equals(msg)) {
            success = true;
          }
        }
      }
      try {
        Thread.sleep(10);
      } catch (InterruptedException ie) {
        ;
      }
    }
    return success;
  }

