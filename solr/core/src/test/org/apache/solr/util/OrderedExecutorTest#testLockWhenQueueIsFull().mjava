  @Test
  public void testLockWhenQueueIsFull() {
    OrderedExecutor orderedExecutor = new OrderedExecutor(10, ExecutorUtil.newMDCAwareCachedThreadPool("testLockWhenQueueIsFull"));
    IntBox intBox = new IntBox();
    long t = System.nanoTime();
    orderedExecutor.execute(1, () -> {
      try {
        Thread.sleep(500L);
      } catch (InterruptedException e) {
        Thread.currentThread().interrupt();
      }
      intBox.value++;
    });
    assertTrue(System.nanoTime() - t < 100 * 1000000);

    t = System.nanoTime();
    orderedExecutor.execute(1, () -> {
      intBox.value++;
    });
    assertTrue(System.nanoTime() - t > 300 * 1000000);
    orderedExecutor.shutdownAndAwaitTermination();
    assertEquals(intBox.value, 2);
  }

