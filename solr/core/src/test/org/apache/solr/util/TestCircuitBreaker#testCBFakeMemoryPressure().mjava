  public void testCBFakeMemoryPressure() throws IOException {
    HashMap<String, String> args = new HashMap<String, String>();

    args.put(QueryParsing.DEFTYPE, CircuitBreaker.NAME);
    args.put(CommonParams.FL, "id");

    CircuitBreaker circuitBreaker = new FakeMemoryPressureCircuitBreaker(h.getCore());

    h.getCore().getCircuitBreakerManager().registerCircuitBreaker(CircuitBreakerType.MEMORY, circuitBreaker);

    expectThrows(SolrException.class, () -> {
      h.query(req("name:\"john smith\""));
    });

    circuitBreaker = new MemoryCircuitBreaker(h.getCore());

    h.getCore().getCircuitBreakerManager().registerCircuitBreaker(CircuitBreakerType.MEMORY, circuitBreaker);
  }

