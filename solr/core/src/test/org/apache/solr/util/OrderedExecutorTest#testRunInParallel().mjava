  @Test
  public void testRunInParallel() {
    OrderedExecutor orderedExecutor = new OrderedExecutor(10, ExecutorUtil.newMDCAwareCachedThreadPool("testLockWhenQueueIsFull"));
    AtomicInteger atomicInteger = new AtomicInteger(0);
    orderedExecutor.execute(1, () -> {
      try {
        Thread.sleep(500L);
      } catch (InterruptedException e) {
        Thread.currentThread().interrupt();
      }
      if (atomicInteger.get() == 1) atomicInteger.incrementAndGet();
    });

    orderedExecutor.execute(2, atomicInteger::incrementAndGet);
    orderedExecutor.shutdownAndAwaitTermination();
    assertEquals(atomicInteger.get(), 2);
  }

