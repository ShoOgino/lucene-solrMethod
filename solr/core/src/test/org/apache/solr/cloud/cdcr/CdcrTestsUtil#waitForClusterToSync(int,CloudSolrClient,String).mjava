  public static long waitForClusterToSync(int numDocs, CloudSolrClient clusterSolrClient, String query) throws SolrServerException, IOException, InterruptedException {
    long start = System.nanoTime();
    QueryResponse response = null;
    while (System.nanoTime() - start <= TimeUnit.NANOSECONDS.convert(120, TimeUnit.SECONDS)) {
      try {
        clusterSolrClient.commit();
        response = clusterSolrClient.query(new SolrQuery(query));
        if (response.getResults().getNumFound() == numDocs) {
          break;
        }
      } catch (Exception e) {
        log.warn("Exception trying to commit on cluster. This is expected and safe to ignore.", e);
      }
      Thread.sleep(1000);
    }
    return response != null ? response.getResults().getNumFound() : 0;
  }

