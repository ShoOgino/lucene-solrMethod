  @Before
  public void init() throws Exception {
    assumeWorkingMockito();
    cloudManager = mock(SolrCloudManager.class);
    DistribStateManager stateManager = new SimDistribStateManager();
    when(cloudManager.getDistribStateManager()).thenReturn(stateManager);
    DistributedQueueFactory queueFactory = new GenericDistributedQueueFactory(stateManager);
    when(cloudManager.getDistributedQueueFactory()).thenReturn(queueFactory);
    when(cloudManager.getTimeSource()).thenReturn(TimeSource.NANO_TIME);
  }

