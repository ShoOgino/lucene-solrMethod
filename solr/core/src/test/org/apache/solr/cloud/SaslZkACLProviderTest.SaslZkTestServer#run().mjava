    @Override
    public void run() throws InterruptedException {
      try {
        kdc = KerberosTestUtil.getKdc(new File(kdcDir));
        // Don't require that credentials match the entire principal string, e.g.
        // can match "solr" rather than "solr/host@DOMAIN"
        System.setProperty("zookeeper.kerberos.removeRealmFromPrincipal", "true");
        System.setProperty("zookeeper.kerberos.removeHostFromPrincipal", "true");
        File keytabFile = new File(kdcDir, "keytabs");
        String zkClientPrincipal = "solr";
        String zkServerPrincipal = "zookeeper/127.0.0.1";

        kdc.start();
        // Create ZK client and server principals and load them into the Configuration
        kdc.createPrincipal(keytabFile, zkClientPrincipal, zkServerPrincipal);
        KerberosTestUtil.JaasConfiguration jaas = new KerberosTestUtil.JaasConfiguration(
        zkClientPrincipal, keytabFile, zkServerPrincipal, keytabFile);
        Configuration.setConfiguration(jaas);
      } catch (Exception ex) {
        throw new RuntimeException(ex);
      }
      super.run();
    }

