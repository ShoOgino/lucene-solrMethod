  private void checkForMissingCollection(String collectionName)
      throws Exception {
    // check for a  collection - we poll the state
    long timeoutAt = System.currentTimeMillis() + 15000;
    boolean found = true;
    while (System.currentTimeMillis() < timeoutAt) {
      solrj.getZkStateReader().updateCloudState(true);
      CloudState cloudState = solrj.getZkStateReader().getCloudState();
      Map<String,Map<String,Slice>> collections = cloudState
          .getCollectionStates();
      if (!collections.containsKey(collectionName)) {
        found = false;
        break;
      }
      Thread.sleep(100);
    }
    if (found) {
      fail("Found collection that should be gone " + collectionName);
    }
  }

