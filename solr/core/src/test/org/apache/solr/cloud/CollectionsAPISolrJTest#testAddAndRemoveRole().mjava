  @Test
  @SuppressWarnings("unchecked")
  public void testAddAndRemoveRole() throws InterruptedException, IOException, SolrServerException {

    String node = cluster.getRandomJetty(random()).getNodeName();

    CollectionAdminRequest.addRole(node, "overseer").process(cluster.getSolrClient());

    CollectionAdminResponse response = CollectionAdminRequest.getClusterStatus().process(cluster.getSolrClient());

    NamedList<Object> rsp = response.getResponse();
    NamedList<Object> cs = (NamedList<Object>) rsp.get("cluster");
    assertNotNull("Cluster state should not be null", cs);
    Map<String, Object> roles = (Map<String, Object>) cs.get("roles");
    assertNotNull("Role information should not be null", roles);
    List<String> overseer = (List<String>) roles.get("overseer");
    assertNotNull(overseer);
    assertEquals(1, overseer.size());
    assertTrue(overseer.contains(node));
    
    // Remove role
    CollectionAdminRequest.removeRole(node, "overseer").process(cluster.getSolrClient());

    response = CollectionAdminRequest.getClusterStatus().process(cluster.getSolrClient());
    rsp = response.getResponse();
    cs = (NamedList<Object>) rsp.get("cluster");
    assertNotNull("Cluster state should not be null", cs);
    roles = (Map<String, Object>) cs.get("roles");
    assertNotNull("Role information should not be null", roles);
    overseer = (List<String>) roles.get("overseer");
    assertFalse(overseer.contains(node));
  }

