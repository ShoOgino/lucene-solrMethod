  protected void waitForEmptyQueue(long maxWait) throws Exception {
    long start = System.currentTimeMillis();
    while (queue.peek() != null) {
      if ((System.currentTimeMillis() - start) > maxWait) fail(" Queue not empty within "
          + maxWait + " ms" + System.currentTimeMillis());
      Thread.sleep(100);
    }
  }

