  /**
   * Check that batch updates with deletes
   */
  @Test
  public void testBatchAddsWithDelete() throws Exception {
    createCollections();

    // Start CDCR
    CdcrTestsUtil.cdcrRestart(sourceSolrClient);
    // Index 50 documents
    CdcrTestsUtil.indexRandomDocs(50, sourceSolrClient);

    // Delete 10 documents: 10-19
    List<String> ids = new ArrayList<>();
    for (int id = 10; id < 20; id++) {
      ids.add(Integer.toString(id));
    }
    sourceSolrClient.deleteById(ids, 10);

    CdcrTestsUtil.indexRandomDocs(50, 60, sourceSolrClient);

    // Delete 1 document: 50
    ids = new ArrayList<>();
    ids.add(Integer.toString(50));
    sourceSolrClient.deleteById(ids, 10);

    CdcrTestsUtil.indexRandomDocs(60, 70, sourceSolrClient);

    assertEquals(59, CdcrTestsUtil.waitForClusterToSync(59, sourceSolrClient));
    assertEquals(59, CdcrTestsUtil.waitForClusterToSync
        (sourceSolrClient.query(new SolrQuery(ALL_Q)).getResults().getNumFound(), targetSolrClient));

    deleteCollections();
  }

