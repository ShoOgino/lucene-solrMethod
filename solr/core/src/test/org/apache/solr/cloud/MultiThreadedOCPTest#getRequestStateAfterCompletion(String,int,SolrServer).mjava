  private String getRequestStateAfterCompletion(String requestId, int waitForSeconds, SolrServer server)
      throws IOException, SolrServerException {
    String state = null;
    long maxWait = System.nanoTime() + TimeUnit.NANOSECONDS.convert(waitForSeconds, TimeUnit.SECONDS);

    while (System.nanoTime() < maxWait)  {
      state = getRequestState(requestId, server);
      if(state.equals("completed") || state.equals("failed"))
        return state;
      try {
        Thread.sleep(1000);
      } catch (InterruptedException e) {
      }
    }

    return state;
  }

