  @Test
  public void testBuildCoreName() throws IOException, InterruptedException, KeeperException {
    String zkDir = createTempDir("zkData").toFile().getAbsolutePath();
    ZkTestServer server = new ZkTestServer(zkDir);
    server.run();
    try (SolrZkClient zkClient = new SolrZkClient(server.getZkAddress(), 10000)) {
      zkClient.makePath("/", true);
      // TODO: fix this to be independent of ZK
      ZkDistribStateManager stateManager = new ZkDistribStateManager(zkClient);
      Map<String, Slice> slices = new HashMap<>();
      slices.put("shard1", new Slice("shard1", new HashMap<>(), null));
      slices.put("shard2", new Slice("shard2", new HashMap<>(), null));

      DocCollection docCollection = new DocCollection("collection1", slices, null, DocRouter.DEFAULT);
      assertEquals("Core name pattern changed", "collection1_shard1_replica_n1", Assign.buildCoreName(stateManager, docCollection, "shard1", Replica.Type.NRT));
      assertEquals("Core name pattern changed", "collection1_shard2_replica_p2", Assign.buildCoreName(stateManager, docCollection, "shard2", Replica.Type.PULL));
    } finally {
      server.shutdown();
    }
  }

