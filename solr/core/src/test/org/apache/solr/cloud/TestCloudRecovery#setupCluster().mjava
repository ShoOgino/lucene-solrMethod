  @BeforeClass
  public static void setupCluster() throws Exception {
    TestInjection.prepRecoveryOpPauseForever = "true:30";
    System.setProperty("solr.directoryFactory", "solr.StandardDirectoryFactory");
    System.setProperty("solr.ulog.numRecordsToKeep", "1000");

    configureCluster(2)
        .addConfig("config", TEST_PATH().resolve("configsets").resolve("cloud-minimal").resolve("conf"))
        .configure();

    onlyLeaderIndexes = random().nextBoolean();
    CollectionAdminRequest
        .createCollection(COLLECTION, "config", 2, 2)
        .setRealtimeReplicas(onlyLeaderIndexes? 1: -1)
        .setMaxShardsPerNode(2)
        .process(cluster.getSolrClient());
    AbstractDistribZkTestBase.waitForRecoveriesToFinish(COLLECTION, cluster.getSolrClient().getZkStateReader(),
        false, true, 30);
  }

