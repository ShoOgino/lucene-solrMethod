  private static void testAutoAddReplicas() throws Exception {
    TimeOut timeOut = new TimeOut(30, TimeUnit.SECONDS, TimeSource.NANO_TIME);
    while (!timeOut.hasTimedOut()) {
      byte[] data = zkClient().getData(SOLR_AUTOSCALING_CONF_PATH, null, null, true);
      ZkNodeProps loaded = ZkNodeProps.load(data);
      @SuppressWarnings({"rawtypes"})
      Map triggers = (Map) loaded.get("triggers");
      if (triggers != null && triggers.containsKey(".auto_add_replicas")) {
        @SuppressWarnings({"unchecked"})
        Map<String, Object> autoAddReplicasTrigger = (Map<String, Object>) triggers.get(".auto_add_replicas");
        assertNotNull(autoAddReplicasTrigger);
        @SuppressWarnings({"unchecked"})
        List<Map<String, Object>> actions = (List<Map<String, Object>>) autoAddReplicasTrigger.get("actions");
        assertNotNull(actions);
        assertEquals(2, actions.size());
        assertEquals("auto_add_replicas_plan", actions.get(0).get("name").toString());
        assertEquals("solr.AutoAddReplicasPlanAction", actions.get(0).get("class").toString());
        break;
      } else {
        Thread.sleep(300);
      }
    }
    if (timeOut.hasTimedOut()) {
      fail("Timeout waiting for .auto_add_replicas being created");
    }
  }

