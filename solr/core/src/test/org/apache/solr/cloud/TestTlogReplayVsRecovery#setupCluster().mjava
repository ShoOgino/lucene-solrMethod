  @Before
  public void setupCluster() throws Exception {
    // we want to ensure there is tlog replay on the leader after we restart it,
    // so in addition to not committing the docs we add during network partition
    // we also want to ensure that our leader doesn't do a "Commit on close"
    DirectUpdateHandler2.commitOnClose = false; 
    
    System.setProperty("solr.directoryFactory", "solr.StandardDirectoryFactory");
    System.setProperty("solr.ulog.numRecordsToKeep", "1000");
    System.setProperty("leaderVoteWait", "60000");

    configureCluster(2)
        .addConfig("conf", configset("cloud-minimal"))
        .configure();

    NODE0 = cluster.getJettySolrRunner(0);
    NODE1 = cluster.getJettySolrRunner(1);
      
    // Add proxies
    proxies = new HashMap<>(cluster.getJettySolrRunners().size());
    jettys = new HashMap<>();
    for (JettySolrRunner jetty:cluster.getJettySolrRunners()) {
      SocketProxy proxy = new SocketProxy();
      jetty.setProxyPort(proxy.getListenPort());
      cluster.stopJettySolrRunner(jetty);//TODO: Can we avoid this restart
      cluster.startJettySolrRunner(jetty);
      proxy.open(jetty.getBaseUrl().toURI());
      log.info("Adding proxy for URL: " + jetty.getBaseUrl() + ". Proxy: " + proxy.getUrl());
      proxies.put(jetty, proxy);
      jettys.put(proxy.getUrl(), jetty);
    }
  }

