  private void testUnloadShardAndCollection() throws Exception{

    final int numShards = 2;

    final String collection = "test_unload_shard_and_collection";

    final String coreName1 = collection+"_1";
    final String coreName2 = collection+"_2";

    // create one leader and one replica
    Create createCmd = new Create();
    createCmd.setCoreName(coreName1);
    createCmd.setCollection(collection);
    String coreDataDir = createTempDir().toFile().getAbsolutePath();
    createCmd.setDataDir(getDataDir(coreDataDir));
    createCmd.setNumShards(numShards);
    
    SolrClient client = clients.get(0);
    String url1 = getBaseUrl(client);

    try (HttpSolrClient adminClient = getHttpSolrClient(url1)) {
      adminClient.setConnectionTimeout(15000);
      adminClient.setSoTimeout(60000);
      adminClient.request(createCmd);

      createCmd = new Create();
      createCmd.setCoreName(coreName2);
      createCmd.setCollection(collection);
      coreDataDir = createTempDir().toFile().getAbsolutePath();
      createCmd.setDataDir(getDataDir(coreDataDir));

      adminClient.request(createCmd);

      // does not mean they are active and up yet :*
      waitForRecoveriesToFinish(collection, false);

      final boolean unloadInOrder = random().nextBoolean();
      final String unloadCmdCoreName1 = (unloadInOrder ? coreName1 : coreName2);
      final String unloadCmdCoreName2 = (unloadInOrder ? coreName2 : coreName1);

      // now unload one of the two
      Unload unloadCmd = new Unload(false);
      unloadCmd.setCoreName(unloadCmdCoreName1);
      adminClient.request(unloadCmd);

      // there should still be two shards (as of SOLR-5209)
      checkCoreNamePresenceAndSliceCount(collection, unloadCmdCoreName1, false /* shouldBePresent */, numShards /* expectedSliceCount */);

      // now unload one of the other
      unloadCmd = new Unload(false);
      unloadCmd.setCoreName(unloadCmdCoreName2);
      adminClient.request(unloadCmd);
      checkCoreNamePresenceAndSliceCount(collection, unloadCmdCoreName2, false /* shouldBePresent */, numShards /* expectedSliceCount */);
    }

    //printLayout();
    // the collection should still be present (as of SOLR-5209 replica removal does not cascade to remove the slice and collection)
    assertTrue("No longer found collection "+collection, getCommonCloudSolrClient().getZkStateReader().getClusterState().hasCollection(collection));
  }

