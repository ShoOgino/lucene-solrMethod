  @Test
  @BadApple(bugUrl="https://issues.apache.org/jira/browse/SOLR-12028")
  public void test() throws Exception {
    waitForThingsToLevelOut(30000);

    testLeaderInitiatedRecoveryCRUD();

    testDoRecoveryOnRestart();

    // Tests that if we set a minRf that's not satisfied, no recovery is requested, but if minRf is satisfied,
    // recovery is requested
    testMinRf();

    waitForThingsToLevelOut(30000);

    // test a 1x2 collection
    testRf2();

    waitForThingsToLevelOut(30000);

    // now do similar for a 1x3 collection while taking 2 replicas on-and-off
    // each time
    testRf3();

    waitForThingsToLevelOut(30000);

    // have the leader lose its Zk session temporarily
    testLeaderZkSessionLoss();

    waitForThingsToLevelOut(30000);

    log.info("HttpPartitionTest succeeded ... shutting down now!");
  }

