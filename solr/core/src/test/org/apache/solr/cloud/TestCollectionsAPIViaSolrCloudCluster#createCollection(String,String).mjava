  private void createCollection(String collectionName, String createNodeSet) throws Exception {
    if (random().nextBoolean()) { // process asynchronously
      CollectionAdminRequest.createCollection(collectionName, configName, numShards, numReplicas)
          .setMaxShardsPerNode(maxShardsPerNode)
          .setCreateNodeSet(createNodeSet)
          .setProperties(collectionProperties)
          .processAndWait(cluster.getSolrClient(), 30);
    }
    else {
      CollectionAdminRequest.createCollection(collectionName, configName, numShards, numReplicas)
          .setMaxShardsPerNode(maxShardsPerNode)
          .setCreateNodeSet(createNodeSet)
          .setProperties(collectionProperties)
          .process(cluster.getSolrClient());
    }
    AbstractDistribZkTestBase.waitForRecoveriesToFinish
        (collectionName, cluster.getSolrClient().getZkStateReader(), true, true, 330);
  }

