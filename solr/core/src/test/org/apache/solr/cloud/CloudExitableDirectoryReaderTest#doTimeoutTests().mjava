  public void doTimeoutTests() throws Exception {
    assertFail(params("q", "name:a*", "timeAllowed", "1"));

    long oneSecond = 1000L; // query rewriting for NUM_DOCS_PER_TYPE terms should take less time than this
    Long timeAllowed = TestUtil.nextLong(random(), oneSecond, Long.MAX_VALUE);
    assertSuccess(params("q", "name:a*", "timeAllowed",timeAllowed.toString()));

    assertFail(params("q", "name:a*", "timeAllowed", "1"));

    timeAllowed = TestUtil.nextLong(random(), oneSecond, Long.MAX_VALUE);
    assertSuccess(params("q", "name:b*", "timeAllowed",timeAllowed.toString()));

    timeAllowed = TestUtil.nextLong(random(), Long.MIN_VALUE, -1L);  // negative timeAllowed should disable timeouts
    assertSuccess(params("q", "name:b*", "timeAllowed",timeAllowed.toString()));

    assertSuccess(params("q","name:b*")); // no time limitation
  }

