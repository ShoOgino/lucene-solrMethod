  protected void testTemplate(Integer numberOfNodes, Integer replicationFactor,
      Integer numberOfSlices, Integer maxShardsPerNode,
      boolean collectionExceptedToBeCreated) throws Exception {
    Set<String> liveNodes = commonMocks(numberOfNodes);
    
    List<SubmitCapture> submitCaptures = null;
    if (collectionExceptedToBeCreated) {
      submitCaptures = mockShardHandlerForCreateJob(numberOfSlices,
          replicationFactor);
    }
    
    replay(workQueueMock);
    replay(zkStateReaderMock);
    replay(clusterStateMock);
    replay(shardHandlerMock);
    startComponentUnderTest();
    
    issueCreateJob(numberOfSlices, replicationFactor, maxShardsPerNode);
    
    waitForEmptyQueue(10000);
    
    verify(shardHandlerMock);
    
    if (collectionExceptedToBeCreated) {
      verifySubmitCaptures(submitCaptures, numberOfSlices, replicationFactor,
          liveNodes);
    }
  }

