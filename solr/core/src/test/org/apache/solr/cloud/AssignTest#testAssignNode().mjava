  @Test
  public void testAssignNode() throws Exception {
    assumeWorkingMockito();
    
    SolrZkClient zkClient = mock(SolrZkClient.class);
    Map<String, byte[]> zkClientData = new HashMap<>();
    when(zkClient.setData(anyString(), any(), anyInt(), anyBoolean())).then(invocation -> {
        zkClientData.put(invocation.getArgument(0), invocation.getArgument(1));
        return null;
      }
    );
    when(zkClient.getData(anyString(), any(), any(), anyBoolean())).then(invocation ->
        zkClientData.get(invocation.getArgument(0)));
    // TODO: fix this to be independent of ZK
    ZkDistribStateManager stateManager = new ZkDistribStateManager(zkClient);
    String nodeName = Assign.assignNode(stateManager, new DocCollection("collection1", new HashMap<>(), new HashMap<>(), DocRouter.DEFAULT));
    assertEquals("core_node1", nodeName);
    nodeName = Assign.assignNode(stateManager, new DocCollection("collection2", new HashMap<>(), new HashMap<>(), DocRouter.DEFAULT));
    assertEquals("core_node1", nodeName);
    nodeName = Assign.assignNode(stateManager, new DocCollection("collection1", new HashMap<>(), new HashMap<>(), DocRouter.DEFAULT));
    assertEquals("core_node2", nodeName);
  }

