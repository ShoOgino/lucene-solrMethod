  // It's OK not to check the return here since the subsequent tests will fail.
  void issueCommands() throws IOException, SolrServerException, KeeperException, InterruptedException {

    // Find a replica to make the preferredLeader. NOTE: may be one that's _already_ leader!
    expected.clear();
    for (Map.Entry<String, List<Replica>> ent : initial.entrySet()) {
      List<Replica> replicas = ent.getValue();
      Replica rep = replicas.get(Math.abs(random().nextInt()) % replicas.size());
      expected.put(ent.getKey(), rep);
      issuePreferred(ent.getKey(), rep);
    }

    if (waitForAllPreferreds() == false) {
      fail("Waited for timeout for preferredLeader assignments to be made and they werent.");
    }
    //fillExpectedWithCurrent();
    // Now rebalance the leaders randomly using SolrJ or direct call
    if(random().nextBoolean())
      rebalanceLeaderUsingSolrJAPI();
    else
      rebalanceLeaderUsingDirectCall();

  }

