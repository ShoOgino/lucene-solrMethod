  @Test
  public void testComplexSnapshot() throws Exception {
    File snapshotDir = new File(TEST_HOME(), "simSnapshot");
    SnapshotCloudManager snapshotCloudManager = SnapshotCloudManager.readSnapshot(snapshotDir);
    assertEquals(48, snapshotCloudManager.getClusterStateProvider().getLiveNodes().size());
    assertEquals(16, snapshotCloudManager.getClusterStateProvider().getClusterState().getCollectionStates().size());
    try (SimCloudManager simCloudManager = SimCloudManager.createCluster(snapshotCloudManager, null, TimeSource.get("simTime:50"))) {
      List<Suggester.SuggestionInfo> suggestions = PolicyHelper.getSuggestions(simCloudManager.getDistribStateManager().getAutoScalingConfig(), simCloudManager);
      assertEquals(1, suggestions.size());
      Suggester.SuggestionInfo suggestion = suggestions.get(0);
      assertEquals(Suggestion.Type.improvement.toString(), suggestion.toMap(new HashMap<>()).get("type").toString());
    }
  }

