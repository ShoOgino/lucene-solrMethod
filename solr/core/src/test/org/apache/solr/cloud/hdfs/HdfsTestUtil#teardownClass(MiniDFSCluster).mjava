  public static void teardownClass(MiniDFSCluster dfsCluster) throws Exception {

    if (badTlogOutStream != null) {
      IOUtils.closeQuietly(badTlogOutStream);
    }

    if (badTlogOutStreamFs != null) {
      IOUtils.closeQuietly(badTlogOutStreamFs);
    }

    SolrTestCaseJ4.resetFactory();

    try {
      if (dfsCluster != null) {
        Timer timer = timers.remove(dfsCluster);
        if (timer != null) {
          timer.cancel();
        }
        try {
          dfsCluster.shutdown();
        } catch (Error e) {
          // Added in SOLR-7134
          // Rarely, this can fail to either a NullPointerException
          // or a class not found exception. The later may fixable
          // by adding test dependencies.
          log.warn("Exception shutting down dfsCluster", e);
        }
      }
    } finally {
      System.clearProperty("solr.lock.type");
      System.clearProperty("test.build.data");
      System.clearProperty("test.cache.data");
      System.clearProperty("solr.hdfs.home");
      System.clearProperty("solr.hdfs.blockcache.global");
    }
  }

