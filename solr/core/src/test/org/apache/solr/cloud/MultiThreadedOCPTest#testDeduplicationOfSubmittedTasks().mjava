  private void testDeduplicationOfSubmittedTasks() throws IOException, SolrServerException {
    SolrServer server = createNewSolrServer("", getBaseUrl((HttpSolrServer) clients.get(0)));
    CollectionAdminRequest.createCollection("ocptest_shardsplit2", 4, "conf1", server, "3000");

    CollectionAdminRequest.splitShard("ocptest_shardsplit2", SHARD1, server, "3001");
    CollectionAdminRequest.splitShard("ocptest_shardsplit2", SHARD2, server, "3002");

    // Now submit another task with the same id. At this time, hopefully the previous 2002 should still be in the queue.
    CollectionAdminResponse response = CollectionAdminRequest.splitShard("ocptest_shardsplit2", SHARD1, server, "3002");
    NamedList r = response.getResponse();
    assertEquals("Duplicate request was supposed to exist but wasn't found. De-duplication of submitted task failed.",
        "Task with the same requestid already exists.", r.get("error"));

    for (int i=3001;i<=3002;i++) {
      String state = getRequestStateAfterCompletion(i + "", 30, server);
      assertTrue("Task " + i + " did not complete, final state: " + state,state.equals("completed"));
    }
  }

