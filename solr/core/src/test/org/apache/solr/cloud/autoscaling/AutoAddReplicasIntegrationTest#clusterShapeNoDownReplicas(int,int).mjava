  private static CollectionStatePredicate clusterShapeNoDownReplicas(final int expectedShards,
                                                                     final int expectedReplicas) {
    return (liveNodes, collectionState)
      -> (clusterShape(expectedShards, expectedReplicas).matches(liveNodes, collectionState)
          && collectionState.getReplicas().size() == expectedReplicas);
  }

