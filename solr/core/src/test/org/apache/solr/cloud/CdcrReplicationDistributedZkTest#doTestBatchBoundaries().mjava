  /**
   * Checks that batches are correctly constructed when batch boundaries are reached.
   */
  public void doTestBatchBoundaries() throws Exception {
    invokeCdcrAction(shardToLeaderJetty.get(SOURCE_COLLECTION).get(SHARD1), CdcrParams.CdcrAction.START);

    log.info("Indexing documents");

    List<SolrInputDocument> docs = new ArrayList<>();
    for (int i = 0; i < 128; i++) { // should create two full batches (default batch = 64)
      docs.add(getDoc(id, Integer.toString(i)));
    }
    index(SOURCE_COLLECTION, docs);

    assertEquals(128, getNumDocs(SOURCE_COLLECTION));

    this.waitForReplicationToComplete(SOURCE_COLLECTION, SHARD1);

    commit(TARGET_COLLECTION);

    assertEquals(128, getNumDocs(SOURCE_COLLECTION));
    assertEquals(128, getNumDocs(TARGET_COLLECTION));
  }

