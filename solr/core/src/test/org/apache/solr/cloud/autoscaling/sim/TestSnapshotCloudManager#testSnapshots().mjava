  @Test
  public void testSnapshots() throws Exception {
    SnapshotCloudManager snapshotCloudManager = new SnapshotCloudManager(realManager, null);
    Map<String, Object> snapshot = snapshotCloudManager.getSnapshot(true, false);
    SnapshotCloudManager snapshotCloudManager1 = new SnapshotCloudManager(snapshot);
    SimSolrCloudTestCase.assertClusterStateEquals(realManager.getClusterStateProvider().getClusterState(), snapshotCloudManager.getClusterStateProvider().getClusterState());
    SimSolrCloudTestCase.assertClusterStateEquals(realManager.getClusterStateProvider().getClusterState(), snapshotCloudManager1.getClusterStateProvider().getClusterState());
    // this will always fail because the metrics will be already different
    // assertNodeStateProvider(realManager, snapshotCloudManager);
    assertNodeStateProvider(snapshotCloudManager, snapshotCloudManager1);
    assertDistribStateManager(snapshotCloudManager.getDistribStateManager(), snapshotCloudManager1.getDistribStateManager());
  }

