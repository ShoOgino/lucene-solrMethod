  private void createSolrCore(final String collection,
      List<SolrServer> collectionClients, final String baseUrl, final int num,
      final String shardId) {
    Callable call = new Callable() {
      public Object call() {
        HttpSolrServer server;
        try {
          server = new HttpSolrServer(baseUrl);
          
          Create createCmd = new Create();
          createCmd.setRoles("none");
          createCmd.setCoreName(collection + num);
          createCmd.setCollection(collection);
          if (shardId == null) {
            createCmd.setNumShards(2);
          }
          createCmd.setDataDir(dataDir.getAbsolutePath() + File.separator
              + collection + num);
          if (shardId != null) {
            createCmd.setShardId(shardId);
          }
          server.request(createCmd);
        } catch (Exception e) {
          e.printStackTrace();
          //fail
        }
        return null;
      }
    };
    
    pending.add(completionService.submit(call));
 
    
    collectionClients.add(createNewSolrServer(collection, baseUrl));
  }

