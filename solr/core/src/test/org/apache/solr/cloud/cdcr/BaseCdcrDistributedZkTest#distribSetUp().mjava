  @Override
  public void distribSetUp() throws Exception {
    super.distribSetUp();

    if (shardCount > 0) {
      System.setProperty("numShards", Integer.toString(shardCount));
    } else {
      System.clearProperty("numShards");
    }

    if (isSSLMode()) {
      System.clearProperty("urlScheme");
      ZkStateReader zkStateReader = new ZkStateReader(zkServer.getZkAddress(),
          AbstractZkTestCase.TIMEOUT, AbstractZkTestCase.TIMEOUT);
      try {
        zkStateReader.getZkClient().create(ZkStateReader.CLUSTER_PROPS,
            Utils.toJSON(Collections.singletonMap("urlScheme", "https")),
            CreateMode.PERSISTENT, true);
      } catch (KeeperException.NodeExistsException e) {
        ZkNodeProps props = ZkNodeProps.load(zkStateReader.getZkClient().getData(ZkStateReader.CLUSTER_PROPS,
            null, null, true));
        props = props.plus("urlScheme", "https");
        zkStateReader.getZkClient().setData(CLUSTER_PROPS, Utils.toJSON(props), true);
      } finally {
        zkStateReader.close();
      }
    }
  }

