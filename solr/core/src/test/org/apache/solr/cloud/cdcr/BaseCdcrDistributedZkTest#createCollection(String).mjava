  /**
   * Create a new collection through the Collection API. It enforces the use of one max shard per node.
   * It will define the nodes to spread the new collection across by using the mapping {@link #collectionToNodeNames},
   * to ensure that a node will not host more than one core (which will create problem when trying to restart servers).
   */
  private void createCollection(String name) throws Exception {
    CloudSolrClient client = createCloudClient(null);
    try {
      // Create the target collection
      Map<String, List<Integer>> collectionInfos = new HashMap<>();

      StringBuilder sb = new StringBuilder();
      for (String nodeName : collectionToNodeNames.get(name)) {
        sb.append(nodeName);
        sb.append(',');
      }
      sb.deleteCharAt(sb.length() - 1);

      createCollection(collectionInfos, name, shardCount, replicationFactor, client, sb.toString());
    } finally {
      client.close();
    }
  }

