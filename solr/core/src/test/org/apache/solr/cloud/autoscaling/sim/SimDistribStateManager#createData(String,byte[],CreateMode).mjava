  @Override
  public String createData(String path, byte[] data, CreateMode mode) throws AlreadyExistsException, NoSuchElementException, IOException {
    if ((CreateMode.EPHEMERAL == mode || CreateMode.PERSISTENT == mode) && hasData(path)) {
      throw new AlreadyExistsException(path);
    }

    String relPath = path.charAt(0) == '/' ? path.substring(1) : path;
    if (relPath.length() == 0) {
      // TODO should trying to create a root node throw an exception since its always init'd in the ctor?
      return null;
    }

    // non-root-node.  Make sure parent exists.
    String[] elements = relPath.split("/");
    StringBuilder parentStringBuilder = new StringBuilder();
    for (int i = 0; i < elements.length - 1; i++) {
      parentStringBuilder.append('/');
      parentStringBuilder.append(elements[i]);
    }
    if (!hasData(parentStringBuilder.toString())) {
      throw new NoSuchElementException(parentStringBuilder.toString());
    }

    multiLock.lock();
    try {
      String nodeName = elements[elements.length-1];
      Node parentNode = traverse(parentStringBuilder.toString(), false, mode);
      Node childNode = createNode(parentNode, mode, parentStringBuilder.append("/"), nodeName, false);
      childNode.setData(data, -1);
      parentNode.setChild(childNode.name, childNode);
      return childNode.path;
    } catch (BadVersionException e) {
      // not happening
      return null;
    } finally {
      multiLock.unlock();
    }

  }

