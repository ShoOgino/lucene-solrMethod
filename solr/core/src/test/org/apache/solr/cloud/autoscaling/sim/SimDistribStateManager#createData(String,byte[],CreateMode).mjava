  @Override
  public String createData(String path, byte[] data, CreateMode mode) throws AlreadyExistsException, NoSuchElementException, IOException {
    if ((CreateMode.EPHEMERAL == mode || CreateMode.PERSISTENT == mode) && hasData(path)) {
      throw new AlreadyExistsException(path);
    }
    // check if parent exists
    String relPath = path.charAt(0) == '/' ? path.substring(1) : path;
    if (relPath.length() > 0) { // non-root path - check if parent exists
      String[] elements = relPath.split("/");
      StringBuilder sb = new StringBuilder();
      for (int i = 0; i < elements.length - 1; i++) {
        sb.append('/');
        sb.append(elements[i]);
      }
      if (!hasData(sb.toString())) {
        throw new NoSuchElementException(sb.toString());
      }
    }
    Node n = null;
    multiLock.lock();
    try {
      n = traverse(path, true, mode);
    } finally {
      multiLock.unlock();
    }
    try {
      n.setData(data, -1);
      return n.path;
    } catch (BadVersionException e) {
      // not happening
      return null;
    }
  }

