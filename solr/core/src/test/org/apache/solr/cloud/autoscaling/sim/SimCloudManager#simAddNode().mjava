  /**
   * Add a new node and initialize its node values (metrics). The
   * /live_nodes list is updated with the new node id.
   * @return new node id
   */
  public String simAddNode() throws Exception {
    Map<String, Object> values = createNodeValues(null);
    String nodeId = (String)values.get(ImplicitSnitch.NODE);
    clusterStateProvider.simAddNode(nodeId);
    nodeStateProvider.simSetNodeValues(nodeId, values);
    LOG.trace("-- added node " + nodeId);
    // initialize history handler if this is the first node
    if (historyHandler == null && liveNodesSet.size() == 1) {
      MetricsHandler metricsHandler = new MetricsHandler(metricManager);
      historyHandler = new MetricsHistoryHandler(nodeId, metricsHandler, solrClient, this, Collections.emptyMap());
      historyHandler.initializeMetrics(metricManager, SolrMetricManager.getRegistryName(SolrInfoBean.Group.node), metricTag, CommonParams.METRICS_HISTORY_PATH);
    }
    return nodeId;
  }

