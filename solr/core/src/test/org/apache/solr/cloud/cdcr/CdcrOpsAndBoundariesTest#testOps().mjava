  /**
   * Check the ops statistics.
   */
  @Test
  @BadApple(bugUrl="https://issues.apache.org/jira/browse/SOLR-12028") // 14-Oct-2018
  public void testOps() throws Exception {
    createCollections();

    // Start CDCR
    CdcrTestsUtil.cdcrRestart(sourceSolrClient);

    // Index documents
    CdcrTestsUtil.indexRandomDocs(100, sourceSolrClient);
    double opsAll = 0.0;
    NamedList ops = null;

    // calculate ops
    int itr = 10;
    while (itr-- > 0 && opsAll == 0.0) {
      NamedList rsp = CdcrTestsUtil.invokeCdcrAction(sourceSolrClient, CdcrParams.CdcrAction.OPS).getResponse();
      NamedList collections = (NamedList) ((NamedList) rsp.get(CdcrParams.OPERATIONS_PER_SECOND)).getVal(0);
      ops = (NamedList) collections.get(TARGET_COLLECTION);
      opsAll = (Double) ops.get(CdcrParams.COUNTER_ALL);
      Thread.sleep(250); // wait for cdcr to complete and check
    }
    // asserts ops values
    double opsAdds = (Double) ops.get(CdcrParams.COUNTER_ADDS);
    assertTrue(opsAll > 0);
    assertTrue(opsAdds > 0);
    double opsDeletes = (Double) ops.get(CdcrParams.COUNTER_DELETES);
    assertEquals(0, opsDeletes, 0);

    // Delete 10 documents: 10-19
    List<String> ids;
    for (int id = 0; id < 50; id++) {
      ids = new ArrayList<>();
      ids.add(Integer.toString(id));
      sourceSolrClient.deleteById(ids, 1);
      int dbq_id = 50 + id;
      sourceSolrClient.deleteByQuery("id:" + dbq_id, 1);
    }

    itr = 10;
    while (itr-- > 0) {
      NamedList rsp = CdcrTestsUtil.invokeCdcrAction(sourceSolrClient, CdcrParams.CdcrAction.OPS).getResponse();
      NamedList collections = (NamedList) ((NamedList) rsp.get(CdcrParams.OPERATIONS_PER_SECOND)).getVal(0);
      ops = (NamedList) collections.get(TARGET_COLLECTION);
      opsAll = (Double) ops.get(CdcrParams.COUNTER_ALL);
      Thread.sleep(250); // wait for cdcr to complete and check
    }
    // asserts ops values
    opsAdds = (Double) ops.get(CdcrParams.COUNTER_ADDS);
    opsDeletes = (Double) ops.get(CdcrParams.COUNTER_DELETES);
    assertTrue(opsAll > 0);
    assertTrue(opsAdds > 0);
    assertTrue(opsDeletes > 0);

    deleteCollections();
  }

