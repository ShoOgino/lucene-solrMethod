  @Override
  public ClusterState getClusterState() throws IOException {
    ensureNotClosed();
    lock.lock();
    try {
      Map<String, DocCollection> states = getCollectionStates();
      ClusterState state = new ClusterState(clusterStateVersion, liveNodes.get(), states);
      return state;
    } finally {
      lock.unlock();
    }
  }

