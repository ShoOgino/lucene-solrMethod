    /**
     * Shutdown the serving instance
     * @throws IOException 
     */
    protected void shutdown() throws IOException {
      zooKeeperServer.shutdown();
      ZKDatabase zkDb = zooKeeperServer.getZKDatabase();
      if (zkDb != null) {
        zkDb.close();
      }
      waitForServerDown(getZkHost() + ":" + getPort(), 5000);
      cnxnFactory.shutdown();
    }

