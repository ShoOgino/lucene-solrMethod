  /**
   * Checks that batches are correctly constructed when batch boundaries are reached.
   */
  @Test
  public void testBatchBoundaries() throws Exception {
    createCollections();

    // Start CDCR
    CdcrTestsUtil.cdcrRestart(sourceSolrClient);

    log.info("Indexing documents");

    CdcrTestsUtil.indexRandomDocs(1000, sourceSolrClient);

    assertEquals(1000, CdcrTestsUtil.waitForClusterToSync
        (sourceSolrClient.query(new SolrQuery(ALL_Q)).getResults().getNumFound(), targetSolrClient));

    deleteCollections();
  }

