  @Test
  public void testOperatingSystemMetricsSet() throws Exception {
    MBeanServer mBeanServer = ManagementFactory.getPlatformMBeanServer();
    OperatingSystemMetricSet set = new OperatingSystemMetricSet(mBeanServer);
    Map<String, Metric> metrics = set.getMetrics();
    assertTrue(metrics.size() > 0);
    for (String metric : OperatingSystemMetricSet.METRICS) {
      Gauge<?> gauge = (Gauge<?>)metrics.get(metric);
      if (gauge == null || gauge.getValue() == null) { // some are optional depending on OS
        continue;
      }
      double value = ((Number)gauge.getValue()).doubleValue();
      // SystemLoadAverage on Windows may be -1.0
      assertTrue("unexpected value of " + metric + ": " + value, value >= 0 || value == -1.0);
    }
  }

