  @Before
  public void beforeTest() throws Exception {
    initCore("solrconfig-basic.xml", "schema.xml");

    final SolrCore core = h.getCore();
    domain = core.getName();

    coreMetricManager = core.getCoreMetricManager();
    metricManager = core.getCoreDescriptor().getCoreContainer().getMetricManager();
    PluginInfo pluginInfo = createReporterPluginInfo();
    metricManager.loadReporter(coreMetricManager.getRegistryName(), coreMetricManager.getCore().getResourceLoader(), pluginInfo);

    Map<String, SolrMetricReporter> reporters = metricManager.getReporters(coreMetricManager.getRegistryName());
    assertTrue("reporters.size should be > 0, but was + " + reporters.size(), reporters.size() > 0);
    reporterName = pluginInfo.name;
    assertNotNull("reporter " + reporterName + " not present among " + reporters, reporters.get(reporterName));
    assertTrue("wrong reporter class: " + reporters.get(reporterName), reporters.get(reporterName) instanceof SolrJmxReporter);

    reporter = (SolrJmxReporter) reporters.get(reporterName);
    mBeanServer = reporter.getMBeanServer();
    assertNotNull("MBean server not found.", mBeanServer);
  }

