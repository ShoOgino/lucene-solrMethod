  /**
   * <p>
   * Given a list of field names in the schema, returns an immutable list in 
   * deterministically random order with the following things removed:
   * </p>
   * <ul>
   *  <li><code>_version_</code> is removed</li>
   *  <li>
   *    <code>*_dv_last</code>, <code>*_dv_first</code> and <code>*_dv</code>
   *    fields are removed if the codec doesn't support missing DocValues
   *  </li>
   * </ul>
   * @see #defaultCodecSupportsMissingDocValues
   */
  public static List<String> pruneAndDeterministicallySort(Collection<String> raw) {

    final boolean prune_dv = ! defaultCodecSupportsMissingDocValues();

    ArrayList<String> names = new ArrayList<String>(37);
    for (String f : raw) {
      if (f.equals("_version_")) {
        continue;
      }
      if (prune_dv && (f.endsWith("_dv_last") || f.endsWith("_dv_first"))
                       || f.endsWith("_dv")) {
        continue;
      }
      names.add(f);
    }

    Collections.sort(names);
    Collections.shuffle(names,random());
    return Collections.<String>unmodifiableList(names);
  }

