  /**
   * <p>
   * Given a list of field names in the schema, returns an immutable list in 
   * deterministically random order with the following things removed:
   * </p>
   * <ul>
   *  <li><code>_version_</code> is removed</li>
   *  <li><code>dv_last</code> and <code>dv_first</code> fields are removed 
   *      if the codec doesn't support them</li>
   * </ul>
   * @see #defaultCodecSupportsMissingDocValues
   */
  public static List<String> pruneAndDeterministicallySort(Collection<String> raw) {

    final boolean prune_dv_missing = ! defaultCodecSupportsMissingDocValues();

    ArrayList<String> names = new ArrayList<String>(37);
    for (String f : raw) {
      if (f.equals("_version_")) {
        continue;
      }
      if (prune_dv_missing && (f.endsWith("_dv_last") || f.endsWith("_dv_first")) ) {
        continue;
      }
      names.add(f);
    }

    Collections.sort(names);
    Collections.shuffle(names,random());
    return Collections.<String>unmodifiableList(names);
  }

