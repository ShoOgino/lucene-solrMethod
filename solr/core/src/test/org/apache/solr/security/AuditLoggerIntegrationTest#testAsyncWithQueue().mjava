  @Test
  public void testAsyncWithQueue() throws Exception {
    setupCluster(true, 100, false, null);
    runAdminCommands();
    assertAuditMetricsMinimums(testHarness.get().cluster, CallbackAuditLoggerPlugin.class.getSimpleName(), 3, 0);
    ArrayList<MetricRegistry> registries = getMetricsReigstries(testHarness.get().cluster);
    Timer timer = ((Timer) registries.get(0).getMetrics().get("SECURITY./auditlogging.CallbackAuditLoggerPlugin.queuedTime"));
    double meanTimeOnQueue = timer.getSnapshot().getMean() / 1000000; // Convert to ms
    assertTrue(meanTimeOnQueue > 50);
    testHarness.get().shutdownCluster();
    assertThreeAdminEvents();
  }

