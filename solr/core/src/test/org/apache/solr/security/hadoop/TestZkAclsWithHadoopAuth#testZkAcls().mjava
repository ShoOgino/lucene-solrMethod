  @Test
  public void testZkAcls() throws Exception {
    ZooKeeper keeper = null;
    try {
      keeper = new ZooKeeper(cluster.getZkServer().getZkAddress(), (int) TimeUnit.MINUTES.toMillis(1), new Watcher() {
        @Override
        public void process(WatchedEvent arg0) {
          // Do nothing
        }
      });

      keeper.addAuthInfo("dummyauth", "solr".getBytes(StandardCharsets.UTF_8));

      // Test well known paths.
      checkNonSecurityACLs(keeper, "/solr.xml");
      checkSecurityACLs(keeper, "/security/token");
      checkSecurityACLs(keeper, "/security");

      // Now test all ZK tree.
      String zkHost = cluster.getSolrClient().getZkHost();
      String zkChroot = zkHost.contains("/")? zkHost.substring(zkHost.indexOf("/")): null;
      walkZkTree(keeper, zkChroot, "/");

    } finally {
      if (keeper != null) {
        keeper.close();
      }
    }
  }

