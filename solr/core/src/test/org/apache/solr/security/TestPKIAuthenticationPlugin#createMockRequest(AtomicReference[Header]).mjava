  private HttpServletRequest createMockRequest(final AtomicReference<Header> header) {
    HttpServletRequest mockReq = EasyMock.createMock(HttpServletRequest.class);
    EasyMock.reset(mockReq);
    mockReq.getHeader(EasyMock.anyObject(String.class));
    EasyMock.expectLastCall().andAnswer(() -> {
      if (PKIAuthenticationPlugin.HEADER.equals(getCurrentArguments()[0])) {
        if (header.get() == null) return null;
        return header.get().getValue();
      } else return null;
    }).anyTimes();
    mockReq.getUserPrincipal();
    EasyMock.expectLastCall().andAnswer(() -> null).anyTimes();

    mockReq.getRequestURI();
    EasyMock.expectLastCall().andAnswer(() -> "/collection1/select").anyTimes();

    EasyMock.replay(mockReq);
    return mockReq;
  }

