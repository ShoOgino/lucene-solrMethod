  private void checkHits(String fieldName, boolean exact, String ptStr, double distKM, int count, int ... docIds) {
    String [] tests = new String[docIds != null && docIds.length > 0 ? docIds.length + 1 : 1];
    //test for presence of required ids first
    int i = 0;
    if (docIds != null && docIds.length > 0) {
      for (int docId : docIds) {
        tests[i++] = "//result/doc/*[@name='id'][.='" + docId + "']";
      }
    }
    //check total length last; maybe response includes ids it shouldn't.  Nicer to check this last instead of first so
    // that there may be a more specific detailed id to investigate.
    tests[i++] = "*[count(//doc)=" + count + "]";

    //Test using the Solr 4 syntax
    {
      //never actually need the score but lets test
      String score = new String[]{null, "none","distance","recipDistance"}[random().nextInt(4)];

      double distDEG = DistanceUtils.dist2Degrees(distKM, DistanceUtils.EARTH_MEAN_RADIUS_KM);
      String circleStr = "Circle(" + ptStr.replaceAll(" ", "") + " d=" + distDEG + ")";
      String shapeStr;
      if (exact) {
        shapeStr = circleStr;
      } else {//bbox
        //the GEO is an assumption
        SpatialContext ctx = SpatialContext.GEO;
        shapeStr = ctx.toString( ctx.readShape(circleStr).getBoundingBox() );
      }

      //FYI default distErrPct=0.025 works with the tests in this file
      assertQ(req(
            "fl", "id", "q","*:*", "rows", "1000",
            "fq", "{!field f=" + fieldName + (score==null?"":" score="+score)
              + "}Intersects(" + shapeStr + ")"),
          tests);
    }
    //Test using the Solr 3 syntax
    {
      assertQ(req(
          "fl", "id", "q", "*:*", "rows", "1000",
          "fq", "{!" + (exact ? "geofilt" : "bbox") + " sfield=" + fieldName + " pt='" + ptStr + "' d=" + distKM + "}"),
          tests);
    }

  }

