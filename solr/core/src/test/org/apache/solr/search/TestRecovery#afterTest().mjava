  @After
  public void afterTest() {
    if (savedFactory == null) {
      System.clearProperty("solr.directoryFactory");
    } else {
      System.setProperty("solr.directoryFactory", savedFactory);
    }
    
    deleteCore();
    
    try {
      FileUtils.deleteDirectory(initCoreDataDir);
    } catch (IOException e) {
      log.error("Exception deleting core directory.", e);
    }
  }

