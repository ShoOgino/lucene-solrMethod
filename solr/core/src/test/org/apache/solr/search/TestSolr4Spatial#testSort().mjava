  @Test
  public void testSort() throws Exception {
    assertU(adoc("id", "100", fieldName, "1,2"));
    assertU(adoc("id", "101", fieldName, "4,-1"));
    assertU(adoc("id", "999", fieldName, "70,70"));//far away from these queries
    assertU(commit());

    //test absence of score=distance means it doesn't score
    assertJQ(req(
        "q", fieldName +":\"Intersects(Circle(3,4 d=9))\"",
        "fl","id,score")
        , 1e-9
        , "/response/docs/[0]/score==1.0"
        , "/response/docs/[1]/score==1.0"
    );

    //score by distance
    assertJQ(req(
        "q", "{! score=distance}"+fieldName +":\"Intersects(Circle(3,4 d=9))\"",
        "fl","id,score",
        "sort","score asc")//want ascending due to increasing distance
        , 1e-3
        , "/response/docs/[0]/id=='100'"
        , "/response/docs/[0]/score==2.827493"
        , "/response/docs/[1]/id=='101'"
        , "/response/docs/[1]/score==5.089807"
    );
    //score by recipDistance
    assertJQ(req(
        "q", "{! score=recipDistance}"+fieldName +":\"Intersects(Circle(3,4 d=9))\"",
        "fl","id,score",
        "sort","score desc")//want descending
        , 1e-3
        , "/response/docs/[0]/id=='100'"
        , "/response/docs/[0]/score==0.3099695"
        , "/response/docs/[1]/id=='101'"
        , "/response/docs/[1]/score==0.19970943"
    );

    //query again with the query point closer to #101, and check the new ordering
    assertJQ(req(
        "q", "{! score=distance}"+fieldName +":\"Intersects(Circle(4,0 d=9))\"",
        "fl","id,score",
        "sort","score asc")//want ascending due to increasing distance
        , 1e-4
        , "/response/docs/[0]/id=='101'"
        , "/response/docs/[1]/id=='100'"
    );

    //use sort=query(...)
    assertJQ(req(
        "q","-id:999",//exclude that doc
        "fl","id,score",
        "sort","query($sortQuery) asc", //want ascending due to increasing distance
        "sortQuery", "{! score=distance}"+fieldName +":\"Intersects(Circle(3,4 d=9))\"" )
        , 1e-4
        , "/response/docs/[0]/id=='100'"
        , "/response/docs/[1]/id=='101'"  );

    //check reversed direction with query point closer to #101
    assertJQ(req(
        "q","-id:999",//exclude that doc
        "fl","id,score",
        "sort","query($sortQuery) asc", //want ascending due to increasing distance
        "sortQuery", "{! score=distance}"+fieldName +":\"Intersects(Circle(4,0 d=9))\"" )
        , 1e-4
        , "/response/docs/[0]/id=='101'"
        , "/response/docs/[1]/id=='100'"  );
  }

