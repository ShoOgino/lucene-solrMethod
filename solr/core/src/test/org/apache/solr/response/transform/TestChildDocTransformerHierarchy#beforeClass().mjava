  @BeforeClass
  public static void beforeClass() throws Exception {
    initCore("solrconfig-update-processor-chains.xml", "schema-nest.xml"); // use "nest" schema
    final boolean useSegments = random().nextBoolean();
    if(useSegments) {
      // create random segments
      final int numOfDocs = 10;
      for(int i = 0; i < numOfDocs; ++i) {
        updateJ(generateDocHierarchy(i), params("update.chain", "nested"));
        if(random().nextBoolean()) {
          assertU(commit());
        }
      }
      assertU(commit());
      fqToExcludeNonTestedDocs = "{!frange l=" + firstTestedDocId + " incl=false}id_i";
    } else {
      fqToExcludeNonTestedDocs = "*:*";
    }
    firstTestedDocId = idCounter.get();
  }

