  @Test
  public void testCopyParamsToMap() {
    ModifiableSolrParams params = new ModifiableSolrParams();
    params.add("x", "X1");
    params.add("x", "X2");
    params.add("y", "Y");
    Map<String, Object> m = CollectionsHandler.copy(params, null, "x", "y");
    String[] x = (String[]) m.get("x");
    assertEquals(2, x.length);
    assertEquals("X1", x[0]);
    assertEquals("X2", x[1]);
    assertEquals("Y", m.get("y"));
    try {
      CollectionsHandler.copy(params.required(), null, "z");
      fail("Error expected");
    } catch (SolrException e) {
      assertEquals(e.code(), SolrException.ErrorCode.BAD_REQUEST.code);

    }
  }

