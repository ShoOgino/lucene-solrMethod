  @Test
  public void testSetClusterReqHandler() throws Exception {
    MiniSolrCloudCluster cluster = configureCluster(4).configure();
    try {
      SolrZkClient zkClient = cluster.getZkClient();
      new V2Request.Builder("/cluster")
          .withPayload("{add-requesthandler:{name : 'foo', class : 'org.apache.solr.handler.DumpRequestHandler'}}")
          .withMethod(SolrRequest.METHOD.POST)
          .build().process(cluster.getSolrClient());

      Map<String, Object> map = assertVersionInSync(zkClient, cluster.getSolrClient());

      assertEquals("org.apache.solr.handler.DumpRequestHandler",
          getObjectByPath(map, true, Arrays.asList("requestHandler", "foo", "class")));

      assertVersionInSync(zkClient, cluster.getSolrClient());
      V2Response rsp = new V2Request.Builder("/node/ext/foo")
          .withMethod(SolrRequest.METHOD.GET)
          .withParams(new MapSolrParams((Map) Utils.makeMap("testkey", "testval")))
          .build().process(cluster.getSolrClient());
      assertEquals("testval", rsp._getStr("params/testkey", null));

      new V2Request.Builder("/cluster")
          .withPayload("{delete-requesthandler: 'foo'}")
          .withMethod(SolrRequest.METHOD.POST)
          .build().process(cluster.getSolrClient());

      assertNull(getObjectByPath(map, true, Arrays.asList("requestHandler", "foo")));
    } finally {
      cluster.shutdown();
    }

  }

