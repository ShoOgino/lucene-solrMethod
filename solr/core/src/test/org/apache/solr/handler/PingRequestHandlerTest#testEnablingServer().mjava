  public void testEnablingServer() throws Exception {

    assertTrue(! healthcheckFile.exists());

    // first make sure that ping responds back that the service is disabled

    try {
      makeRequest(handler, req());
      fail("Should have thrown a SolrException because not enabled yet");
    } catch (SolrException se){
      assertEquals(SolrException.ErrorCode.SERVICE_UNAVAILABLE.code,se.code());
    }

    // now enable

    makeRequest(handler, req("action", "enable"));

    assertTrue(healthcheckFile.exists());
    assertNotNull(FileUtils.readFileToString(healthcheckFile), "UTF-8");

    // now verify that the handler response with success

    SolrQueryResponse rsp = makeRequest(handler, req());
    assertEquals("OK", rsp.getValues().get("status"));

    // enable when already enabled shouldn't cause any problems
    makeRequest(handler, req("action", "enable"));
    assertTrue(healthcheckFile.exists());

  }

