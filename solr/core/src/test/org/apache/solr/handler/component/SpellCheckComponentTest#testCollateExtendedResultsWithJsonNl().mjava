  @Test
  public void testCollateExtendedResultsWithJsonNl() throws Exception {
    final String q = "documemtsss broens";
    final String jsonNl = (random().nextBoolean() ? "map" : "arrntv");
    final boolean collateExtendedResults = random().nextBoolean();
    final List<String> testsList = new ArrayList<String>();
    if (collateExtendedResults) {
      testsList.add("/spellcheck/collations/collation/collationQuery=='document brown'");
      testsList.add("/spellcheck/collations/collation/hits==0");
      switch (jsonNl) {
        case "arrntv":
          testsList.add("/spellcheck/collations/collation/misspellingsAndCorrections/[0]/name=='documemtsss'");
          testsList.add("/spellcheck/collations/collation/misspellingsAndCorrections/[0]/type=='str'");
          testsList.add("/spellcheck/collations/collation/misspellingsAndCorrections/[0]/value=='document'");
          testsList.add("/spellcheck/collations/collation/misspellingsAndCorrections/[1]/name=='broens'");
          testsList.add("/spellcheck/collations/collation/misspellingsAndCorrections/[1]/type=='str'");
          testsList.add("/spellcheck/collations/collation/misspellingsAndCorrections/[1]/value=='brown'");
          break;
        case "map":
          testsList.add("/spellcheck/collations/collation/misspellingsAndCorrections/documemtsss=='document'");
          testsList.add("/spellcheck/collations/collation/misspellingsAndCorrections/broens=='brown'");
          break;
        default:
          fail("unexpected json.nl choice: "+jsonNl);
          break;
      }
    } else {
      testsList.add("/spellcheck/collations/collation=='document brown'");
    }
    final String[] testsArray = new String[testsList.size()];
    implTestCollateExtendedResultsWithJsonNl(q, jsonNl, collateExtendedResults, testsList.toArray(testsArray));
  }

