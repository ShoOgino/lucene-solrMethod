  @Before
  public void setUp() throws Exception {
    originalDiskSpaceprovider = IndexFetcher.usableDiskSpaceProvider;
    originalTestWait = IndexFetcher.testWait;
    
    super.setUp();
    System.setProperty("solr.directoryFactory", "solr.StandardDirectoryFactory");
    String factory = random().nextInt(100) < 75 ? "solr.NRTCachingDirectoryFactory" : "solr.StandardDirectoryFactory"; // test the default most of the time
    System.setProperty("solr.directoryFactory", factory);
    master = new TestReplicationHandler.SolrInstance(createTempDir("solr-instance").toFile(), "master", null);
    master.setUp();
    masterJetty = createAndStartJetty(master);
    masterClient = createNewSolrClient(masterJetty.getLocalPort());

    slave = new TestReplicationHandler.SolrInstance(createTempDir("solr-instance").toFile(), "slave", masterJetty.getLocalPort());
    slave.setUp();
    slaveJetty = createAndStartJetty(slave);
    slaveClient = createNewSolrClient(slaveJetty.getLocalPort());

    System.setProperty("solr.indexfetcher.sotimeout2", "45000");
  }

