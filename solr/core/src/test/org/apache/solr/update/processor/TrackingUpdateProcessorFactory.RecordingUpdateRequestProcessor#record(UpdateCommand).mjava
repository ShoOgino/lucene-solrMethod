    private void record(UpdateCommand cmd) {
      synchronized (memoryConsistency) {
        String coreName = cmd.getReq().getCore().getName();
        Map<Object, Object> context = cmd.getReq().getContext();
        context.put(REQUEST_COUNT, groupSerialNums.get(group).incrementAndGet());
        context.put(REQUEST_NODE, coreName);
        List<UpdateCommand> commands = commandQueueMap.get(group);
        commands.add(cmd.clone()); // important because cmd.clear() will be called
      }
    }

