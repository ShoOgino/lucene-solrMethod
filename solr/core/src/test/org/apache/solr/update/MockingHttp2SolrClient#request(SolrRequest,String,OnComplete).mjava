  public NamedList<Object> request(SolrRequest request, String collection, OnComplete onComplete)
      throws SolrServerException, IOException {
    if (request instanceof UpdateRequest) {
      UpdateRequest ur = (UpdateRequest) request;
      // won't throw exception if request is DBQ
      if (ur.getDeleteQuery() != null && !ur.getDeleteQuery().isEmpty()) {
        return super.request(request, collection, onComplete);
      }
    }

    if (exp != null) {
      if (oneExpPerReq) {
        if (reqGotException.contains(request)) {
          return super.request(request, collection, onComplete);
        }
        else
          reqGotException.add(request);
      }

      Exception e = exception();
      if (e instanceof IOException) {
        if (LuceneTestCase.random().nextBoolean()) {
          throw (IOException) e;
        } else {
          throw new SolrServerException(e);
        }
      } else if (e instanceof SolrServerException) {
        throw (SolrServerException) e;
      } else {
        throw new SolrServerException(e);
      }
    }

    return super.request(request, collection, onComplete);
  }

