  /**
   * Check that the initialisation of the log reader is picking up the tlog file that is currently being
   * written.
   */
  @Test
  public void testLogReaderInitOnNewTlog() throws Exception {
    this.clearCore();

    int start = 0;

    // Start to index some documents to instantiate the new tlog
    LinkedList<Long> versions = new LinkedList<>();
    addDocs(10, start, versions);
    start += 10;

    // Create the reader after the instantiation of the new tlog
    UpdateLog ulog = h.getCore().getUpdateHandler().getUpdateLog();
    CdcrUpdateLog.CdcrLogReader reader = ((CdcrUpdateLog) ulog).newLogReader();

    // Continue to index documents and commits
    addDocs(11, start, versions);
    start += 11;
    assertU(commit());

    // check that the log reader was initialised with the new tlog
    for (int i = 0; i < 22; i++) { // 21 adds + 1 commit
      assertNotNull(reader.next());
    }

    // we should have reach the end of the new tlog
    assertNull(reader.next());
  }

