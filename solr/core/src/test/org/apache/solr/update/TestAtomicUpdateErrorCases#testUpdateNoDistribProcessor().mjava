  public void testUpdateNoDistribProcessor() throws Exception {
    try {
      initCore("solrconfig-tlog.xml","schema15.xml");
      
      assertNotNull("this test requires an update chain named 'nodistrib'",
                    h.getCore().getUpdateProcessingChain("nodistrib")); 


      // creating docs should work fine
      addAndGetVersion(sdoc("id", "1", "val_i", "42"), 
                       params("update.chain","nodistrib"));
      assertU(commit());

      try {
        ignoreException("DistributedUpdateProcessorFactory");

        // updating docs should fail
        addAndGetVersion(sdoc("id", "1", "val_i", map("inc",-666)), 
                         params("update.chain","nodistrib"));
        
        fail("didn't get error about needing DistributedUpdateProcessorFactory");
      } catch (SolrException ex) {
        assertEquals(400, ex.code());
        // if the message doesn't match our expectation, wrap & rethrow
        if (ex.getMessage().indexOf("DistributedUpdateProcessorFactory") < 0) {
          throw new RuntimeException("exception message is not expected", ex);
        }
      } finally {
        resetExceptionIgnores();
      }

    } finally {
      deleteCore();
    }
  }

