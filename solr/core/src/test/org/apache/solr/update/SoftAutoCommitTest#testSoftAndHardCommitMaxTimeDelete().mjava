  public void testSoftAndHardCommitMaxTimeDelete() throws Exception {
    
    final int softCommitWaitMillis = 500;
    final int hardCommitWaitMillis = 1200;

    CommitTracker hardTracker = updater.commitTracker;
    CommitTracker softTracker = updater.softCommitTracker;
    
    softTracker.setTimeUpperBound(softCommitWaitMillis);
    softTracker.setDocsUpperBound(-1);
    hardTracker.setTimeUpperBound(hardCommitWaitMillis);
    hardTracker.setDocsUpperBound(-1);
    
    // add a doc and force a commit
    assertU(adoc("id", "529", "subject", "the doc we care about in this test"));
    assertU(commit());

    Long soft529;
    Long hard529;

/*** an explicit commit can (and should) clear pending auto-commits
    long postAdd529 = System.currentTimeMillis();

    // wait for first hard/soft commit
    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 3, MILLISECONDS);
    assertNotNull("soft529 wasn't fast enough", soft529);
    Long manCommit = monitor.hard.poll(0, MILLISECONDS);

    assertNotNull("manCommit wasn't fast enough", manCommit);
    assertTrue("forced manCommit didn't happen when it should have: " + 
        manCommit + " !<= " + postAdd529, 
        manCommit <= postAdd529);
    
    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 2, MILLISECONDS);
    assertNotNull("hard529 wasn't fast enough", hard529);

    monitor.assertSaneOffers();
 ***/

    monitor.clear();

    // Delete the document
    long del529 = System.currentTimeMillis();
    assertU( delI("529") );

    monitor.assertSaneOffers();

    // Wait for the soft commit with some fudge
    soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);
    assertNotNull("soft529 wasn't fast enough", soft529);
    monitor.assertSaneOffers();
 
    // check for the searcher, should have happened right after soft commit
    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis, MILLISECONDS);
    assertNotNull("searcher529 wasn't fast enough", searcher529);
    monitor.assertSaneOffers();

    // toss in another doc, shouldn't affect first hard commit time we poll
    assertU(adoc("id", "550", "subject", "just for noise/activity"));

    // wait for the hard commit
    hard529 = monitor.hard.poll(hardCommitWaitMillis * 3, MILLISECONDS);
    assertNotNull("hard529 wasn't fast enough", hard529);
    monitor.assertSaneOffers();
    
    assertTrue("soft529 occured too fast: " + 
               del529 + " + " + softCommitWaitMillis + " !<= " + soft529,
               del529 + softCommitWaitMillis <= soft529);
    assertTrue("hard529 occured too fast: " + 
               del529 + " + " + hardCommitWaitMillis + " !<= " + hard529,
               del529 + hardCommitWaitMillis <= hard529);

    // however slow the machine was to do the soft commit compared to expected,
    // assume newSearcher had some magnitude of that much overhead as well 
    long slowTestFudge = Math.max(100, 3 * (soft529 - del529 - softCommitWaitMillis));
    assertTrue("searcher529 wasn't soon enough after soft529: " +
               searcher529 + " !< " + soft529 + " + " + slowTestFudge + " (fudge)",
               searcher529 < soft529 + slowTestFudge );

    assertTrue("hard529 was before searcher529: " + 
               searcher529 + " !<= " + hard529,
               searcher529 <= hard529);

    // clear commmits
    monitor.hard.clear();
    monitor.soft.clear();
    
    // wait a bit, w/o other action we definitely shouldn't see any 
    // new hard/soft commits 
    assertNull("Got a hard commit we weren't expecting",
               monitor.hard.poll(2, SECONDS));
    assertNull("Got a soft commit we weren't expecting",
               monitor.soft.poll(0, MILLISECONDS));

    monitor.assertSaneOffers();
  }

