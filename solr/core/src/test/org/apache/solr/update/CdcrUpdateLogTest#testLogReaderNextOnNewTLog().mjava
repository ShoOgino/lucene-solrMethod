  /**
   * Check that the log reader is able to read the new tlog
   * and pick up new entries as they appear.
   */
  @Test
  public void testLogReaderNextOnNewTLog() throws Exception {
    this.clearCore();

    int start = 0;

    UpdateLog ulog = h.getCore().getUpdateHandler().getUpdateLog();
    CdcrUpdateLog.CdcrLogReader reader = ((CdcrUpdateLog) ulog).newLogReader();

    LinkedList<Long> versions = new LinkedList<>();
    addDocs(10, start, versions);
    start += 10;
    assertU(commit());

    addDocs(11, start, versions);
    start += 11;

    for (int i = 0; i < 22; i++) { // 21 adds + 1 commit
      assertNotNull(reader.next());
    }

    // we should have reach the end of the new tlog
    assertNull(reader.next());

    addDocs(5, start, versions);
    start += 5;

    // the reader should now pick up the new updates

    for (int i = 0; i < 5; i++) { // 5 adds
      assertNotNull(reader.next());
    }

    assertNull(reader.next());
  }

