  /**
   * Sleeps in increments of COMMIT_CHECKING_SLEEP_TIME_MS while checking to see if a commit completed. If it did,
   * then return. If not, continue this cycle for at most the amount of time specified
   * @param maxTotalWaitTimeMillis the max amount of time (in ms) to wait/check for a commit
   */
  private void waitForCommit(long maxTotalWaitTimeMillis) throws Exception {
    long startTimeNanos = System.nanoTime();
    long maxTotalWaitTimeNanos = TimeUnit.MILLISECONDS.toNanos(maxTotalWaitTimeMillis);
    while (System.nanoTime() - startTimeNanos < maxTotalWaitTimeNanos) {
      Thread.sleep(COMMIT_CHECKING_SLEEP_TIME_MS);
      if (!updateHandler.getUpdateLog().hasUncommittedChanges()) {
        return;
      }
    }
  }

