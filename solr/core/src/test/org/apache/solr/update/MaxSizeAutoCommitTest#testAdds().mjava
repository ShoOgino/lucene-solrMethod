  @Test
  public void testAdds() throws Exception {
    int maxFileSizeBound = 1000;
    // Set max size bound
    hardCommitTracker.setTLogFileSizeUpperBound(maxFileSizeBound);

    // Add a large number of docs - should trigger a commit
    int numDocsToAdd = 500;
    SolrQueryResponse updateResp = new SolrQueryResponse();

    Assert.assertEquals("There have been no updates yet, so there shouldn't have been any commits", 0,
        hardCommitTracker.getCommitCount());

    long tlogSizePreUpdates = updateHandler.getUpdateLog().getCurrentLogSizeFromStream();
    Assert.assertEquals("There have been no updates yet, so tlog should be empty", 0, tlogSizePreUpdates);

    updateRequestHandler.handleRequest(constructBatchAddDocRequest(0, numDocsToAdd), updateResp);

    // The long sleep is to allow for the triggered commit to finish
    waitForCommit(1000);

    // Verify commit information
    Assert.assertTrue("At least one commit should have occurred", hardCommitTracker.getCommitCount() > 0);
    long tlogSizePostUpdates = updateHandler.getUpdateLog().getCurrentLogSizeFromStream();
    Assert.assertTrue("Current tlog size is larger than the max bound", tlogSizePostUpdates < maxFileSizeBound);
  }

