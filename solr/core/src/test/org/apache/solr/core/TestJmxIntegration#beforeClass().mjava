  @BeforeClass
  public static void beforeClass() throws Exception {
    // Make sure that at least one MBeanServer is available
    // prior to initializing the core
    //
    // (test configs are setup to use existing server if any, 
    // otherwise skip JMX)
    MBeanServer platformServer = ManagementFactory.getPlatformMBeanServer();

    initCore("solrconfig.xml", "schema.xml");

    // we should be able to se that the core has JmxIntegration enabled
    assertTrue("JMX not enabled",
               h.getCore().getSolrConfig().jmxConfig.enabled);
    // and we should be able to see that the the monitor map found 
    // a JMX server to use, which refers to the server we started

    Map registry = h.getCore().getInfoRegistry();
    assertTrue("info registry is not a JMX monitored map",
               registry instanceof JmxMonitoredMap);
    mbeanServer = ((JmxMonitoredMap)registry).getServer();

    assertNotNull("No JMX server found by monitor map",
                  mbeanServer);

    // NOTE: we can't garuntee that "mbeanServer == platformServer"
    // the JVM may have mutiple MBean servers funning when the test started
    // and the contract of not specifying one when configuring solr with
    // <jmx /> is that it will use whatever the "first" MBean server 
    // returned by the JVM is.
  }

