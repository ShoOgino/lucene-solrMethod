  public static Pair<Server, Integer> runHttpServer(Map<String, Object> jars) throws Exception {
    int port = 0;
    int start = 30000 + random().nextInt(10000);//start at somewhere between 30000 - 40000
    for (int i = start; i < (start+1000); i++) {//check ports one by one
      try {
        new ServerSocket(i).close();
        port = i;
        break;
      } catch (IOException e) {
        continue;
      }
    }
    if (port == 0) {
      fail("No port to be found");
    }
    Server server = null;
    server = new Server(port);
    server.setHandler(new AbstractHandler() {
      @Override
      public void handle(String s, Request request, HttpServletRequest req, HttpServletResponse rsp)
          throws IOException {
        ByteBuffer b = (ByteBuffer) jars.get(s);
        if (b != null) {
          rsp.getOutputStream().write(b.array(), 0, b.limit());
          rsp.setContentType("application/octet-stream");
          rsp.setStatus(HttpServletResponse.SC_OK);
          request.setHandled(true);
        }
      }
    });
    server.start();
    return new Pair<>(server, port);
  }

