  @Test
  public void testJmxAugmentedSolrInfoMBean() throws Exception {
    final MockInfoMBean mock = new MockInfoMBean();
    final String jmxKey = "jmx";
    final String jmxValue = "jmxValue";

    MockJmxAugmentedSolrInfoMBean mbean = new MockJmxAugmentedSolrInfoMBean(mock) {
      @Override
      public NamedList getStatisticsForJmx() {
        NamedList stats = getStatistics();
        stats.add(jmxKey, jmxValue);
        return stats;
      }
    };
    monitoredMap.put("mock", mbean);

    // assert getStatistics called when used as a map.  Note can't use equals here to compare
    // because getStatistics returns a new Object each time.
    assertNull(monitoredMap.get("mock").getStatistics().get(jmxKey));

    //  assert getStatisticsForJmx called when used as jmx server
    Set<ObjectInstance> objects = mbeanServer.queryMBeans(null, Query.match(
        Query.attr("name"), Query.value("mock")));
    ObjectName name = objects.iterator().next().getObjectName();
    assertMBeanTypeAndValue(name, jmxKey, jmxValue.getClass(), jmxValue);
  }

