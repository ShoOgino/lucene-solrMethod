  @Before
  public void setUp() throws IllegalAccessException, NoSuchFieldException {
    blobFetched = false;
    blobKey = "";
    reset(mocks);
    repository = new BlobRepository(mockContainer) {
      @Override
      ByteBuffer fetchBlob(String key) {
        blobKey = key;
        blobFetched = true;
        return blobData;
      }

      @Override
      ByteBuffer fetchFromUrl(String key, String url) {
        if(!Objects.equals(url, BlobRepositoryMockingTest.this.url)) return null;
        blobKey = key;
        blobFetched = true;
        return filecontent;
      }

      @Override
      BlobContentRef getBlobIncRef(String key, Decoder decoder, String url, String sha256) {
        if(!Objects.equals(sha256, BlobRepositoryMockingTest.this.sha256)) return null;
        blobKey = key;
        blobFetched = true;
        return new BlobContentRef(new BlobContent(key, filecontent)) ;
      }

      @Override
      ConcurrentHashMap<String, BlobContent> createMap() {
        return mapMock;
      }

    };
  }

