  @Test
  public void testBackCompatXml() throws Exception {
    setMeUp();
    addSolrPropertiesFile();
    addSolrXml();
    addConfigsForBackCompat();

    CoreContainer cc = init();
    try {
      Properties props = cc.getContainerProperties();

      assertEquals("/admin/cores", cc.getAdminPath());
      assertEquals("collectionLazy2", cc.getDefaultCoreName());

      // Shouldn't get these in properties at this point
      assertNull(props.getProperty("cores.adminPath"));
      assertNull(props.getProperty("cores.defaultCoreName"));
      assertNull(props.getProperty("host"));
      assertNull(props.getProperty("port")); // getProperty actually looks at original props.
      assertNull(props.getProperty("cores.hostContext"));
      assertNull(props.getProperty("cores.zkClientTimeout"));

      SolrCore core1 = cc.getCore("collection1");
      CoreDescriptor desc = core1.getCoreDescriptor();

      assertEquals("collection1", desc.getProperty("solr.core.name"));

      // This is too long and ugly to put in. Besides, it varies.
      assertNotNull(desc.getProperty("solr.core.instanceDir"));

      assertEquals("data/", desc.getProperty("solr.core.dataDir"));
      assertEquals("solrconfig-minimal.xml", desc.getProperty("solr.core.configName"));
      assertEquals("schema-tiny.xml", desc.getProperty("solr.core.schemaName"));
      core1.close();
    } finally {
      cc.shutdown();
    }
  }

