  /**
   * Sends a GET request to get the zk schema version from a specific replica.
   */
  protected void validateZkVersion(Replica replica, int schemaZkVersion, int waitSecs, boolean retry) throws Exception {
    final String replicaUrl = (new ZkCoreNodeProps(replica)).getCoreUrl();
    RestTestHarness testHarness = new RestTestHarness(new RESTfulServerProvider() {
      public String getBaseURL() {
        return replicaUrl.endsWith("/") ? replicaUrl.substring(0, replicaUrl.length()-1) : replicaUrl;
      }
    });
    try {
      long waitMs = waitSecs * 1000L;
      if (waitMs > 0) Thread.sleep(waitMs); // wait a moment for the zk watcher to fire
  
      try {
        testHarness.validateQuery("/schema/zkversion?wt=xml", "//zkversion=" + schemaZkVersion);
      } catch (Exception exc) {
        if (retry) {
          // brief wait before retrying
          Thread.sleep(waitMs > 0 ? waitMs : 2000L);
  
          testHarness.validateQuery("/schema/zkversion?wt=xml", "//zkversion=" + schemaZkVersion);
        } else {
          throw exc;
        }
      }
    } finally {
      testHarness.close();
    }
  }

