  public SolrDocument next() {
    int id = docIterator.nextDoc();
    idx++;
    SolrDocument sdoc = null;

    try {
      if (retrieveFieldsOptimizer.returnStoredFields()) {
        Document doc = docFetcher.doc(id, retrieveFieldsOptimizer.getStoredFields());
        // make sure to use the schema from the searcher and not the request (cross-core)
        sdoc = convertLuceneDocToSolrDoc(doc, rctx.getSearcher().getSchema(),
                                         rctx.getReturnFields());
      } else {
        // no need to get stored fields of the document, see SOLR-5968
        sdoc = new SolrDocument();
      }

      // decorate the document with non-stored docValues fields
      if (retrieveFieldsOptimizer.returnDVFields()) {
        docFetcher.decorateDocValueFields(sdoc, id, retrieveFieldsOptimizer.getDvFields());
      }
    } catch (IOException e) {
      throw new SolrException(SolrException.ErrorCode.SERVER_ERROR, "Error reading document with docId " + id, e);
    }

    if (transformer != null) {
      boolean doScore = rctx.wantsScores();
      try {
        if (doScore) {
          transformer.transform(sdoc, id, docIterator.score());
        } else {
          transformer.transform(sdoc, id);
        }
      } catch (IOException e) {
        throw new SolrException(SolrException.ErrorCode.SERVER_ERROR, "Error applying transformer", e);
      }
    }
    return sdoc;

  }

