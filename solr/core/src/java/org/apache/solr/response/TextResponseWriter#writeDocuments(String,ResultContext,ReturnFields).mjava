  public final void writeDocuments(String name, ResultContext res, ReturnFields fields ) throws IOException {
    DocList ids = res.docs;
    DocsStreamer docsStreamer = new DocsStreamer(res.docs,res.query, req, fields);
    writeStartDocumentList(name, ids.offset(), ids.size(), ids.matches(),
        docsStreamer.hasScores() ? new Float(ids.maxScore()) : null);

    while (docsStreamer.hasNext()) {
      writeSolrDocument(null, docsStreamer.next(), returnFields, docsStreamer.currentIndex());
    }
    writeEndDocumentList();
  }

