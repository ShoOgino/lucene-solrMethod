  @Override
  public void transform(SolrDocument doc, int docid, float score) {

    FieldType idFt = idField.getType();
    Object parentIdField = doc.getFirstValue(idField.getName());
    
    String parentIdExt = parentIdField instanceof StorableField
      ? idFt.toExternal((StorableField)parentIdField)
      : parentIdField.toString();

    try {
      Query parentQuery = idFt.getFieldQuery(null, idField, parentIdExt);
      Query query = new ToChildBlockJoinQuery(parentQuery, parentsFilter);
      DocList children = context.getSearcher().getDocList(query, childFilterQuery, new Sort(), 0, limit);
      if(children.matches() > 0) {
        DocIterator i = children.iterator();
        while(i.hasNext()) {
          Integer childDocNum = i.next();
          StoredDocument childDoc = context.getSearcher().doc(childDocNum);
          SolrDocument solrChildDoc = DocsStreamer.getDoc(childDoc, schema);

          // TODO: future enhancement...
          // support an fl local param in the transformer, which is used to build
          // a private ReturnFields instance that we use to prune unwanted field 
          // names from solrChildDoc
          doc.addChildDocument(solrChildDoc);
        }
      }
      
    } catch (IOException e) {
      doc.put(name, "Could not fetch child Documents");
    }
  }

