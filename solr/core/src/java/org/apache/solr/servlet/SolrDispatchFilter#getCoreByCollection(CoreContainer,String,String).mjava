  private SolrCore getCoreByCollection(CoreContainer cores, String corename, String path) {
    String collection = corename;
    ZkStateReader zkStateReader = cores.getZkController().getZkStateReader();
    
    CloudState cloudState = zkStateReader.getCloudState();
    Map<String,Slice> slices = cloudState.getSlices(collection);
    if (slices == null) {
      return null;
    }
    // look for a core on this node
    Set<Entry<String,Slice>> entries = slices.entrySet();
    SolrCore core = null;
    done:
    for (Entry<String,Slice> entry : entries) {
      // first see if we have the leader
      ZkNodeProps leaderProps = cloudState.getLeader(collection, entry.getKey());
      core = checkProps(cores, path, leaderProps);
      if (core != null) {
        break done;
      }
      
      // check everyone then
      Map<String,ZkNodeProps> shards = entry.getValue().getShards();
      Set<Entry<String,ZkNodeProps>> shardEntries = shards.entrySet();
      for (Entry<String,ZkNodeProps> shardEntry : shardEntries) {
        ZkNodeProps zkProps = shardEntry.getValue();
        core = checkProps(cores, path, zkProps);
        if (core != null) {
          break done;
        }
      }
    }
    return core;
  }

