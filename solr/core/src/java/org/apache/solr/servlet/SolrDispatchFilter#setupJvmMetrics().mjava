  private void setupJvmMetrics()  {
    MBeanServer platformMBeanServer = ManagementFactory.getPlatformMBeanServer();
    SolrMetricManager metricManager = cores.getMetricManager();
    try {
      String registry = SolrMetricManager.getRegistryName(SolrInfoMBean.Group.jvm);
      metricManager.registerAll(registry, new BufferPoolMetricSet(platformMBeanServer), true, "bufferPools");
      metricManager.registerAll(registry, new ClassLoadingGaugeSet(), true, "classLoading");
      metricManager.register(registry, new FileDescriptorRatioGauge(), true, "fileDescriptorRatio");
      metricManager.registerAll(registry, new GarbageCollectorMetricSet(), true, "gc");
      metricManager.registerAll(registry, new MemoryUsageGaugeSet(), true, "memory");
      metricManager.registerAll(registry, new ThreadStatesGaugeSet(), true, "threads"); // todo should we use CachedThreadStatesGaugeSet instead?
    } catch (Exception e) {
      log.warn("Error registering JVM metrics", e);
    }
  }

