  private MatchStatus determineIfPermissionPermitsPrincipal(Principal principal, Permission governingPermission) {
    if (governingPermission.role == null) {
      //no role is assigned permission.That means everybody is allowed to access
      return MatchStatus.PERMITTED;
    }
    if (principal == null) {
      log.info("request has come without principal. failed permission {} ", governingPermission);
      //this resource needs a principal but the request has come without
      //any credential.
      return MatchStatus.USER_REQUIRED;
    } else if (governingPermission.role.contains("*")) {
      return MatchStatus.PERMITTED;
    }

    for (String role : governingPermission.role) {
      Set<String> userRoles = usersVsRoles.get(principal.getName());
      if (userRoles != null && userRoles.contains(role)) return MatchStatus.PERMITTED;
    }
    log.info("This resource is configured to have a permission {}, The principal {} does not have the right role ", governingPermission, principal);
    return MatchStatus.FORBIDDEN;
  }

