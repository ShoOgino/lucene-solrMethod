  HttpServletRequest wrapWithPrincipal(HttpServletRequest request, Principal principal) {
    return new HttpServletRequestWrapper(request) {
      @Override
      public Principal getUserPrincipal() {
        return principal;
      }
    };
  }

