  private void initJwk(Map<String, Object> pluginConfig) {
    this.pluginConfig = pluginConfig;
    String confJwkUrl = (String) pluginConfig.get(PARAM_JWK_URL);
    Map<String, Object> confJwk = (Map<String, Object>) pluginConfig.get(PARAM_JWK);
    jwkCacheDuration = Long.parseLong((String) pluginConfig.getOrDefault(PARAM_JWK_CACHE_DURATION, "3600"));

    jwtConsumer = null;
    int jwkConfigured = confIdpConfigUrl != null ? 1 : 0;
    jwkConfigured += confJwkUrl != null ? 1 : 0;
    jwkConfigured += confJwk != null ? 1 : 0;
    if (jwkConfigured > 1) {
      throw new SolrException(SolrException.ErrorCode.SERVER_ERROR, "JWTAuthPlugin needs to configure exactly one of " +
          PARAM_WELL_KNOWN_URL + ", " + PARAM_JWK_URL + " and " + PARAM_JWK);
    }
    if (jwkConfigured == 0) {
      log.warn("Initialized JWTAuthPlugin without any JWK config. Requests with jwk header will fail.");
    }
    if (oidcDiscoveryConfig != null) {
      String jwkUrl = oidcDiscoveryConfig.getJwksUrl();
      setupJwkUrl(jwkUrl);
    } else if (confJwkUrl != null) {
      setupJwkUrl(confJwkUrl);
    } else if (confJwk != null) {
      try {
        JsonWebKeySet jwks = parseJwkSet(confJwk);
        verificationKeyResolver = new JwksVerificationKeyResolver(jwks.getJsonWebKeys());
      } catch (JoseException e) {
        throw new SolrException(SolrException.ErrorCode.SERVER_ERROR, "Invalid JWTAuthPlugin configuration, " + PARAM_JWK + " parse error", e);
      }
    }
    initConsumer();
    log.debug("JWK configured");
  }

