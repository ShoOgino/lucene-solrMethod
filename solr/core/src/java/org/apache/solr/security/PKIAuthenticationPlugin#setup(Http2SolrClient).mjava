  @Override
  public void setup(Http2SolrClient client) {
    final HttpListenerFactory.RequestResponseListener listener = new HttpListenerFactory.RequestResponseListener() {
      @Override
      public void onQueued(Request request) {
        if (cores.getAuthenticationPlugin() == null) {
          return;
        }
        if (!cores.getAuthenticationPlugin().interceptInternodeRequest(request)) {
          log.debug("{} secures this internode request", this.getClass().getSimpleName());
          generateToken().ifPresent(s -> request.header(HEADER, myNodeName + " " + s));
        } else {
          log.debug("{} secures this internode request", cores.getAuthenticationPlugin().getClass().getSimpleName());
        }
      }
    };
    client.addListenerFactory(() -> listener);
  }

