  public static void setCoreDescriptor(CoreContainer coreContainer, CoreDescriptor cd) {
    if (cd != null) {
      int callDepth = CALL_DEPTH.get();
      CALL_DEPTH.set(callDepth + 1);
      if (callDepth > 0) {
        return;
      }
      
      setCoreName(cd.getName());
      if (coreContainer != null) {
        ZkController zkController = coreContainer.getZkController();
        if (zkController != null) {
          setNodeName(zkController.getNodeName());
        }
      }
      
      CloudDescriptor ccd = cd.getCloudDescriptor();
      if (ccd != null) {
        setCollection(ccd.getCollectionName());
        setShard(ccd.getShardId());
        setReplica(ccd.getCoreNodeName());
      }
    }
  }

