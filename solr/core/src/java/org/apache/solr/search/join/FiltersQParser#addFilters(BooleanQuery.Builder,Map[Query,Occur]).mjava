  /** @return number of added clauses */
  protected int addFilters(BooleanQuery.Builder builder, Map<Query,Occur> clauses) throws SyntaxError {
    Set<Query> filters = new HashSet<>();
    for (Map.Entry<Query, Occur> clause: clauses.entrySet()) {
      if (clause.getValue() == Occur.FILTER) {
        filters.add(clause.getKey());
      }
    }
    if (!filters.isEmpty()) {
      try {
        final SolrConstantScoreQuery intersQuery = new FiltersQuery(req, filters);
        builder.add( intersQuery, Occur.FILTER);
      } catch (IOException e) {
        throw new SyntaxError("Exception occurs while parsing " + stringIncludingLocalParams, e);
      }
    }
    return filters.size();
  }

