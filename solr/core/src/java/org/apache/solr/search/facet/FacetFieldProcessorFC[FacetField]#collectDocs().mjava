  protected void collectDocs() throws IOException {
    final List<LeafReaderContext> leaves = fcontext.searcher.getIndexReader().leaves();
    final Iterator<LeafReaderContext> ctxIt = leaves.iterator();
    LeafReaderContext ctx = null;
    int segBase = 0;
    int segMax;
    int adjustedMax = 0;
    for (DocIterator docsIt = fcontext.base.iterator(); docsIt.hasNext(); ) {
      final int doc = docsIt.nextDoc();
      if (doc >= adjustedMax) {
        do {
          ctx = ctxIt.next();
          segBase = ctx.docBase;
          segMax = ctx.reader().maxDoc();
          adjustedMax = segBase + segMax;
        } while (doc >= adjustedMax);
        assert doc >= ctx.docBase;
        setNextReader(ctx);
      }

      int term = sortedDocValues.getOrd( doc );
      int arrIdx = term - startTermIndex;
      if (arrIdx>=0 && arrIdx<nTerms) {
        countAcc.incrementCount(arrIdx, 1);
        collect(doc - segBase, arrIdx);  // per-seg collectors
        if (allBucketsSlot >= 0 && term >= 0) {
          countAcc.incrementCount(allBucketsSlot, 1);
          collect(doc - segBase, allBucketsSlot);  // per-seg collectors
        }
      }
    }
  }

