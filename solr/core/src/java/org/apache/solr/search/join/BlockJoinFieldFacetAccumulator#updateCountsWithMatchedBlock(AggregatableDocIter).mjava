  void updateCountsWithMatchedBlock(AggregatableDocIter iter) throws IOException {
    if (segmentSDV != null) {
      // some codecs may optimize SORTED_SET storage for single-valued fields
      for (iter.reset(); iter.hasNext(); ) {
        final int docNum = iter.nextDoc();
        if (docNum > segmentSDV.docID()) {
          segmentSDV.advance(docNum);
        }
        
        int term;
        if (docNum == segmentSDV.docID()) {
          term = segmentSDV.ordValue();
        } else {
          term = -1;
        }
        accumulateTermOrd(term, iter.getAggKey());
        //System.out.println("doc# "+docNum+" "+fieldName+" term# "+term+" tick "+Long.toHexString(segmentAccums[1+term]));
      }
    } else {
      for (iter.reset(); iter.hasNext(); ) {
        final int docNum = iter.nextDoc();
        if (docNum > segmentSSDV.docID()) {
          segmentSSDV.advance(docNum);
        }
        if (docNum == segmentSSDV.docID()) {
          int term = (int) segmentSSDV.nextOrd();
          do { // absent values are designated by term=-1, first iteration counts [0] as "missing", and exit, otherwise it spins 
            accumulateTermOrd(term, iter.getAggKey());
          } while (term>=0 && (term = (int) segmentSSDV.nextOrd()) >= 0);
        }
      }
    }
  }

