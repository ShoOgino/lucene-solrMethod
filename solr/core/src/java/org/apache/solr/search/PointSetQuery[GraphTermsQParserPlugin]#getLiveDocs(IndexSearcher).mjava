  private FixedBitSet getLiveDocs(IndexSearcher searcher) throws IOException {
    if (searcher instanceof SolrIndexSearcher) {
      BitDocSet liveDocs = ((SolrIndexSearcher) searcher).getLiveDocs();
      FixedBitSet liveBits = liveDocs.size() == ((SolrIndexSearcher) searcher).maxDoc() ? null : liveDocs.getBits();
      return liveBits;
    } else {
      if (searcher.getTopReaderContext().reader().maxDoc() == searcher.getTopReaderContext().reader().numDocs()) return null;
      FixedBitSet bs = new FixedBitSet(searcher.getTopReaderContext().reader().maxDoc());
      for (LeafReaderContext ctx : searcher.getTopReaderContext().leaves()) {
        Bits liveDocs = ctx.reader().getLiveDocs();
        int max = ctx.reader().maxDoc();
        int base = ctx.docBase;
        for (int i=0; i<max; i++) {
          if (liveDocs.get(i)) bs.set(i + base);
        }
      }
      return bs;
    }
  }

