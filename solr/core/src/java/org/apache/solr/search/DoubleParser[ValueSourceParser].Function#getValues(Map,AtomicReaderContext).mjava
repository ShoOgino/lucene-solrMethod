    @Override
    public DocValues getValues(Map context, AtomicReaderContext readerContext) throws IOException {
      final DocValues vals =  source.getValues(context, readerContext);
      return new DoubleDocValues(this) {
        @Override
        public double doubleVal(int doc) {
          return func(doc, vals);
        }
        @Override
        public String toString(int doc) {
          return name() + '(' + vals.toString(doc) + ')';
        }
      };
    }

