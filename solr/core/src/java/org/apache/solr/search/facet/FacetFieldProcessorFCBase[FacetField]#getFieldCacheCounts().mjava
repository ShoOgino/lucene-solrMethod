  public SimpleOrderedMap<Object> getFieldCacheCounts() throws IOException {
    String prefix = freq.prefix;
    if (prefix == null || prefix.length() == 0) {
      prefixRef = null;
    } else {
      prefixRef = new BytesRefBuilder();
      prefixRef.copyChars(prefix);
    }

    findStartAndEndOrds();

    // if we need an extra slot for the "missing" bucket, and it wasn't able to be tacked onto the beginning,
    // then lets add room for it at the end.
    maxSlots = (freq.missing && startTermIndex != -1) ? nTerms + 1 : nTerms;

    if (freq.allBuckets) {
      allBucketsSlot = maxSlots;
      maxSlots++;
    } else {
      allBucketsSlot = -1;
    }
    createAccs(nDocs, maxSlots);
    setSortAcc(maxSlots);
    prepareForCollection();

    collectDocs();

    return findTopSlots();
  }

