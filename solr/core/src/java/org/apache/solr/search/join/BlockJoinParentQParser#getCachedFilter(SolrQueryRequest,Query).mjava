  public static BitDocIdSetFilterWrapper getCachedFilter(final SolrQueryRequest request, Query parentList) {
    @SuppressWarnings("unchecked")
    SolrCache<Query, Filter> parentCache = request.getSearcher().getCache(CACHE_NAME);
    // lazily retrieve from solr cache
    BitDocIdSetFilterWrapper result;
    if (parentCache != null) {
      Filter filter = parentCache.computeIfAbsent(parentList,
          query -> new BitDocIdSetFilterWrapper(createParentFilter(query)));
      if (filter instanceof BitDocIdSetFilterWrapper) {
        result = (BitDocIdSetFilterWrapper) filter;
      } else {
        result = new BitDocIdSetFilterWrapper(createParentFilter(parentList));
        // non-atomic update of existing entry to ensure strong-typing
        parentCache.put(parentList, result);
      }
    } else {
      result = new BitDocIdSetFilterWrapper(createParentFilter(parentList));
    }
    return result;
  }

