    public void collapse(int ord, int contextDoc, int globalDoc) throws IOException {
      float val = Float.intBitsToFloat((int)vals.get(contextDoc));
      if(ord > -1) {
        if(comp.test(val, ordVals[ord])) {
          ords[ord] = globalDoc;
          ordVals[ord] = val;
          if(needsScores) {
            scores[ord] = scorer.score();
          }
        }
      } else if (this.collapsedSet.get(globalDoc)) {
        //Elevated doc so do nothing
      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_COLLAPSE) {
        if(comp.test(val, nullVal)) {
          nullVal = val;
          nullDoc = globalDoc;
          if(needsScores) {
            nullScore = scorer.score();
          }
        }
      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_EXPAND) {
        this.collapsedSet.set(globalDoc);
        if(needsScores) {
          nullScores.add(scorer.score());
        }
      }
    }

