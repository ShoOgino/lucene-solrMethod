  @Override
  public V remove(K key) {
    synchronized (map) {
      CacheValue<V> entry = map.remove(key);
      if (entry != null) {
        long delta = RamUsageEstimator.sizeOfObject(key, QUERY_DEFAULT_RAM_BYTES_USED)
            + RamUsageEstimator.sizeOfObject(entry, QUERY_DEFAULT_RAM_BYTES_USED)
            + LINKED_HASHTABLE_RAM_BYTES_PER_ENTRY;
        ramBytesUsed -= delta;
        return entry.value;
      } else {
        return null;
      }
    }
  }

