    @Override
    public int nextDoc() {
      int lastDoc = nextDoc;
      assert nextDoc != DocIdSetIterator.NO_MORE_DOCS;
      if (lastDoc>currentParent) { // we passed the previous block, and need to reevaluate a parent
        currentParent = allParentsBitsDocSet.getBits().nextSetBit(lastDoc+segment.docBase)-segment.docBase;
      }
      try {
        nextDoc = disi.nextDoc();
      } catch (IOException e) {
        throw new RuntimeException(e);
      }
      return lastDoc;
    }

