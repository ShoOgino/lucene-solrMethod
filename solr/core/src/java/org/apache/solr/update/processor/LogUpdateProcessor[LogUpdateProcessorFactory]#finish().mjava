  @Override
  public void finish() throws IOException {
    if (next != null) next.finish();
    if (logDebug) { log.debug("finish"); }

    // LOG A SUMMARY WHEN ALL DONE (INFO LEVEL)
    
    // TODO: right now, update requests are logged twice...
    // this will slow down things compared to Solr 1.2
    // we should have extra log info on the SolrQueryResponse, to
    // be logged by SolrCore
    
    // if id lists were truncated, show how many more there were

    NamedList<Object> stdLog = rsp.getToLog();

    StringBuilder sb = new StringBuilder();
    for (int i=0; i<stdLog.size(); i++) {
      String name = stdLog.getName(i);
      Object val = stdLog.getVal(i);
      if ("path"==name || "params"==name) {    //equals OK here
        sb.append(val).append(' ');
      } else {
        sb.append(name).append('=').append(val).append(' ');
      }
    }
    stdLog.clear();   // make it so SolrCore.exec won't log this again

    if (adds != null && numAdds > maxNumToLog) {
      adds.add("... (" + numAdds + " adds)");
    }
    if (deletes != null && numDeletes > maxNumToLog) {
      deletes.add("... (" + numDeletes + " deletes)");
    }
    long elapsed = rsp.getEndTime() - req.getStartTime();

    sb.append(toLog).append(" 0 ").append(elapsed);
    log.info(sb.toString());
  }

