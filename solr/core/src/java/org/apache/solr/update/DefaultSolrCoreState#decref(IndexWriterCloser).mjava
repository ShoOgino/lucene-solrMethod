  @Override
  public  void decref(IndexWriterCloser closer) throws IOException {
    boolean cancelRecovery = false;
    synchronized (this) {
      refCnt--;
      if (refCnt == 0) {
        try {
          if (closer != null) {
            closer.closeWriter(indexWriter);
          } else if (indexWriter != null) {
            indexWriter.close();
          }
        } catch (Throwable t) {
          SolrException.log(log, t);
        }
        directoryFactory.close();
        closed = true;
        cancelRecovery = true;
      }
    }
    // don't wait for this in the sync block
    if (cancelRecovery) cancelRecovery();
  }

