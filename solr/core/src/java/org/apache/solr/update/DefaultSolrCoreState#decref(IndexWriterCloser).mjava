  @Override
  public  void decref(IndexWriterCloser closer) throws IOException {
    boolean cancelRecovery = false;
    synchronized (this) {
      refCnt--;
      if (refCnt == 0) {
        if (closer != null) {
          closer.closeWriter(indexWriter);
        } else if (indexWriter != null) {
          indexWriter.close();
        }
        directoryFactory.close();
        closed = true;
        cancelRecovery = true;
      }
    }
    // don't wait for this in the sync block
    if (cancelRecovery) cancelRecovery();
  }

