  @Override
  public void add(AddUpdateCommand cmd) {
    synchronized (this) {
      ensureLog();
      long pos = tlog.write(cmd);
      LogPtr ptr = new LogPtr(pos);
      map.put(cmd.getIndexedId(), ptr);
      // SolrCore.verbose("TLOG: added id " + cmd.getPrintableId() + " to " + tlog + " " + ptr + " map=" + System.identityHashCode(map));
    }
  }

