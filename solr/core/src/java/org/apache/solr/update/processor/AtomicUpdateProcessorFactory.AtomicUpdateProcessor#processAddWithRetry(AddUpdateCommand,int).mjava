    private void processAddWithRetry(AddUpdateCommand cmd, int attempts) throws IOException {
      try {
        super.processAdd(cmd);
      } catch (SolrException e) {
        if (attempts++ >= MAX_ATTEMPTS) {//maximum number of attempts allowed: 25
          throw new SolrException(SERVER_ERROR,
              "Atomic update failed after multiple attempts due to " + e.getMessage());
        }
        if (e.code() == ErrorCode.CONFLICT.code) { // version conflict
          log.warn("Atomic update failed due to " + e.getMessage() +
              " Retrying with new version .... (" + attempts + ")");
          Long lastVersion = vinfo.lookupVersion(cmd.getIndexedId());
          if (lastVersion != null) {
            cmd.solrDoc.setField(VERSION, lastVersion);
          }
          processAddWithRetry(cmd, attempts);
        }
      }
    }

