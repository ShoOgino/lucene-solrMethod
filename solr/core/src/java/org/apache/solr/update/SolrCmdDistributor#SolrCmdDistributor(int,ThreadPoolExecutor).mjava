  public SolrCmdDistributor(int numHosts, ThreadPoolExecutor executor) {
    int maxPermits = Math.max(16, numHosts * 16);
    // limits how many tasks can actually execute at once
    if (maxPermits != semaphore.getMaxPermits()) {
      semaphore.setMaxPermits(maxPermits);
    }

    completionService = new ExecutorCompletionService<Request>(executor);
    pending = new HashSet<Future<Request>>();
  }

