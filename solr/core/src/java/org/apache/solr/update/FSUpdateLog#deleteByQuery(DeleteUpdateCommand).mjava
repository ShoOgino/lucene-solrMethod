  @Override
  public void deleteByQuery(DeleteUpdateCommand cmd) {
    synchronized (this) {
      ensureLog();
      // TODO: how to support realtime-get, optimistic concurrency, or anything else in this case?
      // Maybe we shouldn't?
      // realtime-get could just do a reopen of the searcher
      // optimistic concurrency? Maybe we shouldn't support deleteByQuery w/ optimistic concurrency
      long pos = tlog.writeDeleteByQuery(cmd);
      LogPtr ptr = new LogPtr(pos);
      // SolrCore.verbose("TLOG: added deleteByQuery " + cmd.query + " to " + tlog + " " + ptr + " map=" + System.identityHashCode(map));
    }
  }

