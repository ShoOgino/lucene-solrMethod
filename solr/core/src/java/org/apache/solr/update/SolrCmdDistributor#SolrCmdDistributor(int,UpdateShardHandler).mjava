  public SolrCmdDistributor(int numHosts, UpdateShardHandler updateShardHandler) {
    int maxPermits = Math.max(16, numHosts * 16);
    // limits how many tasks can actually execute at once
    if (maxPermits != semaphore.getMaxPermits()) {
      semaphore.setMaxPermits(maxPermits);
    }
    
    this.updateShardHandler = updateShardHandler;
    completionService = new ExecutorCompletionService<Request>(updateShardHandler.getCmdDistribExecutor());
    pending = new HashSet<Future<Request>>();
  }

