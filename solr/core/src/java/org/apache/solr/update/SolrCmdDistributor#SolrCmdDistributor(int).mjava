  public SolrCmdDistributor(int numHosts) {
    int maxPoolSize = Math.max(8, (numHosts-1) * 8);
    BoundedExecutor executor = null;
    synchronized (SolrCmdDistributor.class) {
      if (semaphore == null) {
        semaphore = new AdjustableSemaphore(maxPoolSize);
      }
      
      if (maxPoolSize != semaphore.getMaxPermits()) {
        // raise the permits to match maxPoolSize
        semaphore.setMaxPermits(maxPoolSize);
      }
      
      if (commExecutor == null || commExecutor.getMaximumPoolSize() != maxPoolSize) {
        // we don't shutdown the previous because all it's threads will die
        commExecutor = new BoundedExecutor(0, maxPoolSize, 5,
            TimeUnit.SECONDS, new SynchronousQueue<Runnable>(),
            new DefaultSolrThreadFactory("cmdDistribExecutor"));
      }
      executor = commExecutor;
    }
    
    completionService = new ExecutorCompletionService<Request>(executor);
    pending = new HashSet<Future<Request>>();
  }

