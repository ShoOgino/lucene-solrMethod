  public DirectUpdateHandler2(SolrCore core, UpdateHandler updateHandler) throws IOException {
    super(core);
    if (updateHandler instanceof DirectUpdateHandler2) {
      this.solrCoreState = ((DirectUpdateHandler2) updateHandler).solrCoreState;
    } else {
      // the impl has changed, so we cannot use the old state - decref it
      updateHandler.decref();
      solrCoreState = new DefaultSolrCoreState(core.getDirectoryFactory());
    }
    
    UpdateHandlerInfo updateHandlerInfo = core.getSolrConfig()
        .getUpdateHandlerInfo();
    int docsUpperBound = updateHandlerInfo.autoCommmitMaxDocs; // getInt("updateHandler/autoCommit/maxDocs", -1);
    int timeUpperBound = updateHandlerInfo.autoCommmitMaxTime; // getInt("updateHandler/autoCommit/maxTime", -1);
    commitTracker = new CommitTracker("Hard", core, docsUpperBound, timeUpperBound, updateHandlerInfo.openSearcher, false);
    
    int softCommitDocsUpperBound = updateHandlerInfo.autoSoftCommmitMaxDocs; // getInt("updateHandler/autoSoftCommit/maxDocs", -1);
    int softCommitTimeUpperBound = updateHandlerInfo.autoSoftCommmitMaxTime; // getInt("updateHandler/autoSoftCommit/maxTime", -1);
    softCommitTracker = new CommitTracker("Soft", core, softCommitDocsUpperBound, softCommitTimeUpperBound, updateHandlerInfo.openSearcher, true);
    
    this.ulog = updateHandler.getUpdateLog();
    if (this.ulog != null) {
      this.ulog.init(this, core);
    }
  }

