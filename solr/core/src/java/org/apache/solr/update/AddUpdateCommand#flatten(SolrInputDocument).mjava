  private List<SolrInputDocument> flatten(SolrInputDocument root) {
    List<SolrInputDocument> unwrappedDocs = new ArrayList<>();
    recUnwrapp(unwrappedDocs, root);
    if (1 < unwrappedDocs.size() && ! req.getSchema().isUsableForChildDocs()) {
      throw new SolrException
        (SolrException.ErrorCode.BAD_REQUEST, "Unable to index docs with children: the schema must " +
         "include definitions for both a uniqueKey field and the '" + IndexSchema.ROOT_FIELD_NAME +
         "' field, using the exact same fieldType");
    }
    return unwrappedDocs;
  }

