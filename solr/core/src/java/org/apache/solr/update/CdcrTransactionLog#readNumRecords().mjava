  /**
   * The last record of the transaction log file is expected to be a commit with a 4 byte integer that encodes the
   * number of records in the file.
   */
  private int readNumRecords() {
    try {
      if (endsWithCommit()) {
        long size = fos.size();
        // 4 bytes for the record size, the lenght of the end message + 1 byte for its value tag,
        // and 4 bytes for the number of records
        long pos = size - 4 - END_MESSAGE.length() - 1 - 4;
        if (pos < 0) return 0;

        ChannelFastInputStream is = new ChannelFastInputStream(channel, pos);
        return is.readInt();
      }
    } catch (IOException e) {
      log.error("Error while reading number of records in tlog " + this, e);
    }
    return 0;
  }

