      @Override
      public UpdateRequestProcessor getInstance(SolrQueryRequest req, SolrQueryResponse rsp, UpdateRequestProcessor next) {
        if (delegate != null) return delegate.getInstance(req, rsp, next);

        synchronized (this) {
          if (delegate == null)
            delegate = (UpdateRequestProcessorFactory) holder.get();
        }
        return delegate.getInstance(req, rsp, next);
      }

