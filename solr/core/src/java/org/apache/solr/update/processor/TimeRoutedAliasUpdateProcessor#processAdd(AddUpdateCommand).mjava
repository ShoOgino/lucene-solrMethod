  @Override
  public void processAdd(AddUpdateCommand cmd) throws IOException {
    final Object routeValue = cmd.getSolrInputDocument().getFieldValue(routeField);
    final String targetCollection = findTargetCollectionGivenRouteKey(routeValue);
    if (targetCollection == null) {
      throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,
          "Doc " + cmd.getPrintableId() + " couldn't be routed with " + routeField + "=" + routeValue);
    }
    if (thisCollection.equals(targetCollection)) {
      // pass on through; we've reached the right collection
      super.processAdd(cmd);
    } else {
      // send to the right collection
      SolrCmdDistributor.Node targetLeaderNode = lookupShardLeaderOfCollection(targetCollection);
      cmdDistrib.distribAdd(cmd, Collections.singletonList(targetLeaderNode), new ModifiableSolrParams(outParamsToLeader));
    }
  }

