  @Override
  public int readWrappedStream(byte[] target, int offset, int len) throws IOException {
    ByteBuffer bb = ByteBuffer.wrap(target, offset, len);
    assert chPosition  < ch.size();

    for (;;) {
      int ret = ch.read(bb, chPosition);
      if (ret > 0) {
        chPosition += ret;
        return ret;
      } else if (ret < 0) {
        return ret;
      }
      // a channel read can return 0 - retry if this happens
    }
  }

