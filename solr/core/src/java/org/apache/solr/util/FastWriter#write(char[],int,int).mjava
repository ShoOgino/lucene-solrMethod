  @Override
  public void write(char cbuf[], int off, int len) throws IOException {
    int space = buf.length - pos;
    if (len < space) {
      System.arraycopy(cbuf, off, buf, pos, len);
      pos += len;
    } else if (len<BUFSIZE) {
      // if the data to write is small enough, buffer it.
      System.arraycopy(cbuf, off, buf, pos, space);
      sink.write(buf, 0, buf.length);
      pos = len-space;
      System.arraycopy(cbuf, off+space, buf, 0, pos);
    } else {
      sink.write(buf,0,pos);  // flush
      pos=0;
      // don't buffer, just write to sink
      sink.write(cbuf, off, len);
    }
  }

