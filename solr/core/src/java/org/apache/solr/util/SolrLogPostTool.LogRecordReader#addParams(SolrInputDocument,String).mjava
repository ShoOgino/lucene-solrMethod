    private void addParams(SolrInputDocument doc,  String params) {
      String[] pairs = params.split("&");
      for(String pair : pairs) {
        String[] parts = pair.split("=");
        if(parts.length == 2 && parts[0].equals("q")) {
          String dq = URLDecoder.decode(parts[1], Charset.defaultCharset());
          doc.addField("q_s", dq);
          doc.addField("q_t", dq);
        }

        if(parts[0].equals("rows")) {
          String dr = URLDecoder.decode(parts[1], Charset.defaultCharset());
          doc.addField("rows_i", dr);
        }

        if(parts[0].equals("distrib")) {
          String dr = URLDecoder.decode(parts[1], Charset.defaultCharset());
          doc.addField("distrib_s", dr);
        }

        if(parts[0].equals("shards")) {
          doc.addField("shards_s", "true");
        }

        if(parts[0].equals("ids")) {
          doc.addField("ids_s", "true");
        }

        if(parts[0].equals("isShard")) {
          String dr = URLDecoder.decode(parts[1], Charset.defaultCharset());
          doc.addField("isShard_s", dr);
        }

        if(parts[0].equals("wt")) {
          String dr = URLDecoder.decode(parts[1], Charset.defaultCharset());
          doc.addField("wt_s", dr);
        }

        if(parts[0].equals("facet")) {
          String dr = URLDecoder.decode(parts[1], Charset.defaultCharset());
          doc.addField("facet_s", dr);
        }
      }


      //Special params used to determine what stage a query is.
      //So we populate with defaults.
      //The absence of the distrib params means its a distributed query.

      if(doc.getField("distrib_s") == null) {
        doc.addField("distrib_s", "true");
      }

      if(doc.getField("shards_s") == null) {
        doc.addField("shards_s", "false");
      }

      if(doc.getField("ids_s") == null) {
        doc.addField("ids_s", "false");
      }
    }

