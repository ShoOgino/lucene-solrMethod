  private long getCurrentMemoryThreshold() {
    int thresholdValueInPercentage = solrCore.getSolrConfig().memoryCircuitBreakerThreshold;
    double thresholdInFraction = thresholdValueInPercentage / (double) 100;
    long actualLimit = (long) (currentMaxHeap * thresholdInFraction);

    if (actualLimit <= 0) {
      throw new IllegalStateException("Memory limit cannot be less than or equal to zero");
    }

    return actualLimit;
  }

