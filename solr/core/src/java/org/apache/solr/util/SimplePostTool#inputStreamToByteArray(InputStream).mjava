  /**
   * Reads an input stream into a byte array
   * @param is the input stream
   * @return the byte array
   * @throws IOException
   */
  protected byte[] inputStreamToByteArray(InputStream is) throws IOException {
    ByteArrayOutputStream bos = new ByteArrayOutputStream();
    int next = is.read();
    while (next > -1) {
        bos.write(next);
        next = is.read();
    }
    bos.flush();
    is.close();
    return bos.toByteArray();
  }

