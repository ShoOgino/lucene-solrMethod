  // called from parser
  Query handleBoost(Query q, Token boost) {
    // q==null check is to avoid boosting null queries, such as those caused by stop words
    if (boost == null || boost.image.length()==0 || q == null) {
      return q;
    }

    if (boost.image.charAt(0) == '=') {
      // syntax looks like foo:x^=3
      float val = Float.parseFloat(boost.image.substring(1));
      Query newQ = q;
      if (// q instanceof FilterQuery ||  // TODO: fix this when FilterQuery is introduced to avoid needless wrapping: SOLR-7219
          q instanceof ConstantScoreQuery) {
        newQ.setBoost(val);
      } else {
        newQ = new ConstantScoreQuery(q);
        newQ.setBoost(val);
      }
      return newQ;
    }

    float boostVal = Float.parseFloat(boost.image);
    q.setBoost(q.getBoost() * boostVal);

    return q;
  }

