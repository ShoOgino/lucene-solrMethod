  @Override
  protected String getStoredValue(Shape shape, String shapeStr) {
    if (shape instanceof UnitNRShape) {
      UnitNRShape unitShape = (UnitNRShape) shape;
      if (unitShape.getLevel() == tree.getMaxLevels()) {
        //fully precise date. We can be fully compatible with TrieDateField.
        Date date = tree.toCalendar(unitShape).getTime();
        return DateFormatUtil.formatExternal(date);
      }
    }
    return (shapeStr == null ? shape.toString() : shapeStr);//we don't normalize ranges here; should we?
  }

