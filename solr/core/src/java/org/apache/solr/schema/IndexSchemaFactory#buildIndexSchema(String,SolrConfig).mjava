  /** Instantiates the configured schema factory, then calls create on it. */
  public static IndexSchema buildIndexSchema(String resourceName, SolrConfig config) {
    PluginInfo info = config.getPluginInfo(IndexSchemaFactory.class.getName());
    IndexSchemaFactory factory;
    if (null != info) {
      factory = config.getResourceLoader().newInstance(info.className, IndexSchemaFactory.class);
      factory.init(info.initArgs);
    } else {
      if (config.luceneMatchVersion.onOrAfter(Version.LUCENE_6_0_0)) {
        // ManagedIndexSchemaFactory is SolrCoreAware so we must create using the resource loader
        factory = config.getResourceLoader().newInstance(ManagedIndexSchemaFactory.class.getName(), IndexSchemaFactory.class);
      } else {
        factory = new ClassicIndexSchemaFactory();
      }
    }
    IndexSchema schema = factory.create(resourceName, config);
    return schema;
  }

