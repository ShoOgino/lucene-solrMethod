  /**
   * This analyzer is not actually used for indexing.  It is implemented here
   * so that the analysis UI will show reasonable tokens.
   */
  @Override
  public Analyzer getIndexAnalyzer()
  {
    return new Analyzer() {
      
      @Override
      protected TokenStreamComponents createComponents(final String fieldName) {
        return new TokenStreamComponents(new KeywordTokenizer()) {
          private Shape shape = null;
          
          protected void setReader(final Reader reader) throws IOException {
            source.setReader(reader);
            shape = parseShape(IOUtils.toString(reader));
          }
          
          public TokenStream getTokenStream() {
            PrefixTreeStrategy s = newSpatialStrategy(fieldName==null ? getTypeName() : fieldName);
            return s.createIndexableFields(shape)[0].tokenStreamValue();
          }
        };
      }
    };
  }

