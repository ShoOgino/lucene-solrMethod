  public void simSetReplicaValues(String node, Map<String, Map<String, List<ReplicaInfo>>> source, boolean overwrite) {
    List<ReplicaInfo> infos = nodeReplicaMap.get(node);
    if (infos == null) {
      throw new RuntimeException("Node not present: " + node);
    }
    // core_node_name is not unique across collections
    Map<String, Map<String, ReplicaInfo>> infoMap = new HashMap<>();
    infos.forEach(ri -> infoMap.computeIfAbsent(ri.getCollection(), Utils.NEW_HASHMAP_FUN).put(ri.getName(), ri));
    source.forEach((coll, shards) -> shards.forEach((shard, replicas) -> replicas.forEach(r -> {
      ReplicaInfo target = infoMap.getOrDefault(coll, Collections.emptyMap()).get(r.getName());
      if (target == null) {
        throw new RuntimeException("Unable to find simulated replica of " + r);
      }
      r.getVariables().forEach((k, v) -> {
        if (target.getVariables().containsKey(k)) {
          if (overwrite) {
            target.getVariables().put(k, v);
          }
        } else {
          target.getVariables().put(k, v);
        }
      });
    })));
  }

