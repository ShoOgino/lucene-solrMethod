  /**
   * This method implements a primitive form of proportional controller with a limiter.
   */
  @SuppressWarnings({"unchecked", "rawtypes"})
  private void addReplicaHints(String collection, String shard, double r, int replicationFactor, List<Pair<String, String>> hints) {
    int numReplicas = (int)Math.round((r - aboveRate) / (double) replicationFactor);
    // in one event add at least 1 replica
    if (numReplicas < 1) {
      numReplicas = 1;
    }
    // ... and at most maxOps replicas
    if (numReplicas > maxOps) {
      numReplicas = maxOps;
    }
    for (int i = 0; i < numReplicas; i++) {
      hints.add(new Pair(collection, shard));
    }
  }

