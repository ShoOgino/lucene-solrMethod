  private Map<String, DocCollection> getCollectionStates() throws IOException, InterruptedException {
    lock.lockInterruptibly();
    try {
      Map<String, DocCollection> collectionStates = new HashMap<>();
      collectionsStatesRef.forEach((name, cached) -> {
        try {
          collectionStates.put(name, cached.getColl());
        } catch (Exception e) {
          throw new RuntimeException("error building collection " + name + " state", e);
        }
      });
      return collectionStates;
    } finally {
      lock.unlock();
    }
  }

