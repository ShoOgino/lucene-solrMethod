  private Map<String, Replica> lookupReplicas(String collectionName, Collection<String> coreNames) throws InterruptedException {
    Map<String, Replica> result = new HashMap<String, Replica>();
    long endTime = System.currentTimeMillis() +3000;
    for(;;) {
      DocCollection coll = zkStateReader.getClusterState().getCollection(collectionName);
      for (String  coreName : coreNames) {
        if(result.containsKey(coreName)) continue;
        for (Slice slice : coll.getSlices()) {
          for (Replica replica : slice.getReplicas()) {
            if(coreName.equals(replica.getStr(ZkStateReader.CORE_NAME_PROP))) {
              result.put(coreName,replica);
              break;
            }
          }
        }
      }

      if(result.size() == coreNames.size()) {
        return result;
      }
      if( System.currentTimeMillis() > endTime) {
        //time up . throw exception and go out
        throw new SolrException(ErrorCode.SERVER_ERROR, "Unable to create replica entries in ZK");
      }

      Thread.sleep(100);
    }

  }

