    @Override
      public void process(WatchedEvent event) {
        try {

          synchronized (confDirectoryListeners) {
            // if this is not among directories to be watched then don't set the watcher anymore
            if( !confDirectoryListeners.containsKey(zkDir)) {
              log.info("Watcher on {} is removed ", zkDir);
              return;
            }
            Set<Runnable> listeners = confDirectoryListeners.get(zkDir);
            if (listeners != null && !listeners.isEmpty()) {
              final Set<Runnable> listenersCopy = new HashSet<>(listeners);
              new Thread() {
                //run these in a separate thread because this can be long running
                public void run() {
                  for (final Runnable listener : listenersCopy) {
                    try {
                      listener.run();
                    } catch (Exception e) {
                      log.warn("listener throws error", e);
                    }
                  }
                }
              }.start();
            }

          }

        } finally {
          if (Event.EventType.None.equals(event.getType())) {
            log.info("A node got unwatched for {}", zkDir);
            return;
          } else {
            setConfWatcher(zkDir,this);
          }
        }
      }

