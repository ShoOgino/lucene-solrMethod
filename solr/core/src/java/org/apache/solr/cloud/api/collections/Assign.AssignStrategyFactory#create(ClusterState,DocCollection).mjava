    public AssignStrategy create(ClusterState clusterState, DocCollection collection) throws IOException, InterruptedException {
      List<Map> ruleMaps = (List<Map>) collection.get("rule");
      String policyName = collection.getStr(POLICY);
      List snitches = (List) collection.get(SNITCH);
      AutoScalingConfig autoScalingConfig = solrCloudManager.getDistribStateManager().getAutoScalingConfig();

      StrategyType strategyType = null;
      if ((ruleMaps == null || ruleMaps.isEmpty()) && policyName == null && autoScalingConfig.getPolicy().getClusterPolicy().isEmpty()) {
        strategyType = StrategyType.LEGACY;
      } else if (ruleMaps != null && !ruleMaps.isEmpty()) {
        strategyType = StrategyType.RULES;
      } else {
        strategyType = StrategyType.POLICY;
      }

      switch (strategyType) {
        case LEGACY:
          return new LegacyAssignStrategy();
        case RULES:
          List<Rule> rules = new ArrayList<>();
          for (Object map : ruleMaps) rules.add(new Rule((Map) map));
          return new RulesBasedAssignStrategy(rules, snitches, clusterState);
        case POLICY:
          return new PolicyBasedAssignStrategy(policyName);
        default:
          throw new Assign.AssignmentException("Unknown strategy type: " + strategyType);
      }
    }

