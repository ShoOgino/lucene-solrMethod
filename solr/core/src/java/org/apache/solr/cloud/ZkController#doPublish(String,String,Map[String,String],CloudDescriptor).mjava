  private void doPublish(String shardZkNodeName, String coreName,
      Map<String,String> props, CloudDescriptor cloudDesc) {
    Integer numShards = cloudDesc.getNumShards();
    if (numShards == null) {
      numShards = Integer.getInteger(ZkStateReader.NUM_SHARDS_PROP);
    }
    CoreState coreState = new CoreState(coreName,
        cloudDesc.getCollectionName(), props, numShards);
    coreStates.put(shardZkNodeName, coreState);
    final String nodePath = "/node_states/" + getNodeName();

    try {
      zkClient.setData(nodePath, ZkStateReader.toJSON(coreStates.values()),
          true);
      
    } catch (KeeperException e) {
      throw new ZooKeeperException(SolrException.ErrorCode.SERVER_ERROR,
          "could not publish node state", e);
    } catch (InterruptedException e) {
      // Restore the interrupted status
      Thread.currentThread().interrupt();
      throw new ZooKeeperException(SolrException.ErrorCode.SERVER_ERROR,
          "could not publish node state", e);
    }
  }

