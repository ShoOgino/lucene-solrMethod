  /**
   * Copy all content from another DistribStateManager.
   * @param other another state manager.
   * @param failOnExists abort copy when one or more paths already exist (the state of this manager remains unchanged).
   */
  public void copyFrom(DistribStateManager other, boolean failOnExists) throws InterruptedException, IOException, KeeperException, AlreadyExistsException, BadVersionException {
    List<String> tree = other.listTree("/");
    // check if any node exists
    for (String path : tree) {
      if (hasData(path) && failOnExists) {
        throw new AlreadyExistsException(path);
      }
    }
    for (String path : tree) {
      VersionedData data = other.getData(path);
      if (hasData(path)) {
        setData(path, data.getData(), -1);
      } else {
        makePath(path, data.getData(), data.getMode(), failOnExists);
      }
      // hack: set the version to be the same as the source
      Node n = traverse(path, false, CreateMode.PERSISTENT);
      n.version = data.getVersion();
    }
  }

