  public void saveSnapshot(File targetDir, boolean withAutoscaling) throws Exception {
    Map<String, Object> snapshot = getSnapshot(withAutoscaling);
    targetDir.mkdirs();
    for (Map.Entry<String, Object> e : snapshot.entrySet()) {
      FileOutputStream out = new FileOutputStream(new File(targetDir, e.getKey() + ".json"));
      IOUtils.write(Utils.toJSON(e.getValue()), out);
      out.flush();
      out.close();
    }
  }

