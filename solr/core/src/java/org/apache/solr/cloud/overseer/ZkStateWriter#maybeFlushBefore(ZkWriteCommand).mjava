  /**
   * Logic to decide a flush before processing a ZkWriteCommand
   *
   * @param cmd the ZkWriteCommand instance
   * @return true if a flush is required, false otherwise
   */
  protected boolean maybeFlushBefore(ZkWriteCommand cmd) {
    if (lastUpdatedTime == 0) {
      // first update, make sure we go through
      return false;
    }
    if (cmd.collection == null) {
      return false;
    }
    if (cmd.collection.getStateFormat() != lastStateFormat) {
      return true;
    }
    return cmd.collection.getStateFormat() > 1 && !cmd.name.equals(lastCollectionName);
  }

