  private void waitForCoreNodeName(CoreDescriptor descriptor) throws InterruptedException {
    log.info("Waiting for coreNodeName for core {} in collection {} to be assigned",
        descriptor.getName(), descriptor.getCollectionName());
    final String thisNode = getNodeName();
    try {
      zkStateReader.waitForState(descriptor.getCollectionName(), 320, TimeUnit.SECONDS, (n, c) -> {
        if (c == null)
          return false;
        for (Replica replica : c.getReplicasOnNode(thisNode)) {
          if (descriptor.getName().equals(replica.getCoreName())) {
            descriptor.getCloudDescriptor().setCoreNodeName(replica.getName());
            return true;
          }
        }
        return false;
      });
    } catch (TimeoutException e) {
      throw new SolrException(ErrorCode.SERVER_ERROR, "Timed out getting coreNodeName for " + descriptor.getName());
    }
  }

