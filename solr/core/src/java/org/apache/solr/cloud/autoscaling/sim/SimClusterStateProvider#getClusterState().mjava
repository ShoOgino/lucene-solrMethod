  @Override
  public ClusterState getClusterState() throws IOException {
    ensureNotClosed();
    try {
      lock.lockInterruptibly();
      try {
        Map<String, DocCollection> states = getCollectionStates();
        ClusterState state = new ClusterState(clusterStateVersion, liveNodes.get(), states);
        return state;
      } finally {
        lock.unlock();
      }
    } catch (InterruptedException e) {
      throw new IOException(e);
    }
  }

