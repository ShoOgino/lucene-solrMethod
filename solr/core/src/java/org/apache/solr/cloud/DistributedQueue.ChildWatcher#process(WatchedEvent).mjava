    @Override
    public void process(WatchedEvent event) {
      updateLock.lock();
      try {
        // this watcher is automatically cleared when fired
        if (lastWatcher == this) {
          lastWatcher = null;
        }
        // Do no updates in this thread, just signal state back to client threads.
        isDirty = true;
        // optimistically signal any waiters that the queue may not be empty now, so they can wake up and retry
        notEmpty.signalAll();
      } finally {
        updateLock.unlock();
      }
    }

