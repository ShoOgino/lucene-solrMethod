    public void setData(byte[] data, int version) throws BadVersionException, IOException {
      Set<Watcher> currentWatchers = new HashSet<>(dataWatches);
      dataLock.lock();
      try {
        if (version != -1 && version != this.version) {
          throw new BadVersionException(version, path);
        }
        if (data != null) {
          this.data = Arrays.copyOf(data, data.length);
        } else {
          this.data = null;
        }
        this.version++;
        dataWatches.clear();
      } finally {
        dataLock.unlock();
      }
      for (Watcher w : currentWatchers) {
        w.process(new WatchedEvent(Watcher.Event.EventType.NodeDataChanged, Watcher.Event.KeeperState.SyncConnected, path));
      }
    }

