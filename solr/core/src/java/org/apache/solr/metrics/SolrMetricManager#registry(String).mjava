  /**
   * Get (or create if not present) a named registry
   * @param registry name of the registry
   * @return existing or newly created registry
   */
  public MetricRegistry registry(String registry) {
    registry = overridableRegistryName(registry);
    if (isSharedRegistry(registry)) {
      return SharedMetricRegistries.getOrCreate(registry);
    } else {
      final MetricRegistry existing = registries.get(registry);
      if (existing == null) {
        final MetricRegistry created = new MetricRegistry();
        final MetricRegistry raced = registries.putIfAbsent(registry, created);
        if (raced == null) {
          return created;
        } else {
          return raced;
        }
      } else {
        return existing;
      }
    }
  }

