  @Override
  public void initializeMetrics(SolrMetricManager manager, String registryName, String tag, final String scope) {
    this.metricManager = manager;
    this.registryName = registryName;
    this.registry = manager.registry(registryName);
    numErrors = manager.meter(this, registryName, "errors", getCategory().toString(), scope);
    numServerErrors = manager.meter(this, registryName, "serverErrors", getCategory().toString(), scope);
    numClientErrors = manager.meter(this, registryName, "clientErrors", getCategory().toString(), scope);
    numTimeouts = manager.meter(this, registryName, "timeouts", getCategory().toString(), scope);
    requests = manager.counter(this, registryName, "requests", getCategory().toString(), scope);
    MetricsMap metricsMap = new MetricsMap((detail, map) ->
        shardPurposes.forEach((k, v) -> map.put(k, v.getCount())));
    manager.registerGauge(this, registryName, metricsMap, tag, true, "shardRequests", getCategory().toString(), scope);
    requestTimes = manager.timer(this, registryName, "requestTimes", getCategory().toString(), scope);
    totalTime = manager.counter(this, registryName, "totalTime", getCategory().toString(), scope);
    manager.registerGauge(this, registryName, () -> handlerStart, tag, true, "handlerStart", getCategory().toString(), scope);
  }

