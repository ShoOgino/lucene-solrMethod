  protected void writeDocs(SolrQueryRequest req, IteratorWriter.ItemWriter writer, Sort sort) throws IOException {
    List<LeafReaderContext> leaves = req.getSearcher().getTopReaderContext().leaves();
    SortDoc sortDoc = getSortDoc(req.getSearcher(), sort.getSort());
    int count = 0;
    final int queueSize = Math.min(DOCUMENT_BATCH_SIZE, totalHits);

    SortQueue queue = new SortQueue(queueSize, sortDoc);
    SortDoc[] outDocs = new SortDoc[queueSize];

    while (count < totalHits) {
      identifyLowestSortingUnexportedDocs(leaves, sortDoc, queue);
      int outDocsIndex = transferBatchToArrayForOutput(queue, outDocs);

      count += (outDocsIndex + 1);
      addDocsToItemWriter(leaves, writer, outDocs, outDocsIndex);
    }
  }

