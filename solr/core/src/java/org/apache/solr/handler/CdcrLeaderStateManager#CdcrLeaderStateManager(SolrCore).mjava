  CdcrLeaderStateManager(final SolrCore core) {
    this.core = core;

    // Fetch leader state and register the watcher at startup
    try {
      SolrZkClient zkClient = core.getCoreDescriptor().getCoreContainer().getZkController().getZkClient();
      ClusterState clusterState = core.getCoreDescriptor().getCoreContainer().getZkController().getClusterState();

      watcher = this.initWatcher(zkClient);
      // if the node does not exist, it means that the leader was not yet registered. This can happen
      // when the cluster is starting up. The core is not yet fully loaded, and the leader election process
      // is waiting for it.
      if (this.isLeaderRegistered(zkClient, clusterState)) {
        this.checkIfIAmLeader();
      }
    } catch (KeeperException | InterruptedException e) {
      log.warn("Failed fetching initial leader state and setting watch", e);
    }
  }

