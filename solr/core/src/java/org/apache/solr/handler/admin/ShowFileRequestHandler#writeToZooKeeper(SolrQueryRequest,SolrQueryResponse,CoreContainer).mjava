  // write the file contained in the parameter "file=XXX" to ZooKeeper. The file may be a path, e.g.
  // file=velocity/error.vm or file=schema.xml
  //
  // Important: Assumes that the file already exists in ZK, so far we aren't creating files there.
  private void writeToZooKeeper(SolrQueryRequest req, SolrQueryResponse rsp, CoreContainer coreContainer)
      throws KeeperException, InterruptedException, IOException {
    SolrZkClient zkClient = coreContainer.getZkController().getZkClient();

    String adminFile = getAdminFileFromZooKeeper(req, rsp, zkClient);
    ContentStream stream = getOneInputStream(req, rsp);
    if (stream == null) {
      return; // Error already in rsp.
    }

    byte[] data = IOUtils.toByteArray(new InputStreamReader(stream.getStream(), "UTF-8"), "UTF-8");
    String fname = req.getParams().get("file", null);
    // Persist the managed schema
    try {
      // Assumption: the path exists
      zkClient.setData(adminFile, data, true);
      log.info("Saved " + fname + " to ZooKeeper successfully.");
    } catch (KeeperException.BadVersionException e) {
      log.error("Cannot save file: " + fname + " to Zookeeper, " +
          "ZooKeeper error: " + e.getMessage());
      rsp.setException(new SolrException(ErrorCode.SERVER_ERROR, "Cannot save file: " + fname + " to Zookeeper, " +
          "ZooKeeper error: " + e.getMessage()));
    }
  }

