  public void createSnapAsync(final IndexCommit indexCommit, final int numberToKeep, Consumer<NamedList> result) {
    solrCore.getDeletionPolicy().saveCommitPoint(indexCommit.getGeneration());

    new Thread() { //TODO should use Solr's ExecutorUtil
      @Override
      public void run() {
        try {
          result.accept(createSnapshot(indexCommit));
        } catch (Exception e) {
          LOG.error("Exception while creating snapshot", e);
          NamedList snapShootDetails = new NamedList<>();
          snapShootDetails.add("snapShootException", e.getMessage());
          result.accept(snapShootDetails);
        } finally {
          solrCore.getDeletionPolicy().releaseCommitPoint(indexCommit.getGeneration());
        }
        if (snapshotName == null) {
          deleteOldBackups(numberToKeep);
        }
      }
    }.start();
  }

