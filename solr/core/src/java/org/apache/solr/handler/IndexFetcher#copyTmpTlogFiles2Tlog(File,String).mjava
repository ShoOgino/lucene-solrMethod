  /**
   * The tlog files are copied from the tmp dir to the tlog dir by renaming the directory if possible.
   * A backup of the old file is maintained.
   */
  private void copyTmpTlogFiles2Tlog(File tmpTlogDir, String timestamp) {
    File tlogDir = new File(solrCore.getUpdateHandler().getUpdateLog().getLogDir());
    File backupTlogDir = new File(tlogDir.getParent(), UpdateLog.TLOG_NAME + "." + timestamp);

    try {
      org.apache.commons.io.FileUtils.moveDirectory(tlogDir, backupTlogDir);
    } catch (IOException e) {
      throw new SolrException(ErrorCode.SERVER_ERROR,
          "Unable to rename: " + tlogDir + " to: " + backupTlogDir, e);
    }

    try {
      tmpTlogDir = new File(backupTlogDir, tmpTlogDir.getName());
      org.apache.commons.io.FileUtils.moveDirectory(tmpTlogDir, tlogDir);
    } catch (IOException e) {
      throw new SolrException(ErrorCode.SERVER_ERROR,
          "Unable to rename: " + tmpTlogDir + " to: " + tlogDir, e);
    }
  }

