  protected void addDocsToItemWriter(List<LeafReaderContext> leaves, IteratorWriter.ItemWriter writer, SortDoc[] docsToExport, int outDocsIndex) throws IOException {
    try {
      for (int i = outDocsIndex; i >= 0; --i) {
        SortDoc s = docsToExport[i];
        writer.add((MapWriter) ew -> {
          writeDoc(s, leaves, ew);
          s.reset();
        });
      }
    } catch (Throwable e) {
      Throwable ex = e;
      while (ex != null) {
        String m = ex.getMessage();
        if (m != null && m.contains("Broken pipe")) {
          throw new IgnoreException();
        }
        ex = ex.getCause();
      }

      if (e instanceof IOException) {
        throw ((IOException) e);
      } else {
        throw new IOException(e);
      }
    }
  }

