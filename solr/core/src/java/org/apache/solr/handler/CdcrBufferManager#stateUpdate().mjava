  /**
   * This method is synchronised as it can both be called by the leaderStateManager and the bufferStateManager.
   */
  @Override
  public synchronized void stateUpdate() {
    CdcrUpdateLog ulog = (CdcrUpdateLog) core.getUpdateHandler().getUpdateLog();

    // If I am not the leader, I should always buffer my updates
    if (!leaderStateManager.amILeader()) {
      ulog.enableBuffer();
      return;
    }
    // If I am the leader, I should buffer my updates only if buffer is enabled
    else if (bufferStateManager.getState().equals(CdcrParams.BufferState.ENABLED)) {
      ulog.enableBuffer();
      return;
    }

    // otherwise, disable the buffer
    ulog.disableBuffer();
  }

