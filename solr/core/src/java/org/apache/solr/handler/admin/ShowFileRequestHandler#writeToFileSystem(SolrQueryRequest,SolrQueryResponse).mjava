  // Write the data passed in from the stream to the file indicated by the file=XXX parameter on the local file system
  private void writeToFileSystem(SolrQueryRequest req, SolrQueryResponse rsp) throws IOException {
    ContentStream stream = getOneInputStream(req, rsp);
    if (stream == null) {
      return; // Error should already have been logged.
    }

    File adminFile = getAdminFileFromFileSystem(req, rsp);
    if (adminFile == null || adminFile.isDirectory()) {
      String fname = req.getParams().get("file", null);

      if (adminFile == null) {
        log.error("File " + fname + " was not found.");
        rsp.setException(new SolrException( ErrorCode.BAD_REQUEST, "File " + fname + " was not found."));
        return;
      }
      log.error("File " + fname + " is a directory.");
      rsp.setException(new SolrException( ErrorCode.BAD_REQUEST, "File " + fname + " is a directory."));
      return;
    }
    if (OP_TEST.equals(req.getParams().get(OP_PARAM))) {
      testReloadSuccess(req, rsp, stream);
      return;
    }

    FileUtils.copyInputStreamToFile(stream.getStream(), adminFile);
    log.info("Successfully saved file " + adminFile.getAbsolutePath() + " locally");
  }

