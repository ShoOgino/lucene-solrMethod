  private static void formatCountsAndAddToNL(String fieldKey, ResponseBuilder rb, SolrParams params,
                                             int columns, int rows, int[] counts, NamedList<Object> result) {
    final String format = params.getFieldParam(fieldKey, FacetParams.FACET_HEATMAP_FORMAT, FORMAT_INTS2D);
    final Object countsVal;
    switch (format) {
      case FORMAT_INTS2D: //A List of List of Integers. Good for small heatmaps and ease of consumption
        countsVal = counts != null ? asInts2D(columns, rows, counts) : null;
        break;
      case FORMAT_PNG: //A PNG graphic; compressed.  Good for large & dense heatmaps; hard to consume.
        countsVal = counts != null ? asPngBytes(columns, rows, counts, rb) : null;
        break;
      //TODO  case skipList: //A sequence of values; negative values are actually how many 0's to insert.
      //            Good for small or large but sparse heatmaps.
      //TODO    auto choose png or skipList; use skipList when < ~25% full or <= ~512 cells
      //  remember to augment error list below when we add more formats.
      default:
        throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,
            "format should be " + FORMAT_INTS2D + " or " + FORMAT_PNG);
    }
    result.add("counts_" + format, countsVal);
  }

