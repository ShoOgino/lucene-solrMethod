  /**
   * All the files which are common between master and slave must have same size else we assume they are
   * not compatible (stale).
   *
   * @return true if the index stale and we need to download a fresh copy, false otherwise.
   * @throws IOException  if low level io error
   */
  private boolean isIndexStale(Directory dir) throws IOException {
    for (Map<String, Object> file : filesToDownload) {
      if (dir.fileExists((String) file.get(NAME))
              && dir.fileLength((String) file.get(NAME)) != (Long) file.get(SIZE)) {
        LOG.warn("File " + file.get(NAME) + " expected to be " + file.get(SIZE)
            + " while it is " + dir.fileLength((String) file.get(NAME)));
        // file exists and size is different, therefore we must assume
        // corrupted index
        return true;
      }
    }
    return false;
  }

