  public void checkSystemCollection() {
    // check that .system exists
    try {
      if (cloudManager.isClosed() || Thread.interrupted()) {
        factory.setPersistent(false);
        return;
      }
      ClusterState clusterState = cloudManager.getClusterStateProvider().getClusterState();
      DocCollection systemColl = clusterState.getCollectionOrNull(CollectionAdminParams.SYSTEM_COLL);
      if (systemColl == null) {
        if (logMissingCollection) {
          log.warn("Missing " + CollectionAdminParams.SYSTEM_COLL + ", keeping metrics history in memory");
          logMissingCollection = false;
        }
        factory.setPersistent(false);
        return;
      } else {
        boolean ready = false;
        for (Replica r : systemColl.getReplicas()) {
          if (r.isActive(clusterState.getLiveNodes())) {
            ready = true;
            break;
          }
        }
        if (!ready) {
          log.debug(CollectionAdminParams.SYSTEM_COLL + " not ready yet, keeping metrics history in memory");
          factory.setPersistent(false);
          return;
        }
      }
    } catch (Exception e) {
      log.warn("Error getting cluster state, keeping metrics history in memory", e);
      factory.setPersistent(false);
      return;
    }
    logMissingCollection = true;
    factory.setPersistent(true);
  }

