  @Override
  public Weight createWeight(IndexSearcher searcher, boolean needScores) throws IOException {
    // SolrRequestInfo reqInfo = SolrRequestInfo.getRequestInfo();

    if (!(searcher instanceof SolrIndexSearcher)) {
      // delete-by-query won't have SolrIndexSearcher
      ConstantScoreQuery csq = new ConstantScoreQuery(q);
      csq.setBoost(this.getBoost());
      return csq.createWeight(searcher, needScores);
    }

    SolrIndexSearcher solrSearcher = (SolrIndexSearcher)searcher;
    DocSet docs = solrSearcher.getDocSet(q);
    // reqInfo.addCloseHook(docs);  // needed for off-heap refcounting

    SolrConstantScoreQuery csq = new SolrConstantScoreQuery( docs.getTopFilter() );
    csq.setBoost( this.getBoost() );
    return csq.createWeight(searcher, needScores);
  }

