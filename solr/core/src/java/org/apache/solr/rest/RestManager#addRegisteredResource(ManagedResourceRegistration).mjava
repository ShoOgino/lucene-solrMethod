  // used internally to create and attach a ManagedResource to the Restlet router
  // the registry also uses this method directly, which is slightly hacky but necessary
  // in order to support dynamic adding of new fieldTypes using the managed-schema API
  private synchronized ManagedResource addRegisteredResource(ManagedResourceRegistration reg) {
    String resourceId = reg.resourceId;
    ManagedResource res = createManagedResource(reg);
    managed.put(resourceId, res);
    log.info("Registered new managed resource {}", resourceId);
    
    // attach this new resource to the Restlet router
    Matcher resourceIdValidator = resourceIdRegex.matcher(resourceId);
    boolean validated = resourceIdValidator.matches();
    assert validated : "managed resourceId '" + resourceId
                     + "' should already be validated by registerManagedResource()";
    String routerPath = resourceIdValidator.group(1);      
    String path = resourceIdValidator.group(2);
    Router router = SCHEMA_BASE_PATH.equals(routerPath) ? schemaRouter : configRouter;
    if (router != null) {
      attachManagedResource(res, path, router);
    }
    return res;
  }

