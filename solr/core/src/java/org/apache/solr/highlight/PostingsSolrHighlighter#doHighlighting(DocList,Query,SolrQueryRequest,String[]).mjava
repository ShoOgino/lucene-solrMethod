  @Override
  public NamedList<Object> doHighlighting(DocList docs, Query query, SolrQueryRequest req, String[] defaultFields) throws IOException {
    SolrParams params = req.getParams(); 
    
    // if highlighting isnt enabled, then why call doHighlighting?
    if (isHighlightingEnabled(params)) {
      SolrIndexSearcher searcher = req.getSearcher();
      TopDocs topDocs = toTopDocs(docs);
      
      // fetch the unique keys
      String[] keys = getUniqueKeys(searcher, topDocs);
      
      // query-time parameters
      String[] fieldNames = getHighlightFields(query, req, defaultFields);
      int numSnippets = params.getInt(HighlightParams.SNIPPETS, 1);
      
      Map<String,String[]> snippets = highlighter.highlightFields(fieldNames, query, searcher, topDocs, numSnippets);
      return encodeSnippets(keys, fieldNames, snippets);
    } else {
      return null;
    }
  }

