  /**
   * This method deletes the index files associated with specified <code>indexCommit</code> provided they
   * are not referred by some other {@linkplain IndexCommit}.
   *
   * @param dir The index directory containing the {@linkplain IndexCommit} to be deleted.
   * @param refCounts A map containing reference counts for each file associated with every {@linkplain IndexCommit}
   *                  in the specified directory.
   * @param indexCommit The {@linkplain IndexCommit} whose files need to be deleted.
   * @throws IOException in case of I/O errors.
   */
  private static void deleteIndexFiles ( Directory dir, Map<String, Integer> refCounts, IndexCommit indexCommit ) throws IOException {
    log.info("Deleting index files for index commit with generation {} in directory {}", indexCommit.getGeneration(), dir);
    for (String fileName : indexCommit.getFileNames()) {
      try {
        // Ensure that a file being deleted is not referred by some other commit.
        int ref = refCounts.getOrDefault(fileName, 0);
        log.debug("Reference count for file {} is {}", fileName, ref);
        if (ref == 0) {
          dir.deleteFile(fileName);
        }
      } catch (IOException e) {
        log.warn("Unable to delete file {} in directory {} due to exception {}", fileName, dir, e.getMessage());
      }
    }
  }

