  public void execute(SolrRequestHandler handler, SolrQueryRequest req, SolrQueryResponse rsp) {
    if (handler==null) {
      String msg = "Null Request Handler '" +
        req.getParams().get(CommonParams.QT) + "'";
      
      if (log.isWarnEnabled()) log.warn(logid + msg + ":" + req);
      
      throw new SolrException(SolrException.ErrorCode.BAD_REQUEST, msg);
    }
    // setup response header and handle request
    final NamedList<Object> responseHeader = new SimpleOrderedMap<Object>();
    rsp.add("responseHeader", responseHeader);

    // toLog is a local ref to the same NamedList used by the request
    NamedList<Object> toLog = rsp.getToLog();
    // for back compat, we set these now just in case other code
    // are expecting them during handleRequest

    toLog.add("webapp", req.getContext().get("webapp"));
    toLog.add("path", req.getContext().get("path"));
    toLog.add("params", "{" + req.getParamString() + "}");

    handler.handleRequest(req,rsp);
    setResponseHeaderValues(handler,req,rsp);

    if (log.isInfoEnabled() && toLog.size() > 0) {
      StringBuilder sb = new StringBuilder(logid);
      for (int i=0; i<toLog.size(); i++) {
        String name = toLog.getName(i);
        Object val = toLog.getVal(i);
        if (name != null) {
          sb.append(name).append('=');
        }
        sb.append(val).append(' ');
      }

      log.info(sb.toString());
    }

  }

