  /**
   *
   * @return the core instance directory, prepended with solr_home if not an absolute path.
   */
  public String getInstanceDir() {
    String instDir = coreProperties.getProperty(CORE_INSTDIR);
    if (instDir == null) return null; // No worse than before.

    if (new File(instDir).isAbsolute()) {
      return SolrResourceLoader.normalizeDir(
          SolrResourceLoader.normalizeDir(instDir));
    }

    if (coreContainer == null) return null;

    return SolrResourceLoader.normalizeDir(coreContainer.getSolrHome() +
        SolrResourceLoader.normalizeDir(instDir));
  }

