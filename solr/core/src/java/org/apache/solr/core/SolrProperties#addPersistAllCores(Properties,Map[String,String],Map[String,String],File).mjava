  /**
   * PersistSolrProperties persists the Solr.properties file only,
   * <p/>
   * The old version (i.e. using solr.xml) persisted _everything_ in a single file. This version will just
   * persist the solr.properties file for an individual core.
   * The individual cores were persisted in addPersistCore calls above.
   * <p/>
   * TODO: Remove all parameters for 5.0 when we obsolete ConfigSolrXmlBackCompat
   *
   * @param containerProperties - ignored, here for back compat.
   * @param rootSolrAttribs     - ignored, here for back compat.
   * @param coresAttribs        - ignored, here for back compat.
   * @param file                - ignored, here for back compat.
   */

  @Override
  public void addPersistAllCores(Properties containerProperties, Map<String, String> rootSolrAttribs,
                                 Map<String, String> coresAttribs, File file) {
    String val = container.getContainerProperties().getProperty("solr.persistent", "false");
    if (!Boolean.parseBoolean(val)) return;

    // First persist solr.properties
    File parent = new File(container.getSolrHome());
    File props = new File(parent, SOLR_PROPERTIES_FILE);
    Properties propsOut = new Properties();
    propsOut.putAll(container.getContainerProperties());
    for (String prop : origsolrprops.stringPropertyNames()) {
      String toTest = origsolrprops.getProperty(prop);
      if (toTest.indexOf("$") != -1) { // Don't store away things that should be system properties
        propsOut.put(prop, toTest);
      }
    }
    OutputStream os = null;
    try {
      os = new FileOutputStream(props);
      propsOut.store(os, null);
    } catch (IOException e) {
      log.error("Failed to persist file " + props.getAbsolutePath(), e);
    } finally {
      IOUtils.closeQuietly(os);
    }
  }

