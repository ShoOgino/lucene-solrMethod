  /**
   * This method deletes index files of the {@linkplain IndexCommit} for the specified generation number.
   *
   * @param dir The index directory storing the snapshot.
   * @param gen The generation number for the {@linkplain IndexCommit}
   * @throws IOException in case of I/O errors.
   */
  public static void deleteIndexFiles ( Directory dir, Collection<SnapshotMetaData> snapshots, long gen ) throws IOException {
    List<IndexCommit> commits = DirectoryReader.listCommits(dir);
    Map<String, Integer> refCounts = buildRefCounts(snapshots, commits);
    for (IndexCommit ic : commits) {
      if (ic.getGeneration() == gen) {
        deleteIndexFiles(dir,refCounts, ic);
        break;
      }
    }
  }

