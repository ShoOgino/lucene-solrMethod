  protected synchronized void removeDirectory(final CacheValue cacheValue)
      throws IOException {
    final Configuration conf = getConf();
    FileSystem fileSystem = null;
    
    try {
      // no need to close the fs, the cache will do it
      fileSystem = tmpFsCache.get(cacheValue.path, new Callable<FileSystem>() {
        @Override
        public FileSystem call() throws IOException {
          return FileSystem.get(new Path(cacheValue.path).toUri(), conf);
        }
      });
    } catch (ExecutionException e) {
      throw new RuntimeException(e);
    }
    
    try {
      boolean success = fileSystem.delete(new Path(cacheValue.path), true);
      if (!success) {
        throw new RuntimeException("Could not remove directory");
      }
    } catch (Exception e) {
      LOG.error("Could not remove directory", e);
      throw new SolrException(ErrorCode.SERVER_ERROR,
          "Could not remove directory", e);
    }
  }

