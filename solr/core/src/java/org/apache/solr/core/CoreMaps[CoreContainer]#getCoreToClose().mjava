  // Be a little careful. We don't want to either open or close a core unless it's _not_ being opened or closed by
  // another thread. So within this lock we'll walk along the list of pending closes until we find something NOT in
  // the list of threads currently being opened. The "usual" case will probably return the very first one anyway..
  protected SolrCore getCoreToClose() {
    synchronized (locker) {
      if (pendingDynamicCloses.size() == 0) return null; // nothing to do.
      // Yes, a linear search but this is a pretty short list in the normal case and usually we'll take the first one.
      for (SolrCore core : pendingDynamicCloses) {
        if (! pendingDynamicLoads.contains(core.getName())) {  // Don't try close a core if it's being opened.
          return core;
        }
      }
    }
    return null;
  }

