  void initIndex(boolean reload) {
    try {
      String indexDir = getNewIndexDir();
      boolean indexExists = getDirectoryFactory().exists(indexDir);
      boolean firstTime;
      synchronized (SolrCore.class) {
        firstTime = dirs.add(new File(indexDir).getCanonicalPath());
      }
      boolean removeLocks = solrConfig.unlockOnStartup;

      initIndexReaderFactory();

      if (indexExists && firstTime && !reload) {
        // to remove locks, the directory must already exist... so we create it
        // if it didn't exist already...
        Directory dir = directoryFactory.get(indexDir, getSolrConfig().indexConfig.lockType);
        if (dir != null)  {
          if (IndexWriter.isLocked(dir)) {
            if (removeLocks) {
              log.warn(logid + "WARNING: Solr index directory '{}' is locked.  Unlocking...", indexDir);
              IndexWriter.unlock(dir);
            } else {
              log.error(logid + "Solr index directory '{}' is locked.  Throwing exception", indexDir);
              throw new LockObtainFailedException("Index locked for write for core " + name);
            }
          }
          directoryFactory.release(dir);
        }
      }

      // Create the index if it doesn't exist.
      if(!indexExists) {
        log.warn(logid+"Solr index directory '" + new File(indexDir) + "' doesn't exist."
                + " Creating new index...");

        SolrIndexWriter writer = SolrIndexWriter.create("SolrCore.initIndex", indexDir, getDirectoryFactory(), true, schema, solrConfig.indexConfig, solrDelPolicy, codec, false);
        writer.close();
      }

    } catch (IOException e) {
      throw new RuntimeException(e);
    }
  }

