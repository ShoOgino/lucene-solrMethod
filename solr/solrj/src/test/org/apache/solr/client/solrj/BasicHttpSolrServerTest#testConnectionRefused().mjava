  @Test
  public void testConnectionRefused() throws MalformedURLException {
    int unusedPort = findUnusedPort(); // XXX even if fwe found an unused port
                                       // it might not be unused anymore
    HttpSolrServer server = new HttpSolrServer("http://127.0.0.1:" + unusedPort
        + "/solr");
    SolrQuery q = new SolrQuery("*:*");
    try {
      QueryResponse response = server.query(q);
      fail("Should have thrown an exception.");
    } catch (SolrServerException e) {
      assertTrue(e.getMessage().contains("refused"));
    }
  }

