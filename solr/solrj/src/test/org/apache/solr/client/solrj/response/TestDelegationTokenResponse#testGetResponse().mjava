  @Test
  public void testGetResponse() throws Exception {
    DelegationTokenRequest.Get getRequest = new DelegationTokenRequest.Get();
    DelegationTokenResponse.Get getResponse = new DelegationTokenResponse.Get();

    // not a map
    try {
      delegationTokenResponse(getRequest, getResponse, "");
      getResponse.getDelegationToken();
      fail("Expected SolrException");
    } catch (SolrException se) {
    }

    // doesn't have Token outerMap
    final String someToken = "someToken";
    delegationTokenResponse(getRequest, getResponse, getNestedMapJson("NotToken", "urlString", someToken));
    assertNull(getResponse.getDelegationToken());

    // Token is not a map
    try {
      delegationTokenResponse(getRequest, getResponse, getMapJson("Token", someToken));
      getResponse.getDelegationToken();
      fail("Expected SolrException");
    } catch (SolrException se) {
    }

    // doesn't have urlString
    delegationTokenResponse(getRequest, getResponse, getNestedMapJson("Token", "notUrlString", someToken));
    assertNull(getResponse.getDelegationToken());

    // has Token + urlString
    delegationTokenResponse(getRequest, getResponse, getNestedMapJson("Token", "urlString", someToken));
    assertEquals(someToken, getResponse.getDelegationToken());
  }

