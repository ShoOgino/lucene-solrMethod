  @Test
  public void testFileStreamDirectoryCrawl() throws Exception {
    final String fileStream = "files(\"directory1\")";
    ModifiableSolrParams paramsLoc = new ModifiableSolrParams();
    paramsLoc.set("expr", fileStream);
    paramsLoc.set("qt", "/stream");
    String url = cluster.getJettySolrRunners().get(0).getBaseUrl().toString()+"/"+FILESTREAM_COLLECTION;

    SolrStream solrStream = new SolrStream(url, paramsLoc);

    StreamContext context = new StreamContext();
    solrStream.setStreamContext(context);
    List<Tuple> tuples = getTuples(solrStream);
    assertEquals(8, tuples.size());

    for (int i = 0; i < 4; i++) {
      Tuple t = tuples.get(i);
      assertEquals("secondLevel1.txt line " + String.valueOf(i+1), t.get("line"));
      assertEquals("directory1/secondLevel1.txt", t.get("file"));
    }

    for (int i = 4; i < 8; i++) {
      Tuple t = tuples.get(i);
      assertEquals("secondLevel2.txt line " + String.valueOf(i - 3), t.get("line"));
      assertEquals("directory1/secondLevel2.txt", t.get("file"));
    }
  }

