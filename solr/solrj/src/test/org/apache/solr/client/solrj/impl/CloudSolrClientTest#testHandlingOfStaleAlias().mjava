  @Test
  public void testHandlingOfStaleAlias() throws Exception {
    CloudSolrClient client = getRandomClient();

    CollectionAdminRequest.createCollection("nemesis", "conf", 2, 1).process(client);
    CollectionAdminRequest.createAlias("misconfigured-alias", "nemesis").process(client);
    CollectionAdminRequest.deleteCollection("nemesis").process(client);

    List<SolrInputDocument> docs = new ArrayList<>();

    SolrInputDocument doc = new SolrInputDocument();
    doc.addField(id, Integer.toString(1));
    docs.add(doc);

    try {
      client.add("misconfigured-alias", docs);
      fail("Alias points to non-existing collection, add should fail");
    } catch (SolrException e) {
      assertEquals(SolrException.ErrorCode.BAD_REQUEST.code, e.code());
      assertTrue("Unexpected exception", e.getMessage().contains("Collection not found"));
    }
  }

