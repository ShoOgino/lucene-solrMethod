  @Test
  public void testReplaceConfigurer(){
    
    try {
    final AtomicInteger counter = new AtomicInteger();
    HttpClientConfigurer custom = new HttpClientConfigurer(){
      @Override
      protected void configure(DefaultHttpClient httpClient, SolrParams config) {
        super.configure(httpClient, config);
        counter.set(config.getInt("custom-param", -1));
      }
      
    };
    
    HttpClientUtil.setConfigurer(custom);
    
    ModifiableSolrParams params = new ModifiableSolrParams();
    params.set("custom-param", 5);
    HttpClientUtil.createClient(params).getConnectionManager().shutdown();
    assertEquals(5, counter.get());
    } finally {
      //restore default configurer
      HttpClientUtil.setConfigurer(new HttpClientConfigurer());
    }

  }

