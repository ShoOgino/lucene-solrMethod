  @Test
  public void testUpdateRequestWithParameters() throws Exception {
    SolrServer server1 = createNewSolrServer();
    
    server1.deleteByQuery( "*:*" );
    server1.commit();
    
    SolrInputDocument doc = new SolrInputDocument();
    doc.addField("id", "id1");
    
    UpdateRequest req = new UpdateRequest();
    req.setParam("overwrite", "false");
    req.add(doc);
    server1.request(req);
    server1.request(req);
    server1.commit();
    
    SolrQuery query = new SolrQuery();
    query.setQuery("*:*");
    QueryResponse rsp = server1.query(query);
    
    SolrDocumentList out = rsp.getResults();
    assertEquals(2, out.getNumFound());
    if (!(server1 instanceof EmbeddedSolrServer)) {
      /* Do not close in case of using EmbeddedSolrServer,
       * as that would close the CoreContainer */
      server1.shutdown();
    }
  }

