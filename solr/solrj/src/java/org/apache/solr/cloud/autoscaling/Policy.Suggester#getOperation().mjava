    public SolrRequest getOperation() {
      if (!isInitialized) {
        String coll = (String) hints.get(Hint.COLL);
        String shard = (String) hints.get(Hint.SHARD);
        // if this is not a known collection from the existing clusterstate,
        // then add it
        if(session.matrix.stream().noneMatch(row -> row.replicaInfo.containsKey(coll))){
          session.addClausesForCollection(session.dataProvider, coll);
          Collections.sort(session.expandedClauses);
        }
        if(coll != null) {
          for (Row row : session.matrix) {
            if (!row.replicaInfo.containsKey(coll)) row.replicaInfo.put(coll, new HashMap<>());
            if(shard != null){
              Map<String, List<ReplicaInfo>> shardInfo = row.replicaInfo.get(coll);
              if(!shardInfo.containsKey(shard)) shardInfo.put(shard, new ArrayList<>());
            }
          }
        }
        session.applyRules();
        originalViolations.addAll(session.getViolations());
        this.operation = init();
        isInitialized = true;
      }
      return operation;
    }

