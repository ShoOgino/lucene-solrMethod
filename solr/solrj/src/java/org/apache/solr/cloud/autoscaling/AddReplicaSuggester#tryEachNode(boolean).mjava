  SolrRequest tryEachNode(boolean strict) {
    String coll = (String) hints.get(Hint.COLL);
    String shard = (String) hints.get(Hint.SHARD);
    Replica.Type type = Replica.Type.get((String) hints.get(Hint.REPLICATYPE));
    if (coll == null || shard == null)
      throw new RuntimeException("add-replica requires 'collection' and 'shard'");
    //iterate through elements and identify the least loaded

    List<Clause.Violation> leastSeriousViolation = null;
    Integer targetNodeIndex = null;
    for (int i = getMatrix().size() - 1; i >= 0; i--) {
      Row row = getMatrix().get(i);
      if(!row.isLive) continue;
      if (!isAllowed(row.node, Hint.TARGET_NODE)) continue;
      Row tmpRow = row.addReplica(coll, shard, type);
      tmpRow.violations.clear();

      List<Clause.Violation> errs = testChangedMatrix(strict, getModifiedMatrix(getMatrix(), tmpRow, i));
      if(!containsNewErrors(errs)) {
        if(isLessSerious(errs, leastSeriousViolation)){
          leastSeriousViolation = errs;
          targetNodeIndex = i;
        }
      }
    }

    if (targetNodeIndex != null) {// there are no rule violations
      getMatrix().set(targetNodeIndex, getMatrix().get(targetNodeIndex).addReplica(coll, shard, type));
      return CollectionAdminRequest
          .addReplicaToShard(coll, shard)
          .setType(type)
          .setNode(getMatrix().get(targetNodeIndex).node);
    }

    return null;
  }

