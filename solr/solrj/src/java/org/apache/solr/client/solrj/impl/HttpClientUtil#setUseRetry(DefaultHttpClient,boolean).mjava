  /**
   * Control retry handler 
   * @param useRetry when false the client will not try to retry failed requests.
   */
  public static void setUseRetry(final DefaultHttpClient httpClient,
      boolean useRetry) {
    if (!useRetry) {
      httpClient.setHttpRequestRetryHandler(NO_RETRY);
    } else {
      // if the request is not fully sent, we retry
      // streaming updates are not a problem, because they are not retryable
      httpClient.setHttpRequestRetryHandler(new DefaultHttpRequestRetryHandler(){
        @Override
        protected boolean handleAsIdempotent(final HttpRequest request) {
          return false; // we can't tell if a Solr request is idempotent
        }
      });
    }
  }

