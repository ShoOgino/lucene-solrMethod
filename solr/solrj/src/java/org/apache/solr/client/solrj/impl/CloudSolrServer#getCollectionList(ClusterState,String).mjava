  protected Set<String> getCollectionList(ClusterState clusterState,
                                          String collection) {
    // Extract each comma separated collection name and store in a List.
    Set<String> collectionsList = new HashSet<String>();
    // validate collections
    List<String> rawCollectionsList = (collection != null) ? StrUtils.splitSmart(collection, ",", true) : null;
    if (rawCollectionsList != null) {
      for (String collectionName : rawCollectionsList) {
        if (!clusterState.hasCollection(collectionName)) {
          Aliases aliases = zkStateReader.getAliases();
          String alias = aliases.getCollectionAlias(collectionName);
          if (alias != null) {
            List<String> aliasList = StrUtils.splitSmart(alias, ",", true);
            collectionsList.addAll(aliasList);
            continue;
          }

          DocCollection docCollection = getDocCollection(clusterState, collection);
          if (docCollection == null) {
            throw new SolrException(ErrorCode.BAD_REQUEST, "Collection not found: " + collectionName);
          }
        }

        collectionsList.add(collectionName);
      }
    }
    return collectionsList;
  }

