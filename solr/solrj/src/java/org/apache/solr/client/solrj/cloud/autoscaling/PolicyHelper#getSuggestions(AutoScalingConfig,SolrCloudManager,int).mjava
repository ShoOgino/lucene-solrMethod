  public static List<Suggester.SuggestionInfo> getSuggestions(AutoScalingConfig autoScalingConf,
                                                              SolrCloudManager cloudManager, int max) {
    Policy policy = autoScalingConf.getPolicy();
    Suggestion.Ctx ctx = new Suggestion.Ctx();
    ctx.max = max;
    ctx.session = policy.createSession(cloudManager);
    List<Violation> violations = ctx.session.getViolations();
    for (Violation violation : violations) {
      String name = violation.getClause().isPerCollectiontag() ?
          violation.getClause().tag.name :
          violation.getClause().globalTag.name;
      Variable.Type tagType = VariableBase.getTagType(name);
      tagType.getSuggestions(ctx.setViolation(violation));
      ctx.violation = null;
    }

    if (ctx.needMore()) {
      try {
        addMissingReplicas(cloudManager, ctx);
      } catch (IOException e) {
        log.error("Unable to fetch cluster state", e);
      }
    }

    if (ctx.needMore()) {
      suggestOptimizations(ctx, Math.min(ctx.max - ctx.getSuggestions().size(), 10));
    }
    return ctx.getSuggestions();
  }

