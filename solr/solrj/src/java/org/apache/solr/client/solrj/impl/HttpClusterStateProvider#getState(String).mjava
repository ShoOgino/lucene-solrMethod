  @Override
  public CollectionRef getState(String collection) {
    for (String nodeName: liveNodes) {
      try (HttpSolrClient client = new HttpSolrClient.Builder().
          withBaseSolrUrl(ZkStateReader.getBaseUrlForNodeName(nodeName, urlScheme)).
          withHttpClient(httpClient).build()) {
        ClusterState cs = fetchClusterState(client, collection);
        return cs.getCollectionRef(collection);
      } catch (SolrServerException | RemoteSolrException | IOException e) {
        if (e.getMessage().contains(collection + " not found")) {
          // Cluster state for the given collection was not found.
          // Lets fetch/update our aliases:
          getAliases(true);
          return null;
        }
        log.warn("Attempt to fetch cluster state from " +
            ZkStateReader.getBaseUrlForNodeName(nodeName, urlScheme) + " failed.", e);
      }
    }
    throw new RuntimeException("Tried fetching cluster state using the node names we knew of, i.e. " + liveNodes +". However, "
        + "succeeded in obtaining the cluster state from none of them."
        + "If you think your Solr cluster is up and is accessible,"
        + " you could try re-creating a new CloudSolrClient using working"
        + " solrUrl(s) or zkHost(s).");
  }

