  private int getTotalCores(Policy.Session session, AtomicInteger liveNodes) {
    int coresCount = 0;
    for (Row row : session.matrix) {
      if (!row.isLive) continue;
      liveNodes.incrementAndGet();
      Integer res = row.computeCacheIfAbsent(TOTALCORES, o -> {
        int[] result = new int[1];
        row.forEachReplica(replicaInfo -> result[0]++);
        return result[0];
      });
      if (res != null)
        coresCount += res;


    }
    return coresCount;
  }

