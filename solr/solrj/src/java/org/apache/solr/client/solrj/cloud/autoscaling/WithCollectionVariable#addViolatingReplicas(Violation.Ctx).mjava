  public boolean addViolatingReplicas(Violation.Ctx ctx) {
    String node = ctx.currentViolation.node;
    for (Row row : ctx.allRows) {
      if (node.equals(row.node)) {
        @SuppressWarnings({"unchecked"})
        Map<String, String> withCollectionMap = (Map<String, String>) row.getVal("withCollection");
        if (withCollectionMap != null) {
          row.forEachReplica(r -> {
            String withCollection = withCollectionMap.get(r.getCollection());
            if (withCollection != null) {
              // test whether this row has at least 1 replica of withCollection, else there is a violation
              Set<String> uniqueCollections = new HashSet<>();
              row.forEachReplica(replicaInfo -> uniqueCollections.add(replicaInfo.getCollection()));
              if (!uniqueCollections.contains(withCollection)) {
                ctx.currentViolation.addReplica(new Violation.ReplicaInfoAndErr(r).withDelta(1.0d));
              }
            }
          });
          ctx.currentViolation.replicaCountDelta = (double) ctx.currentViolation.getViolatingReplicas().size();
        }
      }
    }
    return true;
  }

