  @Override
  public void writeMap(EntryWriter ew) throws IOException {
    ew.putIfNotNull("collection", coll);
    ew.putIfNotNull("shard", shard);
    ew.putIfNotNull("node", node);
    ew.putStringIfNotNull("tagKey", tagKey);
    ew.putIfNotNull("violation", (MapWriter) ew1 -> {
      if (getClause().isPerCollectiontag()) ew1.put("replica", actualVal);
      else ew1.put(clause.tag.name, String.valueOf(actualVal));
      ew1.putIfNotNull("delta", replicaCountDelta);
    });
    ew.put("clause", getClause());
    if (!replicaInfoAndErrs.isEmpty()) {
      ew.put("violatingReplicas", (IteratorWriter) iw -> {
        for (ReplicaInfoAndErr replicaInfoAndErr : replicaInfoAndErrs) {
          iw.add(replicaInfoAndErr.replicaInfo);
        }
      });
    }
  }

