    @Override
    public void writeMap(EntryWriter ew) throws IOException {
      ew.put("type", violation == null ? "improvement" : "violation");
      ew.putIfNotNull("violation",
          new ConditionalMapWriter(violation,
              (k, v) -> !"violatingReplicas".equals(k)));
      ew.put("operation", operation);
    }

