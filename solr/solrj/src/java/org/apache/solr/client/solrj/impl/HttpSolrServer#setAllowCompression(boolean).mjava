  /**
   * Allow server->client communication to be compressed. Currently gzip and
   * deflate are supported. If the server supports compression the response will
   * be compressed.
   */
  public void setAllowCompression(boolean allowCompression) {
    if (httpClient instanceof DefaultHttpClient) {
      final DefaultHttpClient client = (DefaultHttpClient) httpClient;
      client
          .removeRequestInterceptorByClass(UseCompressionRequestInterceptor.class);
      client
          .removeResponseInterceptorByClass(UseCompressionResponseInterceptor.class);
      if (allowCompression) {
        client.addRequestInterceptor(new UseCompressionRequestInterceptor());
        client.addResponseInterceptor(new UseCompressionResponseInterceptor());
      }
    } else {
      throw new UnsupportedOperationException(
          "HttpClient instance was not of type DefaultHttpClient");
    }
  }

