  private String getEncoding(Response response) {
    String contentType = response.getHeaders().get(HttpHeader.CONTENT_TYPE);
    if (contentType != null) {
      String charset = "charset=";
      int index = contentType.toLowerCase(Locale.ENGLISH).indexOf(charset);
      if (index > 0) {
        String encoding = contentType.substring(index + charset.length());
        // Sometimes charsets arrive with an ending semicolon.
        int semicolon = encoding.indexOf(';');
        if (semicolon > 0)
          encoding = encoding.substring(0, semicolon).trim();
        // Sometimes charsets are quoted.
        int lastIndex = encoding.length() - 1;
        if (encoding.charAt(0) == '"' && encoding.charAt(lastIndex) == '"')
          encoding = encoding.substring(1, lastIndex).trim();
        return encoding;
      }
    }
    return null;
  }

