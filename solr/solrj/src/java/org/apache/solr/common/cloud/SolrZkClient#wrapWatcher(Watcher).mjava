  /**
   * Wraps the watcher so that it doesn't fire off ZK's event queue. In order to guarantee that a watch object will
   * only be triggered once for a given notification, users need to wrap their watcher using this method before
   * calling {@link #exists(String, org.apache.zookeeper.Watcher, boolean)} or
   * {@link #getData(String, org.apache.zookeeper.Watcher, org.apache.zookeeper.data.Stat, boolean)}.
   */
  public Watcher wrapWatcher(final Watcher watcher) {
    if (watcher == null || watcher instanceof SolrZkWatcher) return watcher;

    return new SolrZkWatcher() {
      @Override
      public void process(final WatchedEvent event) {
        log.debug("Submitting job to respond to event " + event);
        try {
          if (watcher instanceof ConnectionManager) {
            zkConnManagerCallbackExecutor.submit(() -> watcher.process(event));
          } else {
            zkCallbackExecutor.submit(() -> watcher.process(event));
          }
        } catch (RejectedExecutionException e) {
          // If not a graceful shutdown
          if (!isClosed()) {
            throw e;
          }
        }
      }
    };
  }

