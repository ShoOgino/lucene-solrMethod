  public CharSequence readStr(DataInputInputStream dis, StringCache stringCache) throws IOException {
    int sz = readSize(dis);
    if (bytes == null || bytes.length < sz) bytes = new byte[sz];
    dis.readFully(bytes, 0, sz);
    if (stringCache != null) {
      return stringCache.get(bytesRef.reset(bytes, 0, sz));
    } else {
      arr.reset();
      if (readStringAsCharSeq) {
        byte[] copyBuf = new byte[sz];
        System.arraycopy(bytes, 0, copyBuf, 0, sz);
        return new ByteArrayUtf8CharSequence(copyBuf, 0, sz);
      } else {
        ByteUtils.UTF8toUTF16(bytes, 0, sz, arr);
        return arr.toString();
      }
    }
  }

