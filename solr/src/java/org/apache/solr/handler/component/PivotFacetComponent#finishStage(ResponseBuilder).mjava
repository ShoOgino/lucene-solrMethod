  @Override
  public void finishStage(ResponseBuilder rb) {
    if (!rb.doFacets || rb.stage != ResponseBuilder.STAGE_GET_FIELDS) return;
    // wait until STAGE_GET_FIELDS
    // so that "result" is already stored in the response (for aesthetics)

    SimpleOrderedMap<List<NamedList<Object>>> tf = rb._pivots;

    // get 'facet_counts' from the response
    NamedList facetCounts = (NamedList) rb.rsp.getValues().get("facet_counts");
    if (facetCounts == null) {
      facetCounts = new NamedList();
      rb.rsp.add("facet_counts", facetCounts);
    }
    facetCounts.add( PIVOT_KEY, tf );
    rb._pivots = null;
  }

