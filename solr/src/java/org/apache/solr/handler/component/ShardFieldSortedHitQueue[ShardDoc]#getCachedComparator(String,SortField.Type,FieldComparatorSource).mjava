  Comparator getCachedComparator(String fieldname, SortField.Type type, FieldComparatorSource factory) {
    Comparator comparator = null;
    switch (type) {
    case SCORE:
      comparator = comparatorScore(fieldname);
      break;
    case STRING:
      comparator = comparatorNatural(fieldname);
      break;
    case CUSTOM:
      if (factory instanceof MissingStringLastComparatorSource){
        comparator = comparatorMissingStringLast(fieldname);
      } else {
        // TODO: support other types such as random... is there a way to
        // support generically?  Perhaps just comparing Object
        comparator = comparatorNatural(fieldname);
        // throw new RuntimeException("Custom sort not supported factory is "+factory.getClass());
      }
      break;
    case DOC:
      // TODO: we can support this!
      throw new RuntimeException("Doc sort not supported");
    default:
      comparator = comparatorNatural(fieldname);
      break;
    }
    return comparator;
  }

