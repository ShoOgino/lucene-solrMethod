  /*** valid comments according to HTML specs
   <!-- Hello -->
   <!-- Hello -- -- Hello-->
   <!---->
   <!------ Hello -->
   <!>
   <!------> Hello -->

   #comments inside of an entity decl:
   <!ENTITY amp     CDATA "&#38;"   -- ampersand, U+0026 ISOnum -->

   Turns out, IE & mozilla don't parse comments correctly.
   Since this is meant to be a practical stripper, I'll just
   try and duplicate what the browsers do.

   <!-- (stuff_including_markup)* -->
   <!FOO (stuff, not including markup) >
   <! (stuff, not including markup)* >


  ***/

  private int readBang(boolean inScript) throws IOException {
    // at this point, "<!" has been read
    int ret = readComment(inScript);
    if (ret==MATCH) return MATCH;

    if ((numRead - lastMark) < safeReadAheadLimit || peek() == '>' ) {

      int ch = next();
      if (ch=='>') return MATCH;

      // if it starts with <! and isn't a comment,
      // simply read until ">"
      //since we did readComment already, it may be the case that we are already deep into the read ahead buffer
      //so, we may need to abort sooner
      while ((numRead - lastMark) < safeReadAheadLimit) {
        ch = next();
        if (ch=='>') {
          return MATCH;
        }
        else if (ch<0) {
          return MISMATCH;
        }
      }
    }
    return MISMATCH;
  }

