    @Override
    void finish() throws IOException {
      if (main) {
        mainResult = createSimpleResponse();
        return;
      }

      NamedList groupResult = commonResponse();

      if (format == Format.Simple) {
        groupResult.add("doclist", createSimpleResponse());
        return;
      }

      List groupList = new ArrayList();
      groupResult.add("groups", groupList);        // grouped={ key={ groups=[

      // handle case of rows=0
      if (numGroups == 0) return;

      if (collector.orderedGroups == null) collector.buildSet();

      int skipCount = offset;
      for (SearchGroup group : collector.orderedGroups) {
        if (skipCount > 0) {
          skipCount--;
          continue;
        }
        NamedList nl = new SimpleOrderedMap();
        groupList.add(nl);                         // grouped={ key={ groups=[ {

        nl.add("groupValue", group.groupValue.toObject());

        SearchGroupDocs groupDocs = collector2.groupMap.get(group.groupValue);
        addDocList(nl, groupDocs.collector);
      }
    }

