    public AllScorer(Similarity similarity, ReaderContext context, FunctionWeight w) throws IOException {
      super(similarity);
      this.weight = w;
      this.qWeight = w.getValue();
      this.reader = context.reader;
      this.maxDoc = reader.maxDoc();
      this.hasDeletions = reader.hasDeletions();
      this.delDocs = MultiFields.getDeletedDocs(reader);
      assert !hasDeletions || delDocs != null;
      Map funcContext = weight.context;
      funcContext.put(reader, context);
      vals = func.getValues(funcContext, reader);
    }

