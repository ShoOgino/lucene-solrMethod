      @Override
      public int compareBottom(int doc) {
        assert bottomSlot != -1;
        int order = (int) readerOrds.get(doc);
        if (order == 0) order = NULL_ORD;
        if (bottomSameReader) {
          // ord is precisely comparable, even in the equal case
          return bottomOrd - order;
        } else {
          // ord is only approx comparable: if they are not
          // equal, we can use that; if they are equal, we
          // must fallback to compare by value
          final int cmp = bottomOrd - order;
          if (cmp != 0) {
            return cmp;
          }

          // take care of the case where both vals are null
          if (order == NULL_ORD) return 0;

          // and at this point we know that neither value is null, so safe to compare
          termsIndex.lookup(order, tempBR);
          return bottomValue.compareTo(tempBR);
        }

      }

