    @Override
    Collector createNextCollector() throws IOException {
      if (numGroups == 0) return null;

      int docsToCollect = getMax(groupOffset, docsPerGroup, maxDoc);
      docsToCollect = Math.max(docsToCollect, 1);

      // if this for the main result, don't skip groups (since we are counting docs, not groups)
      int collectorOffset = main ? 0 : offset;

      if (groupBy instanceof StrFieldSource) {
        collector2 = new Phase2StringGroupCollector(collector, groupBy, context, groupSort, docsToCollect, needScores, collectorOffset);
      } else {
        collector2 = new Phase2GroupCollector(collector, groupBy, context, groupSort, docsToCollect, needScores, collectorOffset);
      }
      return collector2;
    }

