  /** Given an array of IndexReader offsets, find which contains the given doc */
  public static int readerIndex(int doc, int[] offsets) {    // find reader for doc doc:
    int high = offsets.length - 1;

    // fast-path for a big optimized index and a bunch of smaller ones.
    if (high <= 0 || doc < offsets[1]) return 0;

    int low = 1;

    while (high >= low) {
      int mid = (low + high) >>> 1;
      int offset = offsets[mid];
      // check low first since first segments are normally bigger.
      if (doc < offset)
        high = mid - 1;
      else if (doc > offset) {
        low = mid + 1;
      }
      else {
        // exact match on the offset.
        return mid;
      }
    }
    // low is the insertion point, high should be just below that (and the segment we want).
    return high;
  }

