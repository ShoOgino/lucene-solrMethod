  public boolean waitForCommit(int timeout) {
    //triggered = false;
    
    for (int towait=timeout; towait > 0; towait -= 250) {
      try {
        if (triggered) {
          RefCounted<SolrIndexSearcher> holder = core.getSearcher();
          SolrIndexSearcher s = holder.get();
          holder.decref();
          // since there could be two commits in a row, don't test for a specific new searcher
          // just test that the old one has been replaced.
          if (s != currentSearcher) return true;
          // it may be that a commit just happened, but the new searcher hasn't been registered yet.
        }
        Thread.sleep( 250 );
      } catch (InterruptedException e) {}
    }
    return false;
  }

