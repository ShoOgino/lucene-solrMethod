  /*
  Utility test method to process a clone of a document
   */
  @SuppressWarnings("rawtypes")
  private SolrInputDocument process(SolrInputDocument origDoc) {
    SolrInputDocument modifiedDoc = origDoc.deepCopy();
    if (random().nextBoolean()) {
      modifiedDoc.forEach((s, f) -> {
        Object rawVal = f.getRawValue();
        if (rawVal instanceof Collection) {
          Collection rawValue = (Collection) rawVal;
          ArrayList<Object> newVal = new ArrayList<>(rawValue.size());
          for (Object o : rawValue) {
            if (o instanceof String) {
              newVal.add(new ByteArrayUtf8CharSequence((String) o));
            } else {
              newVal.add(rawVal);
            }
          }
          f.setValue(newVal);
        } else if (rawVal instanceof String) {
          f.setValue(new ByteArrayUtf8CharSequence((String) rawVal));
        }
      });
    }
    liProcessor.process(modifiedDoc);
    return modifiedDoc;
  }

