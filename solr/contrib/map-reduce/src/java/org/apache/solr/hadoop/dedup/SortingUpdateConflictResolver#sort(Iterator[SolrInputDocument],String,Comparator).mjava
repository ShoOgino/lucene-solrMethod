  protected Iterator<SolrInputDocument> sort(Iterator<SolrInputDocument> updates, String fieldName, Comparator child) {
    // TODO: use an external merge sort in the pathological case where there are a huge amount of collisions
    List<SolrInputDocument> sortedUpdates = new ArrayList(1); 
    while (updates.hasNext()) {
      sortedUpdates.add(updates.next());
    }
    if (sortedUpdates.size() > 1) { // conflicts are rare
      Collections.sort(sortedUpdates, new SolrInputDocumentComparator(fieldName, child));
    }
    return sortedUpdates.iterator();
  }

