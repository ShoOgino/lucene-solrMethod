  /**
   * The following method changes the rowIterator mutable field. It requires
   * external synchronization. In fact when used in a multi-threaded setup the nextRow() method is called from a
   * synchronized block {@link ThreadedEntityProcessorWrapper#nextRow()}, so this
   * is taken care of.
   */
  private void buildIterator() {
    if (rowIterator == null) {
      // We could use an AtomicBoolean but there's no need since this method
      // would require anyway external synchronization
      if (!initDone) {
        initDone = true;
        SolrDocumentList solrDocumentList = doQuery(0);
        if (solrDocumentList != null) {
          rowIterator = new SolrDocumentListIterator(solrDocumentList);
        }
      }
      return;
    }
    
    SolrDocumentListIterator documentListIterator = (SolrDocumentListIterator) rowIterator;
    if (!documentListIterator.hasNext() && documentListIterator.hasMoreRows()) {
      SolrDocumentList solrDocumentList = doQuery(documentListIterator
          .getStart() + documentListIterator.getSize());
      if (solrDocumentList != null) {
        rowIterator = new SolrDocumentListIterator(solrDocumentList);
      }
    }
    
  }

