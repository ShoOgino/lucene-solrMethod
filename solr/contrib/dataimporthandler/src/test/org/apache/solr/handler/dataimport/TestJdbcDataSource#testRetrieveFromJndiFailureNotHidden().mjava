  @Test
  public void testRetrieveFromJndiFailureNotHidden() throws Exception {
    MockInitialContextFactory.bind("java:comp/env/jdbc/JndiDB", dataSource);

    props.put(JdbcDataSource.JNDI_NAME, "java:comp/env/jdbc/JndiDB");

    SQLException sqlException = new SQLException("fake");
    when(dataSource.getConnection()).thenThrow(sqlException);

    SQLException ex = expectThrows(SQLException.class,
        () -> jdbcDataSource.createConnectionFactory(context, props).call());
    assertSame(sqlException, ex);

    verify(dataSource).getConnection();
  }

