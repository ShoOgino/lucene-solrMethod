  @Test
  public void testRetrieveFromDriverManager() throws Exception {
    // in JDK9, Class.forName will throw exception for mock classes
    if (Constants.JRE_IS_MINIMUM_JAVA9) return;
    DriverManager.registerDriver(driver);
    try {
      when(driver.connect(notNull(),notNull())).thenReturn(connection);

      props.put(JdbcDataSource.DRIVER, driver.getClass().getName());
      props.put(JdbcDataSource.URL, "jdbc:fakedb");
      props.put("holdability", "HOLD_CURSORS_OVER_COMMIT");

      Connection conn = jdbcDataSource.createConnectionFactory(context, props)
              .call();

      verify(connection).setAutoCommit(false);
      verify(connection).setHoldability(1);

      assertSame("connection", conn, connection);
    } catch(Exception e) {
      throw e;
    } finally {
      DriverManager.deregisterDriver(driver);
    }
  }

