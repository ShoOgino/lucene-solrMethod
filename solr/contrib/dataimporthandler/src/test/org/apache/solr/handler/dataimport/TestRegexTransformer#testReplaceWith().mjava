  @Test
  public void testReplaceWith() {
    List<Map<String, String>> fields = new ArrayList<>();
    // <field column="name" regexp="'" replaceWith="''" />
    Map<String, String> fld = getField("name", "string", "'", null, null);
    fld.put(REPLACE_WITH, "''");
    fields.add(fld);
    Context context = getContext(null, null, null, Context.FULL_DUMP, fields, null);

    Map<String, Object> src = new HashMap<>();
    String s = "D'souza";
    src.put("name", s);

    Map<String, Object> result = new RegexTransformer().transformRow(src,
            context);
    assertEquals("D''souza", result.get("name"));

    fld = getField("title_underscore", "string", "\\s+", "title", null);
    fld.put(REPLACE_WITH, "_");
    fields.clear();
    fields.add(fld);
    context = getContext(null, null, null, Context.FULL_DUMP, fields, null);
    src.clear();
    src.put("title", "value with spaces"); // a value which will match the regex
    result = new RegexTransformer().transformRow(src, context);
    assertEquals("value_with_spaces", result.get("title_underscore"));
    src.clear();
    src.put("title", "valueWithoutSpaces"); // value which will not match regex
    result = new RegexTransformer().transformRow(src, context);
    assertEquals("valueWithoutSpaces", result.get("title_underscore")); // value should be returned as-is
  }

