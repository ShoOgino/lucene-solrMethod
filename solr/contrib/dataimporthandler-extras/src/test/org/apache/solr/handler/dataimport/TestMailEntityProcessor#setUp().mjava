  /**
   * Setup an embedded GreenMail server for testing.
   */
  @Override
  @Before
  public void setUp() throws Exception {
    super.setUp();
    
    int port = findAvailablePort(9103,9193);
    serverSetup = new ServerSetup(port, null, protocol);
    greenMail = new GreenMail(serverSetup);
    greenMail.start();
    mailUser = greenMail.setUser(email, user, password);    
    hostAndPort = "localhost:"+port;
    
    // Test mailbox is like this: foldername(mailcount)
    // top1(2) -> child11(6)
    //         -> child12(0)
    // top2(2) -> child21(1)
    //                  -> grandchild211(2)
    //                  -> grandchild212(1)
    //         -> child22(2)    
    ImapHostManager imapMgr = greenMail.getManagers().getImapHostManager();
    setupFolder(imapMgr, "top1", 2);    
    setupFolder(imapMgr, "top1"+sep+"child11", 6);    
    setupFolder(imapMgr, "top2", 2);    
    setupFolder(imapMgr, "top2"+sep+"child21", 1);    
    setupFolder(imapMgr, "top2"+sep+"child21"+sep+"grandchild211", 2);    
    setupFolder(imapMgr, "top2"+sep+"child21"+sep+"grandchild212", 1);    
    setupFolder(imapMgr, "top2"+sep+"child22", 2);
    setupFolder(imapMgr, "top3", 2);    
  }

