  private Message getNextMail() {
    if (!connected) {
      // this is needed to load the activation mail stuff correctly
      // otherwise, the JavaMail multipart support doesn't get configured
      // correctly, which leads to a class cast exception when processing
      // multipart messages: IMAPInputStream cannot be cast to
      // javax.mail.Multipart    
      if (false == withContextClassLoader(getClass().getClassLoader(), this::connectToMailBox)) {
        return null;
      }
      connected = true;
    }
    if (folderIter == null) {
      createFilters();
      folderIter = new FolderIterator(mailbox);
    }
    // get next message from the folder
    // if folder is exhausted get next folder
    // loop till a valid mail or all folders exhausted.
    while (msgIter == null || !msgIter.hasNext()) {
      Folder next = folderIter.hasNext() ? folderIter.next() : null;
      if (next == null) return null;
      
      msgIter = new MessageIterator(next, batchSize);
    }
    return msgIter.next();
  }

