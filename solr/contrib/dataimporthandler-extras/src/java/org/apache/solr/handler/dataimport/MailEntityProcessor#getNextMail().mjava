  private Message getNextMail() {
    if (!connected) {
      if (!connectToMailBox()) return null;
      connected = true;
    }
    if (folderIter == null) {
      createFilters();
      folderIter = new FolderIterator(mailbox);
    }
    // get next message from the folder
    // if folder is exhausted get next folder
    // loop till a valid mail or all folders exhausted.
    while (msgIter == null || !msgIter.hasNext()) {
      Folder next = folderIter.hasNext() ? folderIter.next() : null;
      if (next == null) return null;
      
      msgIter = new MessageIterator(next, batchSize);
    }
    return msgIter.next();
  }

