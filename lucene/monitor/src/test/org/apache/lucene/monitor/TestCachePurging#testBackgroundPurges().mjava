  public void testBackgroundPurges() throws IOException, InterruptedException {

    MonitorConfiguration config = new MonitorConfiguration().setPurgeFrequency(1, TimeUnit.SECONDS);
    try (Monitor monitor = new Monitor(ANALYZER, Presearcher.NO_FILTERING, config)) {

      assertEquals(-1, monitor.getQueryCacheStats().lastPurged);

      for (int i = 0; i < 100; i++) {
        monitor.register(newMonitorQuery(i));
      }
      monitor.deleteById("5");
      assertEquals(99, monitor.getQueryCacheStats().queries);
      assertEquals(100, monitor.getQueryCacheStats().cachedQueries);

      TimeUnit.SECONDS.sleep(2);
      assertEquals(99, monitor.getQueryCacheStats().queries);
      assertEquals(99, monitor.getQueryCacheStats().cachedQueries);
      assertTrue(monitor.getQueryCacheStats().lastPurged > 0);
    }
  }

