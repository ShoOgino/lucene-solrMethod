  public static long getTotalTermFreq(IndexReader reader, final String field, final BytesRef termText) throws Exception {   
    final long totalTF[] = new long[1];
    
    new ReaderUtil.Gather(reader) {

      @Override
      protected void add(int base, AtomicIndexReader r) throws IOException {
        Bits liveDocs = r.getLiveDocs();
        if (liveDocs == null) {
          // TODO: we could do this up front, during the scan
          // (next()), instead of after-the-fact here w/ seek,
          // if the codec supports it and there are no del
          // docs...
          final long totTF = r.totalTermFreq(field, termText);
          if (totTF != -1) {
            totalTF[0] += totTF;
            return;
          }
        }
        DocsEnum de = r.termDocsEnum(liveDocs, field, termText, true);
        if (de != null) {
          while (de.nextDoc() != DocIdSetIterator.NO_MORE_DOCS)
            totalTF[0] += de.freq();
        }
      }
    }.run();
    
    return totalTF[0];
  }

