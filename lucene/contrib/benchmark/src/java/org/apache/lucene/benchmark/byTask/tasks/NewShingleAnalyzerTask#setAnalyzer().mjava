  private void setAnalyzer() throws Exception {
    Class<? extends Analyzer> clazz = null;
    Analyzer wrappedAnalyzer;
    try {
      if (analyzerClassName == null || analyzerClassName.equals("")) {
        analyzerClassName 
          = "org.apache.lucene.analysis.standard.StandardAnalyzer"; 
      }
      if (analyzerClassName.indexOf(".") == -1 
          || analyzerClassName.startsWith("standard.")) {
        //there is no package name, assume o.a.l.analysis
        analyzerClassName = "org.apache.lucene.analysis." + analyzerClassName;
      }
      clazz = Class.forName(analyzerClassName).asSubclass(Analyzer.class);
      // first try to use a ctor with version parameter (needed for many new 
      // Analyzers that have no default one anymore)
      Constructor<? extends Analyzer> ctor = clazz.getConstructor(Version.class);
      wrappedAnalyzer = ctor.newInstance(Version.LUCENE_CURRENT);
    } catch (NoSuchMethodException e) {
      // otherwise use default ctor
      wrappedAnalyzer = clazz.newInstance();
    }
    ShingleAnalyzerWrapper analyzer 
      = new ShingleAnalyzerWrapper(wrappedAnalyzer, maxShingleSize);
    analyzer.setOutputUnigrams(outputUnigrams);
    getRunData().setAnalyzer(analyzer);
  }

