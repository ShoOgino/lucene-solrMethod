  // read until finding a line that starts with the specified prefix, or a terminating tag has been found.
  private void read(StringBuffer buf, String prefix, boolean collectMatchLine,
                    boolean collectAll, String terminatingTag)
      throws IOException, NoMoreDataException {
    String sep = "";
    while (true) {
      String line = reader.readLine();

      if (line == null) {
        openNextFile();
        continue;
      }

      rawDocSize += line.length();

      if (line.startsWith(prefix)) {
        if (collectMatchLine) {
          buf.append(sep).append(line);
          sep = NEW_LINE;
        }
        break;
      }

      if (terminatingTag != null && line.startsWith(terminatingTag)) {
        // didn't find the prefix that was asked, but the terminating
        // tag was found. set the length to 0 to signal no match was
        // found.
        buf.setLength(0);
        break;
      }

      if (collectAll) {
        buf.append(sep).append(line);
        sep = NEW_LINE;
      }
    }
  }

