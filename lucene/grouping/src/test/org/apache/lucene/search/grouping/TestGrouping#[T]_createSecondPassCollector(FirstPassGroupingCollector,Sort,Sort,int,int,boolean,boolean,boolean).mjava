  @SuppressWarnings({"unchecked","rawtypes"})
  private <T> TopGroupsCollector<T> createSecondPassCollector(FirstPassGroupingCollector firstPassGroupingCollector,
                                                                       Sort groupSort,
                                                                       Sort sortWithinGroup,
                                                                       int groupOffset,
                                                                       int maxDocsPerGroup,
                                                                       boolean getScores,
                                                                       boolean getMaxScores,
                                                                       boolean fillSortFields) throws IOException {

    Collection<SearchGroup<T>> searchGroups = firstPassGroupingCollector.getTopGroups(groupOffset, fillSortFields);
    return new TopGroupsCollector<>(firstPassGroupingCollector.getGroupSelector(), searchGroups, groupSort, sortWithinGroup, maxDocsPerGroup, getScores, getMaxScores, fillSortFields);
  }

