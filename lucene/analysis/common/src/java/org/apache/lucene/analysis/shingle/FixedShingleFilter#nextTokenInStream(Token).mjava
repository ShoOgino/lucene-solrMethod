  private Token nextTokenInStream(Token token) throws IOException {
    if (token != null && token.nextToken != null) {
      return token.nextToken;
    }
    if (input.incrementToken() == false) {
      finishInnerStream();
      if (token == null) {
        return endToken;
      }
      else {
        token.nextToken = endToken;
        return endToken;
      }
    }
    if (token == null) {
      return newToken();
    }
    token.nextToken = newToken();
    return token.nextToken;
  }

