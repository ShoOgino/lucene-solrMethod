  public void testWrapGraphs() throws Exception {

    CannedTokenStream cts = new CannedTokenStream(
        new Token("a", 0, 1),
        new Token("b", 2, 3),
        new Token("c", 4, 5),
        new Token("d", 6, 7),
        new Token("e", 8, 9)
    );

    SynonymMap sm;
    try (Analyzer analyzer = new MockAnalyzer(random())) {
      SolrSynonymParser parser = new SolrSynonymParser(true, true, analyzer);
      parser.parse(new StringReader("a b, f\nc d, g"));
      sm = parser.build();
    }

    TokenStream ts = new ConditionalTokenFilter(cts, in -> new SynonymGraphFilter(in, sm, true)) {
      CharTermAttribute termAtt = addAttribute(CharTermAttribute.class);
      @Override
      protected boolean shouldFilter() throws IOException {
        return "c".equals(termAtt.toString()) == false;
      }
    };

    assertTokenStreamContents(ts, new String[]{
        "f", "a", "b", "c", "d", "e"
        },
        null, null, null,
        new int[]{
        1, 0, 1, 1, 1, 1
        },
        new int[]{
        2, 1, 1, 1, 1, 1
        });

  }

