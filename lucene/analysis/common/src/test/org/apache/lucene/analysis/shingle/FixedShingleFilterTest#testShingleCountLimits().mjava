  public void testShingleCountLimits() {

    Token[] tokens = new Token[5000];
    tokens[0] = new Token("term", 1, 0, 1);
    tokens[1] = new Token("term1", 1, 2, 3);
    for (int i = 2; i < 5000; i++) {
      tokens[i] = new Token("term" + i, 0, 2, 3);
    }

    Exception e = expectThrows(IllegalStateException.class, () -> {
      TokenStream ts = new FixedShingleFilter(new CannedTokenStream(tokens), 2);
      ts.reset();
      while (ts.incrementToken()) {}
    });
    assertEquals("Too many shingles (> 1000) at term [term]", e.getMessage());
  }

