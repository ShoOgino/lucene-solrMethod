  /**
   * Set up a new index in RAM with three test phrases and the supplied Analyzer.
   *
   * @param analyzer the analyzer to use
   * @return an indexSearcher on the test index.
   * @throws Exception if an error occurs with index writer or searcher
   */
  @Override
  public void setUp() throws Exception {
    super.setUp();
    analyzer = new ShingleAnalyzerWrapper(new MockAnalyzer(random(), MockTokenizer.WHITESPACE, false), 2);
    directory = newDirectory();
    IndexWriter writer = new IndexWriter(directory, new IndexWriterConfig(TEST_VERSION_CURRENT, analyzer));

    Document doc;
    doc = new Document();
    doc.add(new Field("content", "please divide this sentence into shingles", TextField.TYPE_STORED));
    writer.addDocument(doc);

    doc = new Document();
    doc.add(new Field("content", "just another test sentence", TextField.TYPE_STORED));
    writer.addDocument(doc);

    doc = new Document();
    doc.add(new Field("content", "a sentence which contains no test", TextField.TYPE_STORED));
    writer.addDocument(doc);

    writer.close();

    reader = IndexReader.open(directory);
    searcher = new IndexSearcher(reader);
  }

