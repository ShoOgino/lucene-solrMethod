  public static DoubleValuesSource function(DoubleValuesSource in, DoubleUnaryOperator function) {
    return new DoubleValuesSource() {
      @Override
      public DoubleValues getValues(LeafReaderContext ctx, DoubleValues scores) throws IOException {
        DoubleValues v = in.getValues(ctx, scores);
        return new DoubleValues() {
          @Override
          public double doubleValue() throws IOException {
            return function.applyAsDouble(v.doubleValue());
          }

          @Override
          public boolean advanceExact(int doc) throws IOException {
            return v.advanceExact(doc);
          }
        };
      }

      @Override
      public boolean needsScores() {
        return in.needsScores();
      }

      @Override
      public boolean isCacheable(LeafReaderContext ctx) {
        return in.isCacheable(ctx);
      }

      @Override
      public int hashCode() {
        return 0;
      }

      @Override
      public boolean equals(Object obj) {
        return false;
      }

      @Override
      public String toString() {
        return "fn";
      }
    };
  }

