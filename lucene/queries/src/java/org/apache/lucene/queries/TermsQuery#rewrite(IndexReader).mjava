  @Override
  public Query rewrite(IndexReader reader) throws IOException {
    final int threshold = Math.min(BOOLEAN_REWRITE_TERM_COUNT_THRESHOLD, BooleanQuery.getMaxClauseCount());
    if (termData.size() <= threshold) {
      BooleanQuery bq = new BooleanQuery();
      TermIterator iterator = termData.iterator();
      for (BytesRef term = iterator.next(); term != null; term = iterator.next()) {
        bq.add(new TermQuery(new Term(iterator.field(), BytesRef.deepCopyOf(term))), Occur.SHOULD);
      }
      assert bq.clauses().size() == termData.size();
      ConstantScoreQuery csq = new ConstantScoreQuery(bq);
      csq.setBoost(getBoost());
      return csq;
    }
    return super.rewrite(reader);
  }

