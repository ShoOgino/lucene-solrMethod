  @Override
  public boolean exists(int doc) {
    try {
      if (doc < lastDocRequested) {
        if (noMatches) return false;
        scorer = weight.scorer(readerContext);
        scorerDoc = -1;
        if (scorer==null) {
          noMatches = true;
          return false;
        }
        it = scorer.iterator();
      }
      lastDocRequested = doc;

      if (scorerDoc < doc) {
        scorerDoc = it.advance(doc);
      }

      if (scorerDoc > doc) {
        // query doesn't match this document... either because we hit the
        // end, or because the next doc is after this doc.
        return false;
      }

      // a match!
      return true;
    } catch (IOException e) {
      throw new RuntimeException("caught exception in QueryDocVals("+q+") doc="+doc, e);
    }
  }

