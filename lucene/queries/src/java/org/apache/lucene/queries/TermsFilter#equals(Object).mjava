  @Override
  public boolean equals(Object obj) {
    if (this == obj) {
      return true;
    }
    if ((obj == null) || (obj.getClass() != this.getClass())) {
      return false;
    }
    
    TermsFilter test = (TermsFilter) obj;
    if (test.hashCode == hashCode && this.termsAndFields.length == test.termsAndFields.length) {
      // first check the fields before even comparing the bytes
      for (int i = 0; i < termsAndFields.length; i++) {
        TermsAndField current = termsAndFields[i];
        if (!current.equals(test.termsAndFields[i])) {
          return false;
        }
      }
      // straight byte comparison since we sort they must be identical
      int end = offsets[termsAndFields.length];
      byte[] left = this.termsBytes;
      byte[] right = test.termsBytes;
      for(int i=0;i < end;i++) {
        if (left[i] != right[i]) {
          return false;
        }
      }
      return true;
    }
    return false;
  }

