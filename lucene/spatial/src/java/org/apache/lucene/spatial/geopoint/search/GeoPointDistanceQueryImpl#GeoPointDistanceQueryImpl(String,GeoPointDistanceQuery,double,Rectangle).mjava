  GeoPointDistanceQueryImpl(final String field, final GeoPointDistanceQuery q,
                            final double centerLonUnwrapped, final Rectangle bbox) {
    super(field, bbox.minLat, bbox.maxLat, bbox.minLon, bbox.maxLon);
    distanceQuery = q;
    centerLon = centerLonUnwrapped;

    // unless our box is crazy, we can use this bound
    // to reject edge cases faster in postFilter()
    if (bbox.maxLon - centerLon < 90 && centerLon - bbox.minLon < 90) {
      maxPartialDistance = Math.max(SloppyMath.haversinSortKey(distanceQuery.centerLat, centerLon, distanceQuery.centerLat, bbox.maxLon),
                                    SloppyMath.haversinSortKey(distanceQuery.centerLat, centerLon, bbox.maxLat, centerLon));
    } else {
      maxPartialDistance = Double.POSITIVE_INFINITY;
    }
    axisLat = Rectangle.axisLat(distanceQuery.centerLat, distanceQuery.radiusMeters);
  }

