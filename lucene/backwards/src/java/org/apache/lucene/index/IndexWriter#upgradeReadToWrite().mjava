  // Allows one readLock to upgrade to a writeLock even if
  // there are other readLocks as long as all other
  // readLocks are also blocked in this method:
  synchronized void upgradeReadToWrite() {
    assert readCount > 0;
    upgradeCount++;
    while(readCount > upgradeCount || writeThread != null) {
      doWait();
    }
    
    writeThread = Thread.currentThread();
    readCount--;
    upgradeCount--;
  }

