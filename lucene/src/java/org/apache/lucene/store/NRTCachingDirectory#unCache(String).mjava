  private void unCache(String fileName) throws IOException {
    final IndexOutput out;
    IOContext context = IOContext.DEFAULT;
    synchronized(this) {
      if (!delegate.fileExists(fileName)) {
        assert cache.fileExists(fileName);
        out = delegate.createOutput(fileName, context);
      } else {
        out = null;
      }
    }

    if (out != null) {
      IndexInput in = null;
      try {
        in = cache.openInput(fileName, context);
        in.copyBytes(out, in.length());
      } finally {
        IOUtils.close(in, out);
      }
      synchronized(this) {
        cache.deleteFile(fileName);
      }
    }
  }

