    private int numLeaves(IndexReader reader) {
      final AtomicInteger numLeaves = new AtomicInteger();
      try {
        new Gather(reader) {
          @Override
          protected void add(int base, IndexReader r) {
            numLeaves.incrementAndGet();
          }
        }.run();
      } catch (IOException ioe) {
        // won't happen
        throw new RuntimeException(ioe);
      }
      return numLeaves.get();
    }

