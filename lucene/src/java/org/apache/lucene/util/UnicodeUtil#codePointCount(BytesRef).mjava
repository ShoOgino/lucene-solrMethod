  /** Returns the number of code points in this utf8
   *  sequence.  Behavior is undefined if the utf8 sequence
   *  is invalid.*/
  public static int codePointCount(BytesRef utf8) {
    int upto = utf8.offset;
    final int limit = utf8.offset + utf8.length;
    final byte[] bytes = utf8.bytes;
    int codePointCount = 0;
    while (upto < limit) {
      codePointCount++;
      upto += utf8CodeLength[bytes[upto]&0xFF];
    }
    return codePointCount;
  }

