    private int run(int base, IndexReader reader) throws IOException {
      if (reader instanceof AtomicReader) {
        // atomic reader
        add(base, (AtomicReader) reader);
        base += reader.maxDoc();
      } else {
        assert reader instanceof CompositeReader : "must be a composite reader";
        IndexReader[] subReaders = ((CompositeReader) reader).getSequentialSubReaders();
        for (int i = 0; i < subReaders.length; i++) {
          base = run(base, subReaders[i]);
        }
      }

      return base;
    }

