    private int run(int base, IndexReader reader) throws IOException {
      if (reader instanceof AtomicIndexReader) {
        // atomic reader
        add(base, (AtomicIndexReader) reader);
        base += reader.maxDoc();
      } else {
        assert reader instanceof CompositeIndexReader : "must be a composite reader";
        IndexReader[] subReaders = ((CompositeIndexReader) reader).getSequentialSubReaders();
        for (int i = 0; i < subReaders.length; i++) {
          base = run(base, subReaders[i]);
        }
      }

      return base;
    }

