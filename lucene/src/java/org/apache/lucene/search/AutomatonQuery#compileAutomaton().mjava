  private synchronized void compileAutomaton() {
    // this method must be synchronized, as setting the three transient fields is not atomic:
    if (runAutomaton == null) {
      runAutomaton = new ByteRunAutomaton(automaton);
      isFinite = SpecialOperations.isFinite(automaton);
      commonSuffixRef = isFinite ? null : SpecialOperations.getCommonSuffixBytesRef(runAutomaton.getAutomaton());
    }
  }

