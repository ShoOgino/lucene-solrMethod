    @Override
    public Query rewrite(IndexReader reader, MultiTermQuery query) throws IOException {
      Query result = super.rewrite(reader, query);
      assert result instanceof BooleanQuery;
      // TODO: if empty boolean query return NullQuery?
      if (!((BooleanQuery) result).clauses().isEmpty()) {
        // strip the scores off
        result = new ConstantScoreQuery(new QueryWrapperFilter(result));
        result.setBoost(query.getBoost());
      }
      return result;
    }

