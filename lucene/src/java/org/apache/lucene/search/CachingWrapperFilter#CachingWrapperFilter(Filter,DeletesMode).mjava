  /**
   * Expert: by default, the cached filter will be shared
   * across reopened segments that only had changes to their
   * deletions.  
   *
   * @param filter Filter to cache results of
   * @param deletesMode See {@link DeletesMode}
   */
  public CachingWrapperFilter(Filter filter, DeletesMode deletesMode) {
    this.filter = filter;
    cache = new FilterCache<DocIdSet>(deletesMode) {
      @Override
      public DocIdSet mergeDeletes(final Bits delDocs, final DocIdSet docIdSet) {
        return new FilteredDocIdSet(docIdSet) {
          @Override
            protected boolean match(int docID) {
            return !delDocs.get(docID);
          }
        };
      }
    };
  }

