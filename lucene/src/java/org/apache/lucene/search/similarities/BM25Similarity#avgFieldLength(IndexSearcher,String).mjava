  /** The default implementation computes the average as <code>sumTotalTermFreq / maxDoc</code>,
   * or returns <code>1</code> if the index does not store sumTotalTermFreq (Lucene 3.x indexes
   * or any field that omits frequency information). */
  protected float avgFieldLength(IndexSearcher searcher, String field) throws IOException {
    Terms terms = MultiFields.getTerms(searcher.getIndexReader(), field);
    if (terms == null) {
      // field does not exist;
      return 1f;
    }
    long sumTotalTermFreq = terms.getSumTotalTermFreq();
    long maxdoc = searcher.maxDoc();
    return sumTotalTermFreq == -1 ? 1f : (float) (sumTotalTermFreq / (double) maxdoc);
  }

