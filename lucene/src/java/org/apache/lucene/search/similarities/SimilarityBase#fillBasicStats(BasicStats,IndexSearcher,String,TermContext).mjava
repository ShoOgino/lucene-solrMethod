  /** Fills all member fields defined in {@code BasicStats} in {@code stats}. 
   *  Subclasses can override this method to fill additional stats. */
  protected void fillBasicStats(BasicStats stats, IndexSearcher searcher,
      String fieldName, TermContext termContext) throws IOException {
    IndexReader reader = searcher.getIndexReader();
    int numberOfDocuments = reader.maxDoc();
    
    int docFreq = termContext.docFreq();
    long totalTermFreq = termContext.totalTermFreq();

    // codec does not supply totalTermFreq: substitute docFreq
    if (totalTermFreq == -1) {
      totalTermFreq = docFreq;
    }

    final long numberOfFieldTokens;
    final float avgFieldLength;
    
    Terms terms = MultiFields.getTerms(searcher.getIndexReader(), fieldName);
    if (terms == null) {
      // field does not exist;
      numberOfFieldTokens = 0;
      avgFieldLength = 1;
    } else {
      long sumTotalTermFreq = terms.getSumTotalTermFreq();

      // We have to provide something if codec doesnt supply these measures,
      // or if someone omitted frequencies for the field... negative values cause
      // NaN/Inf for some scorers.
      if (sumTotalTermFreq == -1) {
        numberOfFieldTokens = docFreq;
        avgFieldLength = 1;
      } else {
        numberOfFieldTokens = sumTotalTermFreq;
        avgFieldLength = (float)numberOfFieldTokens / numberOfDocuments;
      }
    }
 
    // TODO: add sumDocFreq for field (numberOfFieldPostings)
    stats.setNumberOfDocuments(numberOfDocuments);
    stats.setNumberOfFieldTokens(numberOfFieldTokens);
    stats.setAvgFieldLength(avgFieldLength);
    stats.setDocFreq(docFreq);
    stats.setTotalTermFreq(totalTermFreq);
  }

