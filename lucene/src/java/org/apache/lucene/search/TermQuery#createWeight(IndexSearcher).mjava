  @Override
  public Weight createWeight(IndexSearcher searcher) throws IOException {
    final ReaderContext context = searcher.getTopReaderContext();
    final int weightDocFreq;
    final PerReaderTermState termState;
    if (perReaderTermState == null || perReaderTermState.topReaderContext != context) {
      // make TermQuery single-pass if we don't have a PRTS or if the context differs!
      termState = PerReaderTermState.build(context, term, true); // cache term lookups!
      // we must not ignore the given docFreq - if set use the given value
      weightDocFreq = docFreq == -1 ? termState.docFreq() : docFreq;
    } else {
     // PRTS was pre-build for this IS
     termState = this.perReaderTermState;
     weightDocFreq = docFreq;
    }
    
    return new TermWeight(searcher, termState, weightDocFreq);
  }

