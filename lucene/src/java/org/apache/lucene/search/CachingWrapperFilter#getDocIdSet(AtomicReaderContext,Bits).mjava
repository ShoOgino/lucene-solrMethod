  @Override
  public DocIdSet getDocIdSet(AtomicReaderContext context, final Bits acceptDocs) throws IOException {
    final IndexReader reader = context.reader;
    final Object coreKey = reader.getCoreCacheKey();

    DocIdSet docIdSet = cache.get(reader, coreKey);
    if (docIdSet != null) {
      hitCount++;
    } else {
      missCount++;
      // cache miss: we use no acceptDocs here
      // (this saves time on building DocIdSet, the acceptDocs will be applied on the cached set)
      docIdSet = docIdSetToCache(filter.getDocIdSet(context, null/**!!!*/), reader);
      cache.put(coreKey, docIdSet);
    }
    
    return BitsFilteredDocIdSet.wrap(docIdSet, acceptDocs);
  }

