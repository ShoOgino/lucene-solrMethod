  @Override
  public void onInsert(DocumentsWriterFlushControl control, ThreadState state) {
    if (flushOnDocCount()
        && state.perThread.getNumDocsInRAM() >= indexWriterConfig
            .getMaxBufferedDocs()) {
      control.setFlushPending(state); // flush by num docs
    } else {// flush by RAM
      if (flushOnRAM()) {
        final double ramBufferSizeMB = indexWriterConfig.getRAMBufferSizeMB();
        final long totalRam = control.activeBytes();
        final long limit = (long) (ramBufferSizeMB * 1024.d * 1024.d);
        if (totalRam >= limit) {
          markLargestWriterPending(control, state, totalRam);
        }
      }
    }
  }

