    // Important that we get docCount, in case there were
    // some last docs that we didn't see
    @Override
    synchronized public void finish(int docCount) throws IOException {
      if (datOut == null) // no added data
        return;
      initIndexOut();
      final int count = 1 + hash.size();
      idxOut.writeInt(count - 1);
      // write index
      final PackedInts.Writer w = PackedInts.getWriter(idxOut, docCount,
          PackedInts.bitsRequired(count - 1));
      final int limit = docCount > docToID.length ? docToID.length : docCount;
      for (int i = 0; i < limit; i++) {
        w.add(docToID[i]);
      }
      // fill up remaining doc with zeros
      for (int i = limit; i < docCount; i++) {
        w.add(0);
      }
      w.finish();
      hash.close();
      super.finish(docCount);
      bytesUsed.addAndGet((-docToID.length)
          * RamUsageEstimator.NUM_BYTES_INT);
      docToID = null;
    }

