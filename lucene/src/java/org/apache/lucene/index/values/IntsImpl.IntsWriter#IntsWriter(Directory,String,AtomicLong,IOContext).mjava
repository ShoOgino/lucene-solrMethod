    protected IntsWriter(Directory dir, String id, AtomicLong bytesUsed, IOContext context)
        throws IOException {
      super(bytesUsed);
      datOut = dir.createOutput(IndexFileNames.segmentFileName(id, "",
          DATA_EXTENSION), context);
      boolean success = false;
      try {
        CodecUtil.writeHeader(datOut, CODEC_NAME, VERSION_CURRENT);
        this.id = id;
        docToValue = new long[1];
        bytesUsed.addAndGet(RamUsageEstimator.NUM_BYTES_LONG); // TODO the
                                                               // bitset
                                                               // needs memory
                                                               // too
        success = true;
      } finally {
        if (!success) {
          datOut.close();
        }
      }
    }

