    @Override
    public void finish(int docCount) throws IOException {
      boolean success = false;
      try {
        if (datOut == null) {
          // if we only add or merge Packed ints datOut is not initialized
          assert !merging || typeOrd == PACKED;
          finishAdd(docCount);
        } else {
          assert datOut != null && merging && typeOrd != PACKED;
          // on merge, simply fill up missing values 
          fillDefault(datOut, docCount - (lastDocId + 1));
        }
        success = true;
      } finally {
        IOUtils.closeSafely(!success, datOut);
        array.clear();
      }
    }

