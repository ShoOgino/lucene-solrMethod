    private void writePackedInts(int docCount) throws IOException {
      initDataOut(PACKED);
      datOut.writeLong(minValue);
      assert array.type() == ValueType.FIXED_INTS_64;
      final long[] docToValue = (long[])array.getArray();
      // write a default value to recognize docs without a value for that
      // field
      final long defaultValue = maxValue >= 0 && minValue <= 0 ? 0 - minValue
          : ++maxValue - minValue;
      datOut.writeLong(defaultValue);
      PackedInts.Writer w = PackedInts.getWriter(datOut, docCount,
          PackedInts.bitsRequired(maxValue - minValue));
      final int limit = docToValue.length > docCount ? docCount
          : docToValue.length;
      for (int i = 0; i < limit; i++) {
        w.add(docToValue[i] == 0 ? defaultValue : docToValue[i] - minValue);
      }
      for (int i = limit; i < docCount; i++) {
        w.add(defaultValue);
      }

      w.finish();
    }

