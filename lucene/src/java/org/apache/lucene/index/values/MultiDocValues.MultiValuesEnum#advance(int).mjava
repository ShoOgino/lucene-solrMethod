    @Override
    public int advance(int target) throws IOException {
      assert target > currentDoc : "target " + target
          + " must be > than the current doc " + currentDoc;
      int relativeDoc = target - currentStart;
      do {
        if (target >= maxDoc) {// we are beyond max doc
          return currentDoc = NO_MORE_DOCS;
        }
        if (target >= currentMax) {
          final int idx = ReaderUtil.subIndex(target, starts);
          currentEnum.close();
          currentEnum = docValuesIdx[idx].docValues.getEnum(this.attributes());
          currentEnum.copyReferences(this);
          currentStart = docValuesIdx[idx].start;
          currentMax = currentStart + docValuesIdx[idx].length;
          relativeDoc = target - currentStart;
        }
        target = currentMax; // make sure that we advance to the next enum if the current is exhausted

      } while ((relativeDoc = currentEnum.advance(relativeDoc)) == NO_MORE_DOCS);
      return currentDoc = currentStart + relativeDoc;
    }

