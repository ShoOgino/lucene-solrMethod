    @Override
    synchronized public void finish(int docCount) throws IOException {
      if(!started)
        return;
      final IndexOutput datOut = dir.createOutput(IndexFileNames
          .segmentFileName(id, "", IndexFileNames.CSF_DATA_EXTENSION));
      CodecUtil.writeHeader(datOut, CODEC_NAME, VERSION_CURRENT);

      // nocommit -- long can't work right since it's signed
      datOut.writeLong(minValue);
      // write a default value to recognize docs without a value for that field
      final long defaultValue = ++maxValue - minValue;
      datOut.writeLong(defaultValue);
      PackedInts.Writer w = PackedInts.getWriter(datOut, docCount, PackedInts.bitsRequired(maxValue-minValue));
         
      final int limit = maxDocID + 1;
      for (int i = 0; i < minDocID; i++) {
        w.add(defaultValue);
      }
      for (int i = minDocID; i < limit; i++) {
        w.add(docToValue[i] - minValue);
      }
      for (int i = limit; i < docCount; i++) {
        w.add(defaultValue);
      }
      w.finish();

      datOut.close();
    }

