    /**
     * Commit all segment reader in the pool.
     * @throws IOException
     */
    synchronized void commit(SegmentInfos infos) throws IOException {

      // We invoke deleter.checkpoint below, so we must be
      // sync'd on IW:
      assert Thread.holdsLock(IndexWriter.this);
      
      for (SegmentInfo info : infos) {
        final SegmentReader sr = readerMap.get(new SegmentCacheKey(info, IOContext.Context.READ));
        if (sr != null && sr.hasChanges) {
          assert infoIsLive(info);
          sr.doCommit();
          // Must checkpoint w/ deleter, because this
          // segment reader will have created new _X_N.del
          // file.
          deleter.checkpoint(segmentInfos, false);
        }
      }
    }

