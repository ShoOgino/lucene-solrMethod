  // IW calls this on finishing a merge.  While the merge
  // was running, it's possible new deletes were pushed onto
  // our last (and only our last) segment.  In this case we
  // must carry forward those deletes onto the merged
  // segment.
  synchronized void commitMerge(MergePolicy.OneMerge merge) {
    assert checkDeleteStats();
    if (infoStream != null) {
      message("commitMerge merge.info=" + merge.info + " merge.segments=" + merge.segments);
    }
    final SegmentInfo lastInfo = merge.segments.lastElement();
    final SegmentDeletes lastDeletes = deletesMap.get(lastInfo);
    if (lastDeletes != null) {
      deletesMap.remove(lastInfo);
      assert !deletesMap.containsKey(merge.info);
      deletesMap.put(merge.info, lastDeletes);
      // don't need to update numTerms/bytesUsed since we
      // are just moving the deletes from one info to
      // another
      if (infoStream != null) {
        message("commitMerge done: new deletions=" + lastDeletes);
      }
    } else if (infoStream != null) {
      message("commitMerge done: no new deletions");
    }
    assert !anyDeletes(merge.segments.range(0, merge.segments.size()-1));
    assert checkDeleteStats();
  }

