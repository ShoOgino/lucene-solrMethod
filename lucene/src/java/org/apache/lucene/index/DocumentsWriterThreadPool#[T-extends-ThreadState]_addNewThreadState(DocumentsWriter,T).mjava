  protected final <T extends ThreadState> T addNewThreadState(DocumentsWriter documentsWriter, T threadState) {
    // Just create a new "private" thread state
    ThreadState[] newArray = new ThreadState[1+allThreadStates.length];
    if (allThreadStates.length > 0)
      System.arraycopy(allThreadStates, 0, newArray, 0, allThreadStates.length);
    threadState.perThread = documentsWriter.newDocumentsWriterPerThread();
    newArray[allThreadStates.length] = threadState;

    allThreadStates = newArray;
    return threadState;
  }

