    public byte[] getPayload(byte[] bytes, int offset) throws IOException {
      if (!any || postingsEnum == null) {
        return null;
      }
      if (pendingPayload == null) {
        if (!postingsEnum.hasPayload()) {
          return null;
        }
        pendingPayload = postingsEnum.getPayload();
      }
      if (pendingPayload == null) {
        return null;
      }

      // old API would always used passed in bytes if it
      // "fits", else allocate new:
      if (bytes != null && pendingPayload.length <= bytes.length - offset) {
        System.arraycopy(pendingPayload.bytes, pendingPayload.offset, bytes, offset, pendingPayload.length);
        return bytes;
      } else if (pendingPayload.offset == 0 && pendingPayload.length == pendingPayload.bytes.length) {
        return pendingPayload.bytes;
      } else {
        final byte[] retBytes = new byte[pendingPayload.length];
        System.arraycopy(pendingPayload.bytes, pendingPayload.offset, retBytes, 0, pendingPayload.length);
        return retBytes;
      }
    }

