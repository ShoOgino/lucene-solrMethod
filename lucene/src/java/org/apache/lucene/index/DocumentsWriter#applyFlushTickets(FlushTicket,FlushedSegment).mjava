  private void applyFlushTickets(FlushTicket current, FlushedSegment segment) throws IOException {
    synchronized (ticketQueue) {
      if (current != null) {
        // this is a segment FlushTicket so assign the flushed segment so we can make progress.
        assert segment != null;
        current.segment = segment;
      }
      while (true) {
        // while we can publish flushes keep on making the queue empty.
        final FlushTicket head = ticketQueue.peek();
        if (head != null && head.canPublish()) {
          ticketQueue.poll();
          finishFlush(head.segment, head.frozenDeletes);
        } else {
          break;
        }
      }
    }
  }

