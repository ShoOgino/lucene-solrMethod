  /** This method may return the reader back, if the
   *  incoming reader is already atomic. */
  public static IndexReader wrap(IndexReader reader) throws IOException {
    final List<IndexReader> subs = new ArrayList<IndexReader>();
    ReaderUtil.gatherSubReaders(subs, reader);
    if (subs == null) {
      // already an atomic reader
      return reader;
    } else if (subs.size() == 1) {
      return subs.get(0);
    } else {
      return new SlowMultiReaderWrapper(reader);
    }
  }

