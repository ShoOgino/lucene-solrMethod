  private synchronized long applyDeletes(IndexWriter.ReaderPool readerPool,
                                            SegmentInfo info, 
                                            SegmentDeletes coalescedDeletes,
                                            SegmentDeletes segmentDeletes) throws IOException {    
    assert readerPool.infoIsLive(info);
    
    assert coalescedDeletes == null || coalescedDeletes.docIDs.size() == 0;
    
    long delCount = 0;

    // Lock order: IW -> BD -> RP
    SegmentReader reader = readerPool.get(info, false);
    try {
      if (coalescedDeletes != null) {
        delCount += applyDeletes(coalescedDeletes, reader);
      }
      if (segmentDeletes != null) {
        delCount += applyDeletes(segmentDeletes, reader);
      }
    } finally {
      readerPool.release(reader);
    }
    return delCount;
  }

