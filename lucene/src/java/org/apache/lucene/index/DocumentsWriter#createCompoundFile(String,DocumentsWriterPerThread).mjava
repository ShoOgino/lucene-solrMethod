  /** Build compound file for the segment we just flushed */
  void createCompoundFile(String segment, DocumentsWriterPerThread perThread) throws IOException {
    
    CompoundFileWriter cfsWriter = new CompoundFileWriter(directory, 
        IndexFileNames.segmentFileName(segment, "", IndexFileNames.COMPOUND_FILE_EXTENSION));
    for(String fileName : perThread.flushState.flushedFiles) {
      cfsWriter.addFile(fileName);
    }
      
    // Perform the merge
    cfsWriter.close();
  }

