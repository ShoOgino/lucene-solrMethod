    @Override
    public DocValuesConsumer addValuesField(FieldInfo field) throws IOException {
      final int codecId = field.getCodecId();
      assert codecId != FieldInfo.UNASSIGNED_CODEC_ID;
      PerDocConsumer perDoc = consumers[codecId];
      if (perDoc == null) {
        perDoc = codecs[codecId].docsConsumer(new PerDocWriteState(state, codecId));
        assert perDoc != null;
        consumers[codecId] = perDoc;
      }
      return perDoc.addValuesField(field);
    }

