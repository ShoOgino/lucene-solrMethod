  /** Get a slice out of the byte array. */
  public void fill(BytesRef b, long start, int length) {
    assert length >= 0: "length=" + length;
    final int index = (int) (start >> blockBits);
    final int offset = (int) (start & blockMask);
    b.length = length;
    if (blockSize - offset >= length) {
      // Within block
      b.bytes = blocks.get(index);
      b.offset = offset;
    } else {
      // Split
      byte[] buffer = threadBuffers.get();
      if (buffer == null) {
        buffer = new byte[length];
        threadBuffers.set(buffer);
      } else if (buffer.length < length) {
        buffer = ArrayUtil.grow(buffer, length);
        threadBuffers.set(buffer);
      }
      b.bytes = buffer;
      b.offset = 0;
      System.arraycopy(blocks.get(index), offset, buffer, 0, blockSize-offset);
      System.arraycopy(blocks.get(1+index), 0, buffer, blockSize-offset, length-(blockSize-offset));
    }
  }

