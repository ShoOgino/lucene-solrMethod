  public void merge(MergeState mergeState, PerDocValues producer)
      throws IOException {
    Iterable<String> fields = producer.fields();
    for (String field : fields) {
      mergeState.fieldInfo = mergeState.fieldInfos.fieldInfo(field);
      assert mergeState.fieldInfo != null : "FieldInfo for field is null: "
          + field;
      if (mergeState.fieldInfo.hasDocValues()) {
        final DocValues docValues = producer.docValues(field);
        if (docValues == null) {
          /*
           * It is actually possible that a fieldInfo has a values type but no
           * values are actually available. this can happen if there are already
           * segments without values around.
           */
          continue;
        }
        final DocValuesConsumer docValuesConsumer = addValuesField(mergeState.fieldInfo);
        assert docValuesConsumer != null;
        docValuesConsumer.merge(mergeState, docValues);
      }
    }

  }

