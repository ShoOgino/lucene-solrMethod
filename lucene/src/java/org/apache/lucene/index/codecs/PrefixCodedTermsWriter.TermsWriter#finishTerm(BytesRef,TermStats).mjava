    @Override
    public void finishTerm(BytesRef text, TermStats stats) throws IOException {

      assert stats.docFreq > 0;
      //System.out.println("finishTerm term=" + fieldInfo.name + ":" + text.utf8ToString() + " fp="  + out.getFilePointer());

      final boolean isIndexTerm = fieldIndexWriter.checkIndexTerm(text, stats);

      termWriter.write(text);
      final int highBit = isIndexTerm ? 0x80 : 0;
      //System.out.println("  isIndex=" + isIndexTerm);

      // This is a vInt, except, we steal top bit to record
      // whether this was an indexed term:
      if ((stats.docFreq & ~0x3F) == 0) {
        // Fast case -- docFreq fits in 6 bits
        out.writeByte((byte) (highBit | stats.docFreq));
      } else {
        // Write bottom 6 bits of docFreq, then write the
        // remainder as vInt:
        out.writeByte((byte) (highBit | 0x40 | (stats.docFreq & 0x3F)));
        out.writeVInt(stats.docFreq >>> 6);
      }
      if (!fieldInfo.omitTermFreqAndPositions) {
        assert stats.totalTermFreq >= stats.docFreq;
        out.writeVLong(stats.totalTermFreq - stats.docFreq);
      }
      postingsWriter.finishTerm(stats, isIndexTerm);
      numTerms++;
    }

