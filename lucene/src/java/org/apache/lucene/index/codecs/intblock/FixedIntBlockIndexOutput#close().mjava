  @Override
  public void close() throws IOException {
    try {
      if (upto > 0) {
      // NOTE: entries in the block after current upto are
      // invalid
        flushBlock(pending, out);
      }
    } finally {
      out.close();
    }
  }

