    public FieldsReader(Directory dir, FieldInfos fieldInfos,
                        SegmentInfo si, int readBufferSize,
                        int indexDivisor) throws IOException {

      final int fieldCount = fieldInfos.size();
      for(int i=0;i<fieldCount;i++) {
        FieldInfo fi = fieldInfos.fieldInfo(i);
        if (fi.isIndexed) {
          fields.add(fi.name);
          Codec codec = getCodec(fi.name);
          if (!codecs.containsKey(codec)) {
            codecs.put(codec, codec.fieldsProducer(new SegmentReadState(dir, si, fieldInfos, readBufferSize, indexDivisor)));
          }
        }
      }
    }

