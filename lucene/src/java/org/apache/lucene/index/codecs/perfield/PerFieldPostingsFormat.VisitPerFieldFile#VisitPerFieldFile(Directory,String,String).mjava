    public VisitPerFieldFile(Directory dir, String segmentName, String outerSegmentSuffix) throws IOException {
      final String mapFileName = IndexFileNames.segmentFileName(segmentName, outerSegmentSuffix, PER_FIELD_EXTENSION);
      final IndexInput in = dir.openInput(mapFileName, IOContext.READONCE);
      boolean success = false;
      try {
        CodecUtil.checkHeader(in, PER_FIELD_NAME, VERSION_START, VERSION_LATEST);

        // Read format name -> format id
        final int formatCount = in.readVInt();
        for(int formatIDX=0;formatIDX<formatCount;formatIDX++) {
          final String segmentSuffix = in.readString();
          final String formatName = in.readString();
          PostingsFormat postingsFormat = PostingsFormat.forName(formatName);
          //System.out.println("do lookup " + formatName + " -> " + postingsFormat);
          if (postingsFormat == null) {
            throw new IllegalStateException("unable to lookup PostingsFormat for name=\"" + formatName + "\": got null");
          }

          // Better be defined, because it was defined
          // during indexing:
          visitOneFormat(segmentSuffix, postingsFormat);
        }

        // Read field name -> format name
        final int fieldCount = in.readVInt();
        for(int fieldIDX=0;fieldIDX<fieldCount;fieldIDX++) {
          final String fieldName = in.readString();
          final String formatName = in.readString();
          visitOneField(fieldName, PostingsFormat.forName(formatName));
        }

        success = true;
      } finally {
        if (!success) {
          IOUtils.closeWhileHandlingException(in);
        } else {
          IOUtils.close(in);
        }
      }
    }

