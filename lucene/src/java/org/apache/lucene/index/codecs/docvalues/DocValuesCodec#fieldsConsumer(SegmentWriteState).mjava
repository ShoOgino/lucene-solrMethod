  @Override
  public FieldsConsumer fieldsConsumer(SegmentWriteState state)
      throws IOException {
    WrappingFieldsConsumer consumer;
    if ((consumer = consumers.get(state.segmentName)) == null) {
      consumer = new WrappingFieldsConsumer(other);
    }
    consumer.state = state; // nocommit this is a hack and only necessary since
                            // we want to initialized the wrapped
    // fieldsConsumer lazily with a SegmentWriteState created after the docvalue
    // ones is. We should fix this in DocumentWriter I guess. See
    // DocFieldProcessor too!
    return consumer;
  }

