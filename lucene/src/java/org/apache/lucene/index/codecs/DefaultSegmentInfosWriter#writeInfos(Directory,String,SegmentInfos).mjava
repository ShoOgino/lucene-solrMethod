  @Override
  public IndexOutput writeInfos(Directory dir, String segmentFileName, SegmentInfos infos)
          throws IOException {
    IndexOutput out = createOutput(dir, segmentFileName);
    out.writeInt(SegmentInfos.CURRENT_FORMAT); // write FORMAT
    out.writeLong(++infos.version); // every write changes
                                 // the index
    out.writeInt(infos.counter); // write counter
    out.writeInt(infos.size()); // write infos
    for (SegmentInfo si : infos) {
      si.write(out);
    }
    out.writeStringStringMap(infos.getUserData());
    return out;
  }

