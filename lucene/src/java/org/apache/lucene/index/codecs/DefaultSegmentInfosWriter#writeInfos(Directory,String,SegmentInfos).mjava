  @Override
  public IndexOutput writeInfos(Directory dir, String segmentFileName, SegmentInfos infos)
          throws IOException {
    IndexOutput out = createOutput(dir, segmentFileName);
    out.writeInt(FORMAT_CURRENT); // write FORMAT
    out.writeLong(infos.version);
    out.writeInt(infos.counter); // write counter
    out.writeLong(infos.getGlobalFieldMapVersion());
    out.writeInt(infos.size()); // write infos
    for (SegmentInfo si : infos) {
      si.write(out);
    }
    out.writeStringStringMap(infos.getUserData());
    return out;
  }

