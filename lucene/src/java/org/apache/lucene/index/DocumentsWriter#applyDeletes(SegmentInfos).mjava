  boolean applyDeletes(SegmentInfos infos) throws IOException {
    if (!hasDeletes())
      return false;

    final long t0 = System.currentTimeMillis();

    if (infoStream != null) {
      message("apply " + deletesInRAM.getNumDeletes() + " buffered deletes on " +
              +infos.size() + " segments.");
    }

    final int infosEnd = infos.size();

    boolean any = false;
    for (int i = 0; i < infosEnd; i++) {

      // Make sure we never attempt to apply deletes to
      // segment in external dir
      assert infos.info(i).dir == indexWriter.getDirectory();

      SegmentInfo si = infos.info(i);
      // we have to synchronize here, because we need a write lock on
      // the segment in order to apply deletes
      synchronized (indexWriter) {
        SegmentReader reader = indexWriter.readerPool.get(si, false);
        try {
          any |= applyDeletes(reader, si.getMinSequenceID(), si.getMaxSequenceID(), null);
        } finally {
          indexWriter.readerPool.release(reader);
        }
      }
    }

    if (infoStream != null) {
      message("apply deletes took " + (System.currentTimeMillis() - t0) + " msec");
    }

    return any;
  }

