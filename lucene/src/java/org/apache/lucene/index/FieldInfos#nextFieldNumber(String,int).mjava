  private int nextFieldNumber(String name, int preferredFieldNumber) {
    // get a global number for this field
    final int fieldNumber = globalFieldNumbers.addOrGet(name,
        preferredFieldNumber);
    assert byNumber.get(fieldNumber) == null : "field number " + fieldNumber
        + " already taken";
    return fieldNumber;
  }

