  // TODO: this method should not have to be entirely
  // synchronized, ie, merges should be allowed to commit
  // even while a flush is happening
  private synchronized final boolean doFlush(boolean flushDocStores, boolean flushDeletes) throws CorruptIndexException, IOException {
    try {
      try {
        return doFlushInternal(flushDocStores, flushDeletes);
      } finally {
        docWriter.balanceRAM();
      }
    } finally {
      docWriter.clearFlushPending();
    }
  }

