    private int numLeaves(IndexReader reader) {
      final int[] numLeaves = new int[1];
      try {
        new ReaderUtil.Gather(reader) {
          @Override
          protected void add(int base, AtomicReader r) {
            numLeaves[0]++;
          }
        }.run();
      } catch (IOException ioe) {
        // won't happen
        throw new RuntimeException(ioe);
      }
      return numLeaves[0];
    }

