  // TODO: remove deletions from SR
  synchronized void deleteDocument(int docNum) throws IOException {
    if (readOnly)
      throw new UnsupportedOperationException("this SegmentReader is read only");
    hasChanges = true;
    if (liveDocs == null) {
      liveDocs = new BitVector(maxDoc());
      liveDocs.setAll();
      liveDocsRef = new AtomicInteger(1);
    }
    // there is more than 1 SegmentReader with a reference to this
    // liveDocs BitVector so decRef the current liveDocsRef,
    // clone the BitVector, create a new liveDocsRef
    if (liveDocsRef.get() > 1) {
      AtomicInteger oldRef = liveDocsRef;
      liveDocs = cloneDeletedDocs(liveDocs);
      liveDocsRef = new AtomicInteger(1);
      oldRef.decrementAndGet();
    }
    // we need a key reflecting actual deletes (if existent or not):
    combinedCoreAndDeletesKey = new Object();
    // liveDocs are now dirty:
    if (liveDocs.getAndClear(docNum)) {
      pendingDeleteCount++;
    }
  }

