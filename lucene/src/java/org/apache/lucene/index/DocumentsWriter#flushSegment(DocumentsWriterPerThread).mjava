  private boolean flushSegment(DocumentsWriterPerThread perThread) throws IOException {
    if (perThread.getNumDocsInRAM() == 0) {
      return false;
    }

    SegmentInfo newSegment = perThread.flush();
    newSegment.dir = indexWriter.getDirectory();

    finishFlushedSegment(newSegment, perThread);
    return true;
  }

