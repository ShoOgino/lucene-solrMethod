  /**
   * Returns the max net memory which marks the upper watermark for the
   * DocumentsWriter to be healthy. If all flushing and active
   * {@link DocumentsWriterPerThread} consume more memory than the upper
   * watermark all incoming threads should be stalled and blocked until the
   * memory drops below this.
   * <p>
   * Note: the upper watermark is only taken into account if this
   * {@link FlushPolicy} flushes by ram usage.
   * 
   * <p>
   * The default for the max net memory is set to 2 x
   * {@link IndexWriterConfig#getRAMBufferSizeMB()}
   * 
   */
  public long getMaxNetBytes() {
    if (!flushOnRAM()) {
      return -1;
    }
    final double ramBufferSizeMB = indexWriterConfig.getRAMBufferSizeMB();
    return (long) (ramBufferSizeMB * 1024.d * 1024.d * 2);
  }

