    public PerDocConsumers(PerDocWriteState state) throws IOException {
      assert segmentCodecs == state.segmentCodecs;
      this.state = state;
      codecs = segmentCodecs.codecs;
      consumers = new PerDocConsumer[codecs.length];
    }

