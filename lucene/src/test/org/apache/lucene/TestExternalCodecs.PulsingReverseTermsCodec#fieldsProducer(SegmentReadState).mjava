    @Override
    public FieldsProducer fieldsProducer(SegmentReadState state) throws IOException {

      StandardPostingsReader docsReader = new StandardPostingsReaderImpl(state.dir, state.segmentInfo, state.readBufferSize);
      StandardPostingsReader pulsingReader = new PulsingPostingsReaderImpl(docsReader);

      // Terms dict index reader
      StandardTermsIndexReader indexReader;

      boolean success = false;
      try {
        indexReader = new SimpleStandardTermsIndexReader(state.dir,
                                                         state.fieldInfos,
                                                         state.segmentInfo.name,
                                                         state.termsIndexDivisor,
                                                         reverseUnicodeComparator);
        success = true;
      } finally {
        if (!success) {
          pulsingReader.close();
        }
      }

      // Terms dict reader
      success = false;
      try {
        FieldsProducer ret = new StandardTermsDictReader(indexReader,
                                                         state.dir,
                                                         state.fieldInfos,
                                                         state.segmentInfo.name,
                                                         pulsingReader,
                                                         state.readBufferSize,
                                                         reverseUnicodeComparator,
                                                         StandardCodec.TERMS_CACHE_SIZE);
        success = true;
        return ret;
      } finally {
        if (!success) {
          try {
            pulsingReader.close();
          } finally {
            indexReader.close();
          }
        }
      }
    }

