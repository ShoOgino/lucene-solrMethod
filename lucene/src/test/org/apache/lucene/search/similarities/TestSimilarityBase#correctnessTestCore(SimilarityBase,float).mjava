  /**
   * The generic test core called by all correctness test methods. It calls the
   * {@link SimilarityBase#score(BasicStats, float, int)} method of all
   * Similarities in {@link #sims} and compares the score against the manually
   * computed {@code gold}.
   */
  private void correctnessTestCore(SimilarityBase sim, float gold)
      throws IOException {
    // We have to fake everything, because computeStats() can be overridden and
    // there is no way to inject false data after fillBasicStats().
    BasicStats stats = createStats();
    SpoofIndexSearcher searcher = new SpoofIndexSearcher(stats);
    TermContext tc = new TermContext(
        searcher.getIndexReader().getTopReaderContext(),
        new OrdTermState(), 0, stats.getDocFreq(), stats.getTotalTermFreq());
    
    BasicStats realStats = (BasicStats) sim.computeStats(
        searcher, "spoof", stats.getTotalBoost(), tc);
    float score = sim.score(realStats, FREQ, DOC_LEN);
    assertEquals(
        sim.toString() + " score not correct.", gold, score, FLOAT_EPSILON);
  }

