  public void testCachedArraysAllocation() throws Exception {
    // tests the cached arrays allocation -- if the 'nextLength' was too high,
    // caching would terminate even if a smaller length would suffice.
    
    // set RAM limit enough for 150 docs + random(10000)
    int numDocs = random.nextInt(10000) + 150;
    CachingCollector cc = new CachingCollector(new NoOpCollector(false), true, 8 * ONE_BYTE * numDocs);
    cc.setScorer(new MockScorer());
    for (int i = 0; i < numDocs; i++) cc.collect(i);
    assertTrue(cc.isCached());
    
    // The 151's document should terminate caching
    cc.collect(numDocs);
    assertFalse(cc.isCached());
  }

