  public void testMmapIndex() throws Exception {
    // sometimes the directory is not cleaned by rmDir, because on Windows it
    // may take some time until the files are finally dereferenced. So clean the
    // directory up front, or otherwise new IndexWriter will fail.
    File dirPath = new File(storePathname);
    rmDir(dirPath);
    MMapDirectory dir = new MMapDirectory(dirPath, null);
    
    // plan to add a set of useful stopwords, consider changing some of the
    // interior filters.
    MockAnalyzer analyzer = new MockAnalyzer(random);
    // TODO: something about lock timeouts and leftover locks.
    IndexWriter writer = new IndexWriter(dir, new IndexWriterConfig(
        TEST_VERSION_CURRENT, analyzer)
        .setOpenMode(OpenMode.CREATE));
    writer.commit();
    IndexSearcher searcher = new IndexSearcher(dir, true);
    
    int num = atLeast(1000);
    for(int dx = 0; dx < num; dx ++) {
      String f = randomField();
      Document doc = new Document();
      doc.add(newField("data", f, Field.Store.YES, Field.Index.ANALYZED));	
      writer.addDocument(doc);
    }
    
    searcher.close();
    writer.close();
    rmDir(dirPath);
  }

