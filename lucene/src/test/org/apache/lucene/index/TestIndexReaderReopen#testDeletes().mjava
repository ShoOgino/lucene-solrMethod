  public void testDeletes() throws Throwable {
    Directory dir = newDirectory();
    createIndex(random, dir, false); // Create an index with a bunch of docs (1 segment)

    modifyIndex(0, dir); // Get delete bitVector on 1st segment
    modifyIndex(5, dir); // Add a doc (2 segments)

    IndexReader r1 = IndexReader.open(dir, false); // MSR

    modifyIndex(5, dir); // Add another doc (3 segments)

    IndexReader r2 = IndexReader.openIfChanged(r1); // MSR
    assertNotNull(r2);
    assertNull(IndexReader.openIfChanged(r2));
    assertTrue(r1 != r2);

    SegmentReader sr1 = (SegmentReader) r1.getSequentialSubReaders()[0]; // Get SRs for the first segment from original
    SegmentReader sr2 = (SegmentReader) r2.getSequentialSubReaders()[0]; // and reopened IRs

    // At this point they share the same BitVector
    assertTrue(sr1.liveDocs==sr2.liveDocs);

    r2.deleteDocument(0);

    // r1 should not see the delete
    final Bits r1LiveDocs = MultiFields.getLiveDocs(r1);
    assertFalse(r1LiveDocs != null && !r1LiveDocs.get(0));

    // Now r2 should have made a private copy of deleted docs:
    assertTrue(sr1.liveDocs!=sr2.liveDocs);

    r1.close();
    r2.close();
    dir.close();
  }

