  public void testFlushByRam() throws CorruptIndexException,
      LockObtainFailedException, IOException, InterruptedException {
    int[] numThreads = new int[] { 2 + atLeast(1), 1 };
    for (int i = 0; i < numThreads.length; i++) {
      final double ramBuffer = (TEST_NIGHTLY ? 1 : 10) + atLeast(2) + random.nextDouble();
      runFlushByRam(numThreads[i], ramBuffer
         , false);
    }
    for (int i = 0; i < numThreads.length; i++) {
      // with a 256 mb ram buffer we should never stall
      runFlushByRam(numThreads[i], 256.d, true);
    }
  }

