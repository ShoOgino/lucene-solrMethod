    public void testVersion() throws IOException {
      Directory dir = newDirectory();
      assertFalse(DirectoryReader.indexExists(dir));
      IndexWriter writer  = new IndexWriter(dir, newIndexWriterConfig(TEST_VERSION_CURRENT, new MockAnalyzer(random)));
      addDocumentWithFields(writer);
      assertTrue(IndexWriter.isLocked(dir));		// writer open, so dir is locked
      writer.close();
      assertTrue(DirectoryReader.indexExists(dir));
      DirectoryReader reader = DirectoryReader.open(dir);
      assertFalse(IndexWriter.isLocked(dir));		// reader only, no lock
      long version = DirectoryReader.getCurrentVersion(dir);
      reader.close();
      // modify index and check version has been
      // incremented:
      writer  = new IndexWriter(dir, newIndexWriterConfig(TEST_VERSION_CURRENT, new MockAnalyzer(random)).setOpenMode(OpenMode.CREATE));
      addDocumentWithFields(writer);
      writer.close();
      reader = DirectoryReader.open(dir);
      assertTrue("old version is " + version + "; new version is " + DirectoryReader.getCurrentVersion(dir), version < DirectoryReader.getCurrentVersion(dir));
      reader.close();
      dir.close();
    }

