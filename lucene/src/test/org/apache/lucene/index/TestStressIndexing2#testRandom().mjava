  public void testRandom() throws Throwable {
    r = newRandom();
    Directory dir1 = new MockRAMDirectory();
    // dir1 = FSDirectory.open("foofoofoo");
    Directory dir2 = new MockRAMDirectory();
    // mergeFactor=2; maxBufferedDocs=2; Map docs = indexRandom(1, 3, 2, dir1);
    int maxThreadStates = 1+r.nextInt(10);
    boolean doReaderPooling = r.nextBoolean();
    Map<String,Document> docs = indexRandom(10, 10, 100, dir1, maxThreadStates, doReaderPooling);
    indexSerial(docs, dir2);

    // verifying verify
    // verifyEquals(dir1, dir1, "id");
    // verifyEquals(dir2, dir2, "id");

    verifyEquals(dir1, dir2, "id");
    FlexTestUtil.verifyFlexVsPreFlex(r, dir1);
    FlexTestUtil.verifyFlexVsPreFlex(r, dir2);
  }

