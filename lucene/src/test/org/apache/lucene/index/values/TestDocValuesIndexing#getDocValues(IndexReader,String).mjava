  private DocValues getDocValues(IndexReader reader, String field)
      throws IOException {
    boolean optimized = reader.isOptimized();
    Fields fields = optimized ? reader.getSequentialSubReaders()[0].fields()
        : MultiFields.getFields(reader);
    switch (random.nextInt(optimized ? 3 : 2)) { // case 2 only if optimized
    case 0:
      return fields.docValues(field);
    case 1:
      FieldsEnum iterator = fields.iterator();
      String name;
      while ((name = iterator.next()) != null) {
        if (name.equals(field))
          return iterator.docValues();
      }
      throw new RuntimeException("no such field " + field);
    case 2:// this only works if we are on an optimized index!
      return reader.getSequentialSubReaders()[0].docValues(field);
    }
    throw new RuntimeException();
  }

