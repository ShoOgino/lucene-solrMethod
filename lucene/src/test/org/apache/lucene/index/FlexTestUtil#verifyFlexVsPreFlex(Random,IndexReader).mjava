  public static void verifyFlexVsPreFlex(Random rand, IndexReader r) throws Exception {
    // First test on DirReader

    verifyFlexVsPreFlexSingle(rand, r);

    // Then on each individual sub reader
    IndexReader[] subReaders = r.getSequentialSubReaders();
    IndexReader[] forcedSubReaders = new IndexReader[subReaders.length];
    for(int i=0;i<subReaders.length;i++) {
      forcedSubReaders[i] = new ForcedExternalReader(subReaders[i]);
      verifyFlexVsPreFlexSingle(rand, forcedSubReaders[i]);
      verifyFlexVsPreFlexSingle(rand, subReaders[i]);
    }

    // Then on a new MultiReader
    IndexReader m = new MultiReader(subReaders, false);
    verifyFlexVsPreFlexSingle(rand, m);
    m.close();

    // Then on a forced-external reader (forced flex to
    // emulate API on pre-flex API, which in turn is
    // emulating pre-flex on flex -- twisted, but, better
    // work):
    verifyFlexVsPreFlexSingle(rand, new ForcedExternalReader(r));
    m = new MultiReader(forcedSubReaders, false);
    verifyFlexVsPreFlexSingle(rand, m);
    m.close();
  }

