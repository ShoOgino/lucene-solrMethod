  /**
   * checks that docvalues across all fields are equivalent
   */
  public void assertDocValues(IndexReader leftReader, IndexReader rightReader) throws Exception {
    PerDocValues leftPerDoc = MultiPerDocValues.getPerDocs(leftReader);
    PerDocValues rightPerDoc = MultiPerDocValues.getPerDocs(rightReader);
    
    Fields leftFields = MultiFields.getFields(leftReader);
    Fields rightFields = MultiFields.getFields(rightReader);
    // Fields could be null if there are no postings,
    // but then it must be null for both
    if (leftFields == null || rightFields == null) {
      assertNull(info, leftFields);
      assertNull(info, rightFields);
      return;
    }
    
    FieldsEnum fieldsEnum = leftFields.iterator();
    String field;
    while ((field = fieldsEnum.next()) != null) {
      DocValues leftDocValues = leftPerDoc.docValues(field);
      DocValues rightDocValues = rightPerDoc.docValues(field);
      if (leftDocValues == null || rightDocValues == null) {
        assertNull(info, leftDocValues);
        assertNull(info, rightDocValues);
        continue;
      }
      assertDocValuesSource(leftDocValues.getDirectSource(), rightDocValues.getDirectSource());
      assertDocValuesSource(leftDocValues.getSource(), rightDocValues.getSource());
    }
  }

