  @Override
  protected void setUp() throws Exception {
    super.setUp();
    assertFalse("ensure your tearDown() calls super.tearDown()!!!", setup);
    setup = true;
    savedUncaughtExceptionHandler = Thread.getDefaultUncaughtExceptionHandler();
    Thread.setDefaultUncaughtExceptionHandler(new Thread.UncaughtExceptionHandler() {
      public void uncaughtException(Thread t, Throwable e) {
        uncaughtExceptions.add(new UncaughtExceptionEntry(t, e));
        if (savedUncaughtExceptionHandler != null)
          savedUncaughtExceptionHandler.uncaughtException(t, e);
      }
    });
    
    ConcurrentMergeScheduler.setTestMode();
    savedBoolMaxClauseCount = BooleanQuery.getMaxClauseCount();
    savedDefaultCodec = CodecProvider.getDefaultCodec();
    codec = _TestUtil.getTestCodec();
    //nocommit
    if (codec.equals("PreFlex")) {
        CodecProvider.getDefault().register(new PreFlexRWCodec());
    } 
    CodecProvider.setDefaultCodec(codec);
  }

