  @BeforeClass
  public static void beforeClassLuceneTestCaseJ4() {
    staticSeed = "random".equals(TEST_SEED) ? seedRand.nextLong() : TwoLongs.fromString(TEST_SEED).l1;
    random.setSeed(staticSeed);
    stores = Collections.synchronizedMap(new IdentityHashMap<MockDirectoryWrapper,StackTraceElement[]>());
    savedCodecProvider = CodecProvider.getDefault();
    if ("randomPerField".equals(TEST_CODEC)) {
      if (random.nextInt(4) == 0) { // preflex-only setup
        codec = installTestCodecs("PreFlex", CodecProvider.getDefault());
      } else { // per-field setup
        CodecProvider.setDefault(new RandomCodecProvider());
        codec = installTestCodecs(TEST_CODEC, CodecProvider.getDefault());
      }
    } else { // ordinary setup
      codec = installTestCodecs(TEST_CODEC, CodecProvider.getDefault());
    }
    savedLocale = Locale.getDefault();
    locale = TEST_LOCALE.equals("random") ? randomLocale(random) : localeForName(TEST_LOCALE);
    Locale.setDefault(locale);
    savedTimeZone = TimeZone.getDefault();
    timeZone = TEST_TIMEZONE.equals("random") ? randomTimeZone(random) : TimeZone.getTimeZone(TEST_TIMEZONE);
    TimeZone.setDefault(timeZone);
    testsFailed = false;
  }

