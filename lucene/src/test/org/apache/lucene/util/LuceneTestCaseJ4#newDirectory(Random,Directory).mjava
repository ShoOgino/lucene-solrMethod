  /**
   * Returns a new Dictionary instance, with contents copied from the
   * provided directory. See {@link #newDirectory(Random)} for more
   * information.
   */
  public static MockDirectoryWrapper newDirectory(Random r, Directory d) throws IOException {
    StackTraceElement[] stack = new Exception().getStackTrace();
    Directory impl = newDirectoryImpl(r, TEST_DIRECTORY);
    for (String file : d.listAll()) {
     d.copy(impl, file, file);
    }
    MockDirectoryWrapper dir = new MockDirectoryWrapper(impl);
    stores.put(dir, stack);
    return dir;
  }

