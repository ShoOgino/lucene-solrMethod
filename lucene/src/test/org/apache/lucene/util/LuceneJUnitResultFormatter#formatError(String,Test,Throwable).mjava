  /**
   * Format an error and print it.
   * @param type the type of error
   * @param test the test that failed
   * @param error the exception that the test threw
   */
  protected synchronized void formatError(String type, Test test,
      Throwable error) {
    if (test != null) {
      endTest(test);
    }
    
    sb.append(formatTest(test) + type);
    sb.append(StringUtils.LINE_SEP);
    sb.append(error.getMessage());
    sb.append(StringUtils.LINE_SEP);
    String strace = JUnitTestRunner.getFilteredTrace(error);
    sb.append(strace);
    sb.append(StringUtils.LINE_SEP);
    sb.append(StringUtils.LINE_SEP);
  }

