  @AfterClass
  public static void afterClassLuceneTestCaseJ4() {
    String codecDescription;
    CodecProvider cp = CodecProvider.getDefault();

    if ("randomPerField".equals(TEST_CODEC)) {
      if (cp instanceof RandomCodecProvider)
        codecDescription = cp.toString();
      else 
        codecDescription = "PreFlex";
    } else {
      codecDescription = codec.toString();
    }
    
    if (CodecProvider.getDefault() == savedCodecProvider)
      removeTestCodecs(codec, CodecProvider.getDefault());
    CodecProvider.setDefault(savedCodecProvider);
    Locale.setDefault(savedLocale);
    TimeZone.setDefault(savedTimeZone);
    System.clearProperty("solr.solr.home");
    System.clearProperty("solr.data.dir");
    // now look for unclosed resources
    if (!testsFailed)
      for (MockDirectoryWrapper d : stores.keySet()) {
        if (d.isOpen()) {
          StackTraceElement elements[] = stores.get(d);
          // Look for the first class that is not LuceneTestCase that requested
          // a Directory. The first two items are of Thread's, so skipping over
          // them.
          StackTraceElement element = null;
          for (int i = 2; i < elements.length; i++) {
            StackTraceElement ste = elements[i];
            if (ste.getClassName().indexOf("LuceneTestCase") == -1) {
              element = ste;
              break;
            }
          }
          fail("directory of test was not closed, opened from: " + element);
        }
      }
    stores = null;
    // if verbose or tests failed, report some information back
    if (VERBOSE || testsFailed)
      System.err.println("NOTE: test params are: codec=" + codecDescription + 
        ", locale=" + locale + 
        ", timezone=" + (timeZone == null ? "(null)" : timeZone.getID()));
    if (testsFailed) {
      System.err.println("NOTE: all tests run in this JVM:");
      System.err.println(Arrays.toString(testClassesRun.toArray()));
    }
  }

