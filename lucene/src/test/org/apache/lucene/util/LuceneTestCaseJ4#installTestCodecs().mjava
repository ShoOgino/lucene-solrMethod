  // returns current default codec
  static Codec installTestCodecs() {
    final CodecProvider cp = CodecProvider.getDefault();

    savedDefaultCodec = CodecProvider.getDefaultCodec();
    String codec = TEST_CODEC;
    if (codec.equals("random")) {
      codec = pickRandomCodec(seedRnd);
    }
    CodecProvider.setDefaultCodec(codec);

    if (codec.equals("PreFlex")) {
      // If we're running w/ PreFlex codec we must swap in the
      // test-only PreFlexRW codec (since core PreFlex can
      // only read segments):
      swapCodec(new PreFlexRWCodec());
    }

    swapCodec(new MockSepCodec());
    swapCodec(new PulsingCodec(_TestUtil.nextInt(seedRnd, 1, 20)));
    swapCodec(new MockFixedIntBlockCodec(_TestUtil.nextInt(seedRnd, 1, 2000)));
    // baseBlockSize cannot be over 127:
    swapCodec(new MockVariableIntBlockCodec(_TestUtil.nextInt(seedRnd, 1, 127)));

    return cp.lookup(codec);
  }

