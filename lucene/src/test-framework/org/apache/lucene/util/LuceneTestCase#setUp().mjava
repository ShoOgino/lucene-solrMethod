  @Before
  public void setUp() throws Exception {
    seed = "random".equals(TEST_SEED) ? seedRand.nextLong() : ThreeLongs.fromString(TEST_SEED).l2;
    random.setSeed(seed);
    State s = state; // capture test execution state
    state = State.SETUP; // set the state for subsequent tests
   
    savedUncaughtExceptionHandler = Thread.getDefaultUncaughtExceptionHandler();
    Thread.setDefaultUncaughtExceptionHandler(new Thread.UncaughtExceptionHandler() {
      public void uncaughtException(Thread t, Throwable e) {
        testsFailed = true;
        uncaughtExceptions.add(new UncaughtExceptionEntry(t, e));
        if (savedUncaughtExceptionHandler != null)
          savedUncaughtExceptionHandler.uncaughtException(t, e);
        }
    });

    savedBoolMaxClauseCount = BooleanQuery.getMaxClauseCount();

    if (!testsFailed) {
      assertTrue("ensure your tearDown() calls super.tearDown()!!!", (s == State.INITIAL || s == State.TEARDOWN));
    }
    
    if (useNoMemoryExpensiveCodec) {
      final String defCodec = CodecProvider.getDefault().getDefaultFieldCodec();
      // Stupid: assumeFalse in setUp() does not print any information, because
      // TestWatchman does not watch test during setUp() - getName() is also not defined...
      // => print info directly and use assume without message:
      if ("SimpleText".equals(defCodec) || "Memory".equals(defCodec)) {
        System.err.println("NOTE: A test method in " + getClass().getSimpleName() + " was ignored, as it uses too much memory with " + defCodec + ".");
        Assume.assumeTrue(false);
      }
    }
  }

