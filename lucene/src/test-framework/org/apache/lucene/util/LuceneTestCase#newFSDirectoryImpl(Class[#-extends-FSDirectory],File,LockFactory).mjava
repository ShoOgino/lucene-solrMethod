  private static Directory newFSDirectoryImpl(
      Class<? extends FSDirectory> clazz, File file, LockFactory lockFactory)
      throws IOException {
    FSDirectory d = null;
    try {
      // Assuming every FSDirectory has a ctor(File), but not all may take a
      // LockFactory too, so setting it afterwards.
      Constructor<? extends FSDirectory> ctor = clazz.getConstructor(File.class);
      d = ctor.newInstance(file);
      return d;
    } catch (Exception e) {
      d = FSDirectory.open(file);
    }
    if (lockFactory != null) {
      d.setLockFactory(lockFactory);
    }
    return d;
  }

