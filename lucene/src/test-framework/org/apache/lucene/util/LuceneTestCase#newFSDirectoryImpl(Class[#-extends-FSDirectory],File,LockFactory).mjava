  private static Directory newFSDirectoryImpl(
      Class<? extends FSDirectory> clazz, File file, LockFactory lockFactory)
      throws IOException {
    try {
      // Assuming every FSDirectory has a ctor(File), but not all may take a
      // LockFactory too, so setting it afterwards.
      Constructor<? extends FSDirectory> ctor = clazz.getConstructor(File.class);
      FSDirectory d = ctor.newInstance(file);
      if (lockFactory != null) {
        d.setLockFactory(lockFactory);
      }
      return d;
    } catch (Exception e) {
      return FSDirectory.open(file);
    }
  }

