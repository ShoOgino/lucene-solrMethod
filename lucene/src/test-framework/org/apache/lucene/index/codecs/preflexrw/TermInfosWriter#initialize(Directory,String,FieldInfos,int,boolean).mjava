  private void initialize(Directory directory, String segment, FieldInfos fis,
                          int interval, boolean isi) throws IOException {
    indexInterval = interval;
    fieldInfos = fis;
    isIndex = isi;
    output = directory.createOutput(IndexFileNames.segmentFileName(segment, "",
        (isIndex ? PreFlexCodec.TERMS_INDEX_EXTENSION
            : PreFlexCodec.TERMS_EXTENSION)), IOContext.DEFAULT);
    boolean success = false;
    try {
    output.writeInt(FORMAT_CURRENT);              // write format
    output.writeLong(0);                          // leave space for size
    output.writeInt(indexInterval);               // write indexInterval
    output.writeInt(skipInterval);                // write skipInterval
    output.writeInt(maxSkipLevels);               // write maxSkipLevels
    assert initUTF16Results();
      success = true;
    } finally {
      if (!success) {
        try {
          IOUtils.closeWhileHandlingException(output);
        } catch (IOException e) {
          // cannot happen since we suppress exceptions
          throw new RuntimeException(e);
        }

        try {
          directory.deleteFile(IndexFileNames.segmentFileName(segment, "",
              (isIndex ? PreFlexCodec.TERMS_INDEX_EXTENSION
                  : PreFlexCodec.TERMS_EXTENSION)));
        } catch (IOException ignored) {
        }
      }
    }
  }

