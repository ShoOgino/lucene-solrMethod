      @Override
      public void addPosition(int position, BytesRef payload, int startOffset, int endOffset) throws IOException {
        assert proxOut != null;
        assert startOffset == -1;
        assert endOffset == -1;
        //System.out.println("      w pos=" + position + " payl=" + payload);
        final int delta = position - lastPosition;
        lastPosition = position;

        if (storePayloads) {
          final int payloadLength = payload == null ? 0 : payload.length;
          if (payloadLength != lastPayloadLength) {
            //System.out.println("        write payload len=" + payloadLength);
            lastPayloadLength = payloadLength;
            proxOut.writeVInt((delta<<1)|1);
            proxOut.writeVInt(payloadLength);
          } else {
            proxOut.writeVInt(delta << 1);
          }
          if (payloadLength > 0) {
            proxOut.writeBytes(payload.bytes, payload.offset, payload.length);
          }
        } else {
          proxOut.writeVInt(delta);
        }
      }

