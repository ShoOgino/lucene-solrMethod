  /**
   * Returns a new Directory instance, using the specified random. You
   * can specify maybeWrap as to whether the directory might be also
   * wrapped by NRTCachingDirectory or FileSwitchDirectory
   * See {@link #newDirectory()} for more information.
   */
  public static MockDirectoryWrapper newDirectory(Random r, boolean maybeWrap) throws IOException {
    Directory impl = newDirectoryImpl(r, TEST_DIRECTORY);
    MockDirectoryWrapper dir = new MockDirectoryWrapper(r, maybeWrap ? maybeNRTWrap(r, impl) : impl);
    stores.put(dir, Thread.currentThread().getStackTrace());
    dir.setThrottling(TEST_THROTTLING);
    return dir;
   }

