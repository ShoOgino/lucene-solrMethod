  /**
   * Internal recursive traversal for conversion.
   */
  private static org.apache.lucene.util.automaton.State convert(State s,
      IdentityHashMap<State,org.apache.lucene.util.automaton.State> visited) {
    org.apache.lucene.util.automaton.State converted = visited.get(s);
    if (converted != null) return converted;
    
    converted = new org.apache.lucene.util.automaton.State();
    converted.setAccept(s.is_final);
    
    visited.put(s, converted);
    int i = 0;
    int[] labels = s.labels;
    for (DaciukMihovAutomatonBuilder.State target : s.states) {
      converted.addTransition(new Transition(labels[i++], convert(target,
          visited)));
    }
    
    return converted;
  }

