  /**
   * Some tests expect the directory to contain a single segment, and want to do tests on that segment's reader.
   * This is an utility method to help them.
   */
  public static SegmentReader getOnlySegmentReader(DirectoryReader reader) {
    IndexReader[] subReaders = reader.getSequentialSubReaders();
    if (subReaders.length != 1)
      throw new IllegalArgumentException(reader + " has " + subReaders.length + " segments instead of exactly one");
    assertTrue(subReaders[0] instanceof SegmentReader);
    return (SegmentReader) subReaders[0];
  }

