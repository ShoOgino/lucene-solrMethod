  @Override
  public void write(Fields fields) throws IOException {

    String lastField = null;
    for(String field : fields) {
      assert lastField == null || lastField.compareTo(field) < 0;
      lastField = field;

      Terms terms = fields.terms(field);
      if (terms == null) {
        continue;
      }

      TermsEnum termsEnum = terms.iterator(null);

      TermsWriter termsWriter = new TermsWriter(fieldInfos.fieldInfo(field));
      BytesRef minTerm = null;
      BytesRef maxTerm = new BytesRef();
      while (true) {
        BytesRef term = termsEnum.next();
        if (term == null) {
          break;
        }
        if (minTerm == null) {
          minTerm = BytesRef.deepCopyOf(term);
        }
        maxTerm.copyBytes(term);
        termsWriter.write(term, termsEnum);
      }

      termsWriter.finish(minTerm, minTerm == null ? null : maxTerm);
    }
  }

