  @Override
  public void addSortedNumericField(FieldInfo field, Iterable<Number> docToValueCount, Iterable<Number> values) throws IOException {
    delegate.addSortedNumericField(field, docToValueCount, values);
    RangeTreeWriter writer = new RangeTreeWriter(maxPointsInLeafNode, maxPointsSortInHeap);
    Iterator<Number> valueIt = values.iterator();
    Iterator<Number> valueCountIt = docToValueCount.iterator();
    //System.out.println("\nSNF: field=" + field.name);
    for (int docID=0;docID<state.segmentInfo.maxDoc();docID++) {
      assert valueCountIt.hasNext();
      int count = valueCountIt.next().intValue();
      for(int i=0;i<count;i++) {
        assert valueIt.hasNext();
        writer.add(valueIt.next().longValue(), docID);
      }
    }

    long indexStartFP = writer.finish(out);

    fieldIndexFPs.put(field.number, indexStartFP);
  }

