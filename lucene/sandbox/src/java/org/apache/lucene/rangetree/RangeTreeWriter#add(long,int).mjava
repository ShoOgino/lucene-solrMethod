  void add(long value, int docID) throws IOException {
    if (valueCount >= maxValuesSortInHeap) {
      if (writer == null) {
        switchToOffline();
      }
      scratchBytesOutput.reset(scratchBytes);
      scratchBytesOutput.writeLong(value);
      scratchBytesOutput.writeVInt(docID);
      scratchBytesOutput.writeVLong(valueCount);
      writer.write(scratchBytes, 0, scratchBytes.length);
    } else {
      // Not too many points added yet, continue using heap:
      heapWriter.append(value, valueCount, docID);
    }

    valueCount++;
    globalMaxValue = Math.max(value, globalMaxValue);
    globalMinValue = Math.min(value, globalMinValue);
  }

