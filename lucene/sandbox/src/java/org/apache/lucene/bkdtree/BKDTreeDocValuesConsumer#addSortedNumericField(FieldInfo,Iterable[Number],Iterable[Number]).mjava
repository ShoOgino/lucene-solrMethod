  @Override
  public void addSortedNumericField(FieldInfo field, Iterable<Number> docToValueCount, Iterable<Number> values) throws IOException {
    delegate.addSortedNumericField(field, docToValueCount, values);
    BKDTreeWriter writer = new BKDTreeWriter(maxPointsInLeafNode, maxPointsSortInHeap);
    Iterator<Number> valueIt = values.iterator();
    Iterator<Number> valueCountIt = docToValueCount.iterator();
    for (int docID=0;docID<state.segmentInfo.maxDoc();docID++) {
      assert valueCountIt.hasNext();
      int count = valueCountIt.next().intValue();
      for(int i=0;i<count;i++) {
        assert valueIt.hasNext();
        long value = valueIt.next().longValue();
        int latEnc = (int) (value >> 32);
        int lonEnc = (int) (value & 0xffffffff);
        writer.add(latEnc, lonEnc, docID);
      }
    }

    long indexStartFP = writer.finish(out);

    fieldIndexFPs.put(field.number, indexStartFP);
  }

