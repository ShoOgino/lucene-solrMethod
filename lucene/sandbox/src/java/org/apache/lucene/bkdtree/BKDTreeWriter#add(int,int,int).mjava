  void add(int latEnc, int lonEnc, int docID) throws IOException {
    assert latEnc > Integer.MIN_VALUE;
    assert latEnc < Integer.MAX_VALUE;
    assert lonEnc > Integer.MIN_VALUE;
    assert lonEnc < Integer.MAX_VALUE;

    if (pointCount >= maxPointsSortInHeap) {
      if (writer == null) {
        switchToOffline();
      }
      scratchBytesOutput.reset(scratchBytes);
      scratchBytesOutput.writeInt(latEnc);
      scratchBytesOutput.writeInt(lonEnc);
      scratchBytesOutput.writeVInt(docID);
      scratchBytesOutput.writeVLong(pointCount);
      writer.write(scratchBytes, 0, scratchBytes.length);
    } else {
      // Not too many points added yet, continue using heap:
      heapWriter.append(latEnc, lonEnc, pointCount, docID);
    }

    pointCount++;
  }

