  public void testSegmentOptimizationSingleField() throws Exception {
    searchAndCheckResults(field(0), 100, 0, true, "b*", "e*");
    // Both multi-terms are present in both segments.
    // So expecting 4 segment accesses.
    assertEquals(4, TestCounters.get().segmentUseCount);
    assertEquals(0, TestCounters.get().segmentSkipCount);
    assertEquals(0, TestCounters.get().queryEarlyStopCount);

    searchAndCheckResults(field(0), 100, 0, true, "t?e", "b*", "e*");
    // "t?e" matches only in the first segment. This term adds 2 segment accesses and 1 segment skip.
    // The other multi-terms match in the first segment. Each one adds 1 segment access.
    // So expecting 3 segment accesses and 1 segment skips.
    assertEquals(4, TestCounters.get().segmentUseCount);
    assertEquals(1, TestCounters.get().segmentSkipCount);
    assertEquals(0, TestCounters.get().queryEarlyStopCount);

    searchAndCheckResults(field(0), 100, 0, true, "t?e", "blind", "e*");
    assertEquals(3, TestCounters.get().segmentUseCount);
    assertEquals(2, TestCounters.get().segmentSkipCount);
    assertEquals(1, TestCounters.get().queryEarlyStopCount);

    expectDifferentScoreForSpanNearQueryWithMultiTermSubset(() -> {
      searchAndCheckResults(field(2), 100, 0, true, "tim*", "t*");
      assertEquals(2, TestCounters.get().segmentUseCount);
      assertEquals(1, TestCounters.get().segmentSkipCount);
      assertEquals(0, TestCounters.get().queryEarlyStopCount);
    });
  }

