    @Override
    public boolean testBBoxQuery(double minLat, double maxLat, double minLon, double maxLon, Object shape) {
      Polygon p = (Polygon)shape;
      if (queryRelation == QueryRelation.WITHIN) {
        // within: bounding box of shape should be within query box
        return minLat <= quantizeLat(p.minLat) && maxLat >= quantizeLat(p.maxLat)
            && minLon <= quantizeLon(p.minLon) && maxLon >= quantizeLon(p.maxLon);
      }

      Polygon2D poly = Polygon2D.create(quantizePolygon(p));
      Relation r = poly.relate(minLat, maxLat, minLon, maxLon);
      if (queryRelation == QueryRelation.DISJOINT) {
        return r == Relation.CELL_OUTSIDE_QUERY;
      }
      return r != Relation.CELL_OUTSIDE_QUERY;
    }

