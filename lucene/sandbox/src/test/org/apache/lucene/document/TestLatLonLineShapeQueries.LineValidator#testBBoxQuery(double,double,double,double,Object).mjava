    @Override
    public boolean testBBoxQuery(double minLat, double maxLat, double minLon, double maxLon, Object shape) {
      Line l = (Line)shape;
      if (queryRelation == QueryRelation.WITHIN) {
        // within: bounding box of shape should be within query box
        return minLat <= quantizeLat(l.minLat) && maxLat >= quantizeLat(l.maxLat)
            && minLon <= quantizeLon(l.minLon) && maxLon >= quantizeLon(l.maxLon);
      }

      // to keep it simple we convert the bbox into a polygon and use poly2d
      Polygon2D p = Polygon2D.create(new Polygon[] {new Polygon(new double[] {minLat, minLat, maxLat, maxLat, minLat},
          new double[] {minLon, maxLon, maxLon, minLon, minLon})});
      return testLine(p, l);
    }

