  public void testFuzzinessLong() throws Exception {
    Directory directory = newDirectory();
    RandomIndexWriter writer = new RandomIndexWriter(random(), directory);
    addDoc("aaaaaaa", writer);
    addDoc("segment", writer);

    IndexReader reader = writer.getReader();
    IndexSearcher searcher = newSearcher(reader);
    writer.close();

    SlowFuzzyQuery query;
    // not similar enough:
    query = new SlowFuzzyQuery(new Term("field", "xxxxx"), 0.5f, 0);   
    ScoreDoc[] hits = searcher.search(query, 1000).scoreDocs;
    assertEquals(0, hits.length);
    // edit distance to "aaaaaaa" = 3, this matches because the string is longer than
    // in testDefaultFuzziness so a bigger difference is allowed:
    query = new SlowFuzzyQuery(new Term("field", "aaaaccc"), 0.5f, 0);   
    hits = searcher.search(query, 1000).scoreDocs;
    assertEquals(1, hits.length);
    assertEquals(searcher.doc(hits[0].doc).get("field"), ("aaaaaaa"));
    
    // now with prefix
    query = new SlowFuzzyQuery(new Term("field", "aaaaccc"), 0.5f, 1);   
    hits = searcher.search(query, 1000).scoreDocs;
    assertEquals(1, hits.length);
    assertEquals(searcher.doc(hits[0].doc).get("field"), ("aaaaaaa"));
    query = new SlowFuzzyQuery(new Term("field", "aaaaccc"), 0.5f, 4);   
    hits = searcher.search(query, 1000).scoreDocs;
    assertEquals(1, hits.length);
    assertEquals(searcher.doc(hits[0].doc).get("field"), ("aaaaaaa"));
    query = new SlowFuzzyQuery(new Term("field", "aaaaccc"), 0.5f, 5);   
    hits = searcher.search(query, 1000).scoreDocs;
    assertEquals(0, hits.length);

    // no match, more than half of the characters is wrong:
    query = new SlowFuzzyQuery(new Term("field", "aaacccc"), 0.5f, 0);   
    hits = searcher.search(query, 1000).scoreDocs;
    assertEquals(0, hits.length);
    
    // now with prefix
    query = new SlowFuzzyQuery(new Term("field", "aaacccc"), 0.5f, 2);   
    hits = searcher.search(query, 1000).scoreDocs;
    assertEquals(0, hits.length);

    // "student" and "stellent" are indeed similar to "segment" by default:
    query = new SlowFuzzyQuery(new Term("field", "student"), 0.5f, 0);   
    hits = searcher.search(query, 1000).scoreDocs;
    assertEquals(1, hits.length);
    query = new SlowFuzzyQuery(new Term("field", "stellent"), 0.5f, 0);   
    hits = searcher.search(query, 1000).scoreDocs;
    assertEquals(1, hits.length);
    
    // now with prefix
    query = new SlowFuzzyQuery(new Term("field", "student"), 0.5f, 1);   
    hits = searcher.search(query, 1000).scoreDocs;
    assertEquals(1, hits.length);
    query = new SlowFuzzyQuery(new Term("field", "stellent"), 0.5f, 1);   
    hits = searcher.search(query, 1000).scoreDocs;
    assertEquals(1, hits.length);
    query = new SlowFuzzyQuery(new Term("field", "student"), 0.5f, 2);   
    hits = searcher.search(query, 1000).scoreDocs;
    assertEquals(0, hits.length);
    query = new SlowFuzzyQuery(new Term("field", "stellent"), 0.5f, 2);   
    hits = searcher.search(query, 1000).scoreDocs;
    assertEquals(0, hits.length);
    
    // "student" doesn't match anymore thanks to increased minimum similarity:
    query = new SlowFuzzyQuery(new Term("field", "student"), 0.6f, 0);   
    hits = searcher.search(query, 1000).scoreDocs;
    assertEquals(0, hits.length);

    try {
      query = new SlowFuzzyQuery(new Term("field", "student"), 1.1f);
      fail("Expected IllegalArgumentException");
    } catch (IllegalArgumentException e) {
      // expecting exception
    }
    try {
      query = new SlowFuzzyQuery(new Term("field", "student"), -0.1f);
      fail("Expected IllegalArgumentException");
    } catch (IllegalArgumentException e) {
      // expecting exception
    }

    reader.close();
    directory.close();
  }

