  @Override
  public void write(Fields fields) throws IOException {
    boolean success = false;
    try {
      write(writeState.fieldInfos, fields);
      success = true;
    } finally {
      if (success) {
        IOUtils.close(this);
      } else {
        IOUtils.closeWhileHandlingException(this);
      }
    }
  }

