  private void writeHeader(int docBase, int numBufferedDocs, int[] lengths) throws IOException {
    // save docBase and numBufferedDocs
    fieldsStream.writeVInt(docBase);
    fieldsStream.writeVInt(numBufferedDocs);

    // save lengths
    final int bitsRequired = bitsRequired(lengths, numBufferedDocs);
    assert bitsRequired <= 31;
    fieldsStream.writeVInt(bitsRequired);

    final PackedInts.Writer writer = PackedInts.getWriterNoHeader(fieldsStream, PackedInts.Format.PACKED, numBufferedDocs, bitsRequired, 1);
    for (int i = 0; i < numBufferedDocs; ++i) {
      assert lengths[i] > 0;
      writer.add(lengths[i]);
    }
    assert writer.ord() + 1 == numBufferedDocs;
    writer.finish();
  }

