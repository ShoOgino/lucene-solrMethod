  @Override
  public void finish(FieldInfos fis, int numDocs) throws IOException {
    endWithPreviousDocument();
    if (numBufferedDocs > 0) {
      flush();
    }
    if (docBase != numDocs) {
      throw new RuntimeException("Wrote " + docBase + " docs, finish called with numDocs=" + numDocs);
    }
    indexWriter.finish(numDocs);
    assert bufferedDocs.length == 0;
  }

