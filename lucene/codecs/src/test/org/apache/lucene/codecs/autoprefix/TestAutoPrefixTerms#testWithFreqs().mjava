  /** Make sure you get clear exc. if you try to use this within anything but IndexOptions.DOCS fields. */
  public void testWithFreqs() throws Exception {
    Directory dir = newDirectory();
    IndexWriterConfig iwc = new IndexWriterConfig(new MockAnalyzer(random()));
    iwc.setCodec(codec);
    IndexWriter w = new IndexWriter(dir, iwc);
    FieldType ft = new FieldType(StringField.TYPE_NOT_STORED);
    ft.setIndexOptions(IndexOptions.DOCS_AND_FREQS);
    Document doc = new Document();
    doc.add(new Field("foo", "bar bar", ft));
    w.addDocument(doc);
    IllegalStateException expected = expectThrows(IllegalStateException.class, () -> {
      w.commit();
    });
    assertEquals("ranges can only be indexed with IndexOptions.DOCS (field: foo)", expected.getMessage());
    w.close();
    dir.close();
  }

