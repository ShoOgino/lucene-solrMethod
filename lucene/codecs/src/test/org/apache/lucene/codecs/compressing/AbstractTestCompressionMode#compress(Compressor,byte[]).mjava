  static byte[] compress(Compressor compressor, byte[] uncompressed) throws IOException {
    byte[] compressed = new byte[uncompressed.length * 2 + 16]; // should be enough
    ByteArrayDataOutput out = new ByteArrayDataOutput(compressed);
    compressor.compress(uncompressed, 0, uncompressed.length, out);
    final int compressedLen = out.getPosition();
    return Arrays.copyOf(compressed, compressedLen);
  }

