  @Override
  public Weight createWeight(IndexSearcher searcher, boolean needsScores) throws IOException {
    CompletionTokenStream stream = (CompletionTokenStream) analyzer.tokenStream(getField(), getTerm().text());
    Automaton a = stream.toAutomaton(unicodeAware);
    final Set<IntsRef> refs = Operations.getFiniteStrings(a, -1);
    assert refs.size() > 0;
    Automaton automaton = toLevenshteinAutomata(refs);
    if (unicodeAware) {
      Automaton utf8automaton = new UTF32ToUTF8().convert(automaton);
      utf8automaton = Operations.determinize(utf8automaton, maxDeterminizedStates);
      automaton = utf8automaton;
    }
    return new FuzzyCompletionWeight(this, automaton, refs);
  }

