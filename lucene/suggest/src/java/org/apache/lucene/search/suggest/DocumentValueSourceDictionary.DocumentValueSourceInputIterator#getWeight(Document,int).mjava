    /** 
     * Returns the weight for the current <code>docId</code> as computed 
     * by the <code>weightsValueSource</code>
     * */
    @Override
    protected long getWeight(Document doc, int docId) {
      if (currentWeightValues == null) {
        return 0;
      }
      int subIndex = ReaderUtil.subIndex(docId, starts);
      if (subIndex != currentLeafIndex) {
        currentLeafIndex = subIndex;
        try {
          currentWeightValues = weightsValueSource.getValues(leaves.get(currentLeafIndex), null);
        } catch (IOException e) {
          throw new RuntimeException(e);
        }
      }
      try {
        if (currentWeightValues.advanceExact(docId - starts[subIndex]))
          return currentWeightValues.longValue();
        else
          return 0;
      } catch (IOException e) {
        throw new RuntimeException(e);
      }
    }

