  @Override
  public boolean incrementToken() throws IOException {
    if (stop) {
      return false;
    } else if (input.incrementToken()) {
      lastToken = captureState();
      maxEndOffset = Math.max(maxEndOffset, offsetAtt.endOffset());
      return true;
    } else if (lastToken == null) {
      return false;
    } else {

      // TODO: this is iffy!!!  maybe somehow instead caller
      // could tell us endOffset up front?
      input.end();

      if (offsetAtt.endOffset() == maxEndOffset) {
        // Text did not see end of token char:
        restoreState(lastToken);
        keywordAtt.setKeyword(true);
        posIncAtt.setPositionIncrement(0);
        lastToken = null;
        stop = true;
        return true;
      } else {
        return false;
      }
    }
  }

