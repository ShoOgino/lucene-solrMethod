    private void addPositions(final DocsAndPositionsEnum in, final IndexOutput out) throws IOException {
      int freq = in.freq();
      out.writeVInt(freq);
      for (int i = 0; i < freq; i++) {
        final int pos = in.nextPosition();
        out.writeVInt(pos);
        if (storeOffsets) { // don't encode offsets if they are not stored
          out.writeVInt(in.startOffset());
          out.writeVInt(in.endOffset());
        }
        BytesRef payload = in.getPayload();
        if (payload != null) {
          out.writeVInt(payload.length);
          out.writeBytes(payload.bytes, payload.offset, payload.length);
        } else {
          out.writeVInt(0);
        }
      }
    }

