  @Override
  public LeafCollector getLeafCollector(AtomicReaderContext context) throws IOException {
    if (SortingMergePolicy.isSorted(context.reader(), sort)) {
      // segment is sorted, can early-terminate
      return new FilterLeafCollector(super.getLeafCollector(context)) {

        @Override
        public void collect(int doc) throws IOException {
          super.collect(doc);
          if (++numCollected >= numDocsToCollect) {
            throw new CollectionTerminatedException();
          }
        }

        @Override
        public boolean acceptsDocsOutOfOrder() {
          return false;
        }

      };
    } else {
      return super.getLeafCollector(context);
    }
  }

