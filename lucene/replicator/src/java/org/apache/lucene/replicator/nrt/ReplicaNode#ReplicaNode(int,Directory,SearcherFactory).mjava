  public ReplicaNode(int id, Directory dir, SearcherFactory searcherFactory) throws IOException {
    super(id, dir, searcherFactory);

    boolean success = false;

    try {
      message("top: init replica dir=" + dir);

      // Obtain a write lock on this index since we "act like" an IndexWriter, to prevent any other IndexWriter or ReplicaNode from using it:
      writeFileLock = dir.obtainLock(IndexWriter.WRITE_LOCK_NAME);
      
      // nocommit must check for no pending deletes here, like IW does

      state = "init";
      deleter = new ReplicaFileDeleter(this, dir);
    } catch (Throwable t) {
      message("exc on init:");
      t.printStackTrace(System.out);
      throw t;
    } finally {
      if (success == false) {
        IOUtils.closeWhileHandlingException(this);
      }
    }
  }

