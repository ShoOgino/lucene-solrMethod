    @Override
    protected IndexWriter openIndexWriter(Directory directory, IndexWriterConfig config) throws IOException {
      writer = super.openIndexWriter(directory, config);
      // must set it here because IndexWriter clones the config
      sdp = (SnapshotDeletionPolicy) writer.getConfig().getIndexDeletionPolicy();
      return writer;
    }

