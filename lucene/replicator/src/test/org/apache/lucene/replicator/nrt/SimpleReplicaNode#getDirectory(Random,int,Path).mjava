  static Directory getDirectory(Random random, int id, Path path) throws IOException {
    MockDirectoryWrapper dir = LuceneTestCase.newMockFSDirectory(path);
    
    dir.setAssertNoUnrefencedFilesOnClose(true);
    // This is very costly (takes more time to check than it did to index); we do this ourselves in the end instead of each time a replica
    // is restarted:
    dir.setCheckIndexOnClose(false);

    // Corrupt any index files not referenced by current commit point; this is important (increases test evilness) because we may have done
    // a hard crash of the previous JVM writing to this directory and so MDW's corrupt-unknown-files-on-close never ran:
    Node.nodeMessage(id, "top: corrupt unknown files");
    dir.corruptUnknownFiles();

    return dir;
  }

