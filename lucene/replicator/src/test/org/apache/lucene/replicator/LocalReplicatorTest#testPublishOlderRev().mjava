  @Test
  public void testPublishOlderRev() throws IOException {
    // we look to see that certain files are deleted:
    if (sourceDir instanceof MockDirectoryWrapper) {
      ((MockDirectoryWrapper)sourceDir).setEnableVirusScanner(false);
    }
    try {
      replicator.publish(createRevision(1));
      Revision old = new IndexRevision(sourceWriter);
      replicator.publish(createRevision(2));
      try {
        replicator.publish(old);
        fail("should have failed to publish an older revision");
      } catch (IllegalArgumentException e) {
        // expected
      }
      assertEquals(1, DirectoryReader.listCommits(sourceDir).size());
    } finally {
      if (sourceDir instanceof MockDirectoryWrapper) {
        // set back to on for other tests
        ((MockDirectoryWrapper)sourceDir).setEnableVirusScanner(true);
      }
    }
  }

