  @Test
  public void testPublishOlderRev() throws IOException {
    replicator.publish(createRevision(1));
    Revision old = new IndexRevision(sourceWriter);
    replicator.publish(createRevision(2));
    try {
      replicator.publish(old);
      fail("should have failed to publish an older revision");
    } catch (IllegalArgumentException e) {
      // expected
    }
    assertEquals(1, DirectoryReader.listCommits(sourceDir).size());
  }

