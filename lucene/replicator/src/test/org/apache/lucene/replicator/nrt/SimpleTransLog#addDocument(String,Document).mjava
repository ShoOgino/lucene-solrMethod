  /** Appends an addDocument op */
  public synchronized long addDocument(String id, Document doc) throws IOException {
    assert buffer.getFilePointer() == 0;
    buffer.writeByte(OP_ADD_DOCUMENT);
    encode(id, doc);
    return flushBuffer();
  }

