  private void doTestMigration(final int partitionSize) throws Exception {
    // create a facets index with PayloadFacetFields and check it after migration
    Directory indexDir = newDirectory();
    Directory taxoDir = newDirectory();
    
    // set custom CLP fields for two dimensions and use the default ($facets) for the other two
    HashMap<CategoryPath,CategoryListParams> params = new HashMap<CategoryPath,CategoryListParams>();
    params.put(new CategoryPath(DIMENSIONS[0]), new CategoryListParams(DIMENSIONS[0]));
    params.put(new CategoryPath(DIMENSIONS[1]), new CategoryListParams(DIMENSIONS[1]));
    FacetIndexingParams fip = new PerDimensionIndexingParams(params) {
      @Override
      public int getPartitionSize() {
        return partitionSize;
      }
    };
    
    HashMap<String,Integer> expectedCounts = createIndex(indexDir, taxoDir, fip);
    migrateIndex(indexDir, fip);
    verifyMigratedIndex(indexDir, taxoDir, expectedCounts, fip);
    
    IOUtils.close(indexDir, taxoDir);
  }

