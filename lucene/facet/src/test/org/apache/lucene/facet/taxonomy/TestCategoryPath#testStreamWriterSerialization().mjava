  @Test 
  public void testStreamWriterSerialization() throws Exception {
    CategoryPath[] testPaths = {
        new CategoryPath("hi", "there", "man"),
        new CategoryPath("hello"),
        new CategoryPath("date", "2009", "May", "13", "14", "59", "00"),
        // See that an empty category, which generates a (char)0,
        // doesn't cause any problems in the middle of the serialization:
        new CategoryPath(),
        new CategoryPath("another", "example")
    };
    ByteArrayOutputStream baos = new ByteArrayOutputStream();
    OutputStreamWriter osw = new OutputStreamWriter(baos, "UTF-8");  // UTF-8 is always supported.
    for (CategoryPath cp : testPaths) {
      cp.serializeToStreamWriter(osw);
    }
    osw.flush();
    ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray());
    InputStreamReader isr = new InputStreamReader(bais, "UTF-8");
    CategoryPath[] checkPaths = {
        new CategoryPath(), new CategoryPath(), new CategoryPath(), new CategoryPath(), new CategoryPath()
    };
    for (int j = 0; j < checkPaths.length; j++) {
      checkPaths[j].deserializeFromStreamReader(isr);
      assertEquals("Paths not equal", testPaths[j], checkPaths[j]);
    }
  }

