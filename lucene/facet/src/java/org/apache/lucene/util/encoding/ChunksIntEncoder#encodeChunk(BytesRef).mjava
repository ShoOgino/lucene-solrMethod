  /**
   * Encodes the values of the current chunk. First it writes the indicator, and
   * then it encodes the values outside the indicator.
   */
  protected void encodeChunk(BytesRef buf) {
    // ensure there's enough room in the buffer
    int maxBytesRequired = buf.length + 1 + encodeQueue.length * 4; /* indicator + at most 4 bytes per positive VInt */
    if (buf.bytes.length < maxBytesRequired) {
      buf.grow(maxBytesRequired);
    }
    
    buf.bytes[buf.length++] = ((byte) indicator);
    for (int i = 0; i < encodeQueue.length; i++) {
      VInt8.encode(encodeQueue.ints[i], buf);
    }
    
    reset();
  }

