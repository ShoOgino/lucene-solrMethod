  @Override
  protected void doEncode(IntsRef values, BytesRef buf, int upto) {
    for (int i = values.offset; i < upto; i++) {
      int value = values.ints[i];
      if (value == 1) {
        indicator |= ENCODE_TABLE[ordinal];
      } else {
        encodeQueue.ints[encodeQueue.length++] = value - 2;
      }
      ++ordinal;
      
      // encode the chunk and the indicator
      if (ordinal == 8) {
        encodeChunk(buf);
      }
    }
    
    // encode remaining values
    if (ordinal != 0) {
      encodeChunk(buf);
    }
  }

