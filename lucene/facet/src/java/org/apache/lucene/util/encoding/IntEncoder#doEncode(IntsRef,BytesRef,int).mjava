  /**
   * Performs the actual encoding. Values should be read from
   * {@link IntsRef#offset} up to {@code upto}. Also, it is guaranteed that
   * {@code buf's} offset and length are set to 0 and the encoder is expected to
   * update {@link BytesRef#length}, but not {@link BytesRef#offset}.
   */
  protected abstract void doEncode(IntsRef values, BytesRef buf, int upto);

