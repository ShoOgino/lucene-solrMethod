  /**
   * Decodes the values from the buffer into the given {@link IntsRef}. Note
   * that {@code values.offset} and {@code values.length} are set to 0.
   */
  public final void decode(BytesRef buf, IntsRef values) {
    values.offset = values.length = 0; // must do that because we cannot grow() them otherwise
    
    // some decoders may use the buffer's offset as a position index, so save
    // current offset.
    int bufOffset = buf.offset;
    
    reset();
    doDecode(buf, values, buf.offset + buf.length);
    assert values.offset == 0 : "offset should not have been modified by the decoder.";
    
    // fix offset
    buf.offset = bufOffset;
  }

