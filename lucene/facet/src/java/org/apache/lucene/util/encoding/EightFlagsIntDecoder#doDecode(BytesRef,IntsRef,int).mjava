  @Override
  protected void doDecode(BytesRef buf, IntsRef values, int upto) {
    while (buf.offset < upto) {
      // read indicator
      int indicator = buf.bytes[buf.offset++] & 0xFF;
      int ordinal = 0;

      int capacityNeeded = values.length + 8;
      if (values.ints.length < capacityNeeded) {
        values.grow(capacityNeeded);
      }

      // process indicator, until we read 8 values, or end-of-buffer
      while (ordinal != 8) {
        if (DECODE_TABLE[indicator][ordinal++] == 0) {
          if (buf.offset == upto) { // end of buffer
            return;
          }
          // decode the value from the stream.
          values.ints[values.length++] = VInt8.decode(buf) + 2; 
        } else {
          values.ints[values.length++] = 1;
        }
      }
    }
  }

