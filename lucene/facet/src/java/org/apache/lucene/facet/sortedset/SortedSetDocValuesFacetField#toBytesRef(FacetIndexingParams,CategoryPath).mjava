  private static BytesRef toBytesRef(FacetIndexingParams fip, CategoryPath cp) {
    if (fip.getPartitionSize() != Integer.MAX_VALUE) {
      throw new IllegalArgumentException("partitions are not supported");
    }
    if (cp.length != 2) {
      throw new IllegalArgumentException("only flat facets (dimension + label) are currently supported");
    }
    String dimension = cp.components[0];
    char delim = fip.getFacetDelimChar();
    if (dimension.indexOf(delim) != -1) {
      throw new IllegalArgumentException("facet dimension cannot contain FacetIndexingParams.getFacetDelimChar()=" + delim + " (U+" + Integer.toHexString(delim) + "); got dimension=\"" + dimension + "\"");
    }

    // We can't use cp.toString(delim) because that fails if
    // cp.components[1] has the delim char, when in fact
    // that is allowed here (but not when using taxonomy
    // index):
    return new BytesRef(dimension + delim + cp.components[1]);
  }

