  @Override
  public void aggregate(MatchingDocs matchingDocs, CategoryListParams clp, FacetArrays facetArrays) throws IOException {
    final CachedOrds ords = OrdinalsCache.getCachedOrds(matchingDocs.context, clp);
    if (ords == null) {
      return; // this segment has no ordinals for the given category list
    }
    final int[] counts = facetArrays.getIntArray();
    int doc = 0;
    int length = matchingDocs.bits.length();
    while (doc < length && (doc = matchingDocs.bits.nextSetBit(doc)) != -1) {
      int start = ords.offsets[doc];
      int end = ords.offsets[doc + 1];
      for (int i = start; i < end; i++) {
        ++counts[ords.ordinals[i]];
      }
      ++doc;
    }
  }

