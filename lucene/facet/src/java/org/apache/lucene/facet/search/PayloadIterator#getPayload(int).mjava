  /**
   * Returns the {@link BytesRef payload} of the given document, or {@code null}
   * if the document does not exist, there are no more documents in the posting
   * list, or the document exists but has not payload. The given document IDs
   * are treated as local to the reader given to
   * {@link #setNextReader(AtomicReaderContext)}.
   */
  public BytesRef getPayload(int docID) throws IOException {
    if (!hasMore) {
      return null;
    }

    if (curDocID > docID) {
      // document does not exist
      return null;
    }
    
    if (curDocID < docID) {
      curDocID = dpe.advance(docID);
      if (curDocID != docID) { // requested document does not have a payload
        if (curDocID == DocIdSetIterator.NO_MORE_DOCS) { // no more docs in this reader
          hasMore = false;
        }
        return null;
      }
    }

    // we're on the document
    assert dpe.freq() == 1 : "expecting freq=1 (got " + dpe.freq() + ") term=" + term + " doc=" + curDocID;
    int pos = dpe.nextPosition();
    assert pos != -1 : "no positions for term=" + term + " doc=" + curDocID;
    return dpe.getPayload();
  }

