    private void rehash() {
      final long[] oldValues = values;
      final int[] oldCounts = counts;

      final int newCapacity = values.length * 2;
      values = new long[newCapacity];
      counts = new int[newCapacity];
      mask = newCapacity - 1;
      threshold = (int) (LOAD_FACTOR * newCapacity);
      size = 0;

      for (int i = 0; i < oldValues.length; ++i) {
        if (oldCounts[i] > 0) {
          add(oldValues[i], oldCounts[i]);
        }
      }
    }

