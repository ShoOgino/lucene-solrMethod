  /**
   * Creates a mapping between a {@link CategoryListParams} and all
   * {@link FacetLabel categories} that are associated with it.
   */
  protected Map<CategoryListParams,Iterable<FacetLabel>> createCategoryListMapping(
      Iterable<FacetLabel> categories) {
    if (indexingParams.getAllCategoryListParams().size() == 1) {
      return Collections.singletonMap(indexingParams.getCategoryListParams(null), categories);
    }
    HashMap<CategoryListParams,Iterable<FacetLabel>> categoryLists = 
        new HashMap<CategoryListParams,Iterable<FacetLabel>>();
    for (FacetLabel cp : categories) {
      // each category may be indexed under a different field, so add it to the right list.
      CategoryListParams clp = indexingParams.getCategoryListParams(cp);
      List<FacetLabel> list = (List<FacetLabel>) categoryLists.get(clp);
      if (list == null) {
        list = new ArrayList<FacetLabel>();
        categoryLists.put(clp, list);
      }
      list.add(cp);
    }
    return categoryLists;
  }

