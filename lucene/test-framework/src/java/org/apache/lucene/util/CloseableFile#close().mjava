  @Override
  public void close() throws IOException {
    // only if there were no other test failures.
    if (failureMarker.wasSuccessful()) {
      if (file.exists()) {
        if (file.listFiles().length > 0) {
          // throw new IOException("Temporary folder not clean: " + file.getAbsolutePath() + ". Created at stack trace:\n" + creationStack); 
        }

        try {
          TestUtil.rmDir(file);
        } catch (IOException e) {
          // Ignore the exception from rmDir.
        }

        // Re-check.
        if (file.exists()) {
          throw new IOException(
            "Could not remove temporary folder: " + file.getAbsolutePath() + ". Created at stack trace:\n" + creationStack);
        }
      }
    }
  }

