  /**
   * Randomly upcases, downcases, or leaves intact each code point in the given string
   */
  public static String randomlyRecaseCodePoints(Random random, String str) {
    StringBuilder builder = new StringBuilder();
    int pos = 0;
    while (pos < str.length()) {
      int codePoint = str.codePointAt(pos);
      pos += Character.charCount(codePoint);
      String codePointSubstring = new String(new int[] { codePoint }, 0, 1);
      switch (nextInt(random, 0, 2)) {
        case 0: builder.append(codePointSubstring.toUpperCase(Locale.ENGLISH)); break;
        case 1: builder.append(codePointSubstring.toLowerCase(Locale.ENGLISH)); break;
        case 2: builder.append(codePointSubstring); // leave intact
      }
    }
    return builder.toString();
  }

