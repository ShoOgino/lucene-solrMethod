  /** Checks a specific exception class is thrown by the given runnable, and returns it. */
  public static <T extends Throwable> T expectThrows(Class<T> expectedType, ThrowingRunnable runnable) {
    try {
      runnable.run();
    } catch (Throwable e) {
      if (expectedType.isInstance(e)) {
        return expectedType.cast(e);
      }
      AssertionFailedError assertion = new AssertionFailedError("Unexpected exception type, expected " + expectedType.getSimpleName() + " but got " + e);
      assertion.initCause(e);
      throw assertion;
    }
    throw new AssertionFailedError("Expected exception " + expectedType.getSimpleName() + " but no exception was thrown");
  }

