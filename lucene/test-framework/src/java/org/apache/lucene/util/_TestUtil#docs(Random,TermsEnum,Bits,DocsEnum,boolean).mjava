  // Returns a DocsEnum from a positioned TermsEnum, but
  // randomly sometimes uses a DocsAndFreqsEnum, DocsAndPositionsEnum.
  public static DocsEnum docs(Random random, TermsEnum termsEnum, Bits liveDocs, DocsEnum reuse, boolean needsFreqs) throws IOException {
    if (random.nextBoolean()) {
      if (random.nextBoolean()) {
        final int flags;
        switch (random.nextInt(4)) {
          case 0: flags = 0; break;
          case 1: flags = DocsAndPositionsEnum.FLAG_OFFSETS; break;
          case 2: flags = DocsAndPositionsEnum.FLAG_PAYLOADS; break;
          default: flags = DocsAndPositionsEnum.FLAG_OFFSETS | DocsAndPositionsEnum.FLAG_PAYLOADS; break;
        }
        // TODO: cast to DocsAndPositionsEnum?
        DocsAndPositionsEnum docsAndPositions = termsEnum.docsAndPositions(liveDocs, null, flags);
        if (docsAndPositions != null) {
          return docsAndPositions;
        }
      }
      final DocsEnum docsAndFreqs = termsEnum.docs(liveDocs, reuse, true);
      if (docsAndFreqs != null) {
        return docsAndFreqs;
      }
    }
    return termsEnum.docs(liveDocs, reuse, needsFreqs);
  }

