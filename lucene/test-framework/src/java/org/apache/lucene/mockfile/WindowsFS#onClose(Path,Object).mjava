  @Override
  protected void onClose(Path path, Object stream) throws IOException {
    Object key = getKey(path); // here we can read this outside of the lock
    synchronized (openFiles) {
      Integer v = openFiles.get(key);
      assert v != null;
      if (v != null) {
        if (v.intValue() == 1) {
          openFiles.remove(key);
        } else {
          v = Integer.valueOf(v.intValue()-1);
          openFiles.put(key, v);
        }
      }
    }
  }

