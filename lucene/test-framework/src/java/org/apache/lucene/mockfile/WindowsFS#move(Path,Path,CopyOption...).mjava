  @Override
  public void move(Path source, Path target, CopyOption... options) throws IOException {
    synchronized (openFiles) {
      checkDeleteAccess(source);
      Object key = getKeyOrNull(target);
      super.move(source, target, options);
      if (key != null) {
        Object newKey = getKey(target);
        if (newKey.equals(key) == false) {
          // we need to transfer ownership here if we have open files on this file since the getKey() method will
          // return a different i-node next time we call it with the target path and our onClose method will
          // trip an assert
          Integer remove = openFiles.remove(key);
          if (remove != null) {
            openFiles.put(newKey, remove);
          }
        }
      }
    }
  }

