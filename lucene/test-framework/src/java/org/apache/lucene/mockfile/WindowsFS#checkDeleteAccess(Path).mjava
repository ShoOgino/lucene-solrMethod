  /** 
   * Checks that its ok to delete {@code Path}. If the file
   * is still open, it throws IOException("access denied").
   */
  private void checkDeleteAccess(Path path) throws IOException {
    Object key = null;
    try {
      key = getKey(path);
    } catch (Throwable ignore) {
      // we don't care if the file doesn't exist
    } 

    if (key != null) {
      synchronized(openFiles) {
        if (openFiles.containsKey(key)) {
          throw new IOException("access denied: " + path);
        }
      }
    }
  }

