  public void testObtainsLock(Directory dir) throws IOException {
    IndexWriter iw = new IndexWriter(dir, newIndexWriterConfig(null));
    iw.addDocument(new Document());
    iw.commit();
    
    // keep IW open...
    try {
      new CheckIndex(dir);
      fail("should not have obtained write lock");
    } catch (LockObtainFailedException expected) {
      // ok
    }
    
    iw.close();
  }

