  private void scoreInRandomOrder(Collector collector) throws IOException {
    assert docID() == -1; // not started
    FakeScorer fake = new FakeScorer(this);
    collector.setScorer(fake);

    final int bufferSize = 1 + random.nextInt(100);
    final int[] docIDs = new int[bufferSize];
    final float[] scores = new float[bufferSize];
    final int[] freqs = new int[bufferSize];

    int buffered = 0;
    int doc;
    while ((doc = nextDoc()) != NO_MORE_DOCS) {
      docIDs[buffered] = doc;
      scores[buffered] = score();
      freqs[buffered] = freq();

      if (++buffered == bufferSize) {
        shuffle(docIDs, scores, freqs, buffered);
        flush(docIDs, scores, freqs, buffered, fake, collector);
        buffered = 0;
      }
    }

    shuffle(docIDs, scores, freqs, buffered);
    flush(docIDs, scores, freqs, buffered, fake, collector);
  }

