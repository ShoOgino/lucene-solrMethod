  /**
   * Returns true if {@link #getDelegate() delegate} must sync its files.
   * Currently, only {@link NRTCachingDirectory} requires sync'ing its files
   * because otherwise they are cached in an internal {@link RAMDirectory}. If
   * other directories require that too, they should be added to this method.
   */
  private boolean mustSync() {
    Directory delegate = this.delegate;
    while (true) {
      if (delegate instanceof RateLimitedDirectoryWrapper) {
        delegate = ((RateLimitedDirectoryWrapper) delegate).getDelegate();
      } else if (delegate instanceof TrackingDirectoryWrapper) {
        delegate = ((TrackingDirectoryWrapper) delegate).getDelegate();
      } else {
        break;
      }
    }
    return delegate instanceof NRTCachingDirectory;
  }

