  public MockDirectoryWrapper(Random random, Directory delegate) {
    super(delegate);
    // must make a private random since our methods are
    // called from different threads; else test failures may
    // not be reproducible from the original seed
    this.randomState = new Random(random.nextInt());
    // force wrapping of lockfactory
    this.lockFactory = new MockLockFactoryWrapper(this, delegate.getLockFactory());

    // NOTE: we init rateLimiter always but we only
    // sometimes use it (by default) in createOutput:
    double maxMBPerSec = 10 + 5*(randomState.nextDouble()-0.5);
    if (LuceneTestCase.VERBOSE) {
      System.out.println("MockDirectoryWrapper: will rate limit output IO to " + maxMBPerSec + " MB/sec");
    }
    rateLimiter = new RateLimiter(maxMBPerSec);

    init();
  }

