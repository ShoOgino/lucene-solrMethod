  @Override
  public DocValuesConsumer fieldsConsumer(SegmentWriteState state) throws IOException {
    if (LuceneTestCase.OLD_FORMAT_IMPERSONATION_IS_ACTIVE) {
      return new Lucene45DocValuesConsumer(state, DATA_CODEC, DATA_EXTENSION, META_CODEC, META_EXTENSION) {
        @Override
        void checkCanWrite(FieldInfo field) {
           // allow writing all fields 
        }
      };
    } else {
      return super.fieldsConsumer(state);
    }
  }

