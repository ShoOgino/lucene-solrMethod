  @Override
  public synchronized Query getQuery(Element e) throws ParserException {
    Element childElement = DOMUtils.getFirstChildOrFail(e);

    if (queryCache == null) {
      queryCache = new LRUCache<>(cacheSize);
    }

    // Test to see if child Element is a query or filter that needs to be
    // cached
    QueryBuilder qb = queryFactory.getQueryBuilder(childElement.getNodeName());
    Object cacheKey = null;
    Query q = qb.getQuery(childElement);
    cacheKey = q;
    Query cachedQuery = queryCache.get(cacheKey);
    if (cachedQuery != null) {
      return cachedQuery; // cache hit
    }

    //cache miss
    cachedQuery = new CachingWrapperQuery(q);

    queryCache.put(cacheKey, cachedQuery);
    return cachedQuery;
  }

