  @Override
  public OffsetsEnum getOffsetsEnum(IndexReader reader, int docId, String content) throws IOException {
    LeafReader leafReader;
    if (reader instanceof LeafReader) {
      leafReader = (LeafReader) reader;
    } else {
      List<LeafReaderContext> leaves = reader.leaves();
      LeafReaderContext LeafReaderContext = leaves.get(ReaderUtil.subIndex(docId, leaves));
      leafReader = LeafReaderContext.reader();
      docId -= LeafReaderContext.docBase; // adjust 'doc' to be within this atomic reader
    }

    Terms docTerms = leafReader.getTermVector(docId, field);
    if (docTerms == null) {
      return OffsetsEnum.EMPTY;
    }
    leafReader = new TermVectorFilteredLeafReader(leafReader, docTerms);

    return createOffsetsEnumFromReader(leafReader, docId);
  }

