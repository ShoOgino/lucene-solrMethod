  protected OffsetsEnum createOffsetsEnumFromTokenStream(int doc, TokenStream tokenStream) throws IOException {
    // if there are automata (MTQ), we have to initialize the "fake" enum wrapping them.
    assert tokenStream != null;
    // TODO Opt: we sometimes evaluate the automata twice when this TS isn't the original; can we avoid?
    PostingsEnum mtqPostingsEnum = MultiTermHighlighting.getDocsEnum(tokenStream, automata);
    assert mtqPostingsEnum instanceof Closeable; // FYI we propagate close() later.
    mtqPostingsEnum.advance(doc);
    return new OffsetsEnum(null, mtqPostingsEnum);
  }

