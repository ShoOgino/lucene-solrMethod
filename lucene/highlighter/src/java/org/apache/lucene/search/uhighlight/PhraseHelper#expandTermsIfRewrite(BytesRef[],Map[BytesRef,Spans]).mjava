  /**
   * Returns terms as a List, but expanded to any terms in phraseHelper' keySet if present.  That can only
   * happen if willRewrite() is true.
   */
  List<BytesRef> expandTermsIfRewrite(BytesRef[] terms, Map<BytesRef, Spans> strictPhrasesTermToSpans) {
    if (willRewrite()) {
      Set<BytesRef> allTermSet = new LinkedHashSet<>(terms.length + strictPhrasesTermToSpans.size());
      Collections.addAll(allTermSet, terms);//FYI already sorted; will keep order
      if (allTermSet.addAll(strictPhrasesTermToSpans.keySet())) { // true if any were added
        List<BytesRef> sourceTerms = Arrays.asList(allTermSet.toArray(new BytesRef[allTermSet.size()]));
        sourceTerms.sort(Comparator.naturalOrder());
        return sourceTerms;
      }
    }
    return Arrays.asList(terms); // no rewrite; use original terms
  }

