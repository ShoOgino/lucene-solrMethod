  @Override
  public Explanation explain(IndexSearcher searcher, Explanation firstPassExplanation, int docID) throws IOException {
    Explanation superExpl = super.explain(searcher, firstPassExplanation, docID);

    List<LeafReaderContext> leaves = searcher.getIndexReader().leaves();
    int subReader = ReaderUtil.subIndex(docID, leaves);
    LeafReaderContext readerContext = leaves.get(subReader);
    int docIDInSegment = docID - readerContext.docBase;

    DoubleValues scores = scores(docIDInSegment, firstPassExplanation.getValue());

    List<Explanation> subs = new ArrayList<>(Arrays.asList(superExpl.getDetails()));
    for(String variable : expression.variables) {
      DoubleValues dv = bindings.getDoubleValuesSource(variable).getValues(readerContext, scores);
      if (dv.advanceExact(docIDInSegment))
        subs.add(Explanation.match((float) dv.doubleValue(), "variable \"" + variable + "\""));
    }

    return Explanation.match(superExpl.getValue(), superExpl.getDescription(), subs);
  }

