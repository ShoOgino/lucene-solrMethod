  @Test
  @Repeat(iterations = 15)
  public void testOperations() throws IOException {
    //setup
    if (random().nextInt(4) > 0) {//75% of the time choose geo (more interesting to test)
      this.ctx = SpatialContext.GEO;
    } else {
      SpatialContextFactory factory = new SpatialContextFactory();
      factory.geo = false;
      factory.worldBounds = new RectangleImpl(-300, 300, -100, 100, null);
      this.ctx = factory.newSpatialContext();
    }
    // randomly test legacy (numeric) and point based bbox strategy
    if (random().nextBoolean()) {
      this.strategy = BBoxStrategy.newInstance(ctx, "bbox");
    } else {
      this.strategy = BBoxStrategy.newLegacyInstance(ctx, "bbox");
    }
    //test we can disable docValues for predicate tests
    if (random().nextBoolean()) {
      FieldType fieldType = ((BBoxStrategy)strategy).getFieldType();
      if (fieldType instanceof LegacyFieldType) {
        fieldType = new LegacyFieldType((LegacyFieldType)fieldType);
      } else {
        fieldType = new FieldType(fieldType);
      }
      fieldType.setDocValuesType(DocValuesType.NONE);
      strategy = new BBoxStrategy(ctx, strategy.getFieldName(), fieldType);
    }
    for (SpatialOperation operation : SpatialOperation.values()) {
      if (operation == SpatialOperation.Overlaps)
        continue;//unsupported
      testOperationRandomShapes(operation);

      deleteAll();
      commit();
    }
  }

