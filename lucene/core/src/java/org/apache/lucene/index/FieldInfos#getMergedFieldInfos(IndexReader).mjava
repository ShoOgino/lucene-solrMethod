  /** Call this to get the (merged) FieldInfos for a
   *  composite reader.
   *  <p>
   *  NOTE: the returned field numbers will likely not
   *  correspond to the actual field numbers in the underlying
   *  readers, and codec metadata ({@link FieldInfo#getAttribute(String)}
   *  will be unavailable.
   */
  public static FieldInfos getMergedFieldInfos(IndexReader reader) {
    final String softDeletesField = reader.leaves().stream()
        .map(l -> l.reader().getFieldInfos().getSoftDeletesField())
        .filter(Objects::nonNull)
        .findAny().orElse(null);
    final Builder builder = new Builder(new FieldNumbers(softDeletesField));
    for(final LeafReaderContext ctx : reader.leaves()) {
      builder.add(ctx.reader().getFieldInfos());
    }
    return builder.finish();
  }

