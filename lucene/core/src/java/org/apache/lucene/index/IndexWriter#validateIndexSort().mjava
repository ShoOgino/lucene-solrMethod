  /** Confirms that the incoming index sort (if any) matches the existing index sort (if any).  */
  private void validateIndexSort() throws CorruptIndexException {
    Sort indexSort = config.getIndexSort();
    if (indexSort != null) {
      for(SegmentCommitInfo info : segmentInfos) {
        Sort segmentIndexSort = info.info.getIndexSort();
        if (segmentIndexSort != null && indexSort.equals(segmentIndexSort) == false) {
          throw new IllegalArgumentException("cannot change previous indexSort=" + segmentIndexSort + " (from segment=" + info + ") to new indexSort=" + indexSort);
        } else if (segmentIndexSort == null) {
          // Flushed segments are not sorted if they were built with a version prior to 6.5.0
          throw new CorruptIndexException("segment not sorted with indexSort=" + segmentIndexSort, info.info.toString());
        }
      }
    }
  }

