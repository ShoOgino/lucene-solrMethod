  /** Opens SegmentReader and inits SegmentState for each segment. */
  private SegmentState[] openSegmentStates(IndexWriter.ReaderPool pool, List<SegmentCommitInfo> infos) throws IOException {
    int numReaders = infos.size();
    SegmentState[] segStates = new SegmentState[numReaders];
    boolean success = false;
    try {
      for(int i=0;i<numReaders;i++) {
        segStates[i] = new SegmentState(pool, infos.get(i));
      }
      success = true;
    } finally {
      if (success == false) {
        for(int j=0;j<numReaders;j++) {
          if (segStates[j] != null) {
            try {
              segStates[j].finish(pool);
            } catch (Throwable th) {
              // suppress so we keep throwing original exc
            }
          }
        }
      }
    }

    return segStates;
  }

