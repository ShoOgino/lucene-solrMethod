  /** Anything that will add N docs to the index should reserve first to
   *  make sure it's allowed. */
  private void reserveDoc() {
    if (pendingNumDocs.incrementAndGet() > IndexWriter.getActualMaxDocs()) {
      // Reserve failed
      pendingNumDocs.decrementAndGet();
      throw new IllegalStateException("number of documents in the index cannot exceed " + IndexWriter.getActualMaxDocs());
    }
  }

