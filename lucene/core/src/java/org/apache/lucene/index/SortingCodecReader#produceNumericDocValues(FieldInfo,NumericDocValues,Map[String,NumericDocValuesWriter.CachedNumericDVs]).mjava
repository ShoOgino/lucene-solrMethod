  private NumericDocValues produceNumericDocValues(FieldInfo field, NumericDocValues oldNorms,
                                                   Map<String, NumericDocValuesWriter.CachedNumericDVs> cachedNorms) throws IOException {
    NumericDocValuesWriter.CachedNumericDVs norms;
    synchronized (cachedNorms) {
      norms = cachedNorms.get(field);
      if (norms == null) {
        FixedBitSet docsWithField = new FixedBitSet(maxDoc());
        long[] values = new long[maxDoc()];
        while (true) {
          int docID = oldNorms.nextDoc();
          if (docID == NO_MORE_DOCS) {
            break;
          }
          int newDocID = docMap.oldToNew(docID);
          docsWithField.set(newDocID);
          values[newDocID] = oldNorms.longValue();
        }
        norms = new NumericDocValuesWriter.CachedNumericDVs(values, docsWithField);
        cachedNorms.put(field.name, norms);
      }
    }
    return new NumericDocValuesWriter.SortingNumericDocValues(norms);
  }

