  private synchronized SegmentReader doGetReaderWithUpdates(IOContext context) throws IOException {
    assert Thread.holdsLock(writer); // when we get here, we should already have the writer lock
    boolean checkpoint = false;
    try {
      checkpoint = writeLiveDocs(info.info.dir);
      if (reader == null) {
        // We steal returned ref:
//        System.out.println("[" + Thread.currentThread().getName() + "] RLD.doGetReaderWithUpdates: newSR " + info);
        reader = new SegmentReader(info, context);
        if (liveDocs == null) {
          liveDocs = reader.getLiveDocs();
        }
      } else if (checkpoint) {
        // enroll a new reader with the applied updates
//        System.out.println("[" + Thread.currentThread().getName() + "] RLD.doGetReaderWithUpdates: reopenReader " + info);
        reopenReader(context);
      }
      
      // Ref for caller
      reader.incRef();
      return reader;
    } finally {
      if (checkpoint) {
        writer.checkpoint();
      }
    }
  }

