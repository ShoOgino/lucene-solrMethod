    void writeAllDocValuesUpdates() throws IOException {
      assert Thread.holdsLock(IndexWriter.this);
      Collection<ReadersAndUpdates> copy;
      synchronized (this) {
        // this needs to be protected by the reader pool lock otherwise we hit ConcurrentModificationException
        copy = new HashSet<>(readerMap.values());
      }
      boolean any = false;
      for (ReadersAndUpdates rld : copy) {
        any |= rld.writeFieldUpdates(directory, globalFieldNumberMap, bufferedUpdatesStream.getCompletedDelGen(), infoStream);
      }
      if (any) {
        checkpoint();
      }
    }

