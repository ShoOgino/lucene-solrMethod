  protected MutableBits getMutableBits() throws IOException {
    if (liveDocsShared) {
      // Copy on write: this means we've cloned a
      // SegmentReader sharing the current liveDocs
      // instance; must now make a private clone so we can
      // change it:
      LiveDocsFormat liveDocsFormat = info.info.getCodec().liveDocsFormat();
      MutableBits mutableBits;
      if (liveDocs == null) {
        mutableBits = liveDocsFormat.newLiveDocs(info.info.maxDoc());
      } else {
        mutableBits = liveDocsFormat.newLiveDocs(liveDocs);
      }
      liveDocs = mutableBits;
      liveDocsShared = false;
    }
    return (MutableBits) liveDocs;
  }

