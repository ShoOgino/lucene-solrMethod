  protected FixedBitSet getMutableBits() throws IOException {
    // if we pull mutable bits but we haven't been initialized something is completely off.
    // this means we receive deletes without having the bitset that is on-disk ready to be cloned
    assert liveDocsInitialized : "can't delete if liveDocs are not initialized";
    if (liveDocsShared) {
      // Copy on write: this means we've cloned a
      // SegmentReader sharing the current liveDocs
      // instance; must now make a private clone so we can
      // change it:
      FixedBitSet mutableBits = new FixedBitSet(info.info.maxDoc());
      mutableBits.set(0, info.info.maxDoc());
      if (liveDocs != null) {
        for (int i = 0; i < liveDocs.length(); ++i) {
          if (liveDocs.get(i) == false) {
            mutableBits.clear(i);
          }
        }
      }
      liveDocs = mutableBits;
      liveDocsShared = false;
    }
    return (FixedBitSet) liveDocs;
  }

