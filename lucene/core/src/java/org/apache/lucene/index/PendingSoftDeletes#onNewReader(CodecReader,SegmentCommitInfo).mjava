  @Override
  void onNewReader(CodecReader reader, SegmentCommitInfo info) throws IOException {
    super.onNewReader(reader, info);
    hardDeletes.onNewReader(reader, info);
    if (dvGeneration < info.getDocValuesGen()) { // only re-calculate this if we haven't seen this generation
      final DocIdSetIterator iterator = DocValuesFieldExistsQuery.getDocValuesDocIdSetIterator(field, reader);
      if (iterator != null) { // nothing is deleted we don't have a soft deletes field in this segment
        assert info.info.maxDoc() > 0 : "maxDoc is 0";
        pendingDeleteCount += applySoftDeletes(iterator, getMutableBits());
      }
      dvGeneration = info.getDocValuesGen();
    }
    assert numPendingDeletes() + info.getDelCount() <= info.info.maxDoc() :
        numPendingDeletes() + " + " + info.getDelCount() + " > " + info.info.maxDoc();
  }

