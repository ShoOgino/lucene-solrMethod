  /** Anything that will add N docs to the index should reserve first to
   *  make sure it's allowed.  This will throw {@code
   *  IllegalStateException} if it's not allowed. */ 
  private void reserveDocs(int numDocs) {
    if (pendingNumDocs.addAndGet(numDocs) > actualMaxDocs) {
      // Reserve failed
      pendingNumDocs.addAndGet(-numDocs);
      throw new IllegalStateException("number of documents in the index cannot exceed " + actualMaxDocs);
    }
  }

