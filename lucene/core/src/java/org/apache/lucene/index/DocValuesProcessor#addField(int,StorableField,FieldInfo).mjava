  @Override
  public void addField(int docID, StorableField field, FieldInfo fieldInfo) {
    final DocValues.Type dvType = field.fieldType().docValueType();
    if (dvType != null) {
      DocValues.Type currentDVType = fieldInfo.getDocValuesType();
      if (currentDVType == null) {
        fieldInfo.setDocValuesType(dvType);
      } else if (currentDVType != dvType) {
        throw new IllegalArgumentException("cannot change DocValues type from " + currentDVType + " to " + dvType + " for field \"" + fieldInfo.name + "\"");
      }
      if (DocValues.isBytes(dvType)) {
        addBinaryField(fieldInfo, docID, field.binaryValue());
      } else if (DocValues.isSortedBytes(dvType)) {
        addSortedField(fieldInfo, docID, field.binaryValue());
      } else if (DocValues.isFloat(dvType)) {
        if (dvType == DocValues.Type.FLOAT_32) {
          addNumericField(fieldInfo, docID, field.numericValue().floatValue());
        } else if (dvType == DocValues.Type.FLOAT_64) {
          addNumericField(fieldInfo, docID, field.numericValue().doubleValue());
        } else {
          assert false;
        }
      } else if (DocValues.isNumber(dvType)) {
        addNumericField(fieldInfo, docID, field.numericValue().longValue());
      } else {
        assert false: "unrecognized DocValues.Type: " + dvType;
      }
    }
  }

