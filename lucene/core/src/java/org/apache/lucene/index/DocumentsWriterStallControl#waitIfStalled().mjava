  /**
   * Blocks if documents writing is currently in a stalled state. 
   * 
   */
  void waitIfStalled() {
    if (stalled) {
      synchronized (this) {
        boolean hasWaited = false;
        while (stalled) {
          try {
            assert hasWaited || incWaiters();
            assert (hasWaited = true);
            wait();
          } catch (InterruptedException e) {
            throw new ThreadInterruptedException(e);
          }
        }
        assert !hasWaited || decrWaiters();
      }
    }
  }

