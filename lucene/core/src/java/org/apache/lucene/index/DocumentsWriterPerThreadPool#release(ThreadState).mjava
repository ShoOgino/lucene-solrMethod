  void release(ThreadState state) {
    state.unlock();
    synchronized (this) {
      assert freeCount < freeList.length;
      freeList[freeCount++] = state;
      // In case any thread is waiting, wake one of them up since we just released a thread state; notify() should be sufficient but we do
      // notifyAll defensively:
      notifyAll();
    }
  }

