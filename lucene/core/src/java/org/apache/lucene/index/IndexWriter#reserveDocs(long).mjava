  /** Anything that will add N docs to the index should reserve first to
   *  make sure it's allowed.  This will throw {@code
   *  IllegalArgumentException} if it's not allowed. */ 
  private void reserveDocs(long numDocs) {
    if (pendingNumDocs.addAndGet(numDocs) > actualMaxDocs) {
      // Reserve failed
      pendingNumDocs.addAndGet(-numDocs);
      throw new IllegalArgumentException("number of documents in the index cannot exceed " + actualMaxDocs + " (current document count is " + pendingNumDocs.get() + "; added numDocs is " + numDocs + ")");
    }
  }

