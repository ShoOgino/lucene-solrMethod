  @Override
  public BytesRef next() {
    if (termQueue.size() == 0) {
      // No more terms in current field:
      if (fieldQueue.size() == 0) {
        // No more fields:
        field = null;
        return null;
      }

      // Transfer all iterators on the next field into the term queue:
      TermIterator top = fieldQueue.pop();
      termQueue.add(top);
      field = top.field;
      assert field != null;

      while (fieldQueue.size() != 0 && fieldQueue.top().field.equals(top.field)) {
        TermIterator iter = fieldQueue.pop();
        assert iter.field.equals(field);
        // TODO: a little bit evil; we do this so we can == on field down below:
        iter.field = field;
        termQueue.add(iter);
      }

      return termQueue.top().bytes;
    } else {
      TermIterator top = termQueue.top();
      if (top.next() == null) {
        termQueue.pop();
      } else if (top.field() != field) {
        // Field changed
        termQueue.pop();
        fieldQueue.add(top);
      } else {
        termQueue.updateTop();
      }
      if (termQueue.size() == 0) {
        // Recurse (just once) to go to next field:                                                                                                                                        
        return next();
      } else {
        // Still terms left in this field
        return termQueue.top().bytes;
      }
    }
  }

