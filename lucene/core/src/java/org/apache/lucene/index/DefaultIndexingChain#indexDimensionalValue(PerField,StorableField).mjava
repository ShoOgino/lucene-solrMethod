  /** Called from processDocument to index one field's dimensional value */
  private void indexDimensionalValue(PerField fp, StorableField field) throws IOException {
    int dimensionCount = field.fieldType().dimensionCount();

    int dimensionNumBytes = field.fieldType().dimensionNumBytes();

    // Record dimensions for this field; this setter will throw IllegalArgExc if
    // the dimensions were already set to something different:
    if (fp.fieldInfo.getDimensionCount() == 0) {
      fieldInfos.globalFieldNumbers.setDimensions(fp.fieldInfo.number, fp.fieldInfo.name, dimensionCount, dimensionNumBytes);
    }

    fp.fieldInfo.setDimensions(dimensionCount, dimensionNumBytes);

    if (fp.dimensionalValuesWriter == null) {
      fp.dimensionalValuesWriter = new DimensionalValuesWriter(docWriter, fp.fieldInfo);
    }
    fp.dimensionalValuesWriter.addPackedValue(docState.docID, field.binaryValue());
  }

