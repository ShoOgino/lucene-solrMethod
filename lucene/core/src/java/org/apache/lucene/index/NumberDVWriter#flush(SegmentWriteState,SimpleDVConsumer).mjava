  @Override
  public void flush(SegmentWriteState state, SimpleDVConsumer dvConsumer) throws IOException {
    NumericDocValuesConsumer consumer = dvConsumer.addNumericField(fieldInfo, minValue, maxValue);
    final int bufferedDocCount = pending.size();

    AppendingLongBuffer.Iterator it = pending.iterator();
    for(int docID=0;docID<bufferedDocCount;docID++) {
      assert it.hasNext();
      long v = it.next();
      consumer.add(v);
    }
    assert !it.hasNext();
    final int maxDoc = state.segmentInfo.getDocCount();
    for(int docID=bufferedDocCount;docID<maxDoc;docID++) {
      consumer.add(0);
    }
    consumer.finish();
    reset();
    //System.out.println("FLUSH");
  }

