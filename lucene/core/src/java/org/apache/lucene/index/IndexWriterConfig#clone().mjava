  @Override
  public IndexWriterConfig clone() {
    IndexWriterConfig clone;
    if (inUseByIndexWriter.get()) {
      throw new IllegalStateException("cannot clone: this IndexWriterConfig is private to IndexWriter; make a new one instead");
    }
    try {
      clone = (IndexWriterConfig) super.clone();
    } catch (CloneNotSupportedException e) {
      // should not happen
      throw new RuntimeException(e);
    }

    // Mostly shallow clone, but do a deepish clone of
    // certain objects that have state that cannot be shared
    // across IW instances:
    clone.inUseByIndexWriter = new AtomicBoolean();
    clone.flushPolicy = flushPolicy.clone();
    clone.indexerThreadPool = indexerThreadPool.clone();
    clone.mergePolicy = mergePolicy.clone();

    return clone;
  }

