  // initialize the per-field DocValuesProducer
  private DocValuesProducer initDocValuesProducer(Codec codec) throws IOException {
    final Directory dir = core.cfsReader != null ? core.cfsReader : si.info.dir;
    final DocValuesFormat dvFormat = codec.docValuesFormat();

    if (!si.hasFieldUpdates()) {
      // simple case, no DocValues updates
      return segDocValues.getDocValuesProducer(-1L, si, IOContext.READ, dir, dvFormat, fieldInfos);
    } else {
      return new SegmentDocValuesProducer(si, dir, fieldInfos, segDocValues, dvFormat);
    }
  }

