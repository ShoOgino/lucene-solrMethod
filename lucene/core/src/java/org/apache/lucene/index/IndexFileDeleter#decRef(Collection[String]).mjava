  /** Decrefs all provided files, even on exception; throws first exception hit, if any. */
  void decRef(Collection<String> files) {
    assert locked();
    Throwable firstThrowable = null;
    for(final String file : files) {
      try {
        decRef(file);
      } catch (Throwable t) {
        if (firstThrowable == null) {
          // Save first exception and throw it in the end, but be sure to finish decRef all files
          firstThrowable = t;
        }
      }
    }

    try {
      deletePendingFiles();
    } catch (Throwable t) {
      if (firstThrowable == null) {
        // Save first exception and throw it in the end, but be sure to finish decRef all files
        firstThrowable = t;
      }
    }

    // NOTE: does nothing if firstThrowable is null
    IOUtils.reThrowUnchecked(firstThrowable);
  }

