  private synchronized void commitPerThreadBytes(DocumentsWriterPerThread perThread) {
    final long delta = perThread.commitLastBytesUsed();
    /*
     * We need to differentiate here if we are pending since setFlushPending
     * moves the perThread memory to the flushBytes and we could be set to
     * pending during a delete
     */
    if (perThread.isFlushPending()) {
      flushBytes += delta;
    } else {
      activeBytes += delta;
    }
    assert updatePeaks(delta);
  }

