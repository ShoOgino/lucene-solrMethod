  protected void ensureCanWrite(String name) throws IOException {
    deletePendingFiles();
    if (pendingDeletes.contains(name)) {
      throw new IOException("file \"" + name + "\" is pending delete and cannot be overwritten");
    }
    Files.deleteIfExists(directory.resolve(name)); // delete existing, if any
  }

