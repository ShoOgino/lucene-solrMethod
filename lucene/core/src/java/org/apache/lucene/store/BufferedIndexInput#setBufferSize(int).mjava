  /** Change the buffer size used by this IndexInput */
  public final void setBufferSize(int newSize) {
    assert buffer == null || bufferSize == buffer.capacity(): "buffer=" + buffer + " bufferSize=" + bufferSize + " buffer.length=" + (buffer != null ? buffer.capacity() : 0);
    if (newSize != bufferSize) {
      checkBufferSize(newSize);
      bufferSize = newSize;
      if (buffer != null) {
        // Resize the existing buffer and carefully save as
        // many bytes as possible starting from the current
        // bufferPosition
        ByteBuffer newBuffer = ByteBuffer.allocate(newSize);
        assert newBuffer.order() == ByteOrder.BIG_ENDIAN;
        if (buffer.remaining() > newBuffer.capacity()) {
          buffer.limit(buffer.position() + newBuffer.capacity());
        }
        assert buffer.remaining() <= newBuffer.capacity();
        newBuffer.put(buffer);
        newBuffer.flip();
        buffer = newBuffer;
      }
    }
  }

