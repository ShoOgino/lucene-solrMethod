  @Override
  public long ramBytesUsed() {
    // Return a rough estimation for allocated blocks. Note that we do not make
    // any special distinction for direct memory buffers.
    ByteBuffer first = blocks.peek();
    if (first == null) {
      return 0L;
    } else {
      // All blocks have the same capacity.
      return (first.capacity() + RamUsageEstimator.NUM_BYTES_OBJECT_REF) * blocks.size();
    }
  }

