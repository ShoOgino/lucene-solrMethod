  RateLimitedIndexOutput(final RateLimiter rateLimiter, final IndexOutput delegate) {
    // TODO should we make buffer size configurable
    if (delegate instanceof BufferedIndexOutput) {
      bufferedDelegate = (BufferedIndexOutput) delegate;
      this.delegate = delegate;
    } else {
      this.delegate = delegate;
      bufferedDelegate = null;
    }
    this.rateLimiter = rateLimiter;
  }

