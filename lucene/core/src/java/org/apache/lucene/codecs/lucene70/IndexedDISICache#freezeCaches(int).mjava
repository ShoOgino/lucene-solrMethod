  private void freezeCaches(int largestBlock) {
    if (largestBlock == -1) { // No set bit: Disable the caches
      blockCache = null;
      rank = null;
      return;
    }

    // Reduce size to minimum
    if (blockCache.length-1 > largestBlock) {
      long[] newBC = new long[Math.max(largestBlock - 1, 1)];
      System.arraycopy(blockCache, 0, newBC, 0, newBC.length);
      blockCache = newBC;
    }

    // Set non-defined blockCache entries (caused by blocks with 0 set bits) to the subsequently defined one
    long latest = BLOCK_EMPTY;
    for (int i = blockCache.length-1; i >= 0 ; i--) {
      long current = blockCache[i];
      if (current == BLOCK_EMPTY) {
        blockCache[i] = latest;
      } else {
        latest = current;
      }
    }
  }

