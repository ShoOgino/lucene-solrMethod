  /** Decompress given ouput stream into int array.
   */
  public static void decompress(LongBuffer data, LongBuffer packed, int header) throws IOException {
    // nocommit assert header isn't "malformed", ie besides
    // numBytes / bit-width there is nothing else!
    
    packed.rewind();
    data.rewind();
    int numBits = ((header >> 8) & MASK[6]);

    if (numBits == 0) {
      Arrays.fill(data.array(), (int)(packed.get(0)>>>32));
      return;
    }

    PackedInts.Format format = PackedInts.fastestFormatAndBits(128, numBits, PackedInts.FASTEST).format;
    PackedInts.Decoder decoder = PackedInts.getDecoder(format, PackedInts.VERSION_CURRENT, numBits);
    int perIter = decoder.values();
    int iters = 128/perIter;
    int nblocks = decoder.blocks()*iters;
    assert 128 % perIter == 0;

    decoder.decode(packed, data, iters);
  }

