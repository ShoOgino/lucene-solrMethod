  @Override
  public void encodeTerm(long[] longs, DataOutput out, FieldInfo fieldInfo, BlockTermState _state, boolean absolute) throws IOException {
    IntBlockTermState state = (IntBlockTermState)_state;
    if (absolute) {
      lastState = newTermState();
    }
    if (VERSION_CURRENT < VERSION_META_ARRAY) {  // impersonation
      _encodeTerm(out, fieldInfo, state);
      return;
    }
    longs[0] = state.docTermStartFP - lastState.docTermStartFP;
    if (fieldHasPositions) {
      longs[1] = state.posTermStartFP - lastState.posTermStartFP;
      if (fieldHasPayloads || fieldHasOffsets) {
        longs[2] = state.payTermStartFP - lastState.payTermStartFP;
      }
    }
    if (state.singletonDocID != -1) {
      out.writeVInt(state.singletonDocID);
    }
    if (fieldHasPositions) {
      if (state.lastPosBlockOffset != -1) {
        out.writeVLong(state.lastPosBlockOffset);
      }
    }
    if (state.skipOffset != -1) {
      out.writeVLong(state.skipOffset);
    }
    if (state.payTermStartFP == -1) {
      state.payTermStartFP = lastState.payTermStartFP;
    }
    lastState = state;
  }

