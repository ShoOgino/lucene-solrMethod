  @Override
  public void startDoc(int docID, int termDocFreq) throws IOException {
    if (DEBUG) {
      System.out.println("FPW.startDoc docID["+docBufferUpto+"]=" + docID);
    }
    final int docDelta = docID - lastDocID;

    if (docID < 0 || (docCount > 0 && docDelta <= 0)) {
      throw new CorruptIndexException("docs out of order (" + docID + " <= " + lastDocID + " ) (docOut: " + docOut + ")");
    }

    docDeltaBuffer[docBufferUpto] = docDelta;
//    if (DEBUG) {
//      System.out.println("  docDeltaBuffer[" + docBufferUpto + "]=" + docDelta);
//    }
    if (fieldHasFreqs) {
      freqBuffer[docBufferUpto] = termDocFreq;
    }
    docBufferUpto++;
    docCount++;

    if (docBufferUpto == blockSize) {
      if (DEBUG) {
        System.out.println("  write docDelta block @ fp=" + docOut.getFilePointer());
      }
      writeBlock(docDeltaBuffer, docOut);
      if (fieldHasFreqs) {
        if (DEBUG) {
          System.out.println("  write freq block @ fp=" + docOut.getFilePointer());
        }
        writeBlock(freqBuffer, docOut);
      }
      // NOTE: don't set docBufferUpto back to 0 here;
      // finishDoc will do so (because it needs to see that
      // the block was filled so it can save skip data)
    }
    lastDocID = docID;
    lastPosition = 0;
    lastStartOffset = 0;
  }

