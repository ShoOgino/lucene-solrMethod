  @Override
  public FieldsConsumer fieldsConsumer(SegmentWriteState state) throws IOException {
    // TODO: implement a new PostingsWriterBase to improve skip-settings
    PostingsWriterBase postingsWriter = new SepPostingsWriter(state, new PForFactory()); 
    boolean success = false;
    try {
      FieldsConsumer ret = new BlockTreeTermsWriter(state, 
                                                    postingsWriter,
                                                    minBlockSize, 
                                                    maxBlockSize);
      success = true;
      return ret;
    } finally {
      if (!success) {
        IOUtils.closeWhileHandlingException(postingsWriter);
      }
    }
  }

