  public Lucene41DocValuesProducer(Directory dir, SegmentInfo segmentInfo,
      FieldInfos fieldInfos, IOContext context) throws IOException {
    this.cfs = new CompoundFileDirectory(dir, IndexFileNames.segmentFileName(
        segmentInfo.name, Lucene41DocValuesConsumer.DV_SEGMENT_SUFFIX,
        IndexFileNames.COMPOUND_FILE_EXTENSION), context, false);
    this.info = segmentInfo;
    for (FieldInfo fieldInfo : fieldInfos) {
      if (fieldInfo.hasDocValues()) {
        if (DocValues.isNumber(fieldInfo.getDocValuesType())
            || DocValues.isFloat(fieldInfo.getDocValuesType())) {
          numeric.put(fieldInfo.name, new Lucene41NumericDocValues.Factory(
              this.cfs, this.info, fieldInfo, context));
        } else if (DocValues.isBytes(fieldInfo.getDocValuesType())) {
          binary.put(fieldInfo.name, new Lucene41BinaryDocValues.Factory(
              this.cfs, this.info, fieldInfo, context));
        } else {
          assert DocValues.isSortedBytes(fieldInfo.getDocValuesType());
          sorted.put(fieldInfo.name, new Lucene41SortedDocValues.Factory(
              this.cfs, this.info, fieldInfo, context));
        }
      }
    }
  }

