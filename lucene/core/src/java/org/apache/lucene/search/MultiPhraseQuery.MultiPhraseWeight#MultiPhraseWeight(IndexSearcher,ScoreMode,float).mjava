    public MultiPhraseWeight(IndexSearcher searcher, ScoreMode scoreMode, float boost)
      throws IOException {
      super(MultiPhraseQuery.this);
      this.scoreMode = scoreMode;
      this.similarity = searcher.getSimilarity();
      final IndexReaderContext context = searcher.getTopReaderContext();

      // compute idf
      ArrayList<TermStatistics> allTermStats = new ArrayList<>();
      for(final Term[] terms: termArrays) {
        for (Term term: terms) {
          TermStates ts = termStates.get(term);
          if (ts == null) {
            ts = TermStates.build(context, term, scoreMode.needsScores());
            termStates.put(term, ts);
          }
          if (scoreMode.needsScores()) {
            TermStatistics termStatistics = searcher.termStatistics(term, ts);
            if (termStatistics != null) {
              allTermStats.add(termStatistics);
            }
          }
        }
      }
      if (allTermStats.isEmpty()) {
        stats = null; // none of the terms were found, we won't use sim at all
      } else {
        stats = similarity.scorer(
          boost,
          searcher.collectionStatistics(field),
          allTermStats.toArray(new TermStatistics[allTermStats.size()]));
      }
    }

