    @Override
    public float score(int doc, float freq) throws IOException {
      // if there are no norms, we act as if b=0
      float norm;
      if (norms == null) {
        norm = k1;
      } else {
        int normsDocID = norms.docID();
        if (normsDocID < doc) {
          normsDocID = norms.advance(doc);
        }
        if (normsDocID == doc) {
          norm = cache[(byte)norms.longValue() & 0xFF];
        } else {
          norm = cache[0];
        }
      }
      return weightValue * freq / (freq + norm);
    }

