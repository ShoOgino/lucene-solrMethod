    int getShardIndex(ScoreDoc scoreDoc) {
      if (useScoreDocIndex) {
        assert scoreDoc.shardIndex != -1 : "scoreDoc shardIndex must be predefined set but wasn't";
        return scoreDoc.shardIndex;
      } else {
        assert scoreDoc.shardIndex == -1 : "scoreDoc shardIndex must be undefined but wasn't";
        return shardIndex;
      }
    }

