    public MultiPhraseWeight(IndexSearcher searcher, boolean needsScores, float boost)
      throws IOException {
      super(MultiPhraseQuery.this);
      this.needsScores = needsScores;
      this.similarity = searcher.getSimilarity(needsScores);
      final IndexReaderContext context = searcher.getTopReaderContext();

      // compute idf
      ArrayList<TermStatistics> allTermStats = new ArrayList<>();
      for(final Term[] terms: termArrays) {
        for (Term term: terms) {
          TermContext termContext = termContexts.get(term);
          if (termContext == null) {
            termContext = TermContext.build(context, term);
            termContexts.put(term, termContext);
          }
          TermStatistics termStatistics = searcher.termStatistics(term, termContext);
          if (termStatistics != null) {
            allTermStats.add(termStatistics);
          }
        }
      }
      if (allTermStats.isEmpty()) {
        stats = null; // none of the terms were found, we won't use sim at all
      } else {
        stats = similarity.computeWeight(
          boost,
          searcher.collectionStatistics(field),
          allTermStats.toArray(new TermStatistics[allTermStats.size()]));
      }
    }

