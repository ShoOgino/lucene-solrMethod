  @Override
  public int score(LeafCollector collector, int min, int max) throws IOException {
    fakeScorer.doc = -1;
    collector.setScorer(fakeScorer);

    BulkScorerAndDoc top = advance(min);
    while (top.next < max) {

      final int windowBase = top.next & ~MASK; // find the window that the next match belongs to
      final int windowMin = Math.max(min, windowBase);
      final int windowMax = Math.min(max, windowBase + SIZE);

      // general case
      scoreWindow(collector, windowBase, windowMin, windowMax);
      top = head.top();
    }

    return top.next;
  }

