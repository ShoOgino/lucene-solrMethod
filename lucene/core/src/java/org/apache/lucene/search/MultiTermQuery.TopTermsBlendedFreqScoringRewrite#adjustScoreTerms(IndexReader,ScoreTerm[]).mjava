    @Override
    void adjustScoreTerms(IndexReader reader, ScoreTerm[] scoreTerms) {
      if (scoreTerms.length <= 1) {
        return;
      }
      int maxDoc = reader.maxDoc();
      int maxDf = 0;
      long maxTtf = 0;
      for (ScoreTerm scoreTerm : scoreTerms) {
        TermContext ctx = scoreTerm.termState;
        int df = ctx.docFreq();
        maxDf = Math.max(df, maxDf);
        long ttf = ctx.totalTermFreq();
        maxTtf = ttf == -1 || maxTtf == -1 ? -1 : Math.max(ttf, maxTtf);
      }

      assert maxDf >= 0 : "DF must be >= 0";
      if (maxDf == 0) {
        return; // we are done that term doesn't exist at all
      }
      assert (maxTtf == -1) || (maxTtf >= maxDf);

      for (int i = 0; i < scoreTerms.length; i++) {
        TermContext ctx = scoreTerms[i].termState;
        ctx = adjustFrequencies(ctx, maxDf, maxTtf);

        ScoreTerm adjustedScoreTerm = new ScoreTerm(ctx);
        adjustedScoreTerm.boost = scoreTerms[i].boost;
        adjustedScoreTerm.bytes.copyBytes(scoreTerms[i].bytes);
        scoreTerms[i] = adjustedScoreTerm;
      }
    }

