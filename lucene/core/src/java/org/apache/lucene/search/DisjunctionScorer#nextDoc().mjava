  @Override
  public final int nextDoc() throws IOException {
    assert doc != NO_MORE_DOCS;

    ScorerWrapper top = subScorers.top();
    final int doc = this.doc;
    while (top.doc == doc) {
      top.doc = top.scorer.nextDoc();
      if (top.doc == NO_MORE_DOCS) {
        subScorers.pop();
        if (subScorers.size() == 0) {
          return this.doc = NO_MORE_DOCS;
        }
        top = subScorers.top();
      } else {
        top = subScorers.updateTop();
      }
    }

    freq = -1;
    return this.doc = top.doc;
  }

