    @Override
    protected Object createValue(AtomicReader reader, Entry entryKey, boolean setDocsWithField)
        throws IOException {

      ShortParser parser = (ShortParser) entryKey.custom;
      if (parser == null) {
        // Confusing: must delegate to wrapper (vs simply
        // setting parser = DEFAULT_SHORT_PARSER) so cache
        // key includes DEFAULT_SHORT_PARSER:
        return wrapper.getShorts(reader, entryKey.field, DEFAULT_SHORT_PARSER, setDocsWithField);
      }

      final ShortParser finalParser = parser;

      final short[] values = new short[reader.maxDoc()];
      Uninvert u = new Uninvert() {
        private short currentValue;

        @Override
        public void visitTerm(BytesRef term) {
          currentValue = finalParser.parseShort(term);
        }

        @Override
        public void visitDoc(int docID) {
          values[docID] = currentValue;
        }
      };

      u.uninvert(reader, entryKey.field, setDocsWithField);

      if (setDocsWithField) {
        wrapper.setDocsWithField(reader, entryKey.field, u.docsWithField);
      }

      return new ShortsFromArray(values);
    }

