  /** Create a conjunction over the provided iterators, taking advantage of
   *  {@link TwoPhaseIterator}. */
  public static ConjunctionDISI intersect(List<? extends DocIdSetIterator> iterators) {
    final List<DocIdSetIterator> allIterators = new ArrayList<>();
    final List<TwoPhaseIterator> twoPhaseIterators = new ArrayList<>();
    for (DocIdSetIterator iterator : iterators) {
      TwoPhaseIterator twoPhaseIterator = null;
      if (iterator instanceof Scorer) { 
        twoPhaseIterator = ((Scorer) iterator).asTwoPhaseIterator();
      } else if (iterator instanceof Spans) {
        twoPhaseIterator = ((Spans) iterator).asTwoPhaseIterator();
      }
      if (twoPhaseIterator != null) {
        allIterators.add(twoPhaseIterator.approximation());
        twoPhaseIterators.add(twoPhaseIterator);
      } else { // no approximation support, use the iterator as-is
        allIterators.add(iterator);
      }
    }

    if (twoPhaseIterators.isEmpty()) {
      return new ConjunctionDISI(allIterators);
    } else {
      return new TwoPhase(allIterators, twoPhaseIterators);
    }
  }

