    public void replay(Collector other) throws IOException {
      postCollection();
      if (!isCached()) {
        throw new IllegalStateException("cannot replay: cache was cleared because too much RAM was required");
      }
      assert docs.size() == contexts.size();
      for (int i = 0; i < contexts.size(); ++i) {
        final AtomicReaderContext context = contexts.get(i);
        final boolean docsInOrder = !acceptDocsOutOfOrders.get(i);
        final LeafCollector collector = other.getLeafCollector(context);
        if (!collector.acceptsDocsOutOfOrder() && !docsInOrder) {
          throw new IllegalArgumentException(
                "cannot replay: given collector does not support "
                    + "out-of-order collection, while the wrapped collector does. "
                    + "Therefore cached documents may be out-of-order.");
        }
        collect(collector, i);
      }
    }

