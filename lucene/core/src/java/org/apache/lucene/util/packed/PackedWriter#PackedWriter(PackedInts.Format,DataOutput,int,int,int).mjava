  PackedWriter(PackedInts.Format format, DataOutput out, int valueCount, int bitsPerValue, int mem) {
    super(out, valueCount, bitsPerValue);
    this.format = format;
    bulkOperation = BulkOperation.of(format, bitsPerValue);
    iterations = bulkOperation.computeIterations(valueCount, mem);
    nextBlocks = LongBuffer.allocate(iterations * bulkOperation.blocks());
    nextValues = LongBuffer.allocate(iterations * bulkOperation.values());
    written = 0;
    finished = false;
  }

