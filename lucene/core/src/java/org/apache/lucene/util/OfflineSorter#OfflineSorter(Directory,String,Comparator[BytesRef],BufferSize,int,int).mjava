  /**
   * All-details constructor.  If {@code valueLength} is -1 (the default), the length of each value differs; otherwise,
   * all values have the specified length.
   */
  public OfflineSorter(Directory dir, String tempFileNamePrefix, Comparator<BytesRef> comparator, BufferSize ramBufferSize, int maxTempfiles, int valueLength) {
    if (ramBufferSize.bytes < ABSOLUTE_MIN_SORT_BUFFER_SIZE) {
      throw new IllegalArgumentException(MIN_BUFFER_SIZE_MSG + ": " + ramBufferSize.bytes);
    }
    
    if (maxTempfiles < 2) {
      throw new IllegalArgumentException("maxTempFiles must be >= 2");
    }
    if (valueLength == -1) {
      buffer = new BytesRefArray(bufferBytesUsed);
    } else {
      if (valueLength == 0 || valueLength > Short.MAX_VALUE) {
        throw new IllegalArgumentException("valueLength must be 1 .. " + Short.MAX_VALUE + "; got: " + valueLength);
      }
      buffer = new FixedLengthBytesRefArray(valueLength);
    }
    this.valueLength = valueLength;
    this.ramBufferSize = ramBufferSize;
    this.maxTempFiles = maxTempfiles;
    this.comparator = comparator;
    this.dir = dir;
    this.tempFileNamePrefix = tempFileNamePrefix;
  }

