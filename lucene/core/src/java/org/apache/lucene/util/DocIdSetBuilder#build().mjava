  /**
   * Build a {@link DocIdSet} that contains all doc ids that have been added.
   * This method may return <tt>null</tt> if no documents were addded to this
   * builder.
   * NOTE: this is a destructive operation, the builder should not be used
   * anymore after this method has been called.
   */
  public DocIdSet build() {
    final DocIdSet result;
    if (denseSet != null) {
      result = new FixedBitDocIdSet(denseSet, denseSet.cardinality());
    } else if (sparseSet != null) {
      result = new SparseFixedBitDocIdSet(sparseSet, sparseSet.approximateCardinality());
    } else {
      result = null;
    }
    denseSet = null;
    sparseSet = null;
    costUpperBound = 0;
    return result;
  }

