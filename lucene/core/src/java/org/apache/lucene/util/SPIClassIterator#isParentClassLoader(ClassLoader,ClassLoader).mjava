  /**
   * Utility method to check if some class loader is a (grand-)parent of or the same as another one.
   * This means the child will be able to load all classes from the parent, too.
   * <p>
   * If Lucene's codebase doesn't have enough permissions to do the check, {@code false} is returned.
   */
  public static boolean isParentClassLoader(final ClassLoader parent, final ClassLoader child) {
    if (parent == child) {
      return true; // don't try to use AccessController for performance
    }
    return AccessController.doPrivileged((PrivilegedAction<Boolean>) () -> {
      try {
        ClassLoader cl = child;
        while (cl != null) {
          if (cl == parent) {
            return true;
          }
          cl = cl.getParent();
        }
        return false;
      } catch (SecurityException se) {
        return false;
      }
    });
  }

