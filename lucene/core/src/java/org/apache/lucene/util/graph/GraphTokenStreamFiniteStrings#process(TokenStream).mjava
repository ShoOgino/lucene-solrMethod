  /**
   * Builds automaton and builds the finite string token streams.
   */
  private List<TokenStream> process(final TokenStream in) throws IOException {
    build(in);

    List<TokenStream> tokenStreams = new ArrayList<>();
    final FiniteStringsIterator finiteStrings = new FiniteStringsIterator(det);
    for (IntsRef ids; (ids = finiteStrings.next()) != null; ) {
      tokenStreams.add(new FiniteStringsTokenStream(IntsRef.deepCopyOf(ids)));
    }

    return tokenStreams;
  }

