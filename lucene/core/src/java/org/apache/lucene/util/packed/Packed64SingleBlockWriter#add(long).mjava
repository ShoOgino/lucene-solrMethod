  @Override
  public void add(long v) throws IOException {
    assert v <= PackedInts.maxValue(bitsPerValue) : "v=" + v
        + " maxValue=" + PackedInts.maxValue(bitsPerValue);
    assert v >= 0;

    if (shift + bitsPerValue > Long.SIZE) {
      out.writeLong(pending);
      pending = 0;
      shift = 0;
    }
    pending |= v << shift;
    shift += bitsPerValue;
    ++written;
  }

