  /** 
   * Creates simple phrase query from the cached tokenstream contents 
   */
  private Query analyzePhrase(String field, TokenStream stream, int slop) throws IOException {
    PhraseQuery pq = newPhraseQuery();
    pq.setSlop(slop);
    
    TermToBytesRefAttribute termAtt = stream.getAttribute(TermToBytesRefAttribute.class);
    BytesRef bytes = termAtt.getBytesRef();

    PositionIncrementAttribute posIncrAtt = stream.getAttribute(PositionIncrementAttribute.class);
    int position = -1;    
    
    stream.reset();
    while (stream.incrementToken()) {
      termAtt.fillBytesRef();
      
      if (enablePositionIncrements) {
        position += posIncrAtt.getPositionIncrement();
        pq.add(new Term(field, BytesRef.deepCopyOf(bytes)), position);
      } else {
        pq.add(new Term(field, BytesRef.deepCopyOf(bytes)));
      }
    }
    
    return pq;
  }

