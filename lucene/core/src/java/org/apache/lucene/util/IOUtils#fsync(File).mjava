  /**
   * Ensure that any writes to the given file is written to the storage device that contains it.
   * @param fileToSync the file to fsync
   */
  public static void fsync(File fileToSync) throws IOException {
    IOException exc = null;
    for (int retry = 0; retry < 5; retry++) {
      try {
        try (FileChannel file = FileChannel.open(fileToSync.toPath(), StandardOpenOption.WRITE)) {
          file.force(true); // TODO: we probably dont care about metadata, but this is what we did before...
          return;
        }
      } catch (IOException ioe) {
        if (exc == null) {
          exc = ioe;
        }
        try {
          // Pause 5 msec
          Thread.sleep(5);
        } catch (InterruptedException ie) {
          ThreadInterruptedException ex = new ThreadInterruptedException(ie);
          ex.addSuppressed(exc);
          throw ex;
        }
      }
    }
    // Throw original exception
    throw exc;
  }

