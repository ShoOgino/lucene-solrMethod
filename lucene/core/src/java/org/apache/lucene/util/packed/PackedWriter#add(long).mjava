  @Override
  public void add(long v) throws IOException {
    assert v >= 0 && v <= PackedInts.maxValue(bitsPerValue);
    assert !finished;
    if (valueCount != -1 && written >= valueCount) {
      throw new EOFException("Writing past end of stream");
    }
    nextValues.put(v);
    if (nextValues.remaining() == 0) {
      flush();
    }
    ++written;
  }

