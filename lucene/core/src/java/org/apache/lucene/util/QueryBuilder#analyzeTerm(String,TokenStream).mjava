  /** 
   * Creates simple term query from the cached tokenstream contents 
   */
  private Query analyzeTerm(String field, TokenStream stream) throws IOException {
    TermToBytesRefAttribute termAtt = stream.getAttribute(TermToBytesRefAttribute.class);
    BytesRef bytes = termAtt.getBytesRef();
    
    stream.reset();
    if (!stream.incrementToken()) {
      throw new AssertionError();
    }
    
    termAtt.fillBytesRef();
    return newTermQuery(new Term(field, BytesRef.deepCopyOf(bytes)));
  }

