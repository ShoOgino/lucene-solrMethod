  /**
   * Add a document to this builder.
   * NOTE: doc IDs do not need to be provided in order.
   * NOTE: if you plan on adding several docs at once, look into using
   * {@link #grow(int)} to reserve space.
   */
  public void add(int doc) {
    if (bitSet != null) {
      bitSet.set(doc);
    } else {
      if (bufferSize + 1 > buffer.length) {
        if (bufferSize + 1 >= threshold) {
          upgradeToBitSet();
          bitSet.set(doc);
          return;
        }
        growBuffer(bufferSize+1);
      }
      buffer[bufferSize++] = doc;
    }
  }

