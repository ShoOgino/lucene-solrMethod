  /** Sort a single partition in-memory. */
  protected String sortPartition(TrackingDirectoryWrapper trackingDir) throws IOException {

    try (IndexOutput tempFile = trackingDir.createTempOutput(tempFileNamePrefix, "sort", IOContext.DEFAULT);
         ByteSequencesWriter out = getWriter(tempFile);) {
      
      BytesRef spare;

      long start = System.currentTimeMillis();
      BytesRefIterator iter = buffer.iterator(comparator);
      sortInfo.sortTime += (System.currentTimeMillis() - start);

      while ((spare = iter.next()) != null) {
        assert spare.length <= Short.MAX_VALUE;
        out.write(spare);
      }
      
      // Clean up the buffer for the next partition.
      buffer.clear();

      CodecUtil.writeFooter(out.out);

      return tempFile.getName();
    }
  }

