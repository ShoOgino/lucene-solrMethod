  /** Sort a single partition in-memory. */
  protected String sortPartition(TrackingDirectoryWrapper trackingDir) throws IOException {
    BytesRefArray data = this.buffer;

    try (IndexOutput tempFile = trackingDir.createTempOutput(tempFileNamePrefix, "sort", IOContext.DEFAULT)) {
      ByteSequencesWriter out = new ByteSequencesWriter(tempFile);
      BytesRef spare;

      long start = System.currentTimeMillis();
      BytesRefIterator iter = buffer.iterator(comparator);
      sortInfo.sortTime += (System.currentTimeMillis() - start);

      while ((spare = iter.next()) != null) {
        assert spare.length <= Short.MAX_VALUE;
        out.write(spare);
      }
      
      // Clean up the buffer for the next partition.
      data.clear();

      return tempFile.getName();
    }
  }

