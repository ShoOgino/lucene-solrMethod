  PackedReaderIterator(PackedInts.Format format, int valueCount, int bitsPerValue, DataInput in, int mem) {
    super(valueCount, bitsPerValue, in);
    this.format = format;
    bulkOperation = BulkOperation.of(format, bitsPerValue);
    iterations = bulkOperation.computeIterations(valueCount, mem);
    assert iterations > 0;
    nextBlocks = LongBuffer.allocate(iterations * bulkOperation.blocks());
    nextValues = new LongsRef(new long[iterations * bulkOperation.values()], 0, 0);
    nextValuesBuffer = LongBuffer.wrap(nextValues.longs);
    assert iterations * bulkOperation.values() == nextValues.longs.length;
    assert iterations * bulkOperation.blocks() == nextBlocks.capacity();
    nextValues.offset = nextValues.longs.length;
    position = -1;
  }

