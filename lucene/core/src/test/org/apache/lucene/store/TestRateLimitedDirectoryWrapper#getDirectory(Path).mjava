  @Override
  protected Directory getDirectory(Path path) {
    Directory in = newFSDirectory(path);
    if (in instanceof MockDirectoryWrapper) {
      // test manipulates directory directly
      ((MockDirectoryWrapper)in).setEnableVirusScanner(false);
    }
    RateLimitedDirectoryWrapper dir = new RateLimitedDirectoryWrapper(in);
    RateLimiter limiter = new RateLimiter.SimpleRateLimiter(.1 + 3*random().nextDouble());
    dir.setRateLimiter(limiter, IOContext.Context.MERGE);
    return dir;
  }

