  @Override
  protected Directory getDirectory(File path) throws IOException {
    final Directory dir;
    if (random().nextBoolean()) {
      dir = newDirectory();
    } else {
      dir = newFSDirectory(path);
    }
    if (dir instanceof MockDirectoryWrapper) {
      // test manipulates directory directly
      ((MockDirectoryWrapper)dir).setEnableVirusScanner(false);
    }
    return dir;
  }

