  public void testNextBitSet() {
    for (int i = 0; i < 10000; i++) {
      long[] bits = buildRandomBits();
      int numLong = bits.length - 1;

      // Verify nextBitSet with countBitsUpTo for all bit indexes.
      for (int bitIndex = -1; bitIndex < 64 * numLong; bitIndex++) {
        int nextIndex = BitUtil.nextBitSet(bits, numLong, bitIndex);
        if (nextIndex == -1) {
          assertEquals("No next bit set, so expected no bit count diff"
                  + " (i=" + i + " bitIndex=" + bitIndex + ")",
              BitUtil.countBitsUpTo(bits, numLong, bitIndex + 1), BitUtil.countBits(bits, numLong));
        } else {
          assertTrue("Expected next bit set at nextIndex=" + nextIndex
                  + " (i=" + i + " bitIndex=" + bitIndex + ")",
              BitUtil.isBitSet(bits, numLong, nextIndex));
          assertEquals("Next bit set at nextIndex=" + nextIndex
                  + " so expected bit count diff of 1"
                  + " (i=" + i + " bitIndex=" + bitIndex + ")",
              BitUtil.countBitsUpTo(bits, numLong, bitIndex + 1) + 1,
              BitUtil.countBitsUpTo(bits, numLong, nextIndex + 1));
        }
      }
    }
  }

