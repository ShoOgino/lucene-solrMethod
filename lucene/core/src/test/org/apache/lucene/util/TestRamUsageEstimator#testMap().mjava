  @AwaitsFix(bugUrl="https://issues.apache.org/jira/browse/LUCENE-8898")
  public void testMap() {
    Map<String, Object> map = new HashMap<>();
    map.put("primitive", 1234L);
    map.put("string", "string");
    for (int i = 0; i < 100; i++) {
      map.put("complex " + i, new Term("foo " + i, "bar " + i));
    }
    long actual = sizeOf(map);
    long estimated = RamUsageEstimator.sizeOfObject(map);
    assertEquals((double)actual, (double)estimated, (double)actual * 0.2);

    // test recursion
    map.put("self", map);
    actual = sizeOf(map);
    estimated = RamUsageEstimator.sizeOfObject(map);
    assertEquals((double)actual, (double)estimated, (double)actual * 0.2);
  }

