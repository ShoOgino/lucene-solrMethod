  public void testStartPositions() throws Exception {
    Directory dir = newDirectory();
    
    // mimic StopAnalyzer
    CharacterRunAutomaton stopSet = new CharacterRunAutomaton(new RegExp("the|a|of").toAutomaton());
    Analyzer analyzer = new MockAnalyzer(random, MockTokenizer.SIMPLE, true, stopSet, true);
    
    RandomIndexWriter writer = new RandomIndexWriter(random, dir, analyzer);
    Document doc = new Document();
    doc.add(newField("field", "the quick brown fox", TextField.TYPE_UNSTORED));
    writer.addDocument(doc);
    Document doc2 = new Document();
    doc2.add(newField("field", "quick brown fox", TextField.TYPE_UNSTORED));
    writer.addDocument(doc2);
    
    IndexReader reader = writer.getReader();
    IndexSearcher searcher = newSearcher(reader);
    
    // user queries on "starts-with quick"
    SpanQuery sfq = new SpanFirstQuery(new SpanTermQuery(new Term("field", "quick")), 1);
    assertEquals(1, searcher.search(sfq, 10).totalHits);
    
    // user queries on "starts-with the quick"
    SpanQuery include = new SpanFirstQuery(new SpanTermQuery(new Term("field", "quick")), 2);
    sfq = new SpanNotQuery(include, sfq);
    assertEquals(1, searcher.search(sfq, 10).totalHits);
    
    writer.close();
    reader.close();
    dir.close();
  }

