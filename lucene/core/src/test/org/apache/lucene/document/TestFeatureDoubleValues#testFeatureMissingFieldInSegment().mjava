  public void testFeatureMissingFieldInSegment() throws IOException {
    Directory dir = newDirectory();
    RandomIndexWriter writer = new RandomIndexWriter(random(), dir);
    Document doc = new Document();
    writer.addDocument(doc);
    writer.commit();
    IndexReader ir = writer.getReader();
    writer.close();
    
    assertEquals(1, ir.leaves().size());
    LeafReaderContext context = ir.leaves().get(0);
    DoubleValuesSource valuesSource = FeatureField.newDoubleValues("field", "name");
    DoubleValues values = valuesSource.getValues(context, null);

    assertFalse(values.advanceExact(0));
    assertFalse(values.advanceExact(1));

    ir.close();
    dir.close();
  }

