  // LUCENE-6299
  public void testDeleteAllAfterClose() throws Exception {
    setIndexWriterMaxDocs(2);
    try {
      Directory dir = newDirectory();
      IndexWriter w = new IndexWriter(dir, new IndexWriterConfig(null));
      w.addDocument(new Document());
      w.close();
      w = new IndexWriter(dir, new IndexWriterConfig(null));
      w.addDocument(new Document());
      try {
        w.addDocument(new Document());
        fail("didn't hit exception");
      } catch (IllegalArgumentException iae) {
        // expected
      }
      w.deleteAll();
      w.addDocument(new Document());
      w.addDocument(new Document());
      try {
        w.addDocument(new Document());
        fail("didn't hit exception");
      } catch (IllegalArgumentException iae) {
        // expected
      }
      w.close();
      dir.close();
    } finally {
      restoreIndexWriterMaxDocs();
    }
  }

