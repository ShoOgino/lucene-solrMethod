  @Test
  public void testMissingSnapshots() throws Exception {
    Directory dir = newDirectory();
    try {
      new PersistentSnapshotDeletionPolicy(
                                           new KeepOnlyLastCommitDeletionPolicy(), dir, OpenMode.APPEND);
      fail("did not hit expected exception");
    } catch (IllegalStateException ise) {
      // expected
    }
    dir.close();
  }

