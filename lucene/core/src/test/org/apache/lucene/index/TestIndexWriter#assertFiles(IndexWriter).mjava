  private static void assertFiles(IndexWriter writer) throws IOException {
    Predicate<String> filter = file -> file.startsWith("segments") == false && file.equals("write.lock") == false;
    // remove segment files we don't know if we have committed and what is kept around
    Set<String> segFiles = new HashSet<>(writer.segmentInfos.files(true)).stream()
        .filter(filter).collect(Collectors.toSet());
    Set<String> dirFiles = new HashSet<>(Arrays.asList(writer.getDirectory().listAll()))
        .stream().filter(filter).collect(Collectors.toSet());
    Set<String> s = new HashSet<>(segFiles);
    s.removeAll(dirFiles);
    assertEquals(segFiles.toString() + " vs "+ dirFiles.toString(), segFiles.size(), dirFiles.size());
  }

