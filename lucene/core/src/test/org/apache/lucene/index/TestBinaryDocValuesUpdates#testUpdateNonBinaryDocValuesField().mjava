  public void testUpdateNonBinaryDocValuesField() throws Exception {
    // we don't support adding new fields or updating existing non-binary-dv
    // fields through binary updates
    Directory dir = newDirectory();
    IndexWriterConfig conf = newIndexWriterConfig(new MockAnalyzer(random()));
    IndexWriter writer = new IndexWriter(dir, conf);
    
    Document doc = new Document();
    doc.add(new StringField("key", "doc", Store.NO));
    doc.add(new StringField("foo", "bar", Store.NO));
    writer.addDocument(doc); // flushed document
    writer.commit();
    writer.addDocument(doc); // in-memory document
    
    try {
      writer.updateBinaryDocValue(new Term("key", "doc"), "bdv", toBytes(17L));
      fail("should not have allowed creating new fields through update");
    } catch (IllegalArgumentException e) {
      // ok
    }
    
    try {
      writer.updateBinaryDocValue(new Term("key", "doc"), "foo", toBytes(17L));
      fail("should not have allowed updating an existing field to binary-dv");
    } catch (IllegalArgumentException e) {
      // ok
    }
    
    writer.shutdown();
    dir.close();
  }

