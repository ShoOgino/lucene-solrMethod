  public void testNoIndexSort() throws Exception {
    IndexWriterConfig iwc = newIndexWriterConfig();
    iwc.setIndexSort(new Sort(new SortField("foo", SortField.Type.INT)));
    Directory dir = newDirectory();
    IndexWriter w = new IndexWriter(dir, iwc);
    w.addDocument(new Document());
    DirectoryReader.open(w).close();
    w.addDocument(new Document());
    // this makes a sorted segment:
    w.forceMerge(1);
    // this makes another segment, so that MultiFields.getFields isn't just a no-op:
    w.addDocument(new Document());
    IndexReader r = DirectoryReader.open(w);
    
    Exception e = expectThrows(IllegalArgumentException.class, () -> {
        MultiFields.getFields(r);
      });
    assertTrue(e.getMessage().contains("cannot handle index sort"));
    assertTrue(e.getMessage().contains("indexSort=<int: \"foo\">"));
    r.close();
    w.close();
    dir.close();
  }

