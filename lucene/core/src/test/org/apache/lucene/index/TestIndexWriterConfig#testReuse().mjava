  @Test
  public void testReuse() throws Exception {
    Directory dir = newDirectory();
    // test that if the same IWC is reused across two IWs, it is cloned by each.
    IndexWriterConfig conf = newIndexWriterConfig(TEST_VERSION_CURRENT, null);
    RandomIndexWriter iw = new RandomIndexWriter(random(), dir, conf);
    LiveIndexWriterConfig liveConf1 = iw.w.getConfig();
    iw.close();
    
    iw = new RandomIndexWriter(random(), dir, conf);
    LiveIndexWriterConfig liveConf2 = iw.w.getConfig();
    iw.close();
    
    // LiveIndexWriterConfig's "copy" constructor doesn't clone objects.
    assertNotSame("IndexWriterConfig should have been cloned", liveConf1.getMergePolicy(), liveConf2.getMergePolicy());
    
    dir.close();
  }

