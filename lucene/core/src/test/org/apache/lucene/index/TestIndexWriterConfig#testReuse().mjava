  @Test
  public void testReuse() throws Exception {
    Directory dir = newDirectory();
    // test that IWC cannot be reused across two IWs
    IndexWriterConfig conf = newIndexWriterConfig(TEST_VERSION_CURRENT, null);
    new RandomIndexWriter(random(), dir, conf).shutdown();

    // this should fail
    try {
      assertNotNull(new RandomIndexWriter(random(), dir, conf));
      fail("should have hit AlreadySetException");
    } catch (AlreadySetException e) {
      // expected
    }

    dir.close();
  }

