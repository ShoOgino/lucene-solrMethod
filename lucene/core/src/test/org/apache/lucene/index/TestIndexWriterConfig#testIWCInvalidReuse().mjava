  public void testIWCInvalidReuse() throws Exception {
    IndexWriterConfig iwc = newIndexWriterConfig(TEST_VERSION_CURRENT, new MockAnalyzer(random()));
    Directory dir = newDirectory();
    RandomIndexWriter riw = new RandomIndexWriter(random(), dir, iwc);
    IndexWriterConfig privateIWC = riw.w.getConfig();
    riw.close();

    // Cannot clone IW's private IWC clone:
    try {
      new RandomIndexWriter(random(), dir, privateIWC);
      fail("did not hit expected exception");
    } catch (IllegalStateException ise) {
      // expected
    }
    dir.close();
  }

