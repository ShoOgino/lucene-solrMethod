  // LUCENE-3800
  @BadApple
  @AwaitsFix(bugUrl = "LUCENE-4280")
  public void testReaderChaining() throws Exception {
    assertTrue(reader.getRefCount() > 0);
    IndexReader wrappedReader = SlowCompositeReaderWrapper.wrap(reader);
    wrappedReader = new ParallelAtomicReader((AtomicReader) wrappedReader);

    // TODO: LUCENE-4280; this fails:
    IndexSearcher searcher = newSearcher(wrappedReader);
    // but with this it works: IndexSearcher searcher = new IndexSearcher(wrappedReader);

    TermRangeQuery query = TermRangeQuery.newStringRange("field", "a", "z", true, true);
    searcher.search(query, 5);
    reader.close(); // close original child reader
    try {
      searcher.search(query, 5);
    } catch (AlreadyClosedException ace) {
      assertEquals(
        "this IndexReader cannot be used anymore as one of its child readers was closed",
        ace.getMessage()
      );
    }
  }

