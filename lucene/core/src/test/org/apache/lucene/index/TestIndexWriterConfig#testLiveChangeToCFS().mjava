  public void testLiveChangeToCFS() throws Exception {
    Directory dir = newDirectory();
    IndexWriterConfig iwc = new IndexWriterConfig(TEST_VERSION_CURRENT, new MockAnalyzer(random()));
    iwc.setMergePolicy(newLogMergePolicy(true));

    // Start false:
    iwc.getMergePolicy().setNoCFSRatio(0.0); 
    IndexWriter w = new IndexWriter(dir, iwc);

    // Change to true:
    MergePolicy lmp = w.getConfig().getMergePolicy();
    lmp.setNoCFSRatio(1.0);
    lmp.setMaxCFSSegmentSizeMB(Double.POSITIVE_INFINITY);

    Document doc = new Document();
    doc.add(newStringField("field", "foo", Store.NO));
    w.addDocument(doc);
    w.commit();

    for(String file : dir.listAll()) {
      // frq file should be stuck into CFS
      assertFalse(file.endsWith(".frq"));
    }
    w.close();
    dir.close();
  }

