  public void testLiveChangeToCFS() throws Exception {
    Directory dir = newDirectory();
    IndexWriterConfig iwc = new IndexWriterConfig(TEST_VERSION_CURRENT, new MockAnalyzer(random()));
    iwc.setMergePolicy(newLogMergePolicy());

    // Start false:
    ((LogMergePolicy) iwc.getMergePolicy()).setUseCompoundFile(false); 
    IndexWriter w = new IndexWriter(dir, iwc);

    // Change to true:
    ((LogMergePolicy) w.getConfig().getMergePolicy()).setNoCFSRatio(1.0);
    ((LogMergePolicy) w.getConfig().getMergePolicy()).setUseCompoundFile(true);

    Document doc = new Document();
    doc.add(newStringField("field", "foo", Store.NO));
    w.addDocument(doc);
    w.commit();

    for(String file : dir.listAll()) {
      // frq file should be stuck into CFS
      assertFalse(file.endsWith(".frq"));
    }
    w.close();
    dir.close();
  }

