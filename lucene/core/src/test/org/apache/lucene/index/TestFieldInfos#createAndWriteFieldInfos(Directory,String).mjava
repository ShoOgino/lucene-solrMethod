  public FieldInfos createAndWriteFieldInfos(Directory dir, String filename) throws IOException{
  //Positive test of FieldInfos
    assertTrue(testDoc != null);
    FieldInfos.Builder builder = new FieldInfos.Builder();
    for (IndexableField field : testDoc.getFields()) {
      builder.addOrUpdate(field.name(), field.fieldType());
    }
    FieldInfos fieldInfos = builder.finish();
    //Since the complement is stored as well in the fields map
    assertTrue(fieldInfos.size() == DocHelper.all.size()); //this is all b/c we are using the no-arg constructor
    
    
    IndexOutput output = dir.createOutput(filename, newIOContext(random()));
    assertTrue(output != null);
    //Use a RAMOutputStream
  
    FieldInfosWriter writer = Codec.getDefault().fieldInfosFormat().getFieldInfosWriter();
    writer.write(dir, filename, "", fieldInfos, IOContext.DEFAULT);
    output.close();
    return fieldInfos;
  }

