  public FieldInfos createAndWriteFieldInfos(Directory dir, String filename) throws IOException{
  //Positive test of FieldInfos
    assertTrue(testDoc != null);
    FieldInfos fieldInfos = new FieldInfos(new FieldInfos.FieldNumberBiMap());
    _TestUtil.add(testDoc, fieldInfos);
    //Since the complement is stored as well in the fields map
    assertTrue(fieldInfos.size() == DocHelper.all.size()); //this is all b/c we are using the no-arg constructor
    
    
    IndexOutput output = dir.createOutput(filename, newIOContext(random()));
    assertTrue(output != null);
    //Use a RAMOutputStream
  
    FieldInfosWriter writer = Codec.getDefault().fieldInfosFormat().getFieldInfosWriter();
    writer.write(dir, filename, fieldInfos, IOContext.DEFAULT);
    output.close();
    return fieldInfos;
  }

