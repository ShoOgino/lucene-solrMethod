  private void checkFooters(Directory dir) throws IOException {
    SegmentInfos sis = new SegmentInfos();
    sis.read(dir);
    checkFooter(dir, sis.getSegmentsFileName());
    
    for (SegmentCommitInfo si : sis) {
      for (String file : si.files()) {
        checkFooter(dir, file);
        if (file.endsWith(IndexFileNames.COMPOUND_FILE_EXTENSION)) {
          // recurse into CFS
          try (CompoundFileDirectory cfsDir = new CompoundFileDirectory(si.info.getId(), dir, file, newIOContext(random()), false)) {
            for (String cfsFile : cfsDir.listAll()) {
              checkFooter(cfsDir, cfsFile);
            }
          }
        }
      }
    }
  }

