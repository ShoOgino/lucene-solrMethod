  public void testSimple() throws Exception {
    final String idField = "id";
    final String toField = "productId";

    Directory dir = newDirectory();
    RandomIndexWriter w = new RandomIndexWriter(
        random(),
        dir,
        newIndexWriterConfig(TEST_VERSION_CURRENT,
            new MockAnalyzer(random())).setMergePolicy(newLogMergePolicy()));

    // 0
    Document doc = new Document();
    doc.add(new Field("description", "random text", TextField.TYPE_UNSTORED));
    doc.add(new Field("name", "name1", TextField.TYPE_UNSTORED));
    doc.add(new Field(idField, "1", TextField.TYPE_UNSTORED));
    w.addDocument(doc);

    // 1
    doc = new Document();
    doc.add(new Field("price", "10.0", TextField.TYPE_UNSTORED));
    doc.add(new Field(idField, "2", TextField.TYPE_UNSTORED));
    doc.add(new Field(toField, "1", TextField.TYPE_UNSTORED));
    w.addDocument(doc);

    // 2
    doc = new Document();
    doc.add(new Field("price", "20.0", TextField.TYPE_UNSTORED));
    doc.add(new Field(idField, "3", TextField.TYPE_UNSTORED));
    doc.add(new Field(toField, "1", TextField.TYPE_UNSTORED));
    w.addDocument(doc);

    // 3
    doc = new Document();
    doc.add(new Field("description", "more random text", TextField.TYPE_UNSTORED));
    doc.add(new Field("name", "name2", TextField.TYPE_UNSTORED));
    doc.add(new Field(idField, "4", TextField.TYPE_UNSTORED));
    w.addDocument(doc);
    w.commit();

    // 4
    doc = new Document();
    doc.add(new Field("price", "10.0", TextField.TYPE_UNSTORED));
    doc.add(new Field(idField, "5", TextField.TYPE_UNSTORED));
    doc.add(new Field(toField, "4", TextField.TYPE_UNSTORED));
    w.addDocument(doc);

    // 5
    doc = new Document();
    doc.add(new Field("price", "20.0", TextField.TYPE_UNSTORED));
    doc.add(new Field(idField, "6", TextField.TYPE_UNSTORED));
    doc.add(new Field(toField, "4", TextField.TYPE_UNSTORED));
    w.addDocument(doc);

    IndexSearcher indexSearcher = new IndexSearcher(w.getReader());
    w.close();

    // Search for product
    Query joinQuery =
        JoinUtil.createJoinQuery(idField, false, toField, new TermQuery(new Term("name", "name2")), indexSearcher, ScoreMode.None);

    TopDocs result = indexSearcher.search(joinQuery, 10);
    assertEquals(2, result.totalHits);
    assertEquals(4, result.scoreDocs[0].doc);
    assertEquals(5, result.scoreDocs[1].doc);

    joinQuery = JoinUtil.createJoinQuery(idField, false, toField, new TermQuery(new Term("name", "name1")), indexSearcher, ScoreMode.None);
    result = indexSearcher.search(joinQuery, 10);
    assertEquals(2, result.totalHits);
    assertEquals(1, result.scoreDocs[0].doc);
    assertEquals(2, result.scoreDocs[1].doc);

    // Search for offer
    joinQuery = JoinUtil.createJoinQuery(toField, false, idField, new TermQuery(new Term("id", "5")), indexSearcher, ScoreMode.None);
    result = indexSearcher.search(joinQuery, 10);
    assertEquals(1, result.totalHits);
    assertEquals(3, result.scoreDocs[0].doc);

    indexSearcher.getIndexReader().close();
    dir.close();
  }

