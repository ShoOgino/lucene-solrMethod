  int buildIndex(File indexDir, IndexWriter indexWriter)
      throws IOException {
    File[] groupsDir = indexDir.listFiles();
    int i = 0;
    if (groupsDir != null) {
      for (File group : groupsDir) {
        String groupName = group.getName();
        File[] posts = group.listFiles();
        if (posts != null) {
          for (File postFile : posts) {
            String number = postFile.getName();
            NewsPost post = parse(postFile, groupName, number);
            if (post != null) {
              Document d = new Document();
              d.add(new StringField(CATEGORY_FIELD,
                  post.getGroup(), Field.Store.YES));
              d.add(new SortedDocValuesField(CATEGORY_FIELD,
                  new BytesRef(post.getGroup())));
              d.add(new TextField(SUBJECT_FIELD,
                  post.getSubject(), Field.Store.YES));
              d.add(new TextField(BODY_FIELD,
                  post.getBody(), Field.Store.YES));
              indexWriter.addDocument(d);
              i++;
            }
          }
        }
      }
    }
    indexWriter.commit();
    return i;
  }

