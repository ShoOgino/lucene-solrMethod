   @Override
   public void afterSuite(final TestDescriptor suite, TestResult result) {
      TestKey key = TestKey.of(suite);
      try {
         // if the test suite failed, report all captured output
         if (Objects.equals(result.getResultType(), TestResult.ResultType.FAILURE)) {
            reportFailure(suite, outputHandlers.get(key));
         }
      } catch (IOException e) {
         throw new UncheckedIOException("Error reading test suite output", e);
      } finally {
         OutputHandler writer = outputHandlers.remove(key);
         if (writer != null) {
            try {
               writer.close();
            } catch (IOException e) {
               LOGGER.error("Failed to close test suite's event writer for: " + key, e);
            }
         }
      }
   }

