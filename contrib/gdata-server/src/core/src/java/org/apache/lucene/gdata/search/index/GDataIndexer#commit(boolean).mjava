    /**
     * This method commits all changes to the index and closes all open
     * resources (e.g. IndexWriter and IndexReader). This method notifies all
     * registered Commit listeners if invoked.
     * 
     * @param optimize -
     *            <code>true</code> if the index should be optimized on this
     *            commit
     * @throws IOException -
     *             if an IOException occurs
     */
    protected synchronized void commit(boolean optimize) throws IOException {
        if (LOG.isInfoEnabled())
            LOG.info("Commit called with optimize = " + optimize);

        int changes = this.docsAdded.intValue() + this.docsDeleted.intValue()
                + this.docsUpdated.intValue();
        /*
         * don't call listeners to prevent unnecessary close / open of searchers
         */
        if (changes == 0)
            return;
        this.committed.incrementAndGet();
        if(optimize)
            this.optimized.incrementAndGet();
        doDeltete();
        if (optimize) {
            closeSearcher();
            openWriter();
            this.writer.optimize();
        }
        closeSearcher();
        closeWriter();
        this.docsAdded.set(0);
        this.docsDeleted.set(0);
        this.docsUpdated.set(0);
        notifyCommitListeners(this.serviceConfiguration.getName());

    }

