    /**
     * Sends a response for a get e.g. query request. This method must not
     * invoked in a case of an error performing the requested action.
     * 
     * @param feed -
     *            the feed to respond to the client
     * @param profile -
     *            the extension profile for the feed to write
     * @throws IOException -
     *             if an I/O exception occurs, often caused by an already
     *             closed Writer or OutputStream
     * 
     */
    public void sendResponse(BaseFeed feed, ExtensionProfile profile)
            throws IOException {
        if (feed == null)
            throw new IllegalArgumentException("feed must not be null");
        if (profile == null)
            throw new IllegalArgumentException(
                    "extension profile must not be null");
        DateTime time = feed.getUpdated();
        if (time != null)
            setLastModifiedHeader(time.getValue());
        XmlWriter writer = createWriter();
        
        if (this.outputFormat.equals(OutputFormat.ATOM)) {
            this.response.setContentType(XMLMIME_ATOM);
            feed.generateAtom(writer, profile);
        } else {
            this.response.setContentType(XMLMIME_RSS);
            feed.generateRss(writer, profile);
        }
        writer.close();
    }

