  private void doIndexAndSearchTest(File file, boolean setBZCompress,
      String bz2CompressVal) throws Exception {

    Properties props = new Properties();
    
    // LineDocMaker specific settings.
    props.setProperty("docs.file", file.getAbsolutePath());
    if (setBZCompress) {
      props.setProperty("bzip.compression", bz2CompressVal);
    }
    
    // Indexing configuration.
    props.setProperty("analyzer", SimpleAnalyzer.class.getName());
    props.setProperty("doc.maker", LineDocMaker.class.getName());
    props.setProperty("directory", "RAMDirectory");
    
    // Create PerfRunData
    Config config = new Config(props);
    PerfRunData runData = new PerfRunData(config);

    TaskSequence tasks = new TaskSequence(runData, "testBzip2", null, false);
    tasks.addTask(new CreateIndexTask(runData));
    tasks.addTask(new AddDocTask(runData));
    tasks.addTask(new CloseIndexTask(runData));
    tasks.doLogic();
    
    IndexSearcher searcher = new IndexSearcher(runData.getDirectory());
    TopDocs td = searcher.search(new TermQuery(new Term("body", "body")), 10);
    assertEquals(1, td.totalHits);
    assertNotNull(td.scoreDocs[0]);
    searcher.close();
  }

