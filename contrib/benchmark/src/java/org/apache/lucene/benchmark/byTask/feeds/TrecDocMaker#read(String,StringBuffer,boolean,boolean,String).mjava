  // read until finding a line that starts with the specified prefix
  protected StringBuffer read(String prefix, StringBuffer sb,
                              boolean collectMatchLine, boolean collectAll,
                              String terminatingTag) throws Exception {
    sb = (sb==null ? new StringBuffer() : sb);
    String sep = "";
    while (true) {
      String line = reader.readLine();
      if (line == null) {
        openNextFile();
        continue;
      }
      if (line.startsWith(prefix)) {
        if (collectMatchLine) {
          sb.append(sep).append(line);
          sep = NEW_LINE;
        }
        break;
      }
      
      if (terminatingTag != null && line.startsWith(terminatingTag)) {
    	  // didn't find the prefix that was asked, but the terminating
    	  // tag was found. set the length to 0 to signal no match was
    	  // found.
    	  sb.setLength(0);
    	  break;
      }
		

      if (collectAll) {
        sb.append(sep).append(line);
        sep = NEW_LINE;
      }
    }
    //System.out.println("read: "+sb);
    return sb;
  }

