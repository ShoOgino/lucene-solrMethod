  /**
   * Constructor given bounding rectangle and a rotation.
   */
  public Ellipse(Point2D p1, Point2D p2, double angle) {
    center = new Point2D();

    // Set the center
    center.x((p1.x() + p2.x()) * 0.5f);
    center.y((p1.y() + p2.y()) * 0.5f);

    // Find sin and cos of the angle
    double angleRad = Math.toRadians(angle);
    c = Math.cos(angleRad);
    s = Math.sin(angleRad);

    // Find the half lengths of the semi-major and semi-minor axes
    double dx = Math.abs(p2.x() - p1.x()) * 0.5;
    double dy = Math.abs(p2.y() - p1.y()) * 0.5;
    if (dx >= dy) {
      a = dx;
      b = dy;
    } else {
      a = dy;
      b = dx;
    }

    // Find k1, k2, k3 - define when a point x,y is on the ellipse
    k1 = SQR(c / a) + SQR(s / b);
    k2 = 2 * s * c * ((1 / SQR(a)) - (1 / SQR(b)));
    k3 = SQR(s / a) + SQR(c / b);
  }

