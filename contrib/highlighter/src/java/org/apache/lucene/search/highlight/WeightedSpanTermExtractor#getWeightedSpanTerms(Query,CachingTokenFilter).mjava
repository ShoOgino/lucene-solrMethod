  /**
   * Creates a Map of <code>WeightedSpanTerms</code> from the given <code>Query</code> and <code>TokenStream</code>.
   * 
   * <p>
   * 
   * @param query
   *          that caused hit
   * @param tokenStream
   *          of text to be highlighted
   * @return
   * @throws IOException
   */
  public Map getWeightedSpanTerms(Query query, CachingTokenFilter cachingTokenFilter)
      throws IOException {
    this.fieldName = null;
    this.tokenStream = cachingTokenFilter;

    Map terms = new PositionCheckingMap();
    try {
      extract(query, terms);
    } finally {
      closeReaders();
    }

    return terms;
  }

