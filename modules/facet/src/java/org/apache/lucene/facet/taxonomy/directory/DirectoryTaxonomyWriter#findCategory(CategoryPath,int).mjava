  /**
   * Look up the given prefix of the given category in the cache and/or the
   * on-disk storage, returning that prefix's ordinal, or a negative number in
   * case the category does not yet exist in the taxonomy.
   */
  private int findCategory(CategoryPath categoryPath, int prefixLen)
  throws IOException {
    int res = cache.get(categoryPath, prefixLen);
    if (res >= 0) {
      return res;
    }
    if (cacheIsComplete) {
      return -1;
    }
    cacheMisses++;
    if (perhapsFillCache()) {
      return cache.get(categoryPath, prefixLen);
    }
    if (reader == null) {
      reader = openReader();
    }
    Bits liveDocs = MultiFields.getLiveDocs(reader);
    DocsEnum docs = MultiFields.getTermDocsEnum(reader, liveDocs, Consts.FULL, 
                                                new BytesRef(categoryPath.toString(delimiter, prefixLen)),
                                                false);
    if (docs == null || docs.nextDoc() == DocIdSetIterator.NO_MORE_DOCS) {
      return -1; // category does not exist in taxonomy
    }
    addToCache(categoryPath, prefixLen, docs.docID());
    return docs.docID();
  }

