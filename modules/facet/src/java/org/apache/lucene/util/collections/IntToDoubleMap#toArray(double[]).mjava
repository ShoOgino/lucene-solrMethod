  /**
   * Translates the mapped pairs' values into an array of T
   * 
   * @param a
   *            the array into which the elements of the list are to be
   *            stored. If it is big enough use whatever space we need,
   *            setting the one after the true data as {@link Double#NaN}.
   * 
   * @return an array containing the elements of the list, using the given
   *         parameter if big enough, otherwise allocate an appropriate array
   *         and return it.
   * 
   */
  public double[] toArray(double[] a) {
    int j = 0;
    if (a.length < this.size()) {
      a = new double[this.size()];
    }

    // Iterates over the values, adding them to the array.
    for (DoubleIterator iterator = iterator(); iterator.hasNext(); ++j) {
      a[j] = iterator.next();
    }

    if (j < a.length) {
      a[j] = Double.NaN;
    }

    return a;
  }

