  static IndexReader createReaderWithNDocs(int nDocs, DocumentFactory docFactory) throws IOException {
    Directory ramDir = new RAMDirectory();

    // Create the index
    IndexWriter writer = new IndexWriter(ramDir, new IndexWriterConfig(TEST_VERSION_CURRENT, new KeywordAnalyzer()));
    for (int docNum = 0; docNum < nDocs; docNum++) {
      writer.addDocument(docFactory.getDoc(docNum));
    }
    writer.commit();
    writer.close();

    // Delete documents marked for deletion
    IndexReader reader = IndexReader.open(ramDir, false);
    reader.deleteDocuments(new Term(DocumentFactory.field, DocumentFactory.delTxt));
    reader.close();

    // Open a fresh read-only reader with the deletions in place
    return IndexReader.open(ramDir, true);
  }

