  /** Prepare index (in RAM/Disk) with some documents and some facets */
  protected final void initIndex(int partitionSize, boolean onDisk) throws Exception {
    if (VERBOSE) {
      System.out.println("Partition Size: " + partitionSize+"  onDisk: "+onDisk);
    }

    if (onDisk) {
      File indexFile = _TestUtil.getTempDir("index");
      indexDir = newFSDirectory(indexFile);
      taxoDir = newFSDirectory(new File(indexFile,"facets"));
    } else { 
      indexDir = newDirectory();
      taxoDir = newDirectory();
    }
    
    RandomIndexWriter iw = new RandomIndexWriter(random, indexDir, getIndexWriterConfig(getAnalyzer()));
    TaxonomyWriter taxo = new DirectoryTaxonomyWriter(taxoDir, OpenMode.CREATE);
    
    populateIndex(iw, taxo, getFacetIndexingParams(partitionSize));
    
    // commit changes (taxonomy prior to search index for consistency)
    taxo.commit();
    iw.commit();
    taxo.close();
    iw.close();
    
    // prepare for searching
    taxoReader = new DirectoryTaxonomyReader(taxoDir);
    indexReader = IndexReader.open(indexDir);
    searcher = newSearcher(indexReader);
  }

