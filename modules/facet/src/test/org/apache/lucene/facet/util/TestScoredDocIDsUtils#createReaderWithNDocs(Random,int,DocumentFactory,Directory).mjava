  static IndexReader createReaderWithNDocs(Random random, int nDocs, DocumentFactory docFactory, Directory dir) throws IOException {
    // Create the index
    RandomIndexWriter writer = new RandomIndexWriter(random, dir, newIndexWriterConfig(random, TEST_VERSION_CURRENT, 
        new MockAnalyzer(random, MockTokenizer.KEYWORD, false)));
    for (int docNum = 0; docNum < nDocs; docNum++) {
      writer.addDocument(docFactory.getDoc(docNum));
    }
    writer.close();

    // Delete documents marked for deletion
    IndexReader reader = IndexReader.open(dir, false);
    reader.deleteDocuments(new Term(DocumentFactory.field, DocumentFactory.delTxt));
    reader.close();

    // Open a fresh read-only reader with the deletions in place
    return IndexReader.open(dir, true);
  }

