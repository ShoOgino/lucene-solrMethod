  private void setAnalyzer() throws Exception {
    Analyzer wrappedAnalyzer = null;
    if (null == analyzerClassName || 0 == analyzerClassName.length()) {
      analyzerClassName = "org.apache.lucene.analysis.standard.StandardAnalyzer";
    } 
    if (-1 == analyzerClassName.indexOf(".")) {
      String coreClassName = "org.apache.lucene.analysis.core." + analyzerClassName;
      try {
        // If there is no package, first attempt to instantiate a core analyzer
        wrappedAnalyzer = NewAnalyzerTask.createAnalyzer(coreClassName);
        analyzerClassName = coreClassName;
      } catch (ClassNotFoundException e) {
        // If this is not a core analyzer, try the base analysis package 
        analyzerClassName = "org.apache.lucene.analysis." + analyzerClassName;
        wrappedAnalyzer = NewAnalyzerTask.createAnalyzer(analyzerClassName);
      }
    } else {    
      if (analyzerClassName.startsWith("standard.")) {
        analyzerClassName = "org.apache.lucene.analysis." + analyzerClassName;
      }
      wrappedAnalyzer = NewAnalyzerTask.createAnalyzer(analyzerClassName);
    }
    
    ShingleAnalyzerWrapper analyzer = new ShingleAnalyzerWrapper(
        wrappedAnalyzer,
        ShingleFilter.DEFAULT_MIN_SHINGLE_SIZE,
        maxShingleSize,
        ShingleFilter.TOKEN_SEPARATOR,
        outputUnigrams,
        false);
    getRunData().setAnalyzer(analyzer);
  }

