    public void setNextReader(IndexReader.AtomicReaderContext context) throws IOException {
      this.readerContext = context;
      groupIndex = FieldCache.DEFAULT.getTermsIndex(context.reader, groupField);
      for (int i = 0; i < fields.length; i++) {
        sortsIndex[i] = FieldCache.DEFAULT.getTermsIndex(context.reader, fields[i].getField());
      }

      // Clear ordSet and fill it with previous encountered groups that can occur in the current segment.
      ordSet.clear();
      segmentGroupHeads = new GroupHead[groupIndex.size()];
      for (GroupHead collectedGroup : collectedGroups) {
        int groupOrd = groupIndex.binarySearchLookup(collectedGroup.groupValue, scratchBytesRef);
        if (groupOrd >= 0) {
          ordSet.put(groupOrd);
          segmentGroupHeads[groupOrd] = collectedGroup;

          for (int i = 0; i < sortsIndex.length; i++) {
            collectedGroup.sortOrds[i] = sortsIndex[i].binarySearchLookup(collectedGroup.sortValues[i], scratchBytesRef);
          }
        }
      }
    }

